{"device":"DESKTOP","widgets":{"productsTable":{"t":"Table","lX":80,"lY":140,"sX":3.94,"sY":3.1,"s":"Manage Products","ps":{"enabled":"true","scalingType":"OK","width":"50% - 200px","height":"100% - 220px","x":"80px","y":"140px"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"name,expiry,weight per block","selectable":"multi","display header":"true","title":"All Products","form id":"products","form key":"all","enable search":"true","colWidths":"0.4155712841253792,0.16582406471183014,0.36804853387259856","auto scroll":"false"},"ev":{"clientEvents":{"inputEvents":{"New Event #1":{"channel":"masterDelRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{}}}},"companyProductsTable":{"t":"Table","lX":732,"lY":140,"sX":5.34,"sY":3.1,"s":"Manage Products","ps":{"enabled":"true","scalingType":"OK","width":"50% - 60px","height":"100% - 220px","x":"50% - 20px","y":"140px"},"ver":"190104c210519","dis":false,"tt":"","a":{"columns":"name,created on,created by,expiry,weight per block","selectable":"multi + single","text color":"#000000","row color":"#000000","display header":"true","title":"Company Products","form id":"products","form key":"company","enable search":"true","colWidths":"0.18577648766328012,0.18577648766328012,0.18432510885341075,0.13497822931785197,0.2365747460087083"},"ev":{"clientEvents":{"inputEvents":{"Delete Rows":{"channel":"compDelRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Select Row":{"channel":"selectCompRow/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"Icon#0":{"t":"Icon","lX":1953,"lY":85,"sX":1,"sY":1,"s":"Manage Products","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"5.2%","x":"100% - 430px","y":"85px"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"plus-square"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"newProdIcon/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"companyDropdown":{"t":"Dropdown","lX":2005,"lY":70,"sX":3,"sY":1,"s":"Manage Products","ps":{"enabled":"true","scalingType":"NOVERT","width":"300px","height":"6.26%","x":"100% - 378px","y":"70px"},"ver":"190104c210519","dis":false,"tt":"","a":{"label text":"Company","default options":"","form id":"products","form key":"compDrop"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"compSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"Container#1":{"t":"Container","lX":40,"lY":40,"sX":11.09,"sY":4.5,"s":"Manage Products","ps":{"enabled":"true","scalingType":"OK","width":"100%- 80px","height":"100%- 80px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Manage Company Products","color":"grey"},"ev":{}},"addToCompanyProducts":{"t":"Button","lX":1074,"lY":300,"sX":0.7,"sY":0.87,"s":"Manage Products","ps":{"enabled":"true","scalingType":"OK","width":"70px","height":"40px","x":"50% - 110px","y":"300px"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":">>","color":"grey"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"addCompanyProducts/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addToProducts":{"t":"Button","lX":1074,"lY":370,"sX":0.7,"sY":0.87,"s":"Manage Products","ps":{"enabled":"true","scalingType":"OK","width":"70px","height":"40px","x":"50% - 110px","y":"370px"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"<<","color":"grey"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"removeCompanyProducts/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"manageProductScript":{"t":"Scripting","lX":110,"lY":580,"sX":1,"sY":1,"s":"Manage Products","ps":{"enabled":"false","scalingType":"OK","width":"5.74%","height":"11.44%","x":"6.31%","y":"66.36%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","file name":"../../js/settings/manage products/manageProducts.js","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar productCollection;\nvar compProductCollection;\nvar currentCompany;\n\nvar companyProductClone;\nconst productsTable = Script.getWidget(\"productsTable\");\nconst compProductsTable = Script.getWidget(\"companyProductsTable\");\nconst compDropdown = Script.getWidget(\"companyDropdown\");\n\nScript.on(\"init\", function () {\n    Client.setScreenVisible(\"Edit Product\", false);\n    Client.setScreenVisible(\"Edit User Role\", false);\n    Client.setScreenVisible(\"Edit Error Codes\", false);\n    Client.setScreenVisible(\"Edit Company\", false);\n    Client.setScreenVisible(\"Edit Application Settings\", false);\n    Client.setScreenVisible(\"Edit Model Type\", false);\n    Client.setScreenVisible(\"Edit Model\", false);\n    Client.setScreenVisible(\"Edit User Access Role\", false);\n});\n\nScript.on('load', function () {\n    Database.readRecords(\"rodent\", \"Companies\", function (eventData) {\n        let companyCollection = SensaCollection.load(eventData.value);\n\n        Database.readRecords(\"rodent\", \"UserRoles\", function (eventData) {\n            let userCollection = SensaCollection.load(eventData.value);\n            let filteredUsers = userCollection.query((record, pk) => {\n                if (record['User'] == Client.getUser()) {\n                    return true;\n                }\n            });\n            var userCompanies = filteredUsers.getColumn(\"CompanyId\");\n\n            let filteredCompanies = companyCollection.query((record, pk) => {\n                //if (userCompanies.includes(pk)) {\n                return true;\n                //}\n            });\n\n            let compNames = filteredCompanies.getColumn(\"Name\");\n            let compLoc = filteredCompanies.getColumn(\"Address\");\n            let compIds = filteredCompanies.getColumn(\"Id\");\n\n            // Get from state if coming back from editing/creating\n            currentCompany = Script.getState(\"currentCompany\");\n            if (currentCompany == null) {\n                currentCompany = compIds[0];\n            }\n\n\n            let compObj = {};\n            compIds.map((comp, idx) => {\n                compObj[comp] = compNames[idx] + \", \" + compLoc[idx];\n            });\n\n            Object.keys(compObj).forEach((comp, idx) => {\n                filteredCompanies.set({ \"Id\": comp, \"Name\": compObj[comp] });\n            });\n\n            filteredCompanies.renameColumn(\"Name\", \"text\");\n            filteredCompanies.renameColumn(\"Id\", \"value\");\n\n            compDropdown.receiveTextValues(filteredCompanies);\n            compDropdown.receiveValue(compObj[currentCompany]);\n\n            Database.readRecords(\"rodent\", \"CompanyProducts\", function (eventData) {\n                compProductCollection = SensaCollection.load(eventData.value);\n                updateTable();\n            });\n        });\n    });\n\n    Database.readRecords(\"rodent\", \"Products\", function (eventData) {\n        productCollection = SensaCollection.load(eventData.value);\n        let filteredComps = productCollection.query((record, pk) => {\n            if (record['Status'] == '1') {\n                return true;\n            }\n        });\n        filteredComps.renameColumn(\"WeightPerBlock\", \"Weight Per Block\");\n        ClientEvents.publish(\"masterDelRows\", \"\");\n        //console.log(\"Working table object: \" + JSON.stringify(filteredComps,null, 4));\n        productsTable.receiveValue(filteredComps);\n    });\n});\n\nClientEvents.subscribe(\"addCompanyProducts\", addProductToCompany);\nClientEvents.subscribe(\"removeCompanyProducts\", removeProductFromCompany);\nClientEvents.subscribe(\"compSelected\", changeCompany);\nClientEvents.subscribe(\"selectCompRow\", editProduct);\nClientEvents.subscribe(\"newProdIcon\", createNewProduct);\n\nfunction addProductToCompany() {\n    var formData = Script.getFormByKey(\"products\");\n    var compData = formData.all;\n    //compData.renameColumn(\"Weight Per Block\", \"WeightPerBlock\");\n    //console.log(\"Data in the compound table \" + JSON.stringify(compData, null, 4));\n    compData.addColumn(\"companyid\");\n\n    var dbReq = {};\n    var compProdCount = Object.keys(compProductCollection.data).length;\n    let today = new Date().getTime();\n    //console.log(\"Created data is \" + today + \" l \" + JSON.stringify(today, null, 4));\n    //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n\n    compData.forEach(function (kvpair, pk) {\n        var prodObj = {};\n        // Check if product already exists with status = 0\n        let matchingProd = compProductCollection.query((record, pk) => {\n            if ((record['CompanyId'] == Script.getFormByKey(\"products\").compDrop) &&\n                (record['Name'] == kvpair.name) &&\n                (record['Expiry'] == kvpair.expiry) &&\n                (record['WeightPerBlock'] == kvpair.weightperblock) &&\n                (record['Status'] == '0')) {\n                return true;\n            }\n        });\n        if (Object.keys(matchingProd.data).length > 0) {\n            // found match, override\n            prodObj.Id = Object.keys(matchingProd.data)[0];\n\n        } else {\n            prodObj.Id = `${++compProdCount}`;\n        }\n        prodObj.Name = kvpair.name;\n        prodObj.Owner = kvpair.owner;\n        prodObj.Status = kvpair.status;\n        prodObj.CreatedOn = today;\n        prodObj.UpdatedOn = today;\n        prodObj.CreatedBy = Client.getUser();\n        prodObj.UpdatedBy = Client.getUser();\n        prodObj.CompanyId = formData.compDrop;\n        prodObj.Expiry = kvpair.expiry;\n        prodObj.LowerThreshold = kvpair.lowerthreshold;\n        prodObj.UpperThreshold = kvpair.upperthreshold;\n        prodObj.WeightPerBlock = kvpair.weightperblock;\n        dbReq[prodObj.Id] = prodObj;\n    });\n    Database.saveRecord(\"rodent\", \"CompanyProducts\", dbReq, () => {\n        Database.readRecords(\"rodent\", \"CompanyProducts\", function (eventData) {\n            compProductCollection = SensaCollection.load(eventData.value);\n            updateTable();\n        });\n    });\n}\n\nfunction updateTable() {\n    let filteredComps = compProductCollection.query((record, pk) => {\n        if ((record['CompanyId'] == currentCompany) &&\n            (record['Status'] == '1')) {\n            //record['CreatedOn'] = formatDate(record['CreatedOn']);\n            //console.log(\"Created \" + JSON.stringify(record['CreatedOn'], null, 4) + \" typw \" + typeof record['CreatedOn']);\n            // if (!isNaN(record['CreatedOn']) ) {\n            //      record['CreatedOn'] = formatDate(record['CreatedOn']);\n            //     console.log(\"Created \" + JSON.stringify(record['CreatedOn'], null, 4));\n            //     record['CreatedOn'] = formatDate(record['CreatedOn']);\n            // }\n            \n            return true;\n        }\n    });\n\n    //companyProductClone = compProductCollection.clone();\n    for (const key in filteredComps.data) {\n        var date = filteredComps.data[key][5];\n        console.log(\"Data is \" + date);\n        if(!isNaN(date) && date !== undefined && date !== \"\") {\n            console.log(\"Data is 2  \" + date);\n            filteredComps.data[key][5] = formatDate(date);\n        }\n    }\n    ///console.log(\"DATa is \" + JSON.stringify(compProductCollection, null, 4));\n\n\n\n    //console.log(\"Data in the compound is \" + JSON.stringify(filteredComps, null, 4));\n    //console.log(\"#1 data in the compound is \" + JSON.stringify(filteredComps, null, 4));\n    filteredComps.renameColumn(\"CreatedOn\", \"Created On\");\n    filteredComps.renameColumn(\"CreatedBy\", \"Created By\");\n    filteredComps.renameColumn(\"WeightPerBlock\", \"Weight Per Block\");\n    //console.log(\"#2 data in the compound is \" + JSON.stringify(filteredComps, null, 4));\n    //filteredComps.renameColumn(\"CreatedOn\", \"Created On\");\n    ClientEvents.publish(\"compDelRows\", \"\");\n\n    compProductsTable.receiveValue(filteredComps);\n}\n\nfunction removeProductFromCompany() {\n    var formData = Script.getFormByKey(\"products\");\n    var ids = formData.company.getColumn(\"id\");\n    for (var i = 0; i < ids.length; i++) {\n        compProductsTable.deleteRows(ids[i]);\n        let req = {};\n        req[{ \"Id\": ids[i], \"Status\": \"0\" }] = { \"Id\": ids[i], \"Status\": \"0\" };\n        Database.updateRecord(\"rodent\", \"CompanyProducts\", req);\n    }\n}\n\nasync function changeCompany(selected) {\n    currentCompany = selected.value;\n\n    Database.readRecords(\"rodent\", \"CompanyProducts\", function (eventData) {\n        compProductCollection = SensaCollection.load(eventData.value);\n        Script.setState(\"currentCompany\", currentCompany);\n        updateTable();\n    });\n}\n\nfunction editProduct(eventData) {\n    var key = Object.keys(eventData.value.data)[0];\n    eventData.value.data[key][5] = compProductCollection.data[key][5];\n    console.log(\"Event data is \" + JSON.stringify(eventData.value, null, 4));\n    Script.setState(\"compProductInfo\", eventData.value);\n    Script.setState(\"masterProduct\", \"product\");\n    Script.setState(\"modifyType\", \"edit\");\n    Client.jumpToScreen(\"Edit Product\");\n}\n\nfunction createNewProduct(eventData) {\n    Script.setState(\"modifyType\", \"add\");\n    Script.setState(\"masterProduct\", \"product\");\n    Script.setState(\"companyId\", currentCompany);\n    Client.jumpToScreen(\"Edit Product\");\n}\n\nfunction formatDate(today) {\n\n    //return Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n    var date = new Date(parseInt(today)).toLocaleString('en-GB');\n    var d = date.split(\", \");\n    var d0 = d[0].split(\"/\");\n    //d0[2] = Math.abs(d0[2] - 2000);\n    d0 = d0.join(\"/\");\n    //return d[1] + \" \" + d0;\n    return d0 + \" \" + d[1].substring(0, 5);\n}"},"ev":{"serverEvents":{"inputEvents":{"database":{"channel":"$DB/ADMIN/MANAGE/RESPONSE","event":"feed"}}}}},"Input#2":{"t":"Input","lX":80,"lY":100,"sX":3.5,"sY":1,"s":"Edit Product","ps":{"enabled":"true","scalingType":"NOVERT","width":"350px","height":"4.19%","x":"80px","y":"100px"},"ver":"270520c210519","dis":false,"tt":"","a":{"label text":"Name","color":"grey","form id":"editProduct","form key":"Name","required":"true"},"ev":{}},"Input#4":{"t":"Input","lX":80,"lY":200,"sX":3.5,"sY":1,"s":"Edit Product","ps":{"enabled":"true","scalingType":"NOVERT","width":"350px","height":"4.19%","x":"80px","y":"200px"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"number","label text":"Weight Per Block","color":"grey","form id":"editProduct","form key":"WeightPerBlock","required":"true"},"ev":{}},"Input#5":{"t":"Input","lX":80,"lY":300,"sX":3.5,"sY":1,"s":"Edit Product","ps":{"enabled":"true","scalingType":"NOVERT","width":"350px","height":"4.19%","x":"80px","y":"300px"},"ver":"270520c210519","dis":false,"tt":"","a":{"label text":"Expiry","color":"grey","type":"number","form id":"editProduct","form key":"Expiry","required":"true"},"ev":{}},"Input#6":{"t":"Input","lX":80,"lY":380,"sX":1,"sY":1,"s":"Edit Product","ps":{"enabled":"true","scalingType":"NOVERT","width":"100px","height":"4.19%","x":"80px","y":"380px"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","label text":"Enabled","color":"grey","checkbox label side":"right","form id":"editProduct","form key":"Status","default value":"1"},"ev":{}},"productFormContainer":{"t":"Container","lX":40,"lY":40,"sX":4.5,"sY":4.2,"s":"Edit Product","ps":{"enabled":"true","scalingType":"OK","width":"450px","height":"420px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Edit Product"},"ev":{}},"prodSubmitButton":{"t":"Button","lX":320,"lY":380,"sX":1,"sY":1.09,"s":"Edit Product","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"320px","y":"380px"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","button name":"Save"},"ev":{"clientEvents":{"inputEvents":{},"outputEvents":{"submitEdit":{"channel":"finishEditProduct/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"masterProductsTable":{"t":"Table","lX":80,"lY":120,"sX":13.43,"sY":6.76,"s":"Manage Master Products","ps":{"enabled":"true","scalingType":"OK","width":"100% - 160px","height":"100% - 200px","x":"80px","y":"120px"},"ver":"190104c210519","dis":false,"tt":"","a":{"columns":"name,expiry,weight per block","text color":"#000000","row color":"#000000","selectable":"multi + single","form id":"master","form key":"products","title":"All Products","display header":"true","colWidths":"0.325078793336335,0.32687978388113464,0.3255290409725349"},"ev":{"clientEvents":{"inputEvents":{"New Event #1":{"channel":"compDelRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Selected Product":{"channel":"productSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"deleteMasterProdIcon":{"t":"Icon","lX":2178,"lY":70,"sX":1,"sY":1,"s":"Manage Master Products","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"7.14%","x":"100% - 190px","y":"70px"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"trash","outline color":"no outline","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"removeMasterProducts/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addMasterProdIcon":{"t":"Icon","lX":2238,"lY":70,"sX":1,"sY":1,"s":"Manage Master Products","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"5.2%","x":"100% - 130px","y":"70px"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"plus-square"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"addNewMasterProduct/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"userRolesTable":{"t":"Table","lX":80,"lY":100,"sX":15.83,"sY":6.94,"s":"User Roles","ps":{"enabled":"true","scalingType":"OK","width":"100% - 160px","height":"100% - 180px","x":"80px","y":"100px"},"ver":"190104c210519","dis":false,"tt":"","a":{"form id":"roles","form key":"users","display header":"true","text color":"#000000","row color":"#000000","columns":"user,updated by,updated on,is admin,is primary","title":"User Roles","selectable":"multi + single","colWidths":"0.1940567312021612,0.194957226474561,0.1990094552003602,0.1940567312021612,0.19540747411076093"},"ev":{"clientEvents":{"inputEvents":{"New Event #1":{"channel":"usrDelRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"New Event #2":{"channel":"userEdit/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"usersCompanyDropdown":{"t":"Dropdown","lX":1998,"lY":84,"sX":3,"sY":1,"s":"User Roles","ps":{"enabled":"true","scalingType":"NOVERT","width":"300px","height":"6.26%","x":"100% - 385px","y":"84px"},"ver":"190104c210519","dis":false,"tt":"","a":{"default options":""},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"usrCcompSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"Icon#1":{"t":"Icon","lX":2193,"lY":50,"sX":1,"sY":1,"s":"User Roles","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"5.08%","x":"100% - 190px","y":"50px"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"trash","outline color":"no outline","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteUsers/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Scripting#7":{"t":"Scripting","lX":385,"lY":365,"sX":1,"sY":1,"s":"Edit User Role","ps":{"enabled":"false","scalingType":"OK","width":"4.2%","height":"7.9%","x":"16.07%","y":"49.45%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\n var userId;\n var modifyType;\n var companyId;\n var userData;\n \n const userFormContainer = Script.getWidget(\"userRoleContainer\");\n const userSubmitButton = Script.getWidget(\"userRoleSubmit\");\n const editUserSelect = Script.getWidget(\"editUserSelect\");\n const editUserCompSelect = Script.getWidget(\"editUserCompSelect\");\n const editUserIsAdmin = Script.getWidget(\"editUserIsAdmin\");\n //IsPrimaryCheck\n const IsPrimaryCheck = Script.getWidget(\"IsPrimaryCheck\");\n const cancelRoleButton = Script.getWidget(\"cancelRoleButton\");\n \n Script.on('load', function () {\n \n     //Script.setState(\"userRoleInfo\", eventData.value);\n     //console.log(\"User event data \" + JSON.stringify(eventData.value, null, 4));\n     //Script.setState(\"companyId\", currentCompany);\n     modifyType = Script.getState(\"modifyType\");\n     cancelRoleButton.subscribe(\"pressed\", () => {\n         Client.jumpToScreen(\"User Roles\");\n     });\n     if (modifyType == \"add\") {\n         userFormContainer.setTitle(\"New User Role\");\n \n         Database.readRecords(\"Directory\", \"users\", function (eventData) {\n             let userCollection = SensaCollection.load(eventData.value);\n             editUserSelect.receiveList(userCollection.getColumn(\"username\"));\n         });\n     } else if (modifyType == \"edit\") {\n         userData = Script.getState(\"userRoleInfo\");\n         //console.log(\"user role is \" + JSON.stringify(userData, null, 4));\n         userFormContainer.setTitle(\"Edit User Role\");\n         IsPrimaryCheck.receiveValue(userData.getColumn(\"is primary\")[0]);\n         editUserIsAdmin.receiveValue(userData.getColumn(\"is admin\")[0]);\n \n         //userFormContainer.setTitle(\"Edit User Role\");\n     }\n \n     Database.readRecords(\"rodent\", \"Companies\", function (eventData) {\n         let companyCollection = SensaCollection.load(eventData.value);\n         Database.readRecords(\"rodent\", \"UserRoles\", function (eventData) {\n             let userCollection = SensaCollection.load(eventData.value);\n             let filteredUsers = userCollection.query((record, pk) => {\n                 if (record['User'] == Client.getUser()) {\n                     return true;\n                 }\n             });\n             var userCompanies = filteredUsers.getColumn(\"CompanyId\");\n \n             let filteredCompanies = companyCollection;\n             // if a user is NOT an admin, only show the companies that the user is a part of\n             if (!(Client.getUser() == \"admin\" || Client.getUser() == \"devadmin@pestsense.com\")) {\n                 filteredCompanies = companyCollection.query((record, pk) => {\n                     if (userCompanies.includes(pk)) {\n                         return true;\n                     }\n                 });\n             }\n \n             let compNames = filteredCompanies.getColumn(\"Name\");\n             let compLoc = filteredCompanies.getColumn(\"Address\");\n             let compIds = filteredCompanies.getColumn(\"Id\");\n \n             companyId = Script.getState(\"companyId\");\n             if (companyId == null) {\n                 companyId = compIds[0];\n             }\n \n             let compObj = {};\n             compIds.map((comp, idx) => {\n                 compObj[comp] = compNames[idx] + \", \" + compLoc[idx];\n             });\n \n             Object.keys(compObj).forEach((comp, idx) => {\n                 filteredCompanies.set({ \"Id\": comp, \"Name\": compObj[comp] });\n             });\n \n             filteredCompanies.renameColumn(\"Name\", \"text\");\n             filteredCompanies.renameColumn(\"Id\", \"value\");\n \n             editUserCompSelect.receiveTextValues(filteredCompanies);\n             editUserCompSelect.receiveValue(filteredCompanies.get(companyId).text);\n             if (userData != undefined) {\n                 editUserSelect.receiveValue(userData.getColumn(\"user\")[0]);\n                 //Script.disableWidget(\"editUserSelect\");\n                 userId = userData.getColumn(\"id\")[0];\n             }\n         });\n     });\n });\n \n ClientEvents.subscribe(\"finishEditUser\", function () {\n     switch (modifyType) {\n         case 'edit':\n             handleEdit();\n             break;\n         case 'add':\n             handleCreate();\n             break;\n     }\n });\n \n function handleEdit() {\n     var formObj = Script.getFormByKey(\"editUser\");\n     if (formObj == undefined) {\n         alert(\"Please fill out all required fields\");\n         return;\n     }\n     var dbReq = {};\n     formObj.Id = userId;\n     let today = new Date().getTime();\n     //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n     formObj.UpdatedOn = today;\n     formObj.UpdatedBy = Client.getUser();\n     formObj.IsAdmin = +formObj.IsAdmin;\n     formObj.IsPrimary = +formObj.IsPrimary;\n     dbReq[userId] = formObj;\n \n     Database.updateRecord(\"rodent\", \"UserRoles\", dbReq, () => {\n         Script.setState(\"currentCompany\", formObj.CompanyId);\n         // Update the other records with this user to account for the IsAdmin field\n         Database.readRecords(\"rodent\", \"UserRoles\", function (eventData) {\n             eventData.value.forEach((record, pk) => {\n                 if (record.Id != userId) {\n                     let newReq = {};\n                     record.IsAdmin = +formObj.IsAdmin;\n                     newReq[userId] = record;\n                     Database.updateRecord(\"rodent\", \"UserRoles\", newReq);\n                 }\n             });\n             Client.jumpToScreen(\"User Roles\");\n         }, {\n             filter:\n                 `User='${userData.getColumn(\"user\")[0]}'`\n         }\n         );\n     });\n }\n \n function handleCreate() {\n     Database.readRecords(\"rodent\", \"UserRoles\", function (eventData) {\n         let userRoleCollection = SensaCollection.load(eventData.value);\n         var formObj = Script.getFormByKey(\"editUser\");\n         if (formObj == undefined) {\n             alert(\"Please fill out all required fields\");\n             return;\n         }\n         var dbReq = {};\n \n         let today = new Date().getTime();\n         //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n         console.log(JSON.stringify(userRoleCollection));\n         var idColumn = userRoleCollection.getColumn(\"Id\");\n         var id = 1;\n         if (!(idColumn == null || idColumn == undefined)) {\n             id = +userRoleCollection.getColumn(\"Id\").at(-1) + 1;\n         }\n         formObj.Id = `${id}`;\n         formObj.CreatedOn = today;\n         formObj.UpdatedOn = today;\n         formObj.Owner = Client.getUser();\n         formObj.CreatedBy = Client.getUser();\n         formObj.UpdatedBy = Client.getUser();\n         formObj.IsAdmin = +formObj.IsAdmin;\n         console.log(\"data before \" + formObj.IsPrimary);\n         formObj.IsPrimary = +formObj.IsPrimary;\n \n         console.log(\"data after \" + formObj.IsPrimary);\n \n         dbReq[id] = formObj;\n         Database.createRecords(\"rodent\", \"UserRoles\", dbReq, () => {\n             Script.setState(\"currentCompany\", formObj.CompanyId);\n             Database.readRecords(\"rodent\", \"UserRoles\", function (eventData) {\n                 eventData.value.forEach((record, pk) => {\n                     if (record.Id != userId) {\n                         let newReq = {};\n                         record.IsAdmin = +formObj.IsAdmin;\n                         newReq[userId] = record;\n                         Database.updateRecord(\"rodent\", \"UserRoles\", newReq);\n                     }\n                 });\n                 Client.jumpToScreen(\"User Roles\");\n             }, {\n                 filter:\n                     `User='${formObj.User}'`\n             }\n             );\n         });\n     });\n }"},"ev":{}},"userRoleContainer":{"t":"Container","lX":40,"lY":40,"sX":6.5,"sY":3.2,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"OK","width":"650px","height":"320px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Title"},"ev":{}},"userRoleSubmit":{"t":"Button","lX":525,"lY":240,"sX":1,"sY":1.09,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"525px","y":"260px"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","button name":"Save"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"finishEditUser/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"editUserCompSelect":{"t":"Dropdown","lX":80,"lY":170,"sX":5.5,"sY":1,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"550px","height":"4.19%","x":"80px","y":"170px"},"ver":"190104c210519","dis":false,"tt":"","a":{"label text":"Company","form id":"editUser","form key":"CompanyId","default options":""},"ev":{}},"editUserSelect":{"t":"Dropdown","lX":80,"lY":100,"sX":5.5,"sY":1,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"550px","height":"4.19%","x":"80px","y":"100px"},"ver":"190104c210519","dis":false,"tt":"","a":{"label text":"User","form id":"editUser","form key":"User","default options":""},"ev":{}},"Icon#2":{"t":"Icon","lX":1133,"lY":50,"sX":1,"sY":1,"s":"User Roles","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"6.89%","x":"100% - 130px","y":"50px"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"plus-square","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"newUser/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Scripting#0":{"t":"Scripting","lX":30,"lY":605,"sX":1,"sY":1,"s":"Error Codes","ps":{"enabled":"false","scalingType":"OK","width":"9.07%","height":"8.26%","x":"1.36%","y":"62.76%"},"ver":"200124c210519","z":"140","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nconst errorCodesTable = Script.getWidget(\"errorCodesTable\");\nconst troubleTable = Script.getWidget(\"troubleTable\");\nconst deviceModelDropdown = Script.getWidget(\"deviceModelDropdown\");\nconst errorColumns = [\"Id\", \"Code Id\", \"Description\", \"Troubleshooting Help\", \"Code Type\", \"CreatedBy\", \"UpdatedBy\", \"CreatedOn\", \"UpdatedOn\", \"Out of bounds\", \"Status\", \"Model Id\"];\nconst fileColumns = [\"Id\", \"File Location\", \"CreatedBy\", \"UpdatedBy\", \"CreatedAt\", \"Status\"];\n\nvar errorCollection;\nvar troubleFilesCollection;\n\nvar status = \"Show Active\";\nvar deviceModel;\nvar deviceModelMap = {};\n\nconst deleteCodes = {\n    \"errorCodesTable\": \"compDelErrorRows\",\n    \"troubleTable\": \"compDelFileRows\"\n};\n\nClientEvents.subscribe(\"errorCodeSelected\", editErrorCode);\nClientEvents.subscribe(\"addErrorCode\", createNewErrorCode);\nClientEvents.subscribe(\"troubleFileSelected\", editTroubleFile);\nClientEvents.subscribe(\"addTroubleFile\", createNewTroubleFile);\nClientEvents.subscribe(\"deleteErrorCodes\", removeErrorCode);\nClientEvents.subscribe(\"deleteTroubleFiles\", removeTroubleFiles);\nClientEvents.subscribe(\"deviceModelSelected\", setDeviceModel);\n\t\t\t\t\t   \nClientEvents.subscribe(\"changeActiveError\", (eventData) => {\n    status = eventData.value; \n    Database.readRecords(\"rodent\", \"ErrorCodes\", function(eventData) {\n        errorCollection = SensaCollection.load(eventData.value);\n        errorCollection.setColumns(errorColumns);\n        updateTable(errorCodesTable, errorCollection);\n    });\n    if (status !== \"Show Active\") {\n        // Do not attempt to delete inactive elements\n        Script.hideWidget(\"deleteErrorCodeIcon\");\n    } else {\n        // Re-enable widgets if hidden before\n        Script.showWidget(\"deleteErrorCodeIcon\");\n    }\n});\n\nClientEvents.subscribe(\"changeActiveFiles\", (eventData) => {\n    status = eventData.value; \n    Database.readRecords(\"rodent\", \"TroubleshootingFiles\", function(eventData) {\n        troubleFilesCollection = SensaCollection.load(eventData.value);\n        troubleFilesCollection.setColumns(fileColumns);\n        updateTable(troubleTable, troubleFilesCollection);\n    });\n    if (status !== \"Show Active\") {\n        // Do not attempt to delete inactive elements\n        Script.hideWidget(\"deleteTroubleFilesIcon\");\n    } else {\n        // Re-enable widgets if hidden before\n        Script.showWidget(\"deleteTroubleFilesIcon\");\n    }\n});\n\nScript.on('load', function() {\n\tDatabase.readRecords(\"rodent\", \"Model\", function (eventData) {\n\t\ttry{\n\t\t\tconsole.log(JSON.stringify(eventData,null,4));\n\t\t\tlet modelIds = eventData.value.getColumn(\"Id\");\n\t\t\tconsole.log(modelIds);\n\t\t\tlet modelNames = eventData.value.getColumn(\"Name\");\n\t\t\tconsole.log(modelNames);\n\t\t\tmodelNames.forEach((key, i) => deviceModelMap[key] = modelIds[i]);\n\n\t\t\tdeviceModelDropdown.receiveList(modelNames);\n\t\t\tdeviceModel = modelIds[0];\n\t\t\tScript.setState(\"errorDeviceModel\", deviceModel);\n\t\t} catch (error) {\n\t\t\tconsole.log(\"Error reading models\");\n\t\t\tconsole.log(error);\n\t\t}\n\t});\n\tDatabase.readRecords(\"rodent\", \"ErrorCodes\", function(eventData) {\n\t\ttry{\n\t\t\terrorCollection = SensaCollection.load(eventData.value);\n\t\t\terrorCollection.setColumns(errorColumns);\n\t\t\tupdateTable(errorCodesTable, errorCollection);\n\t\t\t\n\t\t} catch (error) {\n\t\t\tconsole.log(\"Error reading error codes\");\n\t\t}\n\t});\n\n\tDatabase.readRecords(\"rodent\", \"TroubleshootingFiles\", function(eventData) {\n\t\ttry {\n\t\t\ttroubleFilesCollection = SensaCollection.load(eventData.value);\n\t\t\ttroubleFilesCollection.setColumns(fileColumns);\n\t\t\tupdateTable(troubleTable, troubleFilesCollection);\n\t\t} catch (error) {\n\t\t\t console.log(\"Error reading troubleshooting files\");\n\t\t}\n\t});\n\n});\n\nfunction setDeviceModel(eventData) {\n\t\n\tdeviceModel = deviceModelMap[eventData.value];\n\t\n\tupdateTable(errorCodesTable, errorCollection);\n\tScript.setState(\"errorDeviceModel\", deviceModel); \n}\n\nfunction updateTable(table, collection) {\n\t\n\tconsole.log(\" receive are \" + JSON.stringify(collection, null, 4));\n    let filteredCollection = collection.query((record, pk) => {\n\t\tif (record[\"Model Id\"] == undefined) {\n\t\t\t// Troubleshooting file\n\t\t\tif (record['Status'] == (status == \"Show Active\")){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else {\n\t\t\t// Error Code\n\t\t\tif (record['Status'] == (status == \"Show Active\") && record[\"Model Id\"] == deviceModel){\n\t\t\t\treturn true;\n\t\t\t} \n\t\t\t\n\t\t}\n\t\t\n    });\n    \n    ClientEvents.publish(deleteCodes[table._name], \"\");\n    table.receiveValue(filteredCollection);\n}\n\nfunction editErrorCode(eventData) {\n    Script.setState(\"errorData\", eventData.value);\n    Script.setState(\"modifyType\", \"edit\");\n    Client.jumpToScreen(\"Edit Error Codes\");\n}\n\nfunction editTroubleFile(eventData) {\n    Script.setState(\"fileData\", eventData.value);\n    Script.setState(\"modifyType\", \"edit_file\");\n    Client.jumpToScreen(\"Edit Error Codes\");\n}\n\nfunction createNewErrorCode() {\n    Script.setState(\"modifyType\", \"add\");\n    Client.jumpToScreen(\"Edit Error Codes\");\n}\n\nfunction createNewTroubleFile() {\n    Script.setState(\"modifyType\", \"add_file\");\n    Client.jumpToScreen(\"Edit Error Codes\");\n}\n\nfunction removeErrorCode() {\n    var formData = Script.getFormByKey(\"errors\");\n    var ids = formData.codes.getColumn(\"id\");\n    /*for (var i = 0; i < ids.length; i++) {\n        errorCodesTable.deleteRows(ids[i]);\n        let req = {};\n        req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n        Database.updateRecord(\"rodent\", \"ErrorCodes\", req);\n    } */\n\t\n\tif(ids.length === 0) return;\n\t\n\tvar option = {\"confirmText\": \"Confirm\", \"cancelText\": \"Cancel\"};\n\tClient.confirm(\"Do you want to delete error code?\", \"Delete Error Codes\", option).then((eventData) => {\n\t\t\n\t\tconsole.log(\"Return data is  is \" + JSON.stringify(eventData, null, 4));\n\t\t\n\t\tif(!eventData) return;\n\t\tfor (var i = 0; i < ids.length; i++) {\n\t\t\terrorCodesTable.deleteRows(ids[i]);\n\t\t\t//let req = {};\n\t\t\t//req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n\t\t\t//Database.updateRecord(\"rodent\", \"Products\", req);\n\t\t\tDatabase.deleteRecord(\"rodent\", \"ErrorCodes\", \"Id\", ids[i]);\n\t\t}\n\t});\n}\n\nfunction removeTroubleFiles() {\n    debugger;\n    var formData = Script.getFormByKey(\"errors\");\n    var ids = formData.files.getColumn(\"id\");\n   /* for (var i = 0; i < ids.length; i++) {\n        troubleTable.deleteRows(ids[i]);\n        let req = {};\n        req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n        Database.updateRecord(\"rodent\", \"TroubleshootingFiles\", req);\n    } */\n\t\n\t\n\tif(ids.length === 0) return;\n\t\n\tvar option = {\"confirmText\": \"Confirm\", \"cancelText\": \"Cancel\"};\n\tClient.confirm(\"Do you want to delete trouble shooting file?\", \"Delete Trouble Shouting File\", option).then((eventData) => {\n\t\t\n\t\tconsole.log(\"Return data is  is \" + JSON.stringify(eventData, null, 4));\n\t\t\n\t\tif(!eventData) return;\n\t\tfor (var i = 0; i < ids.length; i++) {\n\t\t\ttroubleTable.deleteRows(ids[i]);\n\t\t\t//let req = {};\n\t\t\t//req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n\t\t\t//Database.updateRecord(\"rodent\", \"Products\", req);\n\t\t\tDatabase.deleteRecord(\"rodent\", \"TroubleshootingFiles\", \"Id\", ids[i]);\n\t\t}\n\t});\n\t\n}"},"ev":{}},"errorCodesTable":{"t":"Table","lX":80,"lY":130,"sX":7.51,"sY":6.74,"s":"Error Codes","ps":{"enabled":"true","scalingType":"OK","width":"50% - 120px","height":"100% - 200px","x":"80px","y":"130px"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"code id,description,troubleshooting help,code type,out of bounds","display header":"true","selectable":"multi + single","title":"Error Codes","form id":"errors","form key":"codes","colWidths":"0.09626168224299066,0.19532710280373833,0.27476635514018694,0.1485981308411215,0.2383177570093458"},"ev":{"clientEvents":{"inputEvents":{"Delete All Rows":{"channel":"compDelErrorRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Selected Error code":{"channel":"errorCodeSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"troubleTable":{"t":"Table","lX":912,"lY":130,"sX":7.51,"sY":6.74,"s":"Error Codes","ps":{"enabled":"true","scalingType":"OK","width":"50% - 120px","height":"100% - 200px","x":"50% + 40px","y":"130px"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"file location","display header":"true","colWidths":"0.9333333333333333","selectable":"multi + single","title":"Troubleshooting Files","form id":"errors","form key":"files","auto scroll":"false"},"ev":{"clientEvents":{"inputEvents":{"Delete All Rows":{"channel":"compDelFileRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Edit Row":{"channel":"troubleFileSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"deleteErrorCodeIcon":{"t":"Icon","lX":722,"lY":80,"sX":1,"sY":1,"s":"Error Codes","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"3.95%","x":"50% - 450px","y":"80px"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"trash","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteErrorCodes/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addErrorCodeIcon":{"t":"Icon","lX":772,"lY":80,"sX":1,"sY":1,"s":"Error Codes","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"3.95%","x":"50% - 400px","y":"80px"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"plus-square","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"addErrorCode/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"deleteTroubleFilesIcon":{"t":"Icon","lX":2203,"lY":80,"sX":1,"sY":1,"s":"Error Codes","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"3.95%","x":"100% - 170px","y":"80px"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"trash","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteTroubleFiles/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addTroubleFilesIcon":{"t":"Icon","lX":2233,"lY":80,"sX":1,"sY":1,"s":"Error Codes","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"3.95%","x":"100% - 120px","y":"80px"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"plus-square","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"addTroubleFile/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Scripting#1":{"t":"Scripting","lX":660,"lY":315,"sX":1,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"false","scalingType":"OK","width":"4.2%","height":"7.9%","x":"27.74%","y":"25.04%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar errorId;\nvar fileId;\nvar modifyType;\nvar deviceModelMap = {};\nconst errorContainer = Script.getWidget(\"errorContainer\");\nconst errorSubmitButton = Script.getWidget(\"errorSubmitButton\");\nconst troubleshootinghelp = Script.getWidget(\"troubleshootinghelp\");\nconst errorModelDropdown = Script.getWidget(\"errorModelDropdown\");\nconst cancelErrorCode = Script.getWidget(\"cancelErrorCode\");\nScript.on('load', function() {\n    // hide at start\n    hideErrorForm();\n    hideFileForm();\n\n\tcancelErrorCode.subscribe(\"pressed\", ()=> {\n\t\tClient.jumpToScreen(\"Error Codes\");\n\t});\n\t\n    modifyType = Script.getState(\"modifyType\");\n    if (modifyType == \"add_file\") {\n        errorContainer.setTitle(\"New Troubleshooting File\");\n        showFileForm();\n        return;\n    } else if (modifyType == \"edit_file\") {\n        var fileData = Script.getState(\"fileData\");\n        errorContainer.setTitle(\"Edit Troubleshooting File\");\n\n        var fileObj = {};\n        fileId = fileData.getColumn(\"id\")[0];\n        fileObj.FileLocation = fileData.getColumn(\"file location\");\n        fileObj.Status = fileData.getColumn(\"status\");\n        Script.setForm(\"filelocation\", fileObj);\n        showFileForm();\n        return;\n    }\n\n    showErrorForm();\n    Database.readRecords(\"rodent\", \"TroubleshootingFiles\", function(eventData) {\n        try{\n            let fileCollection = SensaCollection.load(eventData.value);\n            fileCollection = fileCollection.filter([\"Id\", \"FileLocation\"]);\n            fileCollection.setColumns([\"value\", \"text\"])\n            troubleshootinghelp.receiveTextValues(fileCollection);\n        } catch (error) {\n            console.log(\"No troubleshooting files set\");\n        }\n\t\t\n\t\tDatabase.readRecords(\"rodent\", \"Model\", function (eventData) {\n\t\t\tvar errorData;\n \n\t\t\tlet modelIds = eventData.value.getColumn(\"Id\");\n\t\t\tlet modelNames = eventData.value.getColumn(\"Name\");\n\t\t\tlet errorModels = eventData.value;\n\t\t\tmodelIds.forEach((key, i) => deviceModelMap[key] = modelNames[i]);\n\t\t\t\n\t\t\terrorModels.filter([\"Id\", \"Name\"]);\n\t\t\terrorModels.renameColumn(\"Name\", \"text\");\n\t\t\terrorModels.renameColumn(\"Id\", \"value\");\n\t\t\terrorModelDropdown.receiveTextValues(errorModels);\n\t\t\t\n\t\t\tif (modifyType == \"add\") {\n\t\t\t\terrorContainer.setTitle(\"New Error Code\");\n\t\t\t\treturn;\n\t\t\t} else if (modifyType == \"edit\") {\n\t\t\t\terrorData = Script.getState(\"errorData\");\n\t\t\t}\n\t\t\t\n\t\t\tvar errorObj = {}\n\t\t\terrorId = errorData.getColumn(\"id\")[0];\n\t\t\terrorObj.CodeId = errorData.getColumn(\"code id\");\n\t\t\terrorObj.Description = errorData.getColumn(\"description\");\n\t\t\terrorObj.Status = errorData.getColumn(\"status\");\n\t\t\tlet filteredFile = fileCollection.query((record, pk) => {\n\t\t\t\tif (record.value == errorData.getColumn(\"troubleshooting help\")[0]) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\terrorObj.TroubleshootingHelp = filteredFile.data[0];\n\t\t\terrorObj.CodeType = errorData.getColumn(\"code type\");\n\t\t\terrorObj.OOB = errorData.getColumn(\"out of bounds\");\n\t\t\t//errorObj.ModelId = errorData.getColumn(\"model id\")[0];\n\t\t\tScript.setForm(\"errorcode\", errorObj);\n\t\t\terrorModelDropdown.receiveValue(deviceModelMap[errorData.getColumn(\"model id\")[0]]);\n\t\t\terrorContainer.setTitle(\"Edit Error Code\");\n\t\t});\n    });\n});\n  \nClientEvents.subscribe(\"finishSubmitError\", function() {\n\tdebugger;\n    switch (modifyType) {\n        case 'edit':\n            handleEdit();\n            break;\n        case 'add':\n            handleCreate();\n            break;\n        case 'edit_file':\n            handleEditFile();\n            break;\n        case 'add_file':\n            handleCreateFile();\n            break;\n    }\n});\n  \nfunction handleEdit() {\n    var formObj = Script.getFormByKey(\"errorcode\");\n    if (formObj == undefined) {\n        alert(\"Please fill out all required fields\");\n        return;\n    }\n        \n    var dbReq = {};\n    formObj.Id = errorId;\n    formObj.Status = +formObj.Status;\n    let today = new Date().getTime();\n    //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n    formObj.UpdatedOn = today;\n    formObj.UpdatedBy = Client.getUser();\n    dbReq[errorId] = formObj;\n        \n    Database.updateRecord(\"rodent\", \"ErrorCodes\", dbReq, () => {\n        //Script.setState(\"currentCompany\", formObj.CompanyId);\n        Client.jumpToScreen(\"Error Codes\");\n    });\n}\n\nfunction handleEditFile() {\n    var formObj = Script.getFormByKey(\"filelocation\");\n    if (formObj == undefined) {\n        alert(\"Please fill out all required fields\");\n        return;\n    }\n    var dbReq = {};\n    formObj.Id = fileId;\n    formObj.Status = +formObj.Status;\n    formObj.UpdatedBy = Client.getUser();\n    dbReq[fileId] = formObj;\n        \n    Database.updateRecord(\"rodent\", \"TroubleshootingFiles\", dbReq, () => {\n        //Script.setState(\"currentCompany\", formObj.CompanyId);\n        Client.jumpToScreen(\"Error Codes\");\n    });\n}\n \n  \nfunction handleCreate() {\n    Database.readRecords(\"rodent\", \"ErrorCodes\", function(eventData) {\n        var errorCollection = SensaCollection.load(eventData.value);\n        var formObj = Script.getFormByKey(\"errorcode\");\n        \n        if (formObj == undefined) {\n            alert(\"Please fill out all required fields\");\n            return;\n        }\n\n        var dbReq = {};\n        var errorCount = Object.keys(errorCollection.data).length;\n        formObj.Id = `${errorCount + 1}`;\n        formObj.Status = +formObj.Status;\n\n        let today = new Date().getTime();\n        //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n        formObj.CreatedOn = today;\n        formObj.UpdatedOn = today;\n        formObj.CreatedBy = Client.getUser();\n        formObj.UpdatedBy = Client.getUser();\n        dbReq[errorCount + 1] = formObj;\n\n        Database.createRecords(\"rodent\", \"ErrorCodes\", dbReq, () => {\n            \n            Client.jumpToScreen(\"Error Codes\");\n        });\n    });\n}\n\nfunction handleCreateFile() {\n    Database.readRecords(\"rodent\", \"TroubleshootingFiles\", function(eventData) {\n        var fileCollection = SensaCollection.load(eventData.value);\n        var formObj = Script.getFormByKey(\"filelocation\");\n        \n        if (formObj == undefined) {\n            alert(\"Please fill out all required fields\");\n            return;\n        }\n\n        var dbReq = {};\n        var fileCount = Object.keys(fileCollection.data).length;\n        formObj.Id = `${fileCount + 1}`;\n        formObj.Status = +formObj.Status;\n\n        let today = new Date().getTime();\n        //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n        formObj.CreatedAt = today;\n        formObj.CreatedBy = Client.getUser();\n        formObj.UpdatedBy = Client.getUser();\n        dbReq[fileCount + 1] = formObj;\n\n        Database.createRecords(\"rodent\", \"TroubleshootingFiles\", dbReq, () => {\n            \n            Client.jumpToScreen(\"Error Codes\");\n        });\n    });\n}\n\nfunction hideErrorForm() {\n    Script.hideWidget(\"codeId\");\n    Script.hideWidget(\"desc\");\n    Script.hideWidget(\"troubleshootinghelp\");\n    Script.hideWidget(\"codetype\");\n    Script.hideWidget(\"oob\");\n\tScript.hideWidget(\"errorModelDropdown\");\n}\n\nfunction showErrorForm() {\n    Script.showWidget(\"codeId\");\n    Script.showWidget(\"desc\");\n    Script.showWidget(\"troubleshootinghelp\");\n    Script.showWidget(\"codetype\");\n    Script.showWidget(\"oob\");\n\tScript.showWidget(\"errorModelDropdown\");\n}\n\nfunction hideFileForm() {\n    Script.hideWidget(\"fileloc\");\n    Script.hideWidget(\"filestatus\");\n}\n\nfunction showFileForm() {\n    Script.showWidget(\"fileloc\");\n    Script.showWidget(\"filestatus\");\n}"},"ev":{}},"Input#3":{"t":"Input","lX":75,"lY":620,"sX":1,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"100px","height":"4.19%","x":"75px","y":"620px"},"ver":"270520c210519","dis":false,"tt":"","a":{"color":"grey","label text":"Enabled","type":"checkbox","checkbox label side":"right","default value":"1","form id":"errorcode","form key":"Status"},"ev":{}},"errorContainer":{"t":"Container","lX":40,"lY":40,"sX":6.5,"sY":7,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"OK","width":"650px","height":"700px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Title"},"ev":{}},"errorSubmitButton":{"t":"Button","lX":796,"lY":954,"sX":1,"sY":1.09,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"525px","y":"620px"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","button name":"Save"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"finishSubmitError/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"troubleshootinghelp":{"t":"Dropdown","lX":80,"lY":380,"sX":5.4,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"540px","height":"4.19%","x":"80px","y":"380px"},"ver":"190104c210519","z":"110","dis":false,"tt":"","a":{"default options":"","form id":"errorcode","form key":"TroubleshootingHelp","label text":"Troubleshooting Help","disable edit":"false"},"ev":{}},"codeId":{"t":"Input","lX":80,"lY":170,"sX":5.5,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"550px","height":"4.19%","x":"80px","y":"170px"},"ver":"270520c210519","dis":false,"tt":"","a":{"color":"grey","form id":"errorcode","label text":"Code ID","form key":"CodeId","type":"number","required":"true"},"ev":{}},"desc":{"t":"Input","lX":80,"lY":507,"sX":5.5,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"550px","height":"4.19%","x":"80px","y":"310px"},"ver":"270520c210519","z":"110","dis":false,"tt":"","a":{"color":"grey","form id":"errorcode","label text":"Description","form key":"Description","required":"true"},"ev":{}},"codetype":{"t":"Input","lX":80,"lY":450,"sX":5.5,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"550px","height":"4.19%","x":"80px","y":"450px"},"ver":"270520c210519","dis":false,"tt":"","a":{"color":"grey","form id":"errorcode","label text":"Code Type","form key":"CodeType","type":"number","required":"true"},"ev":{}},"oob":{"t":"Input","lX":80,"lY":520,"sX":5.5,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"550px","height":"4.19%","x":"80px","y":"520px"},"ver":"270520c210519","dis":false,"tt":"","a":{"color":"grey","form id":"errorcode","label text":"Out of Bounds","form key":"OOB","type":"number","required":"true"},"ev":{}},"fileloc":{"t":"Input","lX":80,"lY":100,"sX":5.5,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"550px","height":"4.19%","x":"80px","y":"100px"},"ver":"270520c210519","dis":false,"tt":"","a":{"color":"grey","form id":"filelocation","label text":"File Location","form key":"FileLocation","required":"true"},"ev":{}},"filestatus":{"t":"Input","lX":200,"lY":620,"sX":1.2,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"120px","height":"4.19%","x":"200px","y":"620px"},"ver":"270520c210519","dis":false,"tt":"","a":{"color":"grey","label text":"Enabled","type":"checkbox","checkbox label side":"right","default value":"1","form key":"Status","form id":"filelocation"},"ev":{}},"Scripting#2":{"t":"Scripting","lX":50,"lY":900,"sX":1,"sY":1,"s":"Manage Companies","ps":{"enabled":"false","scalingType":"OK","width":"","height":"","x":"","y":""},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nconst companiesTable = Script.getWidget(\"companiesTable\");\n \nvar companiesCollection;\n \nvar status = \"Show Active\";\n \nClientEvents.subscribe(\"editCompany\", editCompany);\nClientEvents.subscribe(\"addCompany\", addCompany);\nClientEvents.subscribe(\"deleteCompany\", deleteCompany);\nClientEvents.subscribe(\"changeActiveCompany\", (eventData) => {\n    status = eventData.value; \n    Database.readRecords(\"rodent\", \"Companies\", function(eventData) {\n        companiesCollection = SensaCollection.load(eventData.value);\n        updateTable(companiesTable, companiesCollection);\n    });\n\t\n    if (status !== \"Show Active\") {\n        // Do not attempt to delete inactive elements\n        Script.hideWidget(\"deleteCompanyIcon\");\n    } else {\n        // Re-enable widgets if hidden before\n        Script.showWidget(\"deleteCompanyIcon\");\n    } \n});\n \nScript.on('load', function() {\n\n    Database.readRecords(\"rodent\", \"Companies\", function(eventData) {\n        companiesCollection = SensaCollection.load(eventData.value);\n        updateTable(companiesTable, companiesCollection);\n    });\n});\n \nfunction updateTable(table, collection) {\n    let filteredCollection = collection.query((record, pk) => {\n        if (record['Status'] == (status == \"Show Active\")) {\n            return true;\n        }\n    });\n    \n    ClientEvents.publish(\"clearAllCompanies\", \"\");\n    table.receiveValue(filteredCollection);\n}\n \nfunction editCompany(eventData) {\n    Script.setState(\"companyData\", eventData.value);\n    Script.setState(\"modifyType\", \"edit\");\n    Client.jumpToScreen(\"Edit Company\");\n}\n\nfunction addCompany() {\n    Script.setState(\"modifyType\", \"add\");\n    Client.jumpToScreen(\"Edit Company\");\n}\n\nfunction deleteCompany() {\n    var formData = Script.getFormByKey(\"company\");\n    var ids = formData.company.getColumn(\"id\");\n    /*for (var i = 0; i < ids.length; i++) {\n        companiesTable.deleteRows(ids[i]);\n        let req = {};\n        req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n        Database.updateRecord(\"rodent\", \"Companies\", req);\n    } */\n\t\n\t\n\tif(ids.length === 0) return;\n\t\n\tvar option = {\"confirmText\": \"Confirm\", \"cancelText\": \"Cancel\"};\n\tClient.confirm(\"Do you want to delete company?\", \"Delete Companies\", option).then((eventData) => {\n\t\t\n\t\tconsole.log(\"Return data is  is \" + JSON.stringify(eventData, null, 4));\n\t\t\n\t\tif(!eventData) return;\n\t\tfor (var i = 0; i < ids.length; i++) {\n\t\t\tcompaniesTable.deleteRows(ids[i]);\n\t\t\t//let req = {};\n\t\t\t//req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n\t\t\t//Database.updateRecord(\"rodent\", \"Products\", req);\n\t\t\tDatabase.deleteRecord(\"rodent\", \"Companies\", \"Id\", ids[i]);\n\t\t}\n\t});\n\t\n\t\n}"},"ev":{}},"companiesTable":{"t":"Table","lX":80,"lY":100,"sX":15.83,"sY":6.94,"s":"Manage Companies","ps":{"enabled":"true","scalingType":"OK","width":"100% - 160px","height":"100% - 180px","x":"80px","y":"100px"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"name,address","form id":"company","form key":"company","title":"Companies","colWidths":"0.6441441441441441,0.3333333333333333","display header":"true","selectable":"multi + single"},"ev":{"clientEvents":{"inputEvents":{"Delete Rows":{"channel":"clearAllCompanies/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Edit Company":{"channel":"editCompany/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"deleteCompanyIcon":{"t":"Icon","lX":95,"lY":1128,"sX":1,"sY":1,"s":"Manage Companies","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"6.24%","x":"100% - 190px","y":"50px"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"trash","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteCompany/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addCompanyIcon":{"t":"Icon","lX":179,"lY":1128,"sX":1,"sY":1,"s":"Manage Companies","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"6.24%","x":"100% - 130px","y":"50px"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"plus-square"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"addCompany/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"companyContainer":{"t":"Container","lX":40,"lY":40,"sX":6.3,"sY":3.5,"s":"Edit Company","ps":{"enabled":"true","scalingType":"OK","width":"630px","height":"350px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Title"},"ev":{}},"Input#0":{"t":"Input","lX":140,"lY":162,"sX":5.5,"sY":1,"s":"Edit Company","ps":{"enabled":"true","scalingType":"NOVERT","width":"550px","height":"4.19%","x":"80px","y":"100px"},"ver":"270520c210519","dis":false,"tt":"","a":{"label text":"Name","color":"grey","form id":"companyform","form key":"Name","required":"true"},"ev":{}},"Input#1":{"t":"Input","lX":145,"lY":322,"sX":5.5,"sY":1,"s":"Edit Company","ps":{"enabled":"true","scalingType":"NOVERT","width":"550px","height":"4.19%","x":"80px","y":"170px"},"ver":"270520c210519","dis":false,"tt":"","a":{"label text":"Address","color":"grey","form id":"companyform","form key":"Address","required":"true"},"ev":{}},"Input#7":{"t":"Input","lX":75,"lY":270,"sX":1,"sY":1,"s":"Edit Company","ps":{"enabled":"true","scalingType":"NOVERT","width":"100px","height":"4.19%","x":"75px","y":"270px"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","checkbox label side":"right","label text":"Enabled","form id":"companyform","form key":"Status","default value":"1"},"ev":{}},"companySubmitButton":{"t":"Button","lX":525,"lY":270,"sX":1,"sY":1.09,"s":"Edit Company","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"525px","y":"270px"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","button name":"Submit"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"finishSubmitCompany/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"editUserIsAdmin":{"t":"Input","lX":75,"lY":240,"sX":1.2,"sY":1,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"120px","height":"4.19%","x":"75px","y":"260px"},"ver":"270520c210519","dis":false,"tt":"","a":{"label text":"Is Admin","type":"checkbox","checkbox label side":"right","form id":"editUser","form key":"IsAdmin"},"ev":{}},"deviceModelDropdown":{"t":"Dropdown","lX":532,"lY":70,"sX":3,"sY":1,"s":"Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"300px","height":"6.06%","x":"50% - 340px","y":"70px"},"ver":"190104c210519","dis":false,"tt":"","a":{"default options":""},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deviceModelSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"errorModelDropdown":{"t":"Dropdown","lX":80,"lY":240,"sX":5.4,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"540px","height":"6.06%","x":"80px","y":"240px"},"ver":"190104c210519","z":"110","dis":false,"tt":"","a":{"default options":"","form id":"errorcode","form key":"ModelId","label text":"Device Model","disable edit":"false"},"ev":{}},"modelTypesTable":{"t":"Table","lX":80,"lY":100,"sX":15.83,"sY":6.84,"s":"Manage Model Types","ps":{"enabled":"true","scalingType":"OK","width":"100% - 160px","height":"100% -  190px","x":"80px","y":"100px"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"name,question1,question2,question3","form id":"modelType","title":"Model Types","form key":"modelType","selectable":"multi + single","display header":"true","colWidths":""},"ev":{"clientEvents":{"inputEvents":{"Delete Modal Type":{"channel":"clearAllModalTypes/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Edit Modal Type":{"channel":"editModalType/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"deleteModalTypeIcon":{"t":"Icon","lX":2283,"lY":50,"sX":1,"sY":1,"s":"Manage Model Types","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"3.95%","x":"100% - 190px","y":"50px"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"trash","outline color":"no outline","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteModalType/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addModalTypeIcon":{"t":"Icon","lX":2193,"lY":50,"sX":1,"sY":1,"s":"Manage Model Types","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"3.95%","x":"100% - 130px","y":"50px"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"plus-square","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"addModalType/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"modelTypeSubmitButton":{"t":"Button","lX":535,"lY":315,"sX":1,"sY":1.09,"s":"Edit Model Type","ps":{"enabled":"false","scalingType":"OK","width":"100px","height":"50px","x":"525px","y":"170px"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","button name":"Save"},"ev":{"clientEvents":{"outputEvents":{"Submit":{"channel":"finishSubmitModalType/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"modelTypeContainer":{"t":"Container","lX":40,"lY":40,"sX":6.5,"sY":3.4,"s":"Edit Model Type","ps":{"enabled":"true","scalingType":"OK","width":"650px","height":"340px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Edit Model Type"},"ev":{}},"modelsTable":{"t":"Table","lX":80,"lY":100,"sX":13.43,"sY":2.68,"s":"Manage Device Models","ps":{"enabled":"true","scalingType":"OK","width":"100% - 160px","height":"100% - 180px","x":"80px","y":"100px"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"name,model type,battery upper,battery lower,icon url","form id":"models","form key":"models","selectable":"multi + single","display header":"true","title":"Models","colWidths":"0.189873417721519,0.19084712755598832,0.189873417721519,0.19084712755598832,0.189873417721519"},"ev":{"clientEvents":{"inputEvents":{"Delete all Rows":{"channel":"userDelModels/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Edit Model":{"channel":"editModel/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"modelTypesDropdown":{"t":"Dropdown","lX":900,"lY":305,"sX":3,"sY":1,"s":"Manage Device Models","ps":{"enabled":"true","scalingType":"NOVERT","width":"300px","height":"4.19%","x":"100% - 385px","y":"84px"},"ver":"190104c210519","dis":false,"tt":"","a":{"default options":""},"ev":{"clientEvents":{"outputEvents":{"Model Type Select":{"channel":"modelTypeSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"deleteModelIcon":{"t":"Icon","lX":2193,"lY":50,"sX":1,"sY":1,"s":"Manage Device Models","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"6.16%","x":"100% - 190px","y":"50px"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"trash","outline color":"no outline","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"Delete Model":{"channel":"deleteModel/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"modelTypeSelect":{"t":"Dropdown","lX":80,"lY":120,"sX":2.9,"sY":1,"s":"Edit Model","ps":{"enabled":"true","scalingType":"NOVERT","width":"290px","height":"10%","x":"80px","y":"125px"},"ver":"190104c210519","dis":false,"tt":"","a":{"form id":"modelForm","form key":"ModelType","default options":"","label text":"Model Type"},"ev":{}},"modelSubmit":{"t":"Button","lX":240,"lY":380,"sX":1,"sY":1.09,"s":"Edit Model","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"270px","y":"380px"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","outline color":"orange strong","button name":"Save"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"finishEditModel/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"modelFormContainer":{"t":"Container","lX":45,"lY":25,"sX":3.8,"sY":4.2,"s":"Edit Model","ps":{"enabled":"false","scalingType":"OK","width":"380px","height":"420px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Title"},"ev":{}},"addModalIcon":{"t":"Icon","lX":181,"lY":374,"sX":0.07,"sY":0.07,"s":"Manage Device Models","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"3.31","height":"7.3%","x":"14.3%","y":"51.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"plus-square","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"Add Model":{"channel":"addModel/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"activeModelTypeDropDown":{"t":"Dropdown","lX":1584,"lY":124,"sX":3,"sY":1,"s":"Manage Model Types","ps":{"enabled":"true","scalingType":"NOVERT","width":"300px","height":"4.19%","x":"100% - 385px","y":"84px"},"ver":"190104c210519","dis":false,"tt":"","a":{"default options":"Show Active, Show Inactive","default value":"Show Active"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"changeActiveModalType/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"modelTypeScript":{"t":"Scripting","lX":35,"lY":560,"sX":1,"sY":1,"s":"Manage Model Types","ps":{"enabled":"false","scalingType":"OK","width":"15.77%","height":"17.79%","x":"19.56%","y":"76.51%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nconst modelTypesTable = Script.getWidget(\"modelTypesTable\");\n \nvar modelTypesCollection;\n \nvar status = \"Show Active\";\n\nClientEvents.subscribe(\"editModalType\", editModalType);\nClientEvents.subscribe(\"addModalType\", addModalType);\nClientEvents.subscribe(\"deleteModalType\", deleteModalType);\nClientEvents.subscribe(\"changeActiveModalType\", (eventData) => {\n    status = eventData.value; \n    Database.readRecords(\"rodent\", \"ModelType\", function(eventData) {\n        modelTypesCollection = SensaCollection.load(eventData.value);\n        updateTable(modelTypesTable, modelTypesCollection);\n    });\n    if (status !== \"Show Active\") {\n        // Do not attempt to delete inactive elements\n        Script.hideWidget(\"deleteModalTypeIcon\");\n    } else {\n        // Re-enable widgets if hidden before\n        Script.showWidget(\"deleteModalTypeIcon\");\n    }\n});\n\nScript.on('load', function() {\n\tDatabase.readRecords(\"rodent\", \"ModelType\", function(eventData) {\n        modelTypesCollection = SensaCollection.load(eventData.value);\n\t\tupdateTable(modelTypesTable, modelTypesCollection);\n    });\n});\n\nfunction updateTable(table, collection) {\n    let filteredCollection = collection.query((record, pk) => {\n        if (record['Status'] == (status == \"Show Active\")) {\n            return true;\n        }\n    });\n    ClientEvents.publish(\"clearAllModalTypes\", \"\");\n    table.receiveValue(filteredCollection);\n}\n \nfunction editModalType(eventData) {\n    Script.setState(\"modelTypeData\", eventData.value);\n    Script.setState(\"modifyType\", \"edit\");\n    Client.jumpToScreen(\"Edit Model Type\");\n}\n\nfunction addModalType() {\n    Script.setState(\"modifyType\", \"add\");\n    Client.jumpToScreen(\"Edit Model Type\");\n}\n\nfunction deleteModalType() {\n    var formData = Script.getFormByKey(\"modelType\");\n    var ids = formData.modelType.getColumn(\"id\");\n   /** for (var i = 0; i < ids.length; i++) {\n        modelTypesTable.deleteRows(ids[i]);\n        let req = {};\n        req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n        Database.updateRecord(\"rodent\", \"ModelType\", req);\n    }\n\t*/\n\tif(ids.length === 0) return;\n\t\n\tvar option = {\"confirmText\": \"Confirm\", \"cancelText\": \"Cancel\"};\n\tClient.confirm(\"Do you want to delete model types?\", \"Delete Model Types\", option).then((eventData) => {\n\t\t\n\t\t//console.log(\"Return data is  is \" + JSON.stringify(eventData, null, 4));\n\t\t\n\t\tif(!eventData) return;\n\t\tfor (var i = 0; i < ids.length; i++) {\n\t\t\tmodelTypesTable.deleteRows(ids[i]);\n\t\t\t//let req = {};\n\t\t\t//req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n\t\t\t//Database.updateRecord(\"rodent\", \"Products\", req);\n\t\t\tDatabase.deleteRecord(\"rodent\", \"ModelType\", \"Id\", ids[i]);\n\t\t}\n\t});\n}"},"ev":{}},"modelTypeNameInput":{"t":"Input","lX":85,"lY":75,"sX":5.5,"sY":1,"s":"Edit Model Type","ps":{"enabled":"false","scalingType":"NOVERT","width":"550px","height":"11%","x":"80px","y":"100px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modalTypeForm","form key":"Name","required":"true","label text":"Name","color":"grey"},"ev":{}},"modelTypeEnabledCheckbox":{"t":"Input","lX":110,"lY":320,"sX":1,"sY":1,"s":"Edit Model Type","ps":{"enabled":"false","scalingType":"NOVERT","width":"100px","height":"11%","x":"75px","y":"170px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modalTypeForm","form key":"Status","type":"checkbox","default value":"1","label text":"Enabled","checkbox label side":"right"},"ev":{}},"modelTypeSubmitScript":{"t":"Scripting","lX":40,"lY":355,"sX":1,"sY":1,"s":"Edit Model Type","ps":{"enabled":"false","scalingType":"OK","width":"12.33%","height":"17.79%","x":"6.29%","y":"70.28%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description:\n * Create Author/Date:\n * Modified Author/Date Date:\n * Version:\n */\n\n/**\n * Initialise script state (run once at startup)\n */\n var modelTypeId;\n var modifyType;\n const modelTypeContainer = Script.getWidget(\"modelTypeContainer\");\n const modelTypeSubmitButton = Script.getWidget(\"modelTypeSubmitButton\");\n const cancelModelType = Script.getWidget(\"cancelModelType\");\n Script.on(\"load\", function () {\n   modifyType = Script.getState(\"modifyType\");\n   var modelTypeData;\n \n   cancelModelType.subscribe(\"pressed\", () => {\n     Client.jumpToScreen(\"Manage Model Types\");\n   });\n   if (modifyType == \"add\") {\n     modelTypeContainer.setTitle(\"New Model Type\");\n     return;\n   } else if (modifyType == \"edit\") {\n     modelTypeData = Script.getState(\"modelTypeData\");\n   }\n   var modelTypeObj = {};\n   modelTypeId = modelTypeData.getColumn(\"id\")[0];\n   modelTypeObj.Name = modelTypeData.getColumn(\"name\");\n   modelTypeObj.Status = modelTypeData.getColumn(\"status\");\n   modelTypeObj.IsSmart = modelTypeData.getColumn(\"issmart\");\n   modelTypeObj.IsDefault = modelTypeData.getColumn(\"isdefault\");\n   modelTypeObj.Question1 = modelTypeData.getColumn(\"question1\");\n   modelTypeObj.Question2 = modelTypeData.getColumn(\"question2\");\n   modelTypeObj.Question3 = modelTypeData.getColumn(\"question3\");\n \n   Script.setForm(\"modalTypeForm\", modelTypeObj);\n   modelTypeContainer.setTitle(\"Edit Model Type\");\n });\n \n ClientEvents.subscribe(\"finishSubmitModalType\", function () {\n   switch (modifyType) {\n     case \"edit\":\n       handleEdit();\n       break;\n     case \"add\":\n       handleCreate();\n       break;\n   }\n });\n \n function handleEdit() {\n   var formObj = Script.getFormByKey(\"modalTypeForm\");\n   if (formObj == undefined) {\n     alert(\"Please fill out all required fields\");\n     return;\n   }\n   var dbReq = {};\n   formObj.Id = modelTypeId;\n   formObj.Status = +formObj.Status;\n   formObj.IsSmart = +formObj.IsSmart;\n   formObj.IsDefault = +formObj.IsDefault;\n   let today = new Date().getTime();\n   //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n   formObj.UpdatedOn = today;\n   formObj.UpdatedBy = Client.getUser();\n   dbReq[modelTypeId] = formObj;\n   if (formObj.IsDefault == 1) {\n     var updateDefaultQuery = [\n       {\n         Sql: \"UPDATE ModelType SET IsDefault=0\",\n       },\n     ];\n     Database.cudParam(\n       \"Rodent\",\n       \"ModelType\",\n       updateDefaultQuery,\n       function (packet) {\n         Database.updateRecord(\"rodent\", \"ModelType\", dbReq, () => {\n           Client.jumpToScreen(\"Manage Model Types\");\n         });\n       }\n     );\n   } else {\n     Database.updateRecord(\"rodent\", \"ModelType\", dbReq, () => {\n       Client.jumpToScreen(\"Manage Model Types\");\n     });\n   }\n }\n \n function handleCreate() {\n   Database.readRecords(\"rodent\", \"ModelType\", function (eventData) {\n     var modelTypeCollection = SensaCollection.load(eventData.value);\n     var formObj = Script.getFormByKey(\"modalTypeForm\");\n     if (formObj == undefined) {\n       alert(\"Please fill out all required fields\");\n       return;\n     }\n     var dbReq = {};\n     var modelTypeCount = Object.keys(modelTypeCollection.data).length;\n     formObj.Id = `${modelTypeCount + 1}`;\n     formObj.Status = +formObj.Status;\n     formObj.IsSmart = +formObj.IsSmart;\n     formObj.IsDefault = +formObj.IsDefault;\n     let today = new Date();\n     today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n     formObj.CreatedOn = new Date().getTime();\n     formObj.UpdatedOn = new Date().getTime();\n     formObj.CreatedBy = Client.getUser();\n     formObj.UpdatedBy = Client.getUser();\n     dbReq[modelTypeCount + 1] = formObj;\n     if (formObj.IsDefault == 1) {\n       var updateDefaultQuery = [\n         {\n           Sql: \"UPDATE ModelType SET IsDefault=0\",\n         },\n       ];\n       Database.cudParam(\n         \"Rodent\",\n         \"ModelType\",\n         updateDefaultQuery,\n         function (packet) {\n           Database.createRecords(\"rodent\", \"ModelType\", dbReq, () => {\n             Client.jumpToScreen(\"Manage Model Types\");\n           });\n         }\n       );\n     } else {\n       Database.createRecords(\"rodent\", \"ModelType\", dbReq, () => {\n         Client.jumpToScreen(\"Manage Model Types\");\n       });\n     }\n   });\n }"},"ev":{}},"modelScript":{"t":"Scripting","lX":1100,"lY":35,"sX":1,"sY":1,"s":"Manage Device Models","ps":{"enabled":"false","scalingType":"OK","width":"4.2%","height":"7.9%","x":"41.96%","y":"4.34%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description:\n * Create Author/Date:\n * Modified Author/Date Date:\n * Version:\n */\n\n/**\n * Initialise script state (run once at startup)\n */\n\nvar modelCollection;\nvar currentModelType;\nvar modelTypesCollection;\n\nconst modelTypesTable = Script.getWidget(\"modelsTable\");\nconst compDropdown = Script.getWidget(\"modelTypesDropdown\");\n\nClientEvents.subscribe(\"modelTypeSelected\", changeModel);\nClientEvents.subscribe(\"deleteModel\", deleteModel);\nClientEvents.subscribe(\"editModel\", editModel);\nClientEvents.subscribe(\"addModel\", addModel);\n\nScript.on(\"load\", function () {\n  Database.readRecords(\"rodent\", \"ModelType\", function (eventData) {\n    modelTypesCollection = SensaCollection.load(eventData.value);\n    Database.readRecords(\"rodent\", \"Model\", function (eventData) {\n      modelCollection = SensaCollection.load(eventData.value);\n      currentModelType = Script.getState(\"currentModelType\");\n      let modelTypeNames = modelTypesCollection.getColumn(\"Name\");\n      let modelTypeIds = modelTypesCollection.getColumn(\"Id\");\n      if (currentModelType == null) {\n        currentModelType = modelTypeIds[0];\n      }\n      let modelTypeObj = {};\n      modelTypeIds.map((model, idx) => {\n        modelTypeObj[model] = modelTypeNames[idx];\n      });\n      Object.keys(modelTypeObj).forEach((model, idx) => {\n        modelTypesCollection.set({ Id: model, Name: modelTypeObj[model] });\n      });\n      modelTypesCollection.renameColumn(\"Name\", \"text\");\n      modelTypesCollection.renameColumn(\"Id\", \"value\");\n      compDropdown.receiveTextValues(modelTypesCollection);\n      compDropdown.receiveValue(modelTypeObj[currentModelType]);\n      modelTypesCollection.renameColumn(\"text\", \"Name\");\n      modelTypesCollection.renameColumn(\"value\", \"Id\");\n      updateTable();\n    });\n  });\n});\n\nfunction updateTable() {\n  let filteredModels = modelCollection.query((record, pk) => {\n    if (record[\"ModelType\"] == currentModelType && record[\"Status\"] == \"1\") {\n      return true;\n    }\n  });\n  let modelTypeName = modelTypesCollection\n    .query((modelType, pk) => {\n      if (modelType[\"Id\"] == currentModelType) {\n        return true;\n      }\n    })\n    .getFirst();\n  filteredModels.forEach((model, pk) => {\n    filteredModels.set({ Id: model[\"Id\"], ModelType: modelTypeName[\"Name\"] });\n  });\n  //name,model type,battery upper,battery lower\n  ClientEvents.publish(\"userDelModels\", \"\");\n  filteredModels.renameColumn(\"ModelType\", \"Model Type\");\n  filteredModels.renameColumn(\"BatteryUpper\", \"Battery Upper\");\n  filteredModels.renameColumn(\"BatteryLower\", \"Battery Lower\");\n  filteredModels.renameColumn(\"IconURL\", \"Icon Url\");\n  modelTypesTable.receiveValue(filteredModels);\n}\n\nfunction changeModel(selected) {\n  currentModelType = selected.value;\n  updateTable();\n}\n\nfunction deleteModel() {\n  let formData = Script.getFormByKey(\"models\");\n  var ids = formData.models.getColumn(\"id\");\n\n  if (ids.length === 0) return;\n\n  var option = { confirmText: \"Confirm\", cancelText: \"Cancel\" };\n  Client.confirm(\n    \"Do you want to delete device model?\",\n    \"Delete Device Model\",\n    option\n  ).then((eventData) => {\n    //console.log(\"Return data is  is \" + JSON.stringify(eventData, null, 4));\n\n    if (!eventData) return;\n    for (var i = 0; i < ids.length; i++) {\n      modelTypesTable.deleteRows(ids[i]);\n      Database.deleteRecord(\"rodent\", \"Model\", \"Id\", ids[i]);\n    }\n  });\n}\n\nfunction editModel(eventData) {\n  //filteredModels.renameColumn(\"Battery Upper\", \"BatteryUpper\");\n  //filteredModels.renameColumn(\"Battery Lower\", \"BatteryLower\");\n  var data = SensaCollection.load(eventData.value);\n  data.renameColumn(\"battery upper\", \"batteryupper\");\n  data.renameColumn(\"battery lower\", \"batterylower\");\n  data.renameColumn(\"icon url\", \"iconurl\");\n  console.log(\"modele info \" + JSON.stringify(data, null, 4));\n  Script.setState(\"modelInfo\", data); //eventData.value\n\n  Script.setState(\"currentModelType\", currentModelType);\n  Script.setState(\"modifyType\", \"edit\");\n  //filteredModels.renameColumn(\"Model Type\", \"ModelType\");\n  //filteredModels.renameColumn(\"Battery Upper\", \"BatteryUpper\");\n  //filteredModels.renameColumn(\"Battery Lower\", \"BatteryLower\");\n  Client.jumpToScreen(\"Edit Model\");\n}\n\nfunction addModel() {\n  Script.setState(\"currentModelType\", currentModelType);\n  Script.setState(\"modifyType\", \"add\");\n  Client.jumpToScreen(\"Edit Model\");\n}\n"},"ev":{}},"modelNameInput":{"t":"Input","lX":80,"lY":65,"sX":3,"sY":1,"s":"Edit Model","ps":{"enabled":"false","scalingType":"NOVERT","width":"300px","height":"10%","x":"80px","y":"100px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modelForm","form key":"Name","label text":"Name","required":"true","color":"grey"},"ev":{}},"modelSubmitScript":{"t":"Scripting","lX":945,"lY":310,"sX":1,"sY":1,"s":"Edit Model","ps":{"enabled":"false","scalingType":"OK","width":"8.41%","height":"17.79%","x":"8.41%","y":"77.58%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description:\n * Create Author/Date:\n * Modified Author/Date Date:\n * Version:\n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar userId;\nvar modifyType;\nvar modelTypeId;\nvar modelData;\n\nconst modelFormContainer = Script.getWidget(\"modelFormContainer\");\n//const userSubmitButton = Script.getWidget(\"userRoleSubmit\");\nconst modelTypeSelect = Script.getWidget(\"modelTypeSelect\");\nconst cancelModelBtn = Script.getWidget(\"cancelModelBtn\");\n\nScript.on(\"load\", function () {\n  cancelModelBtn.subscribe(\"pressed\", () => {\n    Client.jumpToScreen(\"Manage Device Models\");\n  });\n  modifyType = Script.getState(\"modifyType\");\n  if (modifyType == \"add\") {\n    modelFormContainer.setTitle(\"New User Role\");\n  } else if (modifyType == \"edit\") {\n    modelData = Script.getState(\"modelInfo\");\n    modelFormContainer.setTitle(\"Edit User Role\");\n    if (modelData != null) {\n      var modelObj = {};\n      modelObj.Name = modelData.getColumn(\"name\");\n      modelObj.BatteryLower = modelData.getColumn(\"batterylower\");\n      modelObj.BatteryUpper = modelData.getColumn(\"batteryupper\");\n      modelObj.IconURL = modelData.getColumn(\"iconurl\");\n      Script.setForm(\"modelForm\", modelObj);\n    }\n  }\n  Database.readRecords(\"rodent\", \"ModelType\", function (eventData) {\n    let modelTypesCollection = SensaCollection.load(eventData.value);\n    let modelTypeNames = modelTypesCollection.getColumn(\"Name\");\n    let modelTypeIds = modelTypesCollection.getColumn(\"Id\");\n    modelTypeId = Script.getState(\"currentModelType\");\n    if (modelTypeId == null) {\n      modelTypeId = compIds[0];\n    }\n    let modelTypeObj = {};\n    modelTypeIds.map((model, idx) => {\n      modelTypeObj[model] = modelTypeNames[idx];\n    });\n    Object.keys(modelTypeObj).forEach((model, idx) => {\n      modelTypesCollection.set({ Id: model, Name: modelTypeObj[model] });\n    });\n    modelTypesCollection.renameColumn(\"Name\", \"text\");\n    modelTypesCollection.renameColumn(\"Id\", \"value\");\n    modelTypeSelect.receiveTextValues(modelTypesCollection);\n    modelTypeSelect.receiveValue(modelTypesCollection.get(modelTypeId).text);\n  });\n});\n\nClientEvents.subscribe(\"finishEditModel\", function () {\n  switch (modifyType) {\n    case \"edit\":\n      handleEdit();\n      break;\n    case \"add\":\n      handleCreate();\n      break;\n  }\n});\n\nfunction handleEdit() {\n  var formObj = Script.getFormByKey(\"modelForm\");\n  if (formObj == undefined) {\n    alert(\"Please fill out all required fields\");\n    return;\n  }\n  var dbReq = {};\n  let today = new Date();\n  today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n  formObj.UpdatedOn = today;\n  formObj.UpdatedBy = Client.getUser();\n  let modelData = Script.getState(\"modelInfo\");\n  let modelId = modelData.getColumn(\"id\")[0];\n  formObj.Id = modelId;\n  dbReq[modelId] = formObj;\n  Database.updateRecord(\"rodent\", \"Model\", dbReq, () => {\n    Script.setState(\"currentModelType\", formObj.ModelType);\n    Client.jumpToScreen(\"Manage Device Models\");\n  });\n}\n\nfunction handleCreate() {\n  Database.readRecords(\"rodent\", \"Model\", function (eventData) {\n    let modelCollection = SensaCollection.load(eventData.value);\n    var formObj = Script.getFormByKey(\"modelForm\");\n    if (formObj == undefined) {\n      alert(\"Please fill out all required fields\");\n      return;\n    }\n    var dbReq = {};\n    let today = new Date().getTime();\n    //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n\t  var id;\n\t  try{\n\t\tid = +modelCollection.getColumn(\"Id\").at(-1) + 1;\n\t  }catch (error) {\n\t\t  id = 1;\n\t  }\n    formObj.Id = `${id}`;\n    formObj.CreatedOn = today;\n    formObj.UpdatedOn = today;\n    formObj.CreatedBy = Client.getUser();\n    formObj.UpdatedBy = Client.getUser();\n    dbReq[id] = formObj;\n    Database.createRecords(\"rodent\", \"Model\", dbReq, () => {\n      Script.setState(\"currentModelType\", formObj.ModelType);\n      Client.jumpToScreen(\"Manage Device Models\");\n    });\n  });\n}"},"ev":{}},"modelBatteryUpperInput":{"t":"Input","lX":80,"lY":180,"sX":3,"sY":1,"s":"Edit Model","ps":{"enabled":"true","scalingType":"NOVERT","width":"300px","height":"10%","x":"80px","y":"190px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modelForm","form key":"BatteryUpper","label text":"Battery Upper","color":"grey"},"ev":{}},"packetContainer":{"t":"Container","lX":40,"lY":40,"sX":14.23,"sY":3.68,"s":"Packet 6 Transactions","ps":{"enabled":"true","scalingType":"OK","width":"100%-80px","height":"100%-80px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Transaction Table","color":"grey"},"ev":{}},"tableCtl":{"t":"PickSlider","lX":80,"lY":80,"sX":6.76,"sY":1,"s":"Packet 6 Transactions","ps":{"enabled":"true","scalingType":"NOVERT","width":"90%","height":"5.72%","x":"80px","y":"80px"},"ver":"190104c210519","dis":false,"tt":"","a":{"tick values":"Day,Week,Month,3 Months,Year","form id":"slider-info","form key":"slider-value"},"ev":{"clientEvents":{"outputEvents":{"interval Set":{"channel":"intervalSet/receive value","event":"changed","trigger":"changed","important":"false"}}}}},"packet6Script":{"t":"Scripting","lX":1600,"lY":365,"sX":1,"sY":1,"s":"Packet 6 Transactions","ps":{"enabled":"false","scalingType":"OK","width":"5.74%","height":"11.44%","x":"43.83%","y":"86.84%"},"ver":"200124c210519","z":"140","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nconst transactionTable = Script.getWidget(\"transactionTable\");\nvar transactionDataCollection = null;\n\nconst tableSlider = Script.getWidget(\"tableCtl\");\n\nvar slideValue = \"Day\";\n\nvar intervalMap = {\n\t\"Day\": 1,\n    \"Week\": 7,\n    \"Month\": 30,\n    \"3 Months\": 90,\n    \"Year\": 365\n};\n\n\nvar locationData = [\n    {\n        \"TableName\": \"Locations\", // Specify the primary table used to construct the join request\n        \"Join\": 1, // Join type 1 - Inner Join, 2 - Outer Join, 3 - Left join, 4 - Right Join.\n        \"Columns\":\n            [\n                \"Id\",\n                \"Name\"\n\n            ], // Specify the list of columns to take from the reference table.\n        // Specify the list of columns to take from the reference table.\n\n\n    }];\n\n\nvar siteData = [\n    {\n        \"TableName\": \"Sites\", // Specify the primary table used to construct the join request\n        \"Join\": 1, // Join type 1 - Inner Join, 2 - Outer Join, 3 - Left join, 4 - Right Join.\n        \"Columns\":\n            [\n                \"Id\",\n                \"Name\"\n\n            ], // Specify the list of columns to take from the reference table.\n        // Specify the list of columns to take from the reference table.\n\n\n    }];\n/*.\nvar selectPacket = [\n        {\n            \"TableName\": \"P6Transactions\", // Specify the primary table used to construct the join request\n            \"Join\": 1, // Join type 1 - Inner Join, 2 - Outer Join, 3 - Left join, 4 - Right Join.\n            \"Columns\":\n            [\n            \"DateTime\",\n            \"DeviceNumber\", \n            \"P5Total\",\n            \"IRLeft\",\n            \"IRRight\",\n            \"AvgDelta\",\n            \"MinDelta\",\n            \"MaxDelta\",\n            \"L1\",\n            \"L2\",\n            \"Range\",\n            \"RebaitRange\",\n            \"TakenG\",\n            \"IRL Top\",\n            \"IRL Bottom\",\n            \"IRR Top\",\n            \"IRR Bottom\",\n            \"LocationId\",\n            \"SiteId\"\n            ], // Specify the list of columns to take from the reference table.\n            // Specify the list of columns to take from the reference table.\n        \n\n        }];*/\nvar locationsData;\nvar sitesData;\nvar selectPacket = [\n    {\n        \"TableName\": \"P6Transactions\", // Specify the primary table used to construct the join request\n        \"Join\": 1, // Join type 1 - Inner Join, 2 - Outer Join, 3 - Left join, 4 - Right Join.\n        \"Columns\":\n            [\n                \"DateTime\",\n                \"DeviceNumber\",\n                \"P5Total\",\n                \"IRLeft\",\n                \"IRRight\",\n                \"AvgDelta\",\n                \"MinDelta\",\n                \"MaxDelta\",\n                \"L1\",\n                \"L2\",\n                \"Range\",\n                \"RebaitRange\",\n                \"TakenG\",\n                \"IRLTop\",\n                \"IRLBottom\",\n                \"IRRTop\",\n                \"IRRBottom\",\n\t\t\t\t\"Tilt\",\n\t\t\t\t\"PrevLC\",\n                \"LocationId\",\n                \"SiteId\"\n            ], // Specify the list of columns to take from the reference table.\n        // Specify the list of columns to take from the reference table.\n\n    }];\n\n\n\nconst tableColumns = [\"date time\", \"device number\", \"p5 total\", \"irleft\", \"irright\", \"average\",\n    \"mindelta\", \"maxdelta\", \"l1\", \"l2\", \"range\", \"rebait range\", \"takeng\",\n    \"IRL Top\", \"IRL Bottom\", \"IRR Top\", \"IRR Bottom\", \"location\", \"site\"];\n\nconst tableColumns1 = [\"date time\", \"device number\", \"p5 total\", \"irleft\", \"irright\", \"average\",\n    \"mindelta\", \"maxdelta\", \"l1\", \"l2\", \"range\", \"rebait range\", \"takeng\", \"IRL Top\",\n    \"IRL Bottom\", \"IRR Top\", \"IRR Bottom\", \"location\", \"site\"];\nScript.on('load', function () {\n\tDatabase.readRecords(\"rodent\", \"Locations\", (lData)=> {\n\t\tlocationsData = SensaCollection.load(lData.value);\n\t});\n\n\tDatabase.readRecords(\"rodent\", \"Sites\", (eventData)=> {\n\t\tsitesData = SensaCollection.load(eventData.value);\n\t});\n\n\n    let downloadBtn = Script.getWidget(\"downloadData\");\n\n    downloadBtn.subscribe(\"pressed\", (eventData) => {\n\n        Script.downloadCSV(\"packet_6_data.csv\", transactionDataCollection);\n    });\n\n    ClientEvents.subscribe(\"intervalSet\", function (timeData) {\n        slideValue = timeData.value;\n        //sortData(slideValue);\n\n    });\n\n    ClientEvents.subscribe(\"displayTransactions\", function (eventData) {\n        // button has been pressed, grab the device number and only display that data\n        sortDataV2();\n    }) \n\n    //sortData(\"Day\");\n\n});\n\n\n/**\n* Sort and populate the data in the table\n*/\nfunction sortData(timeValue) {\n    Database.readCompound(\"rodent\", \"P6Transactions\", selectPacket, function(eventData){\n\t\ttransactionDataCollection = SensaCollection.load(eventData.value);\n        var tableData = {};\n        \n        //console.log(\"Data from the P6 table is on line 157 \" + JSON.stringify(transactionDataCollection, null, 4));\n\t\t\n\n        const date = Date.parse(new Date()); //new Date();\n\n        var slideData = intervalMap[timeValue];\n\t\t\n\t\t for (const packet in transactionDataCollection.data) {\n\t\t \n\t\n\t\t\tvar dataValue = transactionDataCollection.data[packet][0]; //grab the data\n\t\t\t \n\t\t\tvar dateDiff = date - parseInt(dataValue);\n\t\t\t//var daysMiliseconds = 86400000;\n\t\t\tvar days = (dateDiff / (60 * 60 * 24 * 1000)) % 365;\n\t\t\t//console.log(\"Th data value is \" + dataValue + \" datedif is \" + dateDiff + \" dys is \" + days + \" if statement \" + days <= slideData || days > 365);\n\t\t\tif (days <= slideData || days > 365) {\n\t\t\t\ttransactionDataCollection.data[packet][0] = formatTime(transactionDataCollection.data[packet][0]); //formating date\n\t\t\t\ttransactionDataCollection.data[packet][11] = parseFloat(transactionDataCollection.data[packet][11]).toFixed(2); // rebait range\n\t\t\t\ttransactionDataCollection.data[packet][12] = parseFloat(transactionDataCollection.data[packet][12]).toFixed(2); // taken gram\n\t\t\t\t\n\t\t\t\tif(transactionDataCollection.data[packet][17] in locationsData.data) {\n\t\t\t\t\ttransactionDataCollection.data[packet][17] = locationsData.data[transactionDataCollection.data[packet][17]][2];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(transactionDataCollection.data[packet][18] in sitesData.data) {\n\t\t\t\t\ttransactionDataCollection.data[packet][18] = sitesData.data[transactionDataCollection.data[packet][18]][1];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\tdelete transactionDataCollection.data[packet];\n\t\t\t}\n\t\t\t\n\t\t }\n\n\t\tconst data = Object.keys(transactionDataCollection.data).reverse().reduce(\n\t\t\t  (obj, key) => { \n\t\t\t\tobj[key] = transactionDataCollection.data[key]; \n\t\t\t\treturn obj;\n\t\t\t  }, \n\t\t  {}\n\t\t);\n\t\ttransactionDataCollection.data = data;\n\t\t\n\t\ttransactionDataCollection.renameColumn(\"AvgDelta\", \"Average\"); //AvgDelta\n\t\ttransactionDataCollection.renameColumn(\"DateTime\", \"date time\"); //AvgDelta\n\t\ttransactionDataCollection.renameColumn(\"DeviceNumber\", \"device number\");\n\t\ttransactionDataCollection.renameColumn(\"P5Total\", \"P5 Total\");\n\n\t\ttransactionDataCollection.renameColumn(\"RebaitRange\", \"rebait range\");\n\t\ttransactionDataCollection.renameColumn(\"IRLTop\", \"irl top\");\n\t\ttransactionDataCollection.renameColumn(\"IRLBottom\", \"irl bottom\");\n\t\ttransactionDataCollection.renameColumn(\"IRRTop\", \"irr top\");\n\t\ttransactionDataCollection.renameColumn(\"IRRBottom\", \"irr bottom\"); // PrevLC\n\t\ttransactionDataCollection.renameColumn(\"PrevLC\", \"Prev LoadCell\"); // PrevLC\n\t\ttransactionDataCollection.renameColumn(\"LocationId\", \"Location\"); // \n\t\ttransactionDataCollection.renameColumn(\"SiteId\", \"Site\");\n        updateTable(transactionTable, transactionDataCollection); //transactionDataCollection  newTransanction\n    });\n\n}\n\n/**\n* Sort and populate the data in the table\n*/\nfunction sortDataV2() {\n    var filteredDeviceNumber = Script.getFormByKey(\"device-info\")[\"device-number\"];\n    // var timeValue = Script.getFormByKey(\"slider-info\")[\"slider-value\"];\n    var timeValue = slideValue;\n    if (filteredDeviceNumber !== \"\" && !(isNaN(parseInt(filteredDeviceNumber))) ) {\n        // add filter to filter by device\n        selectPacket[0][\"Filters\"] = \n             [{\n                 \"Column\": \"DeviceNumber\", //Column that will be applied (don't include table name will be resolved if its contained within the reference table.\n                 \"ParamName\": \"DeviceNumber\", // Parameter name, must be unique and should not contain $ as its resolved by the mapper. \n                 \"Value\": filteredDeviceNumber // Value that you want to pass for comparison (any object)\n             }];\n\n    } else {\n        // otherwise remove it\n        delete selectPacket[0][\"Filters\"];\n    }\n\n    console.log(JSON.stringify(selectPacket,null,4));\n    Database.readCompound(\"rodent\", \"P6Transactions\", selectPacket, function(eventData){\n\t\ttransactionDataCollection = SensaCollection.load(eventData.value);\n        var tableData = {};\n        \n        //console.log(\"Data from the P6 table is on line 157 \" + JSON.stringify(transactionDataCollection, null, 4));\n\t\t\n\n        const date = Date.parse(new Date()); //new Date();\n\n        var slideData = intervalMap[timeValue];\n\t\t\n\t\t for (const packet in transactionDataCollection.data) {\n\t\t \n\t\n\t\t\tvar dataValue = transactionDataCollection.data[packet][0]; //grab the data\n\t\t\t \n\t\t\tvar dateDiff = date - parseInt(dataValue);\n\t\t\t//var daysMiliseconds = 86400000;\n\t\t\tvar days = (dateDiff / (60 * 60 * 24 * 1000)) % 365;\n\t\t\t//console.log(\"Th data value is \" + dataValue + \" datedif is \" + dateDiff + \" dys is \" + days + \" if statement \" + days <= slideData || days > 365);\n\t\t\tif (days <= slideData || days > 365) {\n\t\t\t\ttransactionDataCollection.data[packet][0] = formatTime(transactionDataCollection.data[packet][0]); //formating date\n\t\t\t\ttransactionDataCollection.data[packet][11] = parseFloat(transactionDataCollection.data[packet][11]).toFixed(2); // rebait range\n\t\t\t\ttransactionDataCollection.data[packet][12] = parseFloat(transactionDataCollection.data[packet][12]).toFixed(2); // taken gram\n\t\t\t\t\n\t\t\t\tif(transactionDataCollection.data[packet][17] in locationsData.data) {\n\t\t\t\t\ttransactionDataCollection.data[packet][17] = locationsData.data[transactionDataCollection.data[packet][17]][2];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(transactionDataCollection.data[packet][18] in sitesData.data) {\n\t\t\t\t\ttransactionDataCollection.data[packet][18] = sitesData.data[transactionDataCollection.data[packet][18]][1];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\tdelete transactionDataCollection.data[packet];\n\t\t\t}\n\t\t\t\n\t\t }\n\n\t\tconst data = Object.keys(transactionDataCollection.data).reverse().reduce(\n\t\t\t  (obj, key) => { \n\t\t\t\tobj[key] = transactionDataCollection.data[key]; \n\t\t\t\treturn obj;\n\t\t\t  }, \n\t\t  {}\n\t\t);\n\t\ttransactionDataCollection.data = data;\n\t\t\n\t\ttransactionDataCollection.renameColumn(\"AvgDelta\", \"Average\"); //AvgDelta\n\t\ttransactionDataCollection.renameColumn(\"DateTime\", \"date time\"); //AvgDelta\n\t\ttransactionDataCollection.renameColumn(\"DeviceNumber\", \"device number\");\n\t\ttransactionDataCollection.renameColumn(\"P5Total\", \"P5 Total\");\n\n\t\ttransactionDataCollection.renameColumn(\"RebaitRange\", \"rebait range\");\n\t\ttransactionDataCollection.renameColumn(\"IRLTop\", \"irl top\");\n\t\ttransactionDataCollection.renameColumn(\"IRLBottom\", \"irl bottom\");\n\t\ttransactionDataCollection.renameColumn(\"IRRTop\", \"irr top\");\n\t\ttransactionDataCollection.renameColumn(\"IRRBottom\", \"irr bottom\"); // PrevLC\n\t\ttransactionDataCollection.renameColumn(\"PrevLC\", \"Prev LoadCell\"); // PrevLC\n\t\ttransactionDataCollection.renameColumn(\"LocationId\", \"Location\"); // \n\t\ttransactionDataCollection.renameColumn(\"SiteId\", \"Site\");\n        updateTable(transactionTable, transactionDataCollection); //transactionDataCollection  newTransanction\n    });\n\n}\n\n/*Delay function*/\nfunction delay(time) {\n    return new Promise(resolve => setTimeout(resolve, time));\n}\n\n/**\n* Update data in the table\n*/\nfunction updateTable(table, collection) {\n    ClientEvents.publish(\"deleteRows\", \"\");\n    table.receiveValue(collection);\n\n}\n\n//date time,device number,p5 total,irleft,irright,average,mindelta,maxdelta,l1,l2,range,rebait range,takeng,location,site\n/**\n* Format time from milisecond to Date and time format\n*/\nfunction formatTime(utcTime) {\n    var intDate = parseInt(utcTime);\n    var date = new Date(intDate).toLocaleString('en-GB');\n    var d = date.split(\", \");\n    var d0 = d[0].split(\"/\");\n    //d0[2] = Math.abs(d0[2]);\n    d0 = d0.join(\"/\");\n    //return d[1] + \" \" + d0;\n    return d0 + \" \" + d[1];\n}"},"ev":{}},"transactionTable":{"t":"Table","lX":80,"lY":200,"sX":13.43,"sY":1.68,"s":"Packet 6 Transactions","ps":{"enabled":"true","scalingType":"OK","width":"100% - 160px","height":"100% - 280px","x":"80px","y":"200px"},"ver":"190104c210519","dis":false,"tt":"","a":{"columns":"date time,device number,p5 total,irleft,irright,average,mindelta,maxdelta,l1,l2,range,rebait range,takeng,irl top,irl bottom,irr top,irr bottom,tilt,prev loadcell,location,site","text color":"#000000","row color":"#000000","display header":"true","enable search":"true","title":"Packet 6 Data","colWidths":"0.04743833017077799,0.0480708412397217,0.04743833017077799,0.04743833017077799,0.04743833017077799,0.0480708412397217,0.04743833017077799,0.04680581910183428,0.048703352308665404,0.04743833017077799,0.04743833017077799,0.04743833017077799,0.04743833017077799,0.0480708412397217,0.04680581910183428,0.048703352308665404,0.04680581910183428,0.0480708412397217,0.04743833017077799,0.04743833017077799,0.0480708412397217"},"ev":{"clientEvents":{"inputEvents":{"transTable6":{"channel":"deleteRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Row selected":{"channel":"rowSelected/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Scripting#4":{"t":"Scripting","lX":15,"lY":475,"sX":1,"sY":1,"s":"Application Settings","ps":{"enabled":"false","scalingType":"OK","width":"","height":"","x":"","y":""},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\n\nClientEvents.subscribe(\"editApplicationSettings\", editApplicationSettings);\nClientEvents.subscribe(\"addApplicationSettings\", addApplicationSettings);\n\nconst applicationSettingsTable = Script.getWidget(\"applicationSettingsTable\");\n//deleteApplicationIcon\nClientEvents.subscribe(\"deleteApplicationIcon\", deleteApplicationSettings);\nScript.on('load', function() {\n\tDatabase.readRecords(\"rodent\", \"ApplicationSettings\", function(eventData) {\n\t\tconst applicationSettingsCollection = SensaCollection.load(eventData.value);\n\t\t\n\t\t//id,appname,settings,value\n\t\tapplicationSettingsCollection.renameColumn(\"AppName\", \"App Name\");\n\t\tapplicationSettingsTable.receiveValue(applicationSettingsCollection);\n\t});\n});\n\nfunction editApplicationSettings(eventData) {\n    Script.setState(\"applicationSettingsData\", eventData.value);\n\t//console.log(\"In the app \" + JSON.stringify(eventData.value, null, 4));\n    Script.setState(\"modifyType\", \"edit\");\n    Client.jumpToScreen(\"Edit Application Settings\");\n}\n\n function addApplicationSettings() {\n     Script.setState(\"modifyType\", \"add\");\n     Client.jumpToScreen(\"Edit Application Settings\");\n }\n\nfunction deleteApplicationSettings() {\n\tlet formData = Script.getFormByKey(\"applicationSetting\");\n\tvar ids = formData.applicationSetting.getColumn(\"id\");\n\t\n\tfor (var i = 0; i < ids.length; i++) {\n\t\t applicationSettingsTable.deleteRows(ids[i]);\n\t\t Database.deleteRecord(\"rodent\", \"ApplicationSettings\", \"Id\", ids[i]);\n\t}\n\t\n\tif(ids.length === 0) return;\n\t\n\tvar option = {\"confirmText\": \"Confirm\", \"cancelText\": \"Cancel\"};\n\tClient.confirm(\"Do you want to delete settings\", \"Delete Application Settings\", option).then((eventData) => {\n\t\t\n\t\t//console.log(\"Return data is  is \" + JSON.stringify(eventData, null, 4));\n\t\t\n\t\tif(!eventData) return;\n\t\tfor (var i = 0; i < ids.length; i++) {\n\t\t\t applicationSettingsTable.deleteRows(ids[i]);\n\t\t\t Database.deleteRecord(\"rodent\", \"ApplicationSettings\", \"Id\", ids[i]);\n\t\t}\n\t});\n}"},"ev":{}},"applicationSettingsTable":{"t":"Table","lX":80,"lY":120,"sX":13.43,"sY":2.48,"s":"Application Settings","ps":{"enabled":"true","scalingType":"OK","width":"100% - 160px","height":"100% - 200px","x":"80px","y":"120px"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"id,app name,settings,value","form id":"applicationSetting","form key":"applicationSetting","selectable":"multi + single","display header":"true","title":"Application Settings","colWidths":"0.1558538404175988,0.20432513049962714,0.203579418344519,0.3989560029828486"},"ev":{"clientEvents":{"outputEvents":{"Edit Application Settings":{"channel":"editApplicationSettings/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"editApplicationSettings":{"t":"Container","lX":40,"lY":40,"sX":7,"sY":5.5,"s":"Edit Application Settings","ps":{"enabled":"true","scalingType":"OK","width":"700px","height":"550px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Title"},"ev":{}},"appNameInput":{"t":"Input","lX":80,"lY":100,"sX":6,"sY":1,"s":"Edit Application Settings","ps":{"enabled":"true","scalingType":"NOVERT","width":"600px","height":"6.05%","x":"80px","y":"100px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"applicationSettings","form key":"AppName","label text":"App Name","color":"grey","required":"true","tab index":"1"},"ev":{}},"Text Area#0":{"t":"Text Area","lX":80,"lY":260,"sX":6,"sY":2.5,"s":"Edit Application Settings","ps":{"enabled":"true","scalingType":"OK","width":"600px","height":"250px","x":"80px","y":"260px"},"ver":"190104c210519","dis":false,"tt":"","a":{"form id":"applicationSettings","form key":"Value","color":"grey","label text":"Value","tab index":"3"},"ev":{}},"appSettingsNameInput":{"t":"Input","lX":80,"lY":190,"sX":6,"sY":1,"s":"Edit Application Settings","ps":{"enabled":"true","scalingType":"NOVERT","width":"600px","height":"6.05%","x":"80px","y":"190px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"applicationSettings","form key":"Settings","color":"grey","required":"true","label text":"Settings","tab index":"2"},"ev":{}},"appSettingsEditScript":{"t":"Scripting","lX":0,"lY":0,"sX":1,"sY":1,"s":"Edit Application Settings","ps":{"enabled":"false","scalingType":"OK","width":"","height":"","x":"","y":""},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\n\nvar userId;\nvar modifyType;\nvar modelTypeId;\nvar applicationSettingsData;\n\n//var appSettingsSubmitButton = Script.getWidget(\"appSettingsSubmitButton\");\nconst editApplicationSettings = Script.getWidget(\"editApplicationSettings\");\n//const cancelSettingsBtn = Script.getWidget(\"cancelSettingsBtn\"); //cancelSettingsBtn\nScript.on('load', function () {\n    /**\n    cancelSettingsBtn.subsribe(\"pressed\", ()=> {\n        Client.jumpToScreen(\"Application Settings\");\n    }); */\n\n    \n    // appSettingsSubmitButton.subsribe(\"pressed\", ()=> {\n    //     switch (modifyType) {\n    //         case 'edit':\n    //             handleEdit();\n    //             break;\n    //         case 'add':\n    //             handleCreate();\n    //             break;\n    //     }\n    // }); \n    modifyType = Script.getState(\"modifyType\");\n    if (modifyType == \"add\") {\n        editApplicationSettings.setTitle(\"New Application Settings\");\n    } else if (modifyType == \"edit\") {\n        applicationSettingsData = Script.getState(\"applicationSettingsData\");\n        editApplicationSettings.setTitle(\"Edit Application Settings\");\n        if (applicationSettingsData != null) {\n            var applicationSettingsObj = {};\n            applicationSettingsObj.AppName = applicationSettingsData.getColumn(\"app name\");\n            applicationSettingsObj.Settings = applicationSettingsData.getColumn(\"settings\");\n            applicationSettingsObj.Value = applicationSettingsData.getColumn(\"value\");\n            //console.log(\"from the app setting \" + JSON.stringify(applicationSettingsObj, null, 4));\n            Script.setForm(\"applicationSettings\", applicationSettingsObj);\n            //debugger;\n        }\n    }\n});\n\nClientEvents.subscribe(\"finishEdittAppSettings\", function () {\n    switch (modifyType) {\n        case 'edit':\n            handleEdit();\n            break;\n        case 'add':\n            handleCreate();\n            break;\n    }\n});\n\nfunction handleEdit() {\n    var formObj = Script.getFormByKey(\"applicationSettings\");\n    if (formObj == undefined) {\n        alert(\"Please fill out all required fields\");\n        return;\n    }\n    var dbReq = {};\n    let applicationSettingsData = Script.getState(\"applicationSettingsData\");\n    let modelId = applicationSettingsData.getColumn(\"id\")[0];\n    formObj.Id = modelId;\n    dbReq[modelId] = formObj;\n    //debugger;\n    Database.updateRecord(\"rodent\", \"ApplicationSettings\", dbReq, () => {\n        Client.jumpToScreen(\"Application Settings\");\n    });\n}\n\nfunction handleCreate() {\n\n    Database.readLastPrimaryKey(\"rodent\", \"ApplicationSettings\", function (eventData) {\n\n        var formObj = Script.getFormByKey(\"ApplicationSettings\");\n        if (formObj == undefined) {\n            alert(\"Please fill out all required fields\");\n            return;\n        }\n        var dbReq = {};\n        let id = parseInt(eventData.value) + 1; ////+applicationSettingsCollection.getColumn(\"Id\")[0] + 1;\n        formObj.Id = `${id}`;\n        dbReq[id] = formObj;\n        //debugger;\n        Database.createRecords(\"rodent\", \"ApplicationSettings\", dbReq, () => {\n            Client.jumpToScreen(\"Application Settings\");\n        });\n\n        /*Database.readRecords(\"rodent\", \"ApplicationSettings\", function(eventData) {\n            let applicationSettingsCollection = SensaCollection.load(eventData.value);\n    \t\n        }); */\n    });\n    //console.log(\"the created Id is \" + lastId);\n\n}"},"ev":{"serverEvents":{"inputEvents":{"database":{"channel":"$DB/ADMIN/MANAGE/RESPONSE","event":"feed"}}}}},"appSettingsSubmitButton":{"t":"Button","lX":560,"lY":525,"sX":1,"sY":1.09,"s":"Edit Application Settings","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"560px","y":"525px"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","button name":"Save"},"ev":{"clientEvents":{"outputEvents":{"Submit":{"channel":"finishEdittAppSettings/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addApplicationSettings":{"t":"Icon","lX":1373,"lY":70,"sX":1,"sY":1,"s":"Application Settings","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"3.95%","x":"100% - 130px","y":"70px"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"plus-square"},"ev":{"clientEvents":{"outputEvents":{"Add Application Settings":{"channel":"addApplicationSettings/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"IsPrimaryCheck":{"t":"Input","lX":200,"lY":260,"sX":1.2,"sY":1,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"120px","height":"6.26%","x":"200px","y":"260px"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","label text":"Is Primary","checkbox label side":"right","form id":"editUser","form key":"IsPrimary"},"ev":{}},"cancelRoleButton":{"t":"Button","lX":370,"lY":260,"sX":1,"sY":1.09,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"370px","y":"260px"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"Container#0":{"t":"Container","lX":40,"lY":40,"sX":16.63,"sY":7.94,"s":"User Access Role","ps":{"enabled":"true","scalingType":"OK","width":"100% - 80px","height":"100% - 80px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"User Access Role","color":"grey"},"ev":{}},"removeUserRole":{"t":"Icon","lX":2193,"lY":80,"sX":1,"sY":1,"s":"User Access Role","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"3.95%","x":"100% - 190px","y":"80px"},"ver":"200628c210519","z":"130","dis":false,"tt":"","a":{"icon file":"trash","outline color":"no outline","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteUserRole/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addNewUserRole":{"t":"Icon","lX":2253,"lY":50,"sX":1,"sY":1,"s":"User Access Role","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"3.95%","x":"100% - 130px","y":"80px"},"ver":"200628c210519","z":"130","dis":false,"tt":"","a":{"icon file":"plus-square","outline color":"no outline"},"ev":{}},"userRoleScript":{"t":"Scripting","lX":0,"lY":0,"sX":1,"sY":1,"s":"User Access Role","ps":{"enabled":"false","scalingType":"OK","width":"","height":"","x":"","y":""},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\n\nvar roleData = [\n    {\n        \"TableName\": \"Sites\", // Specify the primary table used to construct the join request\n        \"Join\": 1, // Join type 1 - Inner Join, 2 - Outer Join, 3 - Left join, 4 - Right Join.\n        \"Columns\":\n            [\n                \"Id\",\n                \"CompanyId\",\n                \"RoleName\",\n                \"CreatedOn\",\n                \"CreatedBy\"\n\n            ],\n\n    }];\nvar userTable = Script.getWidget(\"userTable\");\nconst tableColumns = [\"Role Name\", \"Created On\", \"Created By\"];\nconst addUserBtn = Script.getWidget(\"addNewUserRole\");\n\nvar companyIds;\nvar companyNames;\nvar senseCollectData;\n\nClientEvents.subscribe(\"editCompanyRole\", editCompany); //deleteUserRole\nClientEvents.subscribe(\"deleteUserRole\", deleteCompany);\nScript.on('load', function () {\n\n    addUserBtn.subscribe(\"pressed\", () => {\n        Script.setState(\"modifierType\", \"add\");\n        Client.jumpToScreen(\"Edit User Access Role\");\n    });\n\n    ClientEvents.subscribe(\"clickedUser\", function (eventData) {\n        var formData = Script.getFormByKey(\"userRole\");\n        var ids = formData.userRole.getColumn(\"id\");\n\n    });\n\n\n    Database.readRecords(\"rodent\", \"UserAccessRole\", function (eventData) {\n        senseCollectData = SensaCollection.load(eventData.value);\n        //var accessRoles = SensaCollection.load(eventData.value);\n        var accessRoles = senseCollectData.query((record, pk) => {\n            return true;\n        });\n\n        for (const key in accessRoles.data) {\n            var date = accessRoles.data[key][34];\n            //console.log(\"Data user is \" + date);\n            //(!isNaN(date) && date != null && data != \"\" && data != undefined)\n            if (!isNaN(date) && date !== undefined && date !== \"\") {\n                console.log(\"Data is 2  user \" + date);\n                accessRoles.data[key][34] = formatDate(date);\n            }\n        }\n\n        accessRoles.renameColumn(\"RoleName\", \"Role Name\");\n        accessRoles.renameColumn(\"CreatedOn\", \"Created On\");\n        accessRoles.renameColumn(\"CreatedBy\", \"Created By\");\n        accessRoles.addColumn(\"Company\");\n        //ClientEvents.publish(\"deleteRows\", \"\");\n        //userTable.receiveValue(companyData); //senseCollectData\n        console.log(\"Val is this \" + JSON.stringify(accessRoles, null, 4));\n        var col = accessRoles.getColumn(\"Role Name\");\n        //console.log(\"Val is this \" + JSON.stringify(col, null, 4));\n        //compDropdown.receiveList(companyNames);\n\n        Database.readRecords(\"rodent\", \"Companies\", function (eventData) {\n            var companyData = SensaCollection.load(eventData.value);\n\n            //console.log(\"company data \" + JSON.stringify(companyData, null, 4));\n            //var companyNames = companyData.getColumn(\"Name\");\n\n            //var compLoc = companyData.getColumn(\"Address\");\n            //var CompanyIds = companyData.getColumn(\"Id\");\n\n            //console.log(\"Val is this name data \" + JSON.stringify(companyNames, null, 4));\n            //console.log(\"Val is this ID data \" + JSON.stringify(CompanyIds, null, 4));\n            for (const id in accessRoles.data) {\n                //console.log(\"Id is 1 \" + id);\n                if (accessRoles.data[id][1] in companyData.data) {\n                    //console.log(\"Id is yes camp \" + accessRoles.data[id][2]);\n                    accessRoles.data[id][accessRoles.columns.indexOf(\"Company\")] = companyData.data[accessRoles.data[id][1]][1];\n                }\n            }\n            //console.log(\"Val is this 2 \" + JSON.stringify(accessRoles, null, 4));\n            ClientEvents.publish(\"deleteRows\", \"\");\n            userTable.receiveValue(accessRoles); //senseCollectData\n\n        });\n\n    });\n});\n\nfunction editCompany(eventData) {\n    //senseCollectData\n    var key = Object.keys(eventData.value.data)[0]\n    eventData.value.data[key][34] = senseCollectData.data[key][34];\n    console.log(\"Val is this 2 \" + JSON.stringify(eventData.value, null, 4));\n    Script.setState(\"userRoleData\", eventData.value);\n    Script.setState(\"modifierType\", \"edit\");\n    Client.jumpToScreen(\"Edit User Access Role\");\n}\n\n\nfunction deleteCompany() {\n    var formData = Script.getFormByKey(\"userRole\");\n    var ids = formData.userRole.getColumn(\"id\");\n\n\n    if (ids.length === 0) return;\n\n    var option = { \"confirmText\": \"Confirm\", \"cancelText\": \"Cancel\" };\n    Client.confirm(\"Do you want to delete access role\", \"Delete User Access Roles\", option).then((eventData) => {\n\n        //console.log(\"Return data is  is \" + JSON.stringify(eventData, null, 4));\n\n        if (!eventData) return;\n\n        for (var i = 0; i < ids.length; i++) {\n            userTable.deleteRows(ids[i]);\n            //let req = {};\n            //req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n            Database.deleteRecord(\"rodent\", \"UserAccessRole\", \"Id\", ids[i]);\n        }\n    });\n}\n\nfunction formatDate(today) {\n\n    //return Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n    //console.log()\n    var intDate = parseInt(today);\n    var date = new Date(intDate).toLocaleString('en-GB');\n    var d = date.split(\", \");\n    var d0 = d[0].split(\"/\");\n    d0[2] = Math.abs(d0[2] - 2000);\n    d0 = d0.join(\"/\");\n    //return d[1] + \" \" + d0;\n    return d0 + \" \" + d[1];\n}"},"ev":{}},"companyDropDown":{"t":"Dropdown","lX":95,"lY":95,"sX":3.2,"sY":1,"s":"Edit User Access Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"320px","height":"11.83%","x":"95px","y":"95px"},"ver":"190104c210519","dis":false,"tt":"","a":{"form id":"addUser","form key":"CompanyId","label text":"Company Name","bold":"true","default options":"","tab index":"1"},"ev":{}},"feature01":{"t":"Input","lX":100,"lY":250,"sX":3.2,"sY":1,"s":"Edit User Access Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"320px","height":"11.83%","x":"100px","y":"250px"},"ver":"270520c210519","z":"140","dis":false,"tt":"","a":{"type":"checkbox","form id":"addUser","form key":"Feature01","label text":"Heirarchy Maintenance","color":"grey","tab index":"4"},"ev":{}},"saveUserRoleButton":{"t":"Button","lX":230,"lY":600,"sX":1,"sY":1.09,"s":"Edit User Access Role","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"230px","y":"600px"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Save","color":"orange strong","text color":"white","tab index":"11"},"ev":{}},"cancelUserRoleButton":{"t":"Button","lX":100,"lY":600,"sX":1,"sY":1.09,"s":"Edit User Access Role","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"100px","y":"600px"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel","tab index":"10"},"ev":{}},"userRoleAccessScript":{"t":"Scripting","lX":165,"lY":695,"sX":1,"sY":1,"s":"Edit User Access Role","ps":{"enabled":"false","scalingType":"OK","width":"4.2%","height":"11.12%","x":"9.86%","y":"71.86%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nconst compDropdown = Script.getWidget(\"companyDropDown\"); \nconst submitComp = Script.getWidget(\"saveUserRoleButton\");\nconst cancel = Script.getWidget(\"cancelUserRoleButton\");\nconst userRoleEditContainer = Script.getWidget(\"userRoleEditContainer\"); \nconst roleNameInput = Script.getWidget(\"roleNameInput\");\n\nconst feature01 = Script.getWidget(\"feature01\");\nconst feature02 = Script.getWidget(\"feature02\");\nconst feature03 = Script.getWidget(\"feature03\");\nconst feature04 = Script.getWidget(\"feature04\");\nconst feature05 = Script.getWidget(\"feature05\");\n//feature06\nconst feature06 = Script.getWidget(\"feature06\");\nconst features = [feature01, feature02,feature03, feature04, feature05, feature06];\n\nvar CompanyIds;\nvar companyNames;\nvar modifier;\nvar userData;\nvar id;\nvar companyId;\nvar roleName;\nScript.on('load', function() {\n\n\tScript.setState(\"Caller\", \"User Access Role\");\n\tmodifier = Script.getState(\"modifierType\");\n\tuserData = Script.getState(\"userRoleData\");\n\t\n\thandleModifier();\n\tcancel.subscribe(\"pressed\", (eventData) => {\n\t\tClient.jumpToScreen(\"User Access Role\");\n\t\n\t});\n\t\n\tsubmitComp.subscribe(\"pressed\", (eventData) => {\n\t\tconsole.log(\"Button pressed\");\n\t\tconsole.log(JSON.stringify(eventData));\n\n\t\tvar dataType = 1;\n\t\tvar formData = Script.getFormByKey(\"addUser\");\n\t\t\n\t\n\t\tif(formData === undefined){\n\t\t\talert(\"Please fill out all required fields\");\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar dbData = {};\n\t\t\n\t\tvar status = 1;\n\t\tvar companyName = formData.CompanyId;\n\t\tvar compIndex = companyNames.indexOf(companyName);\n\t\tvar today = new Date().getTime();\n\t\t//today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);//new Date().getTime();\n\t\t\n\t\tconsole.log(modifier);\n\t\tif(modifier === \"add\"){\n\t\t\tconsole.log(\"ADDING\");\n\t\t   Database.readLastPrimaryKey(\"rodent\", \"UserAccessRole\", function(eventData){\n\t\t\tconsole.log(\"Last key is \" + eventData.value);\n\t\t\tvar lastId = isNaN(eventData.value) ? 1 : parseInt(eventData.value) + 1;\n\t\t\tvar dbData = {};\n\t\t\t\n\t\t\t\n\t\t\tdbData[lastId] = formData;\n\t\t\t//Database.createRecords(\"rodent\", \"UserAccessRole\", dbData, ()=>{});\n\t\t\tconsole.log(\"data to be stored \" + JSON.stringify(dbData, null, 4));\n\t\t\t\n\t\t\t\n\t\t\tDatabase.saveRecordParam(\"rodent\", \"UserAccessRole\",{ //UserAccessRole\n\t\t\t\t\n\t\t\t\tlastId: {\n\t\t\t\t\t\"Id\": lastId,\n\t\t\t\t\t\"CompanyId\": CompanyIds[compIndex],\n\t\t\t\t\t\"RoleName\": formData.RoleName,\n\t\t\t\t\t\"Status\": 1,\n\t\t\t\t\t\"CreatedBy\": Client.getUser(),\n\t\t\t\t\t\"CreatedOn\": today,\n                    \"Feature01\": +formData.Feature01,\n\t\t\t\t\t\"Feature02\": +formData.Feature02,\n\t\t\t\t\t\"Feature03\": +formData.Feature03,\n\t\t\t\t\t\"Feature04\": +formData.Feature04,\n\t\t\t\t\t\"Feature05\": +formData.Feature05,\n\t\t\t\t\t\"Feature06\": +formData.Feature06,\n\t\t\t\t\t\"ModifiedBy\": Client.getUser(),\n\t\t\t\t\t\"ModifiedOn\": today\n\t\t\t\t}\n\t\t\t\t}, function(dataValue) {\n\t\t\t\t//console.log(\"Data value is : \" + JSON.stringify(dataValue, null, 4));\n\t\t\t\t\t//Client.jumpToScreen(\"User Access Role\");\n\t\t\t\t\t\n\t\t\t\t});\n\t\t\t   Client.jumpToScreen(\"User Access Role\");\n\t\t\t});\n\t\t} else if (modifier === \"edit\"){\n\t\t\t\n\t\t\t//var formData = Script.getFormByKey(\"addUser\");\n\t\t\tif (formData == undefined) {\n\t\t\t\talert(\"Please fill out all required fields\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar dbReq = {};\n\t\t\tformData.Id = id;\n\t\t\t//formObj.Status = +formObj.Status;\n\t\t\t//formData.RoleName = roleName;\n\t\t\tformData.CompanyId = companyId;\n\t\t\tformData.Feature01 = +formData.Feature01;\n\t\t\tformData.Feature02 = +formData.Feature02;\n\t\t\tformData.Feature03 = +formData.Feature03;\n\t\t\tformData.Feature04 = +formData.Feature04;\n\t\t\tformData.Feature05 = +formData.Feature05;\n\t\t\tformData.Feature06 = +formData.Feature06;\n\t\t\tformData.ModifiedOn = today;\n\t\t\tformData.ModifiedBy = Client.getUser();\n\t\t\tdbReq[id] = formData;\n\n\t\t\tDatabase.updateRecord(\"rodent\", \"UserAccessRole\", dbReq, () => {\n\t\t\t\tClient.jumpToScreen(\"User Access Role\");\n\t\t\t});\n\t\t}\n\t\t \n\t});\n\t\n\tDatabase.readRecords(\"rodent\", \"Companies\", function(eventData){\n\t\tvar companyData = SensaCollection.load(eventData.value);\n\t\t\n\t\t//console.log(\"company data \" + JSON.stringify(companyData, null, 4));\n\t\tcompanyNames = companyData.getColumn(\"Name\");\n\t\t\n\t\tlet compLoc = companyData.getColumn(\"Address\");\n\t\tCompanyIds = companyData.getColumn(\"Id\");\n\t\t\n\t\t//console.log(\"name data \" + JSON.stringify(companyNames, null, 4));\n\t\tif(modifier === \"edit\"){\n\t\t   for(let i = 0; i < CompanyIds.length; i++){\n\t\t\t\tif(CompanyIds[i] === companyId) {\n\t\t\t\t\tcompDropdown.receiveValue(companyNames[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log(\"ACCCC \" + JSON.stringify(companyNames, null, 4));\n\t\t\tcompDropdown.receiveList(companyNames);\n\t\t}\n\t\t\n\t});\n});\n\nfunction handleModifier(){\n\n\tswitch(modifier) {\n\t\n\t\tcase \"add\":\n\t\t\t//handle add\n\t\t\tconsole.log(\"it is add\");\n\t\t\taddUserRole();\n\t\t\tbreak;\n\t\tcase \"edit\":\n\t\t\t//handle edit \n\t\t\tconsole.log(\"it is edit\");\n\t\t\teditForm();\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tconsole.log(\"go back\");\n\t\t\tClient.jumpToScreen(\"User Access Role\");\n\t\t\tbreak;\n\t}\n}\n\nfunction editForm(){\n\t userRoleEditContainer.setTitle(\"Edit User Role\");\n\t\n\tvar data = Object.values(userData.data)[0];\n\tid = data[0];\n\tcompanyId = data[1];\n\troleName = data[2];\n\troleNameInput.receiveValue(roleName);\n\t\n\tfor(let i = 0; i < features.length; i++) {\n\t\tfeatures[i].receiveValue(data[i + 3]);\n\t}\n\t//var name;\n\n    return;\n\t\n}\n\nfunction addUserRole(){\n\tuserRoleEditContainer.setTitle(\"New User Role\");\n    return;\n}"},"ev":{}},"userTable":{"t":"Table","lX":80,"lY":130,"sX":15.83,"sY":6.64,"s":"User Access Role","ps":{"enabled":"true","scalingType":"OK","width":"100% - 160px","height":"100% - 210px","x":"80px","y":"130px"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"role name,created on,created by,company","selectable":"multi + single","enable search":"true","form id":"userRole","form key":"userRole","colWidths":"0.24086502609992544,0.24086502609992544,0.2401193139448173,0.24086502609992544"},"ev":{"clientEvents":{"inputEvents":{"deleteUserRows":{"channel":"deleteRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"clickerUser":{"channel":"clickedUser/receive value","event":"pressed","trigger":"pressed","important":"false"},"editCompanyRole":{"channel":"editCompanyRole/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"userRoleEditContainer":{"t":"Container","lX":40,"lY":40,"sX":4.2,"sY":6.5,"s":"Edit User Access Role","ps":{"enabled":"true","scalingType":"OK","width":"420px","height":"650px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Title"},"ev":{}},"roleNameInput":{"t":"Input","lX":95,"lY":170,"sX":2.2,"sY":1,"s":"Edit User Access Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"220px","height":"11.83%","x":"95px","y":"170px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"addUser","form key":"RoleName","required":"true","label text":"Role Name","tab index":"2","color":"grey"},"ev":{}},"cancelProduct":{"t":"Button","lX":200,"lY":380,"sX":1,"sY":1.09,"s":"Edit Product","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"200px","y":"380px"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"Container#2":{"t":"Container","lX":40,"lY":40,"sX":14.23,"sY":7.96,"s":"Manage Master Products","ps":{"enabled":"true","scalingType":"OK","width":"100%-80px","height":"100%-80px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Manage Master Products"},"ev":{}},"Container#3":{"t":"Container","lX":40,"lY":40,"sX":16.63,"sY":7.94,"s":"User Roles","ps":{"enabled":"true","scalingType":"OK","width":"100% - 80px","height":"100% - 80px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"User Roles","color":"grey"},"ev":{}},"cancelErrorCode":{"t":"Button","lX":370,"lY":620,"sX":1,"sY":1.09,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"370px","y":"620px"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"Container#4":{"t":"Container","lX":40,"lY":40,"sX":16.63,"sY":7.94,"s":"Error Codes","ps":{"enabled":"true","scalingType":"OK","width":"100%- 80px","height":"100%- 80px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Error Codes","color":"grey"},"ev":{}},"Container#5":{"t":"Container","lX":40,"lY":40,"sX":16.63,"sY":7.94,"s":"Manage Companies","ps":{"enabled":"true","scalingType":"OK","width":"100%-80px","height":"100%-80px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Manage Companies","color":"grey"},"ev":{}},"canceCompanyBtn":{"t":"Button","lX":370,"lY":240,"sX":1,"sY":1.09,"s":"Edit Company","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"370px","y":"270px"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"Container#6":{"t":"Container","lX":40,"lY":40,"sX":16.63,"sY":7.94,"s":"Manage Model Types","ps":{"enabled":"true","scalingType":"OK","width":"100%-80px","height":"100%-80px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Manage Model Type","color":"grey"},"ev":{}},"cancelModelType":{"t":"Button","lX":425,"lY":315,"sX":1,"sY":1.09,"s":"Edit Model Type","ps":{"enabled":"false","scalingType":"OK","width":"100px","height":"50px","x":"370px","y":"170px"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"Container#7":{"t":"Container","lX":40,"lY":40,"sX":14.23,"sY":3.68,"s":"Manage Device Models","ps":{"enabled":"true","scalingType":"OK","width":"100%-80px","height":"100%-80px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Manage Device Models","color":"grey"},"ev":{}},"cancelModelBtn":{"t":"Button","lX":60,"lY":380,"sX":1,"sY":1.09,"s":"Edit Model","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"150px","y":"380px"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"Container#8":{"t":"Container","lX":40,"lY":40,"sX":14.23,"sY":3.68,"s":"Application Settings","ps":{"enabled":"true","scalingType":"OK","width":"100%-80px","height":"100%-80px","x":"40px","y":"40px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Application Settings","color":"grey"},"ev":{}},"cancelSettingsBtn":{"t":"Button","lX":410,"lY":525,"sX":1,"sY":1.09,"s":"Edit Application Settings","ps":{"enabled":"true","scalingType":"OK","width":"100px","height":"50px","x":"410px","y":"525px"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel","jump to screen":"Application Settings"},"ev":{}},"feature02":{"t":"Input","lX":100,"lY":310,"sX":3.2,"sY":1,"s":"Edit User Access Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"320px","height":"11.83%","x":"100px","y":"310px"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","form id":"addUser","form key":"Feature02","label text":"Device Provisioning","color":"grey","tab index":"5"},"ev":{}},"addModelIcon":{"t":"Icon","lX":208,"lY":870,"sX":1,"sY":1,"s":"Manage Device Models","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"6.16%","x":"100% - 130px","y":"50px"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"plus-square","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"Add Model":{"channel":"addModel/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"deleteApplicationIcon":{"t":"Icon","lX":1313,"lY":70,"sX":1,"sY":1,"s":"Application Settings","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"6.29%","x":"100% - 190px","y":"70px"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"trash","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteApplicationIcon/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"managerMasterProductScript":{"t":"Scripting","lX":55,"lY":934,"sX":1,"sY":1,"s":"Manage Master Products","ps":{"enabled":"false","scalingType":"OK","width":"4.2%","height":"14.29%","x":"2.31%","y":"126.43%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar productCollection;\n// Default\nvar status = \"Show Active\";\n\nconst productsTable = Script.getWidget(\"masterProductsTable\");\n\nScript.on('load', function() {\n\t\n\tDatabase.readRecords(\"rodent\", \"Products\", function(eventData) {\n\t\tproductCollection = SensaCollection.load(eventData.value);\n\t\tconsole.log(\" data in the big comp \" + JSON.stringify(productCollection, null, 4));\n\t\tupdateTable();\n\t});\n});\n\nClientEvents.subscribe(\"productSelected\", editProduct);\nClientEvents.subscribe(\"removeMasterProducts\", removeProductFromCompany);\nClientEvents.subscribe(\"addNewMasterProduct\", createNewProduct);\nClientEvents.subscribe(\"changeActive\", (eventData) => {\n\tstatus = eventData.value; \n\tDatabase.readRecords(\"rodent\", \"Products\", function(eventData) {\n\t\tproductCollection = SensaCollection.load(eventData.value);\n\t\tupdateTable();\n\t});\n\tif (status !== \"Show Active\") {\n\t\t// Do not attempt to delete inactive elements\n\t\tScript.hideWidget(\"deleteMasterProdIcon\");\n\t\t//Script.disableWidget(\"addMasterProdIcon\");\n\t} else {\n\t\t// Re-enable widgets if disabled before\n\t\tScript.showWidget(\"deleteMasterProdIcon\");\n\t\t//Script.enableWidget(\"addMasterProdIcon\");\n\t}\n});\n\nfunction editProduct(eventData) {\n\tScript.setState(\"productInfo\", eventData.value);\n\tScript.setState(\"modifyType\", \"edit_master\");\n\tScript.setState(\"masterProduct\", \"master\");\n\tClient.jumpToScreen(\"Edit Product\");\n}\n\nfunction updateTable() {\n\t//status = Script.getFormByKey(\"master\").activeSelection == \"Show Active\" ? '1' : '0';\n\tlet filteredComps = productCollection.query((record, pk) => {\n\t\tif (record['Status'] == (status == \"Show Active\")){\n\t\t\treturn true;\n\t\t}\n\t});\n\t\n\tClientEvents.publish(\"compDelRows\", \"\");\n\tvar tableComps = filteredComps.filter([\"Id\", \"Name\", \"Expiry\", \"WeightPerBlock\"]);\n\ttableComps.setColumns([\"Id\", \"Name\", \"Expiry\", \"Weight Per Block\"]);\n\tproductsTable.receiveValue(tableComps);\n}\n\nfunction createNewProduct(eventData) {\n\tScript.setState(\"modifyType\", \"add_master\");\n\tScript.setState(\"masterProduct\", \"master\");\n\tClient.jumpToScreen(\"Edit Product\");\n}\n\nfunction removeProductFromCompany() {\n\n\tvar formData =  Script.getFormByKey(\"master\");\n\tvar ids = formData.products.getColumn(\"id\");\n\t\n\tif(ids.length === 0) return;\n\t\n\tvar option = {\"confirmText\": \"Confirm\", \"cancelText\": \"Cancel\"};\n\tClient.confirm(\"Do you want to delete Company Records?\", \"Delete Records\", option).then((eventData) => {\n\t\t\n\t\t//console.log(\"Return data is  is \" + JSON.stringify(eventData, null, 4));\n\t\t\n\t\tif(!eventData) return;\n\t\tfor (var i = 0; i < ids.length; i++) {\n\t\t\tproductsTable.deleteRows(ids[i]);\n\t\t\t//let req = {};\n\t\t\t//req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n\t\t\t//Database.updateRecord(\"rodent\", \"Products\", req);\n\t\t\tDatabase.deleteRecord(\"rodent\", \"Products\", \"Id\", ids[i]);\n\t\t}\n\t});\n\t//var selectedOption = await promise;\n\t//console.log(\"Ids are \" + ids);\n\t//console.log(\"Promise is \" + JSON.stringify(promise, null, 4));\n\t\n\t\n}"},"ev":{}},"manageCompanyStatus":{"t":"Dropdown","lX":1983,"lY":84,"sX":3,"sY":1,"s":"Manage Companies","ps":{"enabled":"true","scalingType":"NOVERT","width":"300px","height":"5.51%","x":"100% - 385px","y":"84px"},"ver":"190104c210519","z":"140","dis":false,"tt":"","a":{"default options":"Show Active,Show Inactive","default value":"Show Active"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"changeActiveCompany/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"errorCodeStatus":{"t":"Dropdown","lX":842,"lY":113,"sX":3,"sY":1,"s":"Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"300px","height":"7.57%","x":"50% - 342px","y":"113px"},"ver":"190104c210519","z":"140","dis":false,"tt":"","a":{"default value":"Show Active","default options":"Show Active, Show Inactive"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"changeActiveError/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"manageMasterStatus":{"t":"Dropdown","lX":1983,"lY":105,"sX":3,"sY":1,"s":"Manage Master Products","ps":{"enabled":"true","scalingType":"NOVERT","width":"300px","height":"7.57%","x":"100% - 385px","y":"105px"},"ver":"190104c210519","z":"130","dis":false,"tt":"","a":{"default options":"Show Active, Show Inactive","default value":"Show Active"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"changeActive/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"errorCodeStatusFile":{"t":"Dropdown","lX":1993,"lY":115,"sX":3,"sY":1,"s":"Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"300px","height":"7.57%","x":"100% - 375px","y":"113px"},"ver":"190104c210519","dis":false,"tt":"","a":{"default value":"Show Active","default options":"Show Active, Show Inactive"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"changeActiveFiles/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"Scripting#8df":{"t":"Scripting","lX":670,"lY":625,"sX":1,"sY":1,"s":"Edit Product","ps":{"enabled":"false","scalingType":"OK","width":"","height":"","x":"","y":""},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar prodId;\nvar modifyType;\nvar masterProduct;\nconst prodFormContainer = Script.getWidget(\"productFormContainer\");\nconst prodSubmitButton = Script.getWidget(\"prodSubmitButton\");\nconst cancelProduct = Script.getWidget(\"cancelProduct\");\nScript.on('load', function () {\n\n    masterProduct = Script.getState(\"masterProduct\");\n\n    cancelProduct.subscribe(\"pressed\", () => {\n        jumpScreen();\n        //Client.jumpToScreen(\"Manage Products\");\n    });\n    modifyType = Script.getState(\"modifyType\");\n\n    if (!modifyType) {\n\n        jumpScreen();\n        //Client.jumpToScreen(\"Manage Products\");\n    }\n    var productData;\n\n    if (modifyType.startsWith(\"add\")) {\n        prodFormContainer.setTitle(\"New Product\");\n        return;\n    } else if (modifyType == \"edit\") {\n        productData = Script.getState(\"compProductInfo\");\n    } else if (modifyType == \"edit_master\") {\n        productData = Script.getState(\"productInfo\");\n    }\n    var prodObj = {}\n    prodId = productData.getColumn(\"id\")[0];\n    prodObj.Name = productData.getColumn(\"name\");\n    prodObj.Status = productData.getColumn(\"status\");\n    prodObj.WeightPerBlock = productData.getColumn(\"weight per block\");\n    prodObj.Expiry = productData.getColumn(\"expiry\");\n\n    Script.setForm(\"editProduct\", prodObj);\n    prodFormContainer.setTitle(\"Edit Product\");\n});\n\nClientEvents.subscribe(\"finishEditProduct\", function () {\n    switch (modifyType) {\n        case 'edit':\n            handleEdit();\n            break;\n        case 'edit_master':\n            handleEditMaster();\n            break;\n        case 'add':\n            handleCreate();\n            break;\n        case 'add_master':\n            handleCreateMaster();\n            break;\n    }\n});\n\n\nfunction jumpScreen() {\n\n    if (masterProduct === \"master\") {\n        Client.jumpToScreen(\"Manage Master Products\");\n    } else if (masterProduct === \"product\") {\n        Client.jumpToScreen(\"Manage Products\");\n    }\n\n}\nfunction handleEdit() {\n    var formObj = Script.getFormByKey(\"editProduct\");\n    if (formObj == undefined) {\n        alert(\"Please fill out all required fields\");\n        return;\n    }\n\n    var dbReq = {};\n    var companyProducts = Script.getState(\"companyProducts\");\n    formObj.Id = prodId;\n    formObj.Status = +formObj.Status;\n    let today = new Date().getTime();\n    console.log(\"Inside 3\" + today);\n    //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n    formObj.UpdatedOn = today;\n    formObj.UpdatedBy = Client.getUser();\n    dbReq[prodId] = formObj;\n\n    Database.updateRecord(\"rodent\", \"CompanyProducts\", dbReq, () => {\n        //Script.setState(\"currentCompany\", formObj.CompanyId);\n        Client.jumpToScreen(\"Manage Products\");\n    });\n}\n\nfunction handleEditMaster() {\n    var formObj = Script.getFormByKey(\"editProduct\");\n    if (formObj == undefined) {\n        alert(\"Please fill out all required fields\");\n        return;\n    }\n\n    var dbReq = {};\n    formObj.Id = prodId;\n    formObj.Status = +formObj.Status;\n    let today = new Date().getTime();\n    console.log(\"Inside 2\" + today);\n    //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n    formObj.UpdatedOn = today;\n    formObj.UpdatedBy = Client.getUser();\n    dbReq[prodId] = formObj;\n\n    Database.updateRecord(\"rodent\", \"Products\", dbReq, (dataCreated) => {\n        console.log(\"Master edit is \" + JSON.stringify(dataCreated, null, 4));\n        Client.jumpToScreen(\"Manage Master Products\");\n    });\n}\n\nfunction handleCreate() {\n    Database.readRecords(\"rodent\", \"CompanyProducts\", function (eventData) {\n        var compProductCollection = SensaCollection.load(eventData.value);\n        var formObj = Script.getFormByKey(\"editProduct\");\n\n        if (formObj == undefined) {\n            alert(\"Please fill out all required fields\");\n            return;\n        }\n\n        var dbReq = {};\n        var compProdCount = Object.keys(compProductCollection.data).length;\n        formObj.Id = `${compProdCount + 1}`;\n        formObj.Status = +formObj.Status;\n\n        let today = new Date().getTime();\n        //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n        console.log(\"Inside 1\" + today);\n        formObj.CreatedOn = today;\n        formObj.UpdatedOn = today;\n        formObj.Owner = Client.getUser();\n        formObj.CreatedBy = Client.getUser();\n        formObj.UpdatedBy = Client.getUser();\n        formObj.CompanyId = Script.getState(\"companyId\");\n        dbReq[compProdCount + 1] = formObj;\n\n        Database.createRecords(\"rodent\", \"CompanyProducts\", dbReq, () => {\n            Script.setState(\"currentCompany\", formObj.CompanyId);\n            Client.jumpToScreen(\"Manage Products\");\n        });\n    });\n}\n\nfunction handleCreateMaster() {\n    Database.readRecords(\"rodent\", \"Products\", function (eventData) {\n        var productCollection = SensaCollection.load(eventData.value);\n        var formObj = Script.getFormByKey(\"editProduct\");\n\n        if (formObj == undefined) {\n            alert(\"Please fill out all required fields\");\n            return;\n        }\n\n        var dbReq = {};\n        var compProdCount = Object.keys(productCollection.data).length;\n\n        formObj.Id = `${parseInt(compProdCount) + 1}`;\n        formObj.Status = +formObj.Status;\n\n        let today = new Date().getTime();\n        console.log(\"Inside 4\" + today);\n        //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n        formObj.CreatedOn = today;\n        formObj.UpdatedOn = today;\n        formObj.Owner = Client.getUser();\n        formObj.CreatedBy = Client.getUser();\n        formObj.UpdatedBy = Client.getUser();\n        dbReq[compProdCount + 1] = formObj;\n        //console.log(\"Master created is \" + JSON.stringify(dbReq, null, 4));\n        /**Database.createRecords(\"rodent\", \"Products\", dbReq, (dataCreated) => {\n            console.log(\"Master created is \" + JSON.stringify(dataCreated, null, 4));\n            Client.jumpToScreen(\"Manage Master Products\");\n        }); */\n        var id = formObj.Id;\n        Database.saveRecordParam(\"Rodent\", \"Products\", {\n\n            id: {\n                \"Id\": formObj.Id,\n                \"Name\": formObj.Name, //new Date().getTime(),\n                \"Expiry\": formObj.Expiry,//,deviceNum,\n                \"WeightPerBlock\": formObj.WeightPerBlock,\n                \"Status\": formObj.Status,\n                \"CreatedOn\": today,\n                \"UpdatedOn\": today,\n                \"Owner\": Client.getUser(),\n                \"CreatedBy\": Client.getUser(),\n                \"UpdatedBy\": Client.getUser()\n\n            }\n\n        }, function (data) {\n            //console.log(\"inisde save: \" + selected.Id.toString() + \" data is \" + JSON.stringify(data, null, 4));\n            Client.jumpToScreen(\"Manage Master Products\");\n        });\n\n\n    });\n\n\n}"},"ev":{}},"editManageCompanyScript":{"t":"Scripting","lX":45,"lY":440,"sX":1,"sY":1,"s":"Edit Company","ps":{"enabled":"false","scalingType":"OK","width":"9.07%","height":"8.26%","x":"4.53%","y":"35.92%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar companyId;\nvar modifyType;\nconst companyContainer = Script.getWidget(\"companyContainer\");\nconst companySubmitButton = Script.getWidget(\"companySubmitButton\");\nconst canceCompanyBtn = Script.getWidget(\"canceCompanyBtn\");\nScript.on('load', function() {\n\t\n\tcanceCompanyBtn.subscribe(\"pressed\", ()=> {\n\t\t Client.jumpToScreen(\"Manage Companies\");\n\t});\n    modifyType = Script.getState(\"modifyType\");\n    var companyData;\n\n    if (modifyType == \"add\") {\n        companyContainer.setTitle(\"New Company\");\n        return;\n    } else if (modifyType == \"edit\") {\n        companyData = Script.getState(\"companyData\");\n    }\n\n    var companyObj = {}\n    companyId = companyData.getColumn(\"id\")[0];\n    companyObj.Name = companyData.getColumn(\"name\");\n    companyObj.Address = companyData.getColumn(\"address\");\n    companyObj.Status = companyData.getColumn(\"status\");\n\n    Script.setForm(\"companyform\", companyObj);\n    companyContainer.setTitle(\"Edit Company\");\n});\n\nClientEvents.subscribe(\"finishSubmitCompany\", function() {\n    switch (modifyType) {\n        case 'edit':\n            handleEdit();\n            break;\n        case 'add':\n            handleCreate();\n            break;\n    }\n});\n\nfunction handleEdit() {\n    var formObj = Script.getFormByKey(\"companyform\");\n    if (formObj == undefined) {\n        alert(\"Please fill out all required fields\");\n        return;\n    }\n        \n    var dbReq = {};\n    formObj.Id = companyId;\n    formObj.Status = +formObj.Status;\n    let today = new Date().getTime();\n    // today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n    formObj.UpdatedOn = today;\n    formObj.UpdatedBy = Client.getUser();\n    dbReq[companyId] = formObj;\n        \n    Database.updateRecord(\"rodent\", \"Companies\", dbReq, () => {\n        Client.jumpToScreen(\"Manage Companies\");\n    });\n}\n\nfunction handleCreate() {\n\t\n\t\n\tDatabase.readLastPrimaryKey(\"rodent\",\"Companies\",function(eventData){\n\t\n\t//var lastId = eventData.value;\n\t\t //var primaryKey = isNaN(lastId) ? 1 : parseInt(lastId) + 1;\n\t\t //var primaryKey = null;\n\t\t var devId;\n\t\t if(eventData.value === null || eventData.value === undefined || isNaN(eventData.value)) {\n\t\t\t devId = 1;\n\t\t } else {\n\t\t\t devId = parseInt(eventData.value) + 1;\n\t\t }\n\n\t\t//var companyCollection = SensaCollection.load(eventData.value);\n        var formObj = Script.getFormByKey(\"companyform\");\n        \n        if (formObj == undefined) {\n            alert(\"Please fill out all required fields\");\n            return;\n        }\n\n\t\tconsole.log(\"New devId is \" + devId);\n        var dbReq = {};\n        //var companyCount = Object.keys(companyCollection.data).length;\n        formObj.Id = devId;\n        formObj.Status = +formObj.Status;\n\n        let today = new Date().getTime();\n        //today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n        formObj.CreatedOn = today;\n        formObj.UpdatedOn = today;\n        formObj.CreatedBy = Client.getUser();\n        formObj.UpdatedBy = Client.getUser();\n        dbReq[devId] = formObj;\n\n\t\t/*\n       Database.createRecords(\"rodent\", \"Companies\", dbReq, () => {\n            \n            Client.jumpToScreen(\"Manage Companies\");\n        }); */\n\t\t\n\t\t\n\t\tvar id = formObj.Id;\n\t\tconsole.log(\"Saving Company\");\n\t\tDatabase.saveRecordParam(\"Rodent\", \"Companies\", {\n\t\t\t devId: {\n\t\t\t\t \"Id\": devId,\n\t\t\t\t \"Name\": formObj.Name, //new Date().getTime(),\n\t\t\t\t \"Address\": formObj.Address,//,deviceNum,\n\t\t\t\t \"Status\": formObj.Status,\n\t\t\t\t \"CreatedOn\": today,\n\t\t\t\t \"UpdatedOn\" : today,\n\t\t\t\t \"Owner\": Client.getUser(),\n\t\t\t\t \"CreatedBy\": Client.getUser(),\n\t\t\t\t \"UpdatedBy\": Client.getUser()\n\t\t\t }\n\n\t\t }, function (data) {\n\t\t\t Client.jumpToScreen(\"Manage Companies\");\n\t\t}); \n\t\tconsole.log(\"after company save\");\n\n\t\n      /*   \n    Database.readRecords(\"rodent\", \"Companies\", function(eventData) {\n        var companyCollection = SensaCollection.load(eventData.value);\n        var formObj = Script.getFormByKey(\"companyform\");\n        \n        if (formObj == undefined) {\n            alert(\"Please fill out all required fields\");\n            return;\n        }\n\n        var dbReq = {};\n        var companyCount = Object.keys(companyCollection.data).length;\n        formObj.Id = `${companyCount + 1}`;\n        formObj.Status = +formObj.Status;\n\n        let today = new Date();\n        today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n        formObj.CreatedOn = today;\n        formObj.UpdatedOn = today;\n        formObj.CreatedBy = Client.getUser();\n        formObj.UpdatedBy = Client.getUser();\n        dbReq[companyCount + 1] = formObj;\n\n       /** Database.createRecords(\"rodent\", \"Companies\", dbReq, () => {\n            \n            Client.jumpToScreen(\"Manage Companies\");\n        });\n\t\t\n\t\tvar id = formObj.Id;\n\t\tDatabase.saveRecordParam(\"Rodent\", \"Companies\", {\n\n\t\t\t id: {\n\t\t\t\t \"Id\": formObj.Id,\n\t\t\t\t \"Name\": formObj.Name, //new Date().getTime(),\n\t\t\t\t \"Address\": formObj.Address,//,deviceNum,\n\t\t\t\t \"Status\": formObj.Status,\n\t\t\t\t \"CreatedOn\": today,\n\t\t\t\t \"UpdatedOn\" : today,\n\t\t\t\t \"Owner\": Client.getUser(),\n\t\t\t\t \"CreatedBy\": Client.getUser(),\n\t\t\t\t \"UpdatedBy\": Client.getUser()\n\t\t\t\t\n\t\t\t }\n\n\t\t }, function (data) {\n\t\t\t //console.log(\"inisde save: \" + selected.Id.toString() + \" data is \" + JSON.stringify(data, null, 4));\n\t\t\t Client.jumpToScreen(\"Manage Companies\");\n\t\t});\n    }); */\n\t});\n}"},"ev":{}},"feature05":{"t":"Input","lX":100,"lY":490,"sX":3.2,"sY":1,"s":"Edit User Access Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"320px","height":"11.83%","x":"100px","y":"490px"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","label text":"Clear Errors","form id":"addUser","form key":"Feature05","tab index":"8"},"ev":{}},"userRolesScripts":{"t":"Scripting","lX":1160,"lY":20,"sX":1,"sY":1,"s":"User Roles","ps":{"enabled":"false","scalingType":"OK","width":"9.07%","height":"8.26%","x":"77.06%","y":"4.95%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar userRolesCollection;\nvar currentCompany;\n\nconst userRolesTable = Script.getWidget(\"userRolesTable\");\nconst compDropdown = Script.getWidget(\"usersCompanyDropdown\");\n\nScript.on('load', function () {\n    Database.readRecords(\"rodent\", \"Companies\", function (eventData) {\n        let companyCollection = SensaCollection.load(eventData.value);\n\n        console.log(\"Companies are \" + JSON.stringify(companyCollection, null, 4));\n        Database.readRecords(\"rodent\", \"UserRoles\", function (eventData) {\n            userRolesCollection = SensaCollection.load(eventData.value);\n            let filteredUsers = userRolesCollection.query((record, pk) => {\n                if (record['User'] == Client.getUser()) {\n                    return true;\n                }\n            });\n            var userCompanies = filteredUsers.getColumn(\"CompanyId\");\n\n            //var filteredCompanies = userCompanies;\n\n            let filteredCompanies = companyCollection.query((record, pk) => {\n                //if (userCompanies.includes(pk)) {\n                return true;\n                //}\n            });\n\n            let compNames = filteredCompanies.getColumn(\"Name\");\n            let compLoc = filteredCompanies.getColumn(\"Address\");\n            let compIds = filteredCompanies.getColumn(\"Id\");\n\n            currentCompany = Script.getState(\"currentCompany\");\n            if (currentCompany == null) {\n                currentCompany = compIds[0];\n            }\n\n            let compObj = {};\n            compIds.map((comp, idx) => {\n                compObj[comp] = compNames[idx] + \", \" + compLoc[idx];\n            });\n\n            Object.keys(compObj).forEach((comp, idx) => {\n                filteredCompanies.set({ \"Id\": comp, \"Name\": compObj[comp] });\n            });\n\n            filteredCompanies.renameColumn(\"Name\", \"text\");\n            filteredCompanies.renameColumn(\"Id\", \"value\");\n\n            compDropdown.receiveTextValues(filteredCompanies);\n            compDropdown.receiveValue(compObj[currentCompany]);\n\n            updateTable();\n        });\n    });\n});\n\nClientEvents.subscribe(\"usrCcompSelected\", changeCompany);\nClientEvents.subscribe(\"userEdit\", editUser);\nClientEvents.subscribe(\"newUser\", createNewUser);\nClientEvents.subscribe(\"deleteUsers\", deleteUsers);\n\nasync function changeCompany(selected) {\n    currentCompany = selected.value;\n\n    Database.readRecords(\"rodent\", \"UserRoles\", function (eventData) {\n        userRolesCollection = SensaCollection.load(eventData.value);\n        updateTable();\n    });\n}\n\nfunction updateTable() {\n    let filteredUsers = userRolesCollection.query((record, pk) => {\n        if ((record['CompanyId'] == currentCompany) &&\n            (record['Status'] == '1')) {\n            return true;\n        }\n    });\n\n    for (const key in filteredUsers.data) {\n        var date = filteredUsers.data[key][4];\n        console.log(\"Data user is \" + date);\n        //(!isNaN(date) && date != null && data != \"\" && data != undefined)\n        if (!isNaN(date) && date !== undefined && date !== \"\") {\n            console.log(\"Data is 2  user \" + date);\n            filteredUsers.data[key][4] = formatDate(date);\n        }\n    }\n\n    var tableCollection = filteredUsers.filter([\"Id\", \"User\", \"UpdatedOn\", \"UpdatedBy\", \"IsAdmin\", \"IsPrimary\"]);\n    tableCollection.setColumns([\"Id\", \"User\", \"Updated On\", \"Updated By\", \"Is Admin\", \"Is Primary\"]);\n\n    ClientEvents.publish(\"usrDelRows\", \"\");\n    userRolesTable.receiveValue(tableCollection);\n}\n\nfunction editUser(eventData) {\n    //userRolesCollection\n    var key = Object.keys(eventData.value.data)[0]\n    eventData.value.data[key][4] = userRolesCollection.data[key][4];\n    Script.setState(\"userRoleInfo\", eventData.value);\n    //console.log(\"User event data \" + JSON.stringify(eventData.value, null, 4));\n    Script.setState(\"companyId\", currentCompany);\n\n    //console.log(\"User company \" + currentCompany);\n    Script.setState(\"modifyType\", \"edit\");\n    Client.jumpToScreen(\"Edit User Role\");\n}\n\nfunction createNewUser() {\n    Script.setState(\"companyId\", currentCompany);\n    Script.setState(\"modifyType\", \"add\");\n    Client.jumpToScreen(\"Edit User Role\");\n}\n\nfunction deleteUsers() {\n    let formData = Script.getFormByKey(\"roles\");\n    var ids = formData.users.getColumn(\"id\");\n\n    if (ids.length === 0) return;\n    var option = { \"confirmText\": \"Confirm\", \"cancelText\": \"Cancel\" };\n    Client.confirm(\"Do you want to delete user role?\", \"Delete User Roles\", option).then((eventData) => {\n\n        //console.log(\"Return data is  is \" + JSON.stringify(eventData, null, 4));\n\n        if (!eventData) return;\n        // your code here\n        for (var i = 0; i < ids.length; i++) {\n            userRolesTable.deleteRows(ids[i]);\n            Database.deleteRecord(\"rodent\", \"UserRoles\", \"Id\", ids[i]);\n        }\n    });\n\n}\n\nfunction formatDate(today) {\n\n   //return Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n    var date = new Date(parseInt(today)).toLocaleString('en-GB');\n    var d = date.split(\", \");\n    var d0 = d[0].split(\"/\");\n    //d0[2] = Math.abs(d0[2] - 2000);\n\t//d0[2] = Math.abs(d0[2]);\n    d0 = d0.join(\"/\");\n    //return d[1] + \" \" + d0;\n    return d0 + \" \" + d[1].substring(0, 5);\n}","file name":"../../js/settings/manage user roles/manageUserRoles.js"},"ev":{}},"feature03":{"t":"Input","lX":100,"lY":370,"sX":3.2,"sY":1,"s":"Edit User Access Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"320px","height":"11.83%","x":"100px","y":"370px"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","form id":"addUser","form key":"Feature03","label text":"Create Site Events","color":"grey","tab index":"6"},"ev":{}},"feature04":{"t":"Input","lX":100,"lY":430,"sX":3.2,"sY":1,"s":"Edit User Access Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"320px","height":"11.83%","x":"100px","y":"430px"},"ver":"270520c210519","z":"130","dis":false,"tt":"","a":{"type":"checkbox","form id":"addUser","form key":"Feature04","label text":"Device Actions","color":"grey","tab index":"7"},"ev":{}},"feature06":{"t":"Input","lX":100,"lY":550,"sX":3.2,"sY":1,"s":"Edit User Access Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"320px","height":"11.83%","x":"100px","y":"550px"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","label text":"Manage Floor Map","form id":"addUser","form key":"Feature06","tab index":"9"},"ev":{}},"Input#8":{"t":"Input","lX":80,"lY":140,"sX":2,"sY":1,"s":"Packet 6 Transactions","ps":{"enabled":"true","scalingType":"NOVERT","width":"200px","height":"6.06%","x":"80px","y":"137px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"device-info","form key":"device-number","label text":"Device Number (eg. 999044)"},"ev":{}},"Display Transactions":{"t":"Button","lX":300,"lY":140,"sX":1.8,"sY":1.09,"s":"Packet 6 Transactions","ps":{"enabled":"true","scalingType":"OK","width":"180px","height":"50px","x":"300px","y":"140px"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Display Transactions","color":"orange strong","outline color":"grey","text color":"white"},"ev":{"clientEvents":{"outputEvents":{"displayTransactions":{"channel":"displayTransactions/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"downloadData":{"t":"Button","lX":1425,"lY":140,"sX":1.8,"sY":1.09,"s":"Packet 6 Transactions","ps":{"enabled":"true","scalingType":"OK","width":"180px","height":"50px","x":"100% - 260px","y":"140px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"button name":"Download Data","color":"orange strong","outline color":"grey","text color":"white"},"ev":{}},"isSmartCheckbox":{"t":"Input","lX":215,"lY":320,"sX":0.85,"sY":1,"s":"Edit Model Type","ps":{"enabled":"false","scalingType":"NOVERT","width":"7.71%","height":"11%","x":"75px","y":"170px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modalTypeForm","form key":"IsSmart","type":"checkbox","default value":"1","label text":"Smart","checkbox label side":"right"},"ev":{}},"isDefaultCheckbox":{"t":"Input","lX":295,"lY":320,"sX":0.95,"sY":1,"s":"Edit Model Type","ps":{"enabled":"false","scalingType":"NOVERT","width":"8.61%","height":"11%","x":"75px","y":"170px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modalTypeForm","form key":"IsDefault","type":"checkbox","label text":"Default","checkbox label side":"right"},"ev":{}},"Input#9":{"t":"Input","lX":80,"lY":250,"sX":3,"sY":1,"s":"Edit Model","ps":{"enabled":"false","scalingType":"NOVERT","width":"300px","height":"10%","x":"80px","y":"250px"},"ver":"270520c210519","z":"100","dis":false,"tt":"","a":{"form id":"modelForm","form key":"BatteryLower","label text":"Battery Lower","color":"grey"},"ev":{}},"modelIconUrlInput":{"t":"Input","lX":80,"lY":310,"sX":3,"sY":1,"s":"Edit Model","ps":{"enabled":"true","scalingType":"NOVERT","width":"300px","height":"10%","x":"80px","y":"310px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modelForm","form key":"IconURL","label text":"Icon Url","color":"grey"},"ev":{}},"Input#10":{"t":"Input","lX":85,"lY":130,"sX":5.5,"sY":1,"s":"Edit Model Type","ps":{"enabled":"false","scalingType":"NOVERT","width":"550px","height":"11%","x":"80px","y":"100px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modalTypeForm","form key":"Question1","required":"true","label text":"Question 1","color":"grey"},"ev":{}},"Input#11":{"t":"Input","lX":90,"lY":185,"sX":5.5,"sY":1,"s":"Edit Model Type","ps":{"enabled":"false","scalingType":"NOVERT","width":"550px","height":"11%","x":"80px","y":"100px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modalTypeForm","form key":"Question2","required":"true","label text":"Question 2","color":"grey"},"ev":{}},"Input#12":{"t":"Input","lX":90,"lY":245,"sX":5.5,"sY":1,"s":"Edit Model Type","ps":{"enabled":"false","scalingType":"NOVERT","width":"550px","height":"11%","x":"80px","y":"100px"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modalTypeForm","form key":"Question3","required":"true","label text":"Question 3","color":"grey"},"ev":{}},"BarcodeScanner#0":{"t":"BarcodeScanner","lX":489,"lY":150,"sX":3.34,"sY":2.67,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"28.06%","height":"50.45%","x":"45%","y":"31.13%"},"ver":"190104c210519","dis":false,"tt":"","a":{},"ev":{"clientEvents":{"inputEvents":{"qaDeviceScan":{"channel":"qaDeviceScan/activate","event":"activate","important":"false"},"stopQaDeviceScanner":{"channel":"stopQaDeviceScanner/deactivate","event":"deactivate","important":"false"}},"outputEvents":{"qaDeviceDetected":{"channel":"qaDeviceDetected/receive value","event":"Detected","trigger":"Detected","important":"false"}}}}},"Button#0":{"t":"Button","lX":375,"lY":90,"sX":0.95,"sY":0.87,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"8%","height":"7.55%","x":"32%","y":"17%"},"ver":"190104c210519","vis":false,"dis":false,"tt":"","a":{"button name":"Press"},"ev":{"clientEvents":{"outputEvents":{"testPubChannel":{"channel":"testPubChannel/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Scripting#3":{"t":"Scripting","lX":460,"lY":10,"sX":1,"sY":1,"s":"QA Dashboard","ps":{"enabled":false,"scalingType":"OK","width":"8.41%","height":"18.87%","x":"38.69%","y":"1.89%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description:\n * Create Author/Date:\n * Modified Author/Date Date:\n * Version:\n */\n\n var deviceNumber;\n var deviceId;\n let reportObj = {};\n let p4LoadCell;\n let p5LoadCell;\n let p1LoadCell;\n let p2LoadCell;\n let rebaitRange;\n \n /**\n  * Initialise script state (run once at startup)\n  */\n Script.on(\"load\", function () {\n   Script.disableWidget(\"qaFinishButton\");\n });\n \n Script.on(\"server\", function (eventData, channel) {\n   var channelData = channel.split(\"/\");\n   var category = channelData[0].toUpperCase();\n   var className = channelData[1].toUpperCase();\n   var instance = parseInt(channelData[2]);\n   var scope = channelData[3].toUpperCase();\n   var value = eventData.value;\n debugger;\n \n   if (\n     category !== \"RODENTS\" ||\n     className !== \"QA\" ||\n     instance !== deviceNumber\n   ) {\n     return;\n   }\n \n   switch (scope) {\n     case \"REGIONCHECK\":\n       console.log(\"Region Check == \" + value);\n       if (parseInt(value) == 1) {\n         ClientEvents.publish(\"regionPassColor\", \"green\");\n         reportObj.regionCheck = true;\n       } else {\n         ClientEvents.publish(\"regionFailColor\", \"red\");\n         reportObj.regionCheck = false;\n       }\n       break;\n     case \"BATTERYCHECK\":\n       console.log(\"Region Check == \" + value);\n       if (parseInt(value) == 1) {\n         ClientEvents.publish(\"batteryPassColor\", \"green\");\n         reportObj.batteryCheck = true;\n       } else {\n         ClientEvents.publish(\"batteryFailColor\", \"red\");\n         reportObj.batteryCheck = false;\n       }\n       break;\n     case \"TILTCHECK\":\n       console.log(\"Region Check == \" + value);\n       if (parseInt(value) == 1) {\n         ClientEvents.publish(\"tiltPassColor\", \"green\");\n         reportObj.tiltCheck = true;\n       } else {\n         ClientEvents.publish(\"tiltFailColor\", \"red\");\n         reportObj.tiltCheck = false;\n       }\n       break;\n     // case \"LOADCELLCHECK\":\n     //   console.log(\"Region Check == \" + value);\n     //   if (parseInt(value) == 1) {\n     //     ClientEvents.publish(\"loadPassColor\", \"green\");\n     //     reportObj.loadCellCheck = true;\n     //   } else {\n     //     ClientEvents.publish(\"loadFailColor\", \"red\");\n     //     reportObj.loadCellCheck = false;\n     //   }\n     //   break;\n     case \"IRLEFTCHECK\":\n       console.log(\"Region Check == \" + value);\n       if (parseInt(value) == 1) {\n         ClientEvents.publish(\"leftIRPassColor\", \"green\");\n         reportObj.irLeftCheck = true;\n       } else {\n         ClientEvents.publish(\"leftIRFailColor\", \"red\");\n         reportObj.irLeftCheck = false;\n       }\n       break;\n     case \"IRRIGHTCHECK\":\n       console.log(\"Region Check == \" + value);\n       if (parseInt(value) == 1) {\n         ClientEvents.publish(\"rightIRPassColor\", \"green\");\n         reportObj.irRightCheck = true;\n       } else {\n         ClientEvents.publish(\"rightIRFailColor\", \"red\");\n         reportObj.irRightCheck = false;\n       }\n       break;\n     // case \"WEIGHTDROPCHECK\":\n     //   console.log(\"Region Check == \" + value);\n     //   if (parseInt(value) == 1) {\n     //     ClientEvents.publish(\"weightDropPassColor\", \"green\");\n     //     reportObj.weightDropCheck = true;\n     //   } else {\n     //     ClientEvents.publish(\"weightDropFailColor\", \"red\");\n     //     reportObj.weightDropCheck = false;\n     //   }\n     //   break;\n     case \"P8CHECK\":\n       console.log(\"Region Check == \" + value);\n       if (parseInt(value) == 1) {\n         ClientEvents.publish(\"p8PassColor\", \"green\");\n         reportObj.p8Check = true;\n         calculateOverallReport();\n       } else {\n         ClientEvents.publish(\"p8FailColor\", \"red\");\n         reportObj.p8Check = false;\n         calculateOverallReport();\n       }\n       break;\n     case \"P1LOADCELL\":\n       p1LoadCell = parseInt(value);\n       break;\n     case \"P2LOADCELL\":\n       p2LoadCell = parseInt(value);\n       if(!p1LoadCell) break;\n       const range = p2LoadCell - p1LoadCell;\n       rebaitRange = range / 111.1;\n       //const rebaitRange = calculateRebaitRange(p1LoadCell,p2LoadCell);\n       if (rebaitRange >= 4000 && rebaitRange <= 5000) {\n         ClientEvents.publish(\"loadPassColor\", \"green\");\n         reportObj.loadCellCheck = true;\n       } else {\n         ClientEvents.publish(\"loadFailColor\", \"red\");\n         reportObj.loadCellCheck = false;\n       }\n       break;\n     case \"P4LOADCELL\":\n       p4LoadCell = parseInt(value);\n       break;\n     case \"P5LOADCELL\":\n       p5LoadCell = parseInt(value);       \n       const p5Range = p5LoadCell-p4LoadCell;\n       const weightDropRebaitRange = p5Range/rebaitRange;\n       if (weightDropRebaitRange >= 48 && weightDropRebaitRange <= 52) {\n         ClientEvents.publish(\"weightDropPassColor\", \"green\");\n         reportObj.weightDropCheck = true;\n       } else {\n         ClientEvents.publish(\"weightDropFailColor\", \"red\");\n         reportObj.weightDropCheck = false;\n       }\n       break;\n   }\n });\n \n ClientEvents.subscribe(\"deviceInput\", function (eventData) {\n   deviceNumber = parseInt(eventData.value);\n   var channelObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"Enabled\",\n     label: \"number\",\n     value: \"1\",\n   };\n   Script.publishToChannel(channelObj);\n });\n function calculateOverallReport() {\n   const {\n     turnOnLed,\n     regionCheck,\n     batteryCheck,\n     tiltCheck,\n     buttonPressLed,\n     loadCellCheck,\n     irLeftCheck,\n     irRightCheck,\n     weightDropCheck,\n     turnOffLed,\n     p8Check,\n   } = reportObj;\n   if (\n     turnOnLed !== undefined &&\n     regionCheck !== undefined &&\n     batteryCheck !== undefined &&\n     tiltCheck !== undefined &&\n     buttonPressLed !== undefined &&\n     loadCellCheck !== undefined &&\n     irLeftCheck !== undefined &&\n     irRightCheck !== undefined &&\n     weightDropCheck !== undefined &&\n     turnOffLed !== undefined &&\n     p8Check !== undefined\n   ) {\n     Script.enableWidget(\"qaFinishButton\");\n     const failValues = [];\n     Object.keys(reportObj).forEach((id) => {\n       if (!reportObj[id]) {\n         failValues.push({});\n       }\n     });\n     if (failValues.length > 0) {\n       ClientEvents.publish(\"overallFailColor\", \"red\");\n       reportObj.overallResult = false;\n     } else {\n       ClientEvents.publish(\"overallPassColor\", \"green\");\n       reportObj.overallResult = true;\n     }\n   }\n }\n \n ClientEvents.subscribe(\"testPubChannel\", function (EventData) {\n   var channelObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"Enabled\",\n     label: \"number\",\n     value: \"1\",\n   };\n   var p1LoadCellObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"P1LOADCELL\",\n     label: \"number\",\n     value: \"50000\",\n   };\n   var p2LoadCellObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"P2LOADCELL\",\n     label: \"number\",\n     value: \"600000\",\n   };\n   var p5LoadCellObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"P5LOADCELL\",\n     label: \"number\",\n     value: \"6000\",\n   };\n   var p4LoadCellObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"P4LOADCELL\",\n     label: \"number\",\n     value: \"400\",\n   };\n   Script.publishToChannel(channelObj);\n   var channelObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"REGIONCHECK\",\n     label: \"number\",\n     value: \"0\",\n   };\n   var batteryChannelObj = {\n     category: \"Rodents\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"BATTERYCHECK\",\n     label: \"number\",\n     value: \"0\",\n   };\n   var tiltChannelObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"TILTCHECK\",\n     label: \"number\",\n     value: \"0\",\n   };\n   var loadChannelObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"LOADCELLCHECK\",\n     label: \"number\",\n     value: \"0\",\n   };\n   var IRLeftChannelObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"IRLEFTCHECK\",\n     label: \"number\",\n     value: \"1\",\n   };\n   var IRRightChannelObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"IRRIGHTCHECK\",\n     label: \"number\",\n     value: \"1\",\n   };\n   var weightDropChannelObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"WEIGHTDROPCHECK\",\n     label: \"number\",\n     value: \"1\",\n   };\n   var p8ChannelObj = {\n     category: \"RODENTS\",\n     className: \"QA\",\n     instance: deviceNumber.toString(),\n     scope: \"P8CHECK\",\n     label: \"number\",\n     value: \"1\",\n   };\n   Script.publishToChannel(channelObj);\n   Script.publishToChannel(batteryChannelObj);\n   Script.publishToChannel(tiltChannelObj);\n   Script.publishToChannel(loadChannelObj);\n   Script.publishToChannel(IRLeftChannelObj);\n   Script.publishToChannel(IRRightChannelObj);\n   Script.publishToChannel(weightDropChannelObj);\n   Script.publishToChannel(p8ChannelObj);\n   Script.publishToChannel(p2LoadCellObj);\n   Script.publishToChannel(p1LoadCellObj);\n   Script.publishToChannel(p4LoadCellObj);\n   Script.publishToChannel(p5LoadCellObj);\n });\n \n ClientEvents.subscribe(\"onLedPass\", function (eventData) {\n   if (eventData.value) {\n     Script.setForm(\"qaForm\", { ledFail: false });\n     reportObj.turnOnLed = true;\n     ClientEvents.publish(\"ledFailRed\", \"\");\n     ClientEvents.publish(\"ledPassGreen\", \"green\");\n   } else {\n     Script.setForm(\"qaForm\", { ledFail: true });\n     reportObj.turnOnLed = false;\n     ClientEvents.publish(\"ledFailRed\", \"red\");\n     ClientEvents.publish(\"ledPassGreen\", \"\");\n     calculateOverallReport();\n   }\n });\n \n ClientEvents.subscribe(\"onLedFail\", function (eventData) {\n   if (eventData.value) {\n     Script.setForm(\"qaForm\", { ledPass: false });\n     reportObj.turnOnLed = false;\n     ClientEvents.publish(\"ledFailRed\", \"red\");\n     ClientEvents.publish(\"ledPassGreen\", \"\");\n     calculateOverallReport();\n   } else {\n     Script.setForm(\"qaForm\", { ledPass: true });\n     reportObj.turnOnLed = true;\n     ClientEvents.publish(\"ledFailRed\", \"\");\n     ClientEvents.publish(\"ledPassGreen\", \"green\");\n   }\n });\n \n ClientEvents.subscribe(\"onPressLedPass\", function (eventData) {\n   if (eventData.value) {\n     Script.setForm(\"qaForm\", { pressLedFail: false });\n     reportObj.buttonPressLed = true;\n     ClientEvents.publish(\"pressLedFailRed\", \"\");\n     ClientEvents.publish(\"pressLedPassGreen\", \"green\");\n   } else {\n     Script.setForm(\"qaForm\", { pressLedFail: true });\n     reportObj.buttonPressLed = false;\n     ClientEvents.publish(\"pressLedFailRed\", \"red\");\n     ClientEvents.publish(\"pressLedPassGreen\", \"\");\n     calculateOverallReport();\n   }\n });\n \n ClientEvents.subscribe(\"onPressLedFail\", function (eventData) {\n   if (eventData.value) {\n     Script.setForm(\"qaForm\", { pressLedPass: false });\n     reportObj.buttonPressLed = false;\n     ClientEvents.publish(\"pressLedFailRed\", \"red\");\n     ClientEvents.publish(\"pressLedPassGreen\", \"\");\n     calculateOverallReport();\n   } else {\n     Script.setForm(\"qaForm\", { pressLedPass: true });\n     reportObj.buttonPressLed = true;\n     ClientEvents.publish(\"pressLedFailRed\", \"\");\n     ClientEvents.publish(\"pressLedPassGreen\", \"green\");\n   }\n });\n \n ClientEvents.subscribe(\"onTurnOffLedPass\", function (eventData) {\n   if (eventData.value) {\n     Script.setForm(\"qaForm\", { turnOffLedFail: false });\n     reportObj.turnOffLed = true;\n     ClientEvents.publish(\"turnOffLedRed\", \"\");\n     ClientEvents.publish(\"turnOffLedGreen\", \"green\");\n   } else {\n     Script.setForm(\"qaForm\", { turnOffLedFail: true });\n     reportObj.turnOffLed = false;\n     ClientEvents.publish(\"turnOffLedRed\", \"red\");\n     ClientEvents.publish(\"turnOffLedGreen\", \"\");\n     calculateOverallReport();\n   }\n });\n \n ClientEvents.subscribe(\"onTurnOffLedFail\", function (eventData) {\n   if (eventData.value) {\n     Script.setForm(\"qaForm\", { turnOffLedPass: false });\n     reportObj.turnOffLed = false;\n     ClientEvents.publish(\"turnOffLedRed\", \"red\");\n     ClientEvents.publish(\"turnOffLedGreen\", \"\");\n     calculateOverallReport();\n   } else {\n     Script.setForm(\"qaForm\", { turnOffLedPass: true });\n     reportObj.turnOffLed = true;\n     ClientEvents.publish(\"turnOffLedRed\", \"\");\n     ClientEvents.publish(\"turnOffLedGreen\", \"green\");\n   }\n });\n \n ClientEvents.subscribe(\"qaDeviceDetected\", function (data) {\n   var res = data.value.split(\",\");\n   const device = {\n     model: res[0],\n     deviceId: res[1],\n   };\n   deviceNumber = parseInt(device.deviceId);\n   ClientEvents.publish(\"setQaDeviceNumber\", deviceNumber);\n   Script.setForm(\"qaForm\", { deviceNumber: deviceNumber });\n   updateQaFlag(deviceNumber, \"1\");\n   ClientEvents.publish(\"stopQaDeviceScanner\", \"\");\n });\n \n ClientEvents.subscribe(\"startQaScan\", function (data) {\n   ClientEvents.publish(\"qaDeviceScan\", \"\", false);\n });\n \n function updateQaFlag(deviceNumber, isQAEnabled) {\n   Database.readRecords(\n     \"rodent\",\n     \"Devices\",\n     function (eventData) {\n       let collection = SensaCollection.load(eventData.value);\n       const device = collection.getFirst();\n       if (device) {\n         const dbVal = {};\n         deviceId = device.Id;\n         dbVal[device.Id] = {\n           Id: `${device.Id}`,\n           IsQAEnabled: isQAEnabled,\n         };\n         Database.updateRecord(\"rodent\", \"Devices\", dbVal);\n       }\n     },\n     {\n       filter: `DeviceNumber='${deviceNumber}'`,\n     }\n   );\n }\n \n ClientEvents.subscribe(\"qaFinish\", function (eventData) {\n   updateQaFlag(deviceNumber, \"0\");\n   Database.readRecords(\"rodent\", \"QaLogs\", function (eventData) {\n     let collection = SensaCollection.load(eventData.value);\n     const keys = Object.keys(collection.data);\n     const id = keys.length > 0 ? parseInt(keys[keys.length - 1]) + 1 : 1;\n     const dbVal = {};\n     dbVal[id] = {\n       Id: `${id}`,\n       DeviceId: deviceId,\n       TurnOnLEDCheck: reportObj.turnOnLed ? \"Pass\" : \"Fail\",\n       RegionCheck: reportObj.regionCheck ? \"Pass\" : \"Fail\",\n       BatteryCheck: reportObj.batteryCheck ? \"Pass\" : \"Fail\",\n       TiltCheck: reportObj.tiltCheck ? \"Pass\" : \"Fail\",\n       ButtonPressLED: reportObj.buttonPressLed ? \"Pass\" : \"Fail\",\n       LoadCellCheck: reportObj.loadCellCheck ? \"Pass\" : \"Fail\",\n       LefIRCheck: reportObj.irLeftCheck ? \"Pass\" : \"Fail\",\n       RightIRCheck: reportObj.irRightCheck ? \"Pass\" : \"Fail\",\n       WeightDropCheck: reportObj.weightDropCheck ? \"Pass\" : \"Fail\",\n       TurnOffLEDCheck: reportObj.turnOffLed ? \"Pass\" : \"Fail\",\n       TurnOffP8Check: reportObj.p8Check ? \"Pass\" : \"Fail\",\n       OverallResult: reportObj.overallResult ? \"Pass\" : \"Fail\",\n     };\n     Database.createRecords(\"rodent\", \"QaLogs\", dbVal, function () {});\n     deviceNumber = null;\n     deviceId = null;\n     reportObj = {};\n   });\n   Script.clearForm(\"qaForm\");\n   ClientEvents.publish(\"setQaDeviceNumber\", \"----------------\");\n   ClientEvents.publish(\"regionPassColor\", \"white\");\n   ClientEvents.publish(\"regionFailColor\", \"white\");\n   ClientEvents.publish(\"batteryPassColor\", \"white\");\n   ClientEvents.publish(\"batteryFailColor\", \"white\");\n   ClientEvents.publish(\"tiltPassColor\", \"white\");\n   ClientEvents.publish(\"tiltFailColor\", \"white\");\n   ClientEvents.publish(\"loadPassColor\", \"white\");\n   ClientEvents.publish(\"loadFailColor\", \"white\");\n   ClientEvents.publish(\"leftIRPassColor\", \"white\");\n   ClientEvents.publish(\"leftIRFailColor\", \"white\");\n   ClientEvents.publish(\"rightIRPassColor\", \"white\");\n   ClientEvents.publish(\"rightIRFailColor\", \"white\");\n   ClientEvents.publish(\"weightDropPassColor\", \"white\");\n   ClientEvents.publish(\"weightDropFailColor\", \"white\");\n   ClientEvents.publish(\"p8PassColor\", \"white\");\n   ClientEvents.publish(\"p8FailColor\", \"white\");\n   ClientEvents.publish(\"overallFailColor\", \"white\");\n   ClientEvents.publish(\"overallPassColor\", \"white\");\n   ClientEvents.publish(\"ledFailRed\", \"\");\n   ClientEvents.publish(\"ledPassGreen\", \"\");\n   ClientEvents.publish(\"pressLedFailRed\", \"\");\n   ClientEvents.publish(\"pressLedPassGreen\", \"\");\n   ClientEvents.publish(\"turnOffLedRed\", \"\");\n   ClientEvents.publish(\"turnOffLedGreen\", \"\");\n });"},"ev":{"serverEvents":{"inputEvents":{"New Event #1":{"channel":"$DB/ADMIN/MANAGE/REQUEST","event":"feed","important":"false"},"New Event #2":{"channel":"Rodents/QA/+/+","event":"feed","important":"false"}}}}},"Label#0":{"t":"Label","lX":304,"lY":125,"sX":0.47,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"3.99%","height":"3.53%","x":"28%","y":"26%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"Pass"},"ev":{}},"Label#1":{"t":"Label","lX":375,"lY":125,"sX":0.48,"sY":0.84,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"4%","height":"3.94%","x":"34%","y":"26%"},"ver":"200124c210519","z":"100","dis":false,"tt":"","a":{"font size":"14","label text":"Fail"},"ev":{}},"Label#2":{"t":"Label","lX":43,"lY":149,"sX":2.38,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"20.04%","height":"3.53%","x":"4%","y":"31%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"1. Turn On LED................................"},"ev":{}},"Label#3":{"t":"Label","lX":43,"lY":183,"sX":2.38,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"20.04%","height":"3.53%","x":"4%","y":"38%"},"ver":"200124c210519","z":"100","dis":false,"tt":"","a":{"font size":"14","label text":"2. Region Check..............................."},"ev":{}},"Label#4":{"t":"Label","lX":43,"lY":222,"sX":2.38,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"20.04%","height":"3.53%","x":"4%","y":"45%"},"ver":"200124c210519","z":"100","dis":false,"tt":"","a":{"font size":"14","label text":"3. Battery Check.............................."},"ev":{}},"Label#5":{"t":"Label","lX":43,"lY":260,"sX":2.38,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"20.04%","height":"3.53%","x":"4%","y":"52%"},"ver":"200124c210519","z":"100","dis":false,"tt":"","a":{"font size":"14","label text":"4. Tilt Check......................................"},"ev":{}},"Label#6":{"t":"Label","lX":43,"lY":299,"sX":2.38,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"20.04%","height":"3.53%","x":"4%","y":"59%"},"ver":"200124c210519","z":"100","dis":false,"tt":"","a":{"font size":"14","label text":"5. Button Press Led........................."},"ev":{}},"Label#7":{"t":"Label","lX":43,"lY":318,"sX":2.38,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"20.04%","height":"3.53%","x":"4%","y":"66%"},"ver":"200124c210519","z":"100","dis":false,"tt":"","a":{"font size":"14","label text":"6. Load Cell Check..........................."},"ev":{}},"Input#14":{"t":"Input","lX":470,"lY":236,"sX":0.48,"sY":1,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOVERT","width":"4%","height":"6.87%","x":"27.3%","y":"30.5%"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","form id":"qaForm","form key":"ledPass"},"ev":{"clientEvents":{"inputEvents":{"ledPassGreen":{"channel":"ledPassGreen/change checkbox color","event":"change checkbox color","important":"false"}},"outputEvents":{"onLedPass":{"channel":"onLedPass/receive value","event":"on change","trigger":"on change","important":"false"}}}}},"Input#15":{"t":"Input","lX":554,"lY":236,"sX":0.48,"sY":1,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOVERT","width":"4%","height":"6.87%","x":"32.25%","y":"30.5%"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","form id":"qaForm","form key":"ledFail"},"ev":{"clientEvents":{"inputEvents":{"ledFailRed":{"channel":"ledFailRed/change checkbox color","event":"change checkbox color","important":"false"}},"outputEvents":{"onLedFail":{"channel":"onLedFail/receive value","event":"on change","trigger":"on change","important":"false"}}}}},"Icon#3":{"t":"Icon","lX":498,"lY":297,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.06%","x":"29%","y":"38.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"regionPassColor":{"channel":"regionPassColor/set color","event":"set color","important":"false"}}}}},"Icon#4":{"t":"Icon","lX":369,"lY":186,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"34%","y":"38.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"regionFailColor":{"channel":"regionFailColor/set color","event":"set color","important":"false"}}}}},"Icon#5":{"t":"Icon","lX":315,"lY":219,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"29%","y":"45.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"batteryPassColor":{"channel":"batteryPassColor/set color","event":"set color","important":"false"}}}}},"Icon#6":{"t":"Icon","lX":369,"lY":231,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"34%","y":"45.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"batteryFailColor":{"channel":"batteryFailColor/set color","event":"set color","important":"false"}}}}},"Icon#7":{"t":"Icon","lX":315,"lY":253,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"29%","y":"52.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"tiltPassColor":{"channel":"tiltPassColor/set color","event":"set color","important":"false"}}}}},"Icon#8":{"t":"Icon","lX":369,"lY":265,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"34%","y":"52.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"tiltFailColor":{"channel":"tiltFailColor/set color","event":"set color","important":"false"}}}}},"Input#16":{"t":"Input","lX":485,"lY":452,"sX":0.47,"sY":1,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOVERT","width":"3.99%","height":"6.87%","x":"27.3%","y":"58.5%"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","form id":"qaForm","form key":"pressLedPass"},"ev":{"clientEvents":{"inputEvents":{"pressLedPassGreen":{"channel":"pressLedPassGreen/change checkbox color","event":"change checkbox color","important":"false"}},"outputEvents":{"onPressLedPass":{"channel":"onPressLedPass/receive value","event":"on change","trigger":"on change","important":"false"}}}}},"Input#17":{"t":"Input","lX":572,"lY":452,"sX":0.47,"sY":1,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOVERT","width":"3.99%","height":"6.87%","x":"32.25%","y":"58.5%"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","form id":"qaForm","form key":"pressLedFail"},"ev":{"clientEvents":{"inputEvents":{"pressLedFailRed":{"channel":"pressLedFailRed/change checkbox color","event":"change checkbox color","important":"false"}},"outputEvents":{"onPressLedFail":{"channel":"onPressLedFail/receive value","event":"on change","trigger":"on change","important":"false"}}}}},"Icon#9":{"t":"Icon","lX":315,"lY":321,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"29%","y":"66.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"loadPassColor":{"channel":"loadPassColor/set color","event":"set color","important":"false"}}}}},"Icon#10":{"t":"Icon","lX":369,"lY":349,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"34%","y":"66.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"loadFailColor":{"channel":"loadFailColor/set color","event":"set color","important":"false"}}}}},"Label#8":{"t":"Label","lX":43,"lY":381,"sX":2.38,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"20.04%","height":"3.53%","x":"4%","y":"73%"},"ver":"200124c210519","z":"100","dis":false,"tt":"","a":{"font size":"14","label text":"7. Left IR Check................................"},"ev":{}},"Icon#11":{"t":"Icon","lX":315,"lY":383,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"29%","y":"73.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"leftIRPassColor":{"channel":"leftIRPassColor/set color","event":"set color","important":"false"}}}}},"Icon#12":{"t":"Icon","lX":369,"lY":383,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"34%","y":"73.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"leftIRFailColor":{"channel":"leftIRFailColor/set color","event":"set color","important":"false"}}}}},"Label#9":{"t":"Label","lX":43,"lY":415,"sX":2.38,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"20.04%","height":"3.53%","x":"4%","y":"79%"},"ver":"200124c210519","z":"100","dis":false,"tt":"","a":{"font size":"14","label text":"8. Right IR Check.............................."},"ev":{}},"Icon#13":{"t":"Icon","lX":315,"lY":417,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"29%","y":"80.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"rightIRPassColor":{"channel":"rightIRPassColor/set color","event":"set color","important":"false"}}}}},"Icon#14":{"t":"Icon","lX":369,"lY":417,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"34%","y":"80.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"rightIRFailColor":{"channel":"rightIRFailColor/set color","event":"set color","important":"false"}}}}},"Label#10":{"t":"Label","lX":43,"lY":415,"sX":2.38,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"20.04%","height":"3.53%","x":"4%","y":"86%"},"ver":"200124c210519","z":"100","dis":false,"tt":"","a":{"font size":"14","label text":"9. Weight Drop Check....................."},"ev":{}},"Icon#15":{"t":"Icon","lX":315,"lY":422,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"29%","y":"87.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"weightDropPassColor":{"channel":"weightDropPassColor/set color","event":"set color","important":"false"}}}}},"Icon#16":{"t":"Icon","lX":369,"lY":451,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"34%","y":"87.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"weightDropFailColor":{"channel":"weightDropFailColor/set color","event":"set color","important":"false"}}}}},"Label#11":{"t":"Label","lX":43,"lY":482,"sX":2.38,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"20.04%","height":"3.53%","x":"4%","y":"93%"},"ver":"200124c210519","z":"100","dis":false,"tt":"","a":{"font size":"14","label text":"10. Turn Off Led Check..................."},"ev":{}},"Input#18":{"t":"Input","lX":485,"lY":713,"sX":0.47,"sY":1,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOVERT","width":"3.99%","height":"7%","x":"27.3%","y":"92.5%"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","form id":"qaForm","form key":"turnOffLedPass"},"ev":{"clientEvents":{"inputEvents":{"turnOffLedGreen":{"channel":"turnOffLedGreen/change checkbox color","event":"change checkbox color","important":"false"}},"outputEvents":{"onTurnOffLedPass":{"channel":"onTurnOffLedPass/receive value","event":"on change","trigger":"on change","important":"false"}}}}},"Input#19":{"t":"Input","lX":572,"lY":713,"sX":0.47,"sY":1,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOVERT","width":"3.99%","height":"7%","x":"32.25%","y":"92.5%"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","form id":"qaForm","form key":"turnOffLedFail"},"ev":{"clientEvents":{"inputEvents":{"turnOffLedRed":{"channel":"turnOffLedRed/change checkbox color","event":"change checkbox color","important":"false"}},"outputEvents":{"onTurnOffLedFail":{"channel":"onTurnOffLedFail/receive value","event":"on change","trigger":"on change","important":"false"}}}}},"Label#12":{"t":"Label","lX":43,"lY":482,"sX":2.38,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"20.04%","height":"3.53%","x":"4%","y":"100%"},"ver":"200124c210519","z":"100","dis":false,"tt":"","a":{"font size":"14","label text":"11. Turn Off P8 Check....................."},"ev":{}},"Icon#17":{"t":"Icon","lX":315,"lY":480,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"29%","y":"99.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"p8PassColor":{"channel":"p8PassColor/set color","event":"set color","important":"false"}}}}},"Icon#18":{"t":"Icon","lX":369,"lY":480,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"34%","y":"99.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"p8FailColor":{"channel":"p8FailColor/set color","event":"set color","important":"false"}}}}},"Label#13":{"t":"Label","lX":43,"lY":530,"sX":2.38,"sY":0.75,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"20.04%","height":"3.53%","x":"4%","y":"110%"},"ver":"200124c210519","z":"100","dis":false,"tt":"","a":{"font size":"14","label text":"12. Overall Result............................"},"ev":{}},"Icon#19":{"t":"Icon","lX":315,"lY":528,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"29%","y":"109.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"overallPassColor":{"channel":"overallPassColor/set color","event":"set color","important":"false"}}}}},"Icon#20":{"t":"Icon","lX":369,"lY":528,"sX":0.54,"sY":0.54,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"2.27%","height":"5.19%","x":"34%","y":"109.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"action":"toggle","icon file":"circle-fill","outline color":"no outline","hover":"white","color":"white"},"ev":{"clientEvents":{"inputEvents":{"overallFailColor":{"channel":"overallFailColor/set color","event":"set color","important":"false"}}}}},"Label#14":{"t":"Label","lX":170,"lY":55,"sX":1.2,"sY":1.4,"s":"QA Dashboard","ps":{"enabled":false,"scalingType":"OK","width":"10.09%","height":"6.6%","x":"14.21%","y":"10.19%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"<font size=\"5\">---------------------</font>"},"ev":{"clientEvents":{"inputEvents":{"setQaDeviceNumber":{"channel":"setQaDeviceNumber/receive value","event":"receive value","important":"false"}}}}},"Button#2":{"t":"Button","lX":170,"lY":95,"sX":1,"sY":0.76,"s":"QA Dashboard","ps":{"enabled":false,"scalingType":"OK","width":"9.07%","height":"7.26%","x":"15.59%","y":"19.5%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Scan","color":"orange strong"},"ev":{"clientEvents":{"outputEvents":{"startQaScan":{"channel":"startQaScan/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"qaFinishButton":{"t":"Button","lX":409,"lY":525,"sX":1.02,"sY":0.53,"s":"QA Dashboard","ps":{"enabled":true,"scalingType":"OK","width":"8.61%","height":"4.56%","x":"37.62%","y":"109%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Finish","color":"orange strong"},"ev":{"clientEvents":{"outputEvents":{"qaFinish":{"channel":"qaFinish/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}}},"screens":{"Manage Products":{"index":0,"icon":"shopping_basket","meta":""},"Edit Product":{"index":1,"icon":"edit","meta":""},"Manage Master Products":{"index":2,"icon":"shopping_basket","meta":""},"User Roles":{"index":3,"icon":"verified_user","meta":""},"Edit User Role":{"index":4,"icon":"assignment_ind","meta":""},"Error Codes":{"index":5,"icon":"error","meta":""},"Edit Error Codes":{"index":6,"icon":"edit","meta":""},"Manage Companies":{"index":7,"icon":"business","meta":""},"Edit Company":{"index":8,"icon":"edit","meta":""},"Manage Model Types":{"index":9,"icon":"airplay","meta":""},"Edit Model Type":{"index":10,"icon":"create","meta":""},"Manage Device Models":{"index":11,"icon":"widgets","meta":""},"Edit Model":{"index":12,"icon":"mode_edit","meta":""},"Packet 6 Transactions":{"index":13,"icon":"data_usage","meta":""},"Application Settings":{"index":14,"icon":"widgets","meta":""},"Edit Application Settings":{"index":15,"icon":"create","meta":""},"User Access Role":{"index":16,"icon":"verified_user","meta":""},"Edit User Access Role":{"index":17,"icon":"mode_edit","meta":""},"QA Dashboard":{"index":18,"icon":"widgets","meta":""}},"meta":""}