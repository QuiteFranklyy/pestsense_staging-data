<!DOCTYPE html>
<html lang="en">
<head>
    <title>Trap Widget</title>
    <link rel="preload" href="../fonts/OpenSans400.woff2" as="font" crossorigin="anonymous">
    <link href="/widgets/js/line_chart/chartist.min.css" rel="stylesheet">

    <style>
    
    /* Customize the label (the container) */
    .container {
    display: block;
    position: relative;
        cursor: pointer;
        -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    }

    /* Hide the browser's default checkbox */
    .container input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
    }

    /* Create a custom checkbox */
    .checkmark {
    position: absolute;
    top: 3px;
    left: 0;
    height: 15px;
    width: 15px;
    background-color: #f2f2f2;
    border-radius: 2px;
    border: 2px solid #e57123;
    }

    /* On mouse-over, add a grey background color */
    .container:hover input ~ .checkmark {
    background-color: rgba(247, 152, 89, 0.7);
    }

    /* When the checkbox is checked, add a blue background */
    .container input:checked ~ .checkmark {
    background-color: rgba(245, 129, 51);
    }

    /* Create the checkmark/indicator (hidden when not checked) */
    .checkmark:after {
    content: "";
    position: absolute;
    display: none;
    }

    /* Show the checkmark when checked */
    .container input:checked ~ .checkmark:after {
    display: block;
    }

    /* Style the checkmark/indicator */
    .container .checkmark:after {
    left: 4px;
    /* top: 1px; */
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 3px 3px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
    }

    body {
    font-family: sans-serif !important;
    font-size: 16px;
    user-select: none;
    overflow-x: hidden;
    overflow-y: auto;
    }



    .noSelect {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    }

    #widget {
    background-color: white;
    }
    /* Hide scrollbar for Chrome, Safari and Opera */
    #container::-webkit-scrollbar {
    display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    #container {
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */
    }

    #container {
    position: fixed;
    height: calc(100% - 2px);
    border: 1px solid #ddd;
    border-radius: 3px;
    overflow: auto;
    }

    thead th {
    position: sticky;
    position: -webkit-sticky;
    top: 35px;
    z-index: 999;
    background-color: #f2f2f2;
    }

    .selectBtn:hover {
    color: #000000;
    text-decoration: none;
    font-family: sans-serif;
    background-color: #4d98c2ff;
    padding: 10px 25px;
    cursor: pointer;
    margin: 2%;
    height: 15px;
    }

    .btnSelected {
    border-bottom: 2px solid #4c4c4c;
    color: #000000;
    text-decoration: none;
    font-family: sans-serif;
    background-color: #4d98c2ff;
    padding: 10px 25px;
    cursor: pointer;
    margin: 2%;
    height: 15px;
    }

    .selectBtn {
    background-color: #6ec4f7ff;
    /* Green */
    font-family: sans-serif;
    margin: 2%;
    border: none;
    color: white;
    padding: 10px 25px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 1rem;
    height: 15px;
    cursor: pointer;
    }

    table {
    border-collapse: collapse;
    table-layout: fixed;
    border-spacing: 0;
    width: 100%;
    max-height: calc(100% - 30px);
    border: none;
    bottom: 38px;
    }

    th {
    text-transform: capitalize;
    text-align: left;
    padding: 5px 0px 5px 0px;
    margin: 0px 4px 0px 4px;
    background-color: white;
    border-bottom: 2px solid #dee2e6;
    }

    .checkbox-row {
    height: 1.5rem;
    }

    td {
    position: sticky;
    text-align: left;
    word-break: break-word;
    padding: 4px;
    border-bottom: 1px solid #dee2e6;
    }

    .barLegend {
    padding-left: 2%;
    padding-right: 2%;
    font-size: 12px;
    color: white;
    width: 100%;
    }

    tr:nth-child(even) {
    background-color: rgba(0,0,0,.05);
    }

    tr.selected {
    background-color: #dff0d8;
    font-weight: bold /* our pastel green*/
    }

    .rowHover:hover td {
    background-color: #fffaf3;
    /* our pastel yellow*/
    }

    #searchInp {
    width: 100px;
    float: right;
    height: 25px;
    text-indent: 4px;
    font: 14px sans-serif;
    display: none;
    border-radius: 3px;
    border-color: lightgray;
    margin: 4px;
    padding: .375rem .75rem;
    font-size: 1rem;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: .25rem;
    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    -webkit-transition: width 0.4s ease-in-out;
    transition: width 0.4s ease-in-out;
    }

    /* When the input field gets focus, change its width to 100% */
    #searchInp:focus {
        width: 300px;
    }

    /* Remove blue box around textbox. */
    input:focus {
    outline: none;
    }

    #headerBar {
    top: 0;
    z-index: 100;
    position: sticky;
    display: none;
    background-color: #f2f2f2;
    height: 34px;
    border-bottom: 1px solid #ddd;
    }

    #tableTitle {
    float: left;
    margin: 6px 0 6px 14px;
    }

    .headCol {
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
    }

    /* Status border */
    .newPhotoBorder {
    border-right: 5px solid blue;
    }

    .openCardBorder {
 
    }

    .normalCardBorder {
    border-right: 5px solid #f2f2f2;
    }

    .alertCardBorder {
    border-right: 5px solid red;
    }


    /* Triggered */
    .redIcon {
    background-image: url("/userfiles/Animal-Trap-Icon-Red.png");
    background-size: contain;
    background-color: white;
    border-radius: 5px;
    }

    /* Inactive */
    .greyIcon {
    background-image: url("/userfiles/Animal-Trap-Icon-DkGrey.png");
    background-size: contain;
    background-color: white;
    border-radius: 5px;
    }

    /* Set  */
    .greenIcon {
    background-image: url("/userfiles/Animal-Trap-Icon-Green.png");
    background-size: contain;
    background-color: white;
    border-radius: 5px;
    }



    .capitalize {
    text-transform: capitalize;
    /* font-family:  //"Open Sans" !important; */
    font-family: sans-serif;
    }

    .button {
    background-color: #4CAF50;
    /* Green */
    font-family: sans-serif;
    border: none;
    color: white;
    padding: 10px 25px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 1rem;
    border-radius: 6px;
    height: 50px;
    cursor: pointer;
    }

    .notes-css {
    cursor: pointer;
    display: block;
    font-size: 16px;
    font-family: sans-serif;
    font-weight: 700;
    color: #444;
    line-height: 1.3;
    padding: 0.6em 0.8em;
    width: calc(100% - 16px);
    max-width: 100%;
    box-sizing: border-box;
    margin: 8px;
    border: 1px solid #aaa;
    box-shadow: 0 1px 0 1px rgba(0, 0, 0, .04);
    -moz-appearance: none;
    -webkit-appearance: none;
    appearance: none;
    background-color: #fff;
    background-repeat: no-repeat, repeat;
    background-position: right .7em top 50%, 0 0;
    background-size: .65em auto, 100%;
    }

    .notes-css::-ms-expand {
        display: none;
    }

    .notes-css:hover {
        border-color: #888;
    }

    .notes-css:focus {
        border-color: #aaa;
        box-shadow: 0 0 1px 3px rgba(59, 153, 252, .7);
        box-shadow: 0 0 0 3px -moz-mac-focusring;
        color: #222;
        outline: none;
    }

    .notes-css option {
        font-weight: normal;
    }

        .select-css {
            cursor: pointer;
            display: block;
            font-size: 16px;
            font-weight: 700;
            color: white;
            line-height: 1.3;
            padding: 0.6em 0.8em;
            width: calc(100% - 16px);
            max-width: 100%;
            box-sizing: border-box;
            margin: 8px;
            border: 1px solid #aaa;
            border-radius: 5px;
            background: #646c83;
            color: white;
            box-shadow: 0 1px 0 1px rgba(0, 0, 0, .04);
            -moz-appearance: none;
            -webkit-appearance: none;
            appearance: none;
            background-color: white;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABmJLR0QA/wD/AP+gvaeTAAABWElEQVRoge3SoUvcYRzHcc9TcYjHYAgDYYJgESwLF5YWTCuWWUxrFuP+hUuzuWAzWbRYTAtLCxdWBhZhsMFAGIOxIRNl+lq5g8dxHPc7f797DN93+qXn+bx4fmNjURRFURRFURRFUbmh5f7XGhTzJvfSPu0UeZUadnMv7tEexov+YuPYzzw87RD1QogEU8dBZgAcYXIoRIKZwnFGxDtM3wmRYB7gfQbEB8yUgkgwDbRHiGhjtlREgnmIjyNAfMKjShAJZg4nFSJO8bhSRIKZx+cKEF+xMBJEgnmCLyUivmFxpIgEs4SzEhDfsZwFkWBW8OMOiJ94mhXRDU38HgLxC83c+2+FZzgvgPiD57l39wyruBgAcYkXuff2DWu46oP4i/XcOwcKLzuD/+8aG7n3FQqvOsO73WAz966hwlYCeV3lXRNVHl6r1d6i0fnervKuKIqiKIqie9g/aeemAbFqNx4AAAAASUVORK5CYII=') !important;
            background-repeat: no-repeat, repeat !important;
            background-position: right .7em top 50%, 0 0 !important;
            background-size: 1em auto, 100% !important;
        }

    .select-css::-ms-expand {
        display: none;
    }

    .select-css:hover {
        background: #646c83;
        color: white;
    }

    .select-css:focus {
        border-color: #aaa;
        box-shadow: 0 0 1px 3px rgba(59, 153, 252, .7);
        box-shadow: 0 0 0 3px -moz-mac-focusring;
        border-color: #ffffff;
        outline: none;
    }

    .select-css option {
        font-weight: normal;
    }

    .container {
    height: 60px;
    position: relative;
    }

    .vertical-center {
    margin: 0;
    position: absolute;
    top: 50%;
    -ms-transform: translateY(-50%);
    transform: translateY(-50%);
    }

    ul {
    margin: 4px 0 4px 0;
    overflow: hidden;
    white-space: nowrap;
    }

    li {
    white-space: nowrap;
    overflow: hidden;
    }

    .mapIcon {
    float: right;
    cursor: pointer;
    font-size: 29px;
    margin-right: 3%;
    }

    .mapIcon:hover {
        float: right;
        cursor: pointer;
        font-size: 35px;
        color: #f58133;
    }

    .dialText {
    font-size: 12px;
    }

    .fullWidth {
    width: 80%;
    }

    .container-fluid {
    margin: 3%;
    }

    .displayContainer {
    display: inline-block;
    text-align: end;
    }

    .underlineIndicatorLeft {
    border: 0.1px solid #ffffff;
    border-radius: 52px;
    background-color: #ffffff;
    height: 3px;
    display: flex;
    width: 10px;
    position: relative;
    left: 0%;
    }

    .underlineIndicatorRight {
    border: 0.1px solid #ffffff;
    border-radius: 52px;
    background-color: #ffffff;
    height: 3px;
    display: flex;
    width: 10px;
    position: relative;
    left: 94%;
    }



    .underlineIndicatorCenter {
    border: 0.1px solid #ffffff;
    border-radius: 52px;
    background-color: #ffffff;
    height: 3px;
    display: flex;
    width: 10px;
    position: relative;
    left: 46%;
    }

    @media screen and (max-width: 1440px) {
    .underlineIndicatorLeft {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 10px;
        position: relative;
        left: 0%;
    }

    .underlineIndicatorRight {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 10px;
        position: relative;
        left: 89%;
    }



    .underlineIndicatorCenter {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 10px;
        position: relative;
        left: 44%;
    }
    }

    @media screen and (max-width: 1024px) {
    .underlineIndicatorLeft {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 10px;
        position: relative;
        left: 0%;
    }

    .underlineIndicatorRight {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 10px;
        position: relative;
        left: 84%;
    }



    .underlineIndicatorCenter {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 10px;
        position: relative;
        left: 43%;
    }
    }


    @media screen and (max-width: 768px) {
    .underlineIndicatorLeft {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 10px;
        position: relative;
        left: 0%;
    }

    .underlineIndicatorRight {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 10px;
        position: relative;
        left: 78%;
    }



    .underlineIndicatorCenter {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 10px;
        position: relative;
        left: 40%;
    }
    }

    @media screen and (max-width: 425px) {
    .underlineIndicatorLeft {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 9px;
        position: relative;
        left: 0%;
    }

    .underlineIndicatorRight {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 9px;
        position: relative;
        left: 78%;
    }



    .underlineIndicatorCenter {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 9px;
        position: relative;
        left: 40%;
    }
    }

    @media screen and (max-width: 375px) {
    .underlineIndicatorLeft {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 9px;
        position: relative;
        left: 0%;
    }

    .underlineIndicatorRight {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 9px;
        position: relative;
        left: 74%;
    }



    .underlineIndicatorCenter {
        border: 0.1px solid #ffffff;
        border-radius: 52px;
        background-color: #ffffff;
        height: 3px;
        display: flex;
        width: 9px;
        position: relative;
        left: 38%;
    }
    }



        @media screen and (max-width: 320px) {
            .underlineIndicatorLeft {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 9px;
                position: relative;
                left: 0%;
            }

            .underlineIndicatorRight {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 9px;
                position: relative;
                left: 70%;
            }



            .underlineIndicatorCenter {
                border: 0.1px solid #ffffff;
                border-radius: 52px;
                background-color: #ffffff;
                height: 3px;
                display: flex;
                width: 9px;
                position: relative;
                left: 35%;
            }
        }

    .UnderlineGreen {
        width: 100%;
        border: 1px solid #388b3d;
        border-radius: 52px;
        margin-top: 3.7px;
        margin-bottom: 3.7px;
        background-color: #388b3d;
    }


    

    .UnderlineOrange {
        width: 100%;
        border: 1px solid #f88924ff;
        border-radius: 52px;
        margin-top: 3.7px;
        margin-bottom: 3.7px;
        background-color: #f88924ff;
    }

    .UnderlineRed {
        border: 1px solid #d74423ff;
        border-radius: 52px;
        margin-top: 3.7px;
        margin-bottom: 3.7px;
        background-color: #d74423ff;
    }

    .UnderlineGray {
    width: 100%;
    border: 1px solid gray;
    border-radius: 52px;
    margin-top: 3.7px;
    margin-bottom: 3.7px;
    background-color: gray;
    }

    .LabelStyle {
    font-size: 8.5px;
    justify-content: center;
    display: inline-flex;
    }

    .SideBarGray {
    border-left: 8px solid gray;
    }

    .SideBarGreen {
    border-left: 8px solid green;
    }

    .SideBarYellow {
    border-left: 8px solid orange;
    }

    .SideBarRed {
    border-left: 8px solid red;
    }

    .StatusIndicator {
    float: right;
    font-size: 10px;
    }

    .ValueStyle {
    font-size: 15.5px;
    font-weight: bold;
    color: #41505aff;
    /* font-family: "Open Sans" !important; */
    font-family: sans-serif;
    }

    .tabBtn {
    text-align: center;
    width: 50%;
    padding-left: 10%;
    padding-right: 10%;
    padding-top: 15px;
    padding-bottom: 15px;
    font-family: sans-serif;
    background-color: rgb(230 230 230);
    border: none;
    color: #41505a;
    padding: 10px 25px;
    text-align: center;
    text-decoration: none;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 2px;
    }

    .tabBtn:hover {
        text-align: center;
        width: 50%;
        padding-left: 10%;
        padding-right: 10%;
        padding-top: 15px;
        padding-bottom: 15px;
        font-family: sans-serif;
        background-color: #4d98c2;
        border: none;
        color: white;
        padding: 10px 25px;
        text-align: center;
        text-decoration: none;
        font-size: 1rem;
        cursor: pointer;
        border-radius: 2px;
    }

    .tabBtnSelected {
    text-align: center;
    width: 50%;
    padding-left: 10%;
    padding-right: 10%;
    padding-top: 15px;
    padding-bottom: 15px;
    font-family: sans-serif;
    background-color: #4d98c2;
    border: none;
    color: white;
    padding: 10px 25px;
    text-align: center;
    text-decoration: none;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 2px;
    }

    .normalCardBorder {
    background-color: #e6e6e6ff;
    }

    .normalCardBorder:hover {
        background-color: #f2f2f2
    }


    [data-info="chart"] {
    padding: 20px;
    }

    [data-info="chart"] table {
        width: 100%;
        height: 400px;
    }

    .charttitle {
    text-align: center;
    }

    .bars {
    color: white;
    font-size: 13px;
    text-align: center;
    }

    .bars td {
        text-align: center;
        vertical-align: bottom;
    }

    .bars div:hover {
        opacity: 0.6;
    }

    .legend {
    vertical-align: bottom;
    padding-left: 20px;
    text-align: left;
    }

    .legbox {
    display: block;
    clear: both;
    }

    .xaxisname {
    margin: 5px;
    color: #fff;
    font-size: 77%;
    padding: 5px;
    float: left;
    }


    /*Flat UI colors*/

    .one {
    background: #16A085;
    }

    .two {
    background: #2ECC71;
    }

    .three {
    background: #27AE60;
    }

    .four {
    background: #3498DB;
    }

    .five {
    background: #2980B9;
    }

    .six {
    background: #9B59B6;
    }

    .seven {
    background: #8E44AD;
    }

    .eight {
    background: #34495E;
    }

    .nine {
    background: #2C3E50;
    }

    .ten {
    background: #22313f;
    }

    .eleven {
    background: #F1C40F;
    }

    .twelve {
    background: #F39C12;
    }

    .thirteen {
    background: #E67E22;
    }

    .fourteen {
    background: #D35400;
    }

    .fifteen {
    background: #E74C3C;
    }

    .sixteen {
    background: #C0392B;
    }

    .seventeen {
    background: #ECF0F1;
    }

    .seventeen.clouds {
        color: #BDC3C7;
    }

    .eighteen {
    background: #BDC3C7;
    }

    .nineteen {
    background: #95A5A6;
    }

    .twenty {
    background: #7F8C8D;
    }

    .barColor {
    background-color: #6ec4f7ff;
    }

    .barColor:hover {
        background-color: #4d98c2;
        cursor: pointer;
    }


    .barColorMotion {
    background-color: #dbdbdb;
    }

    .barColorMotion:hover {
        background-color: #faf8f8;
        cursor: pointer;
    }

    .flex {
    display: -webkit-box; /* OLD - iOS 6-, Safari 3.1-6, BB7 */
    display: -ms-flexbox; /* TWEENER - IE 10 */
    display: -webkit-flex; /* NEW - Safari 6.1+. iOS 7.1+, BB10 */
    display: flex; /* NEW, Spec - Firefox, Chrome, Opera */
    flex: 1;
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    -webkit-display: flex;
    -webkit-flex-direction: row;
    -webkit-align-items: flex-start;
    }

    .labelChild {
    width: 100%;
    }

    @supports (overflow:-webkit-marquee) and (justify-content:inherit) {
    .flex {
        display: -webkit-flex; /* NEW - Safari 6.1+. iOS 7.1+, BB10 */
        flex: 1;
        flex-direction: row;
        align-items: flex-start;
    }
    }

    .iconWidth {
    width: 5%;
    }

    @media screen and (max-width: 2560px) {
    .CardWidth {
        width: 99.5%;
    }

    .setupContent {
        width: 45%;
        display: grid;
        margin-left: 3%;
    }
    }

    @media screen and (max-width: 1504px) {
    .CardWidth {
        width: 99%;
    }

    .setupContent {
        width: 45%;
        display: grid;
        margin-left: 3.5%;
    }
    }

    @media screen and (max-width: 1404px) {
    .CardWidth {
        width: 99%;
    }

    .setupContent {
        width: 45%;
        display: grid;
        margin-left: 5.5%;
    }
    }


    @media screen and (max-width: 868px) {
    .CardWidth {
        width: 99%;
    }

    .setupContent {
        width: 38%;
        display: grid;
        margin-left: 7%;
    }

    .labelChild {
        width: 100%;
        font-size: 7px;
    }
    }


    @media screen and (max-width: 722px) {
    .CardWidth {
        width: 99%;
    }

    .setupContent {
        width: 38%;
        display: grid;
        margin-left: 11%;
    }

    .labelChild {
        width: 100%;
        font-size: 7px;
    }
    }


    @media screen and (max-width: 427px) {
    .labelChild {
        width: 100%;
        font-size: 4px;
    }

    .CardWidth {
        width: 97%;
    }

    .setupContent {
        width: 38%;
        display: grid;
        margin-left: 14%;
    }
    }

    @media screen and (max-width: 320px) {
    .labelChild {
        width: 100%;
        font-size: 4px;
    }

    .CardWidth {
        width: 97%;
    }

    .setupContent {
        width: 33%;
        display: grid;
        margin-left: 15%;
    }
    }

    .ct-golden-section {
    display: block;
    position: relative;
    width: 100%;
    height: 218px;
    }

    .alignCenter {
    width: 100%;
    text-align: center;
    font-size: 10px;
    }

    .ct-label.ct-horizontal.ct-end {
    -webkit-box-align: flex-start;
    -webkit-align-items: flex-start;
    -ms-flex-align: flex-start;
    align-items: flex-start;
    -webkit-box-pack: flex-start;
    -webkit-justify-content: flex-start;
    -ms-flex-pack: flex-start;
    justify-content: flex-start;
    text-align: left;
    text-anchor: start;
    color: white;
    font-size: 6px;
    padding-top: 16px;
    }

    .ct-grid {
    stroke: rgb(255 255 255 / 20%);
    stroke-width: 0.9px;
    stroke-dasharray: 0px;
    }

    .ct-label.ct-vertical.ct-start {
    -webkit-box-align: flex-end;
    -webkit-align-items: flex-end;
    -ms-flex-align: flex-end;
    align-items: flex-end;
    -webkit-box-pack: flex-end;
    -webkit-justify-content: flex-end;
    -ms-flex-pack: flex-end;
    justify-content: flex-end;
    text-align: right;
    text-anchor: end;
    color: white;
    font-size: 10px;
    }

    .labelsParent {
    position: relative;
    top: 84%;
    color: white;
    display: flex;
    padding-left: 0%;
    padding-right: 2%;
    }


    .postionChartButton {
    position: absolute;
    bottom: 50%;
    border-radius: 2px;
    right: 50%;
    padding: 8px;
    background-color: #4d98c25c;
    color: white;
    z-index: 55;
    }

    @media screen and (max-width: 600px) {

    .labelsParent {
        position: relative;
        top: 84%;
        color: white;
        display: flex;
        padding-left: 9%;
        padding-right: 0%;
    }

    .postionChartButton {
        position: absolute;
        bottom: 50%;
        border-radius: 2px;
        right: 40%;
        padding: 8px;
        background-color: #4d98c25c;
        color: white;
        z-index: 55;
    }
    }



    .iconDeviceError {
    position: absolute;
    left: 3px;
    top: -10px;
    }

    .iconCommunicationError {
        position: absolute;
        left: 19px;
        top: -10px;
    }

    .PositionToggle {
    /* text-align: center; */
    width: 100%;
    text-align: right;
    /* margin-right: 19px; */
    position: relative;
    right: 22px;
    margin-top: 10px;
    }
    /* The switch - the box around the slider */
    .switch {
    position: relative;
    display: inline-block;
    width: 73px;
    height: 23px;
    }

    /* Hide default HTML checkbox */
    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 20px;
    right: 0;
    bottom: 0;
    background-color: #6ac0f3;
    -webkit-transition: .4s;
    transition: .4s;
    font-size: 9px;
    padding-top: 10px;
    padding-left: 24px;
    color: white;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 15px;
        width: 15px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        -webkit-transition: .4s;
        transition: .4s;
    }
    span{
        /* font-family: "Open Sans"!important; */
        font-family: sans-serif;
    }
    .inactiveToggle {
    /* font-family: "Open Sans"!important; */
    font-family: sans-serif;
    position: absolute;
    top: 6px;
    left: 21px;
    }

    .activeToggle {
    /* font-family: "Open Sans"!important; */
    font-family: sans-serif;
    position: absolute;
    left: 5px;
    top: 6px;
    }

    .Selected {
    position: absolute;
    left: 10px;
    }

    input:checked + .slider {
        background-color: #6ac0f3ff;
        font-size: 9px;
        padding-top: 10px;
        padding-right: 45px;
        color: white;
    }

    input:focus + .slider {
    box-shadow: 0 0 1px #6ac0f3ff;
    }

    input:checked + .slider:before {
    -webkit-transform: translateX(46px);
    -ms-transform: translateX(46px);
    transform: translateX(46px);
    }

    /* Rounded sliders */
    .slider.round {
    border-radius: 34px;
    }

    .slider.round:before {
        border-radius: 50%;
    }


    /* Use this selector to override the line style on a given series */
    .ct-series-a .ct-line {
    /* Set the colour of this series line */
    stroke: #4d98c2;
    /* Control the thikness of your lines */
    stroke-width: 5px;
    /* Create a dashed line with a pattern */
    }
    /* Use this selector to override the line style on a given series */
    .ct-series-b .ct-line {
    /* Set the colour of this series line */
    stroke: #dbdbdb;
    /* Control the thikness of your lines */
    stroke-width: 5px;
    /* Create a dashed line with a pattern */
    }

    .ct-series-a .ct-point {
    stroke: #4d98c2;
    }

    .ct-series-b .ct-point {
    stroke: #dbdbdb;
    }

    .flexItem {
    width: 100%;
    }

    .iconGrid {
    width: 40px;
    height: 60px;
    cursor: pointer;
    }

    .flexItemHolder {
    text-align: center;
    }

    .PositionCheckbox {
    display: inline;
    position: relative;
    margin-bottom: 20px;
    margin-right: 8px;
    left: 0;
    right: -2px;
    float: right;
    }

    .CheckboxLabel {
    display: table-caption;
    color: white;
    float: left;
    margin-right: 10px;
    }

    .CustomCheckbox {
    width: 35px;
    height: 50px;
    }


    input[type='checkbox'] {
    -webkit-font-smoothing: antialiased;
    text-rendering: optimizeSpeed;
    width: 35px;
    height: 35px;
    margin: 0;
    margin-right: 1px;
    display: block;
    float: left;
    position: relative;
    cursor: pointer;
    }

    input[type='checkbox']:after {
        content: "";
        vertical-align: middle;
        text-align: center;
        line-height: 41px;
        position: absolute;
        cursor: pointer;
        height: 35px;
        width: 35px;
        left: 0;
        top: 0;
        font-size: 35px;
        -webkit-box-shadow: inset 0 1px 1px #646c83, 0 1px 0 #646c83;
        -moz-box-shadow: inset 0 1px 1px #41505a, 0 1px 0 #41505a;
        box-shadow: inset 0 1px 1px #646c83, 0 1px 0 #646c83;
        background: #646c83;
    }

        /* input[type='checkbox']:hover:after, input[type='checkbox']:checked:hover:after {
            background: #646c83;
            height: 35px;
            width: 35px;
            content: '\2714';
            color: #fff;
            font-size: 35px;
        } */

    input[type='checkbox']:checked:after {
        background: #646c83;
        content: '\2714';
        height: 35px;
        width: 35px;
        color: #fff;
        font-size: 35px;
    }

    input[type="number"] {
    -webkit-appearance: textfield;
    -moz-appearance: textfield;
    appearance: textfield;
    }

    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    }

    .number-input {
    margin: 8px;
    border: 1px solid #aaa;
    /*            padding: 0.6em 0.8em;
    */ background-color: #646c83;
    display: inline-flex;
    }

    .number-input,
    .number-input * {
        box-sizing: border-box;
    }

        .number-input button {
            outline: none;
            -webkit-appearance: none;
            background-color: transparent;
            border: none;
            align-items: center;
            justify-content: center;
            width: 3rem;
            height: 41px;
            cursor: pointer;
            margin: 0;
            position: relative;
        }

            .number-input button:before,
            .number-input button:after {
                display: inline-block;
                position: absolute;
                content: '';
                width: 1rem;
                height: 2px;
                background-color: white;
                color: white;
                transform: translate(-50%, -50%);
            }

            .number-input button.plus:after {
                transform: translate(-50%, -50%) rotate(90deg);
            }

        .number-input input[type=number] {
            font-family: sans-serif;
            max-width: 5rem;
            border: none;
            color: white;
            background-color: #646c83;
            border-width: 0 2px;
            font-size: 22px;
            height: 42px;
            font-weight: bold;
            text-align: center;
        }

    .alignLabelCenter {
    width: 100%;
    text-align: center;
    color: white;
    }

    .inputDate {
    background: #646c83;
    border: none;
    color: white;
    height: 40px;
    font-size:16px;
    width: 100%;
    text-align: center;
    }

    ::-webkit-calendar-picker-indicator {
    filter: invert(1);
    }

    .inputText {
    position: relative;
    text-align: left;
    width: 100%;
    font-size: 16px;
    }

                 

    .StationId {
    position: absolute;
    left: 1px;
    top: 0px;
    font-size: 14px;
    display: block;
    text-align: center;
    min-width: 10px;
    }

    .StationLabel{
    color: #41505a;
    top: 44px;
    /* left: 4px; */
    text-align: center;
    font-weight: 800;
    }

    .PositionNumber {
    float: right;
    font-size: 10px;
    margin-right: 6px;
    /* font-family: "Open Sans" !important; */
    font-family: sans-serif;
    }
    input, label {
    display: block;
    }

    .BoxLabel {
    margin-right: 4%;
    margin-left: 1%;
    display: block;
    width: 100%;
    }

    label {
    color: white;
    padding-left:9px;
    }

    .CardLabels {
        width: 100%;
        position: relative;
        left: -18px;
    }
    .PositionIcon {
        position: relative;
        top: 10px;
        right: -5px;
    }
    .ErrorLabelHolder{
        flex-direction: row;
        width: 100%;
        text-align: left;
        padding-left: 10px;
        display: block;
    }
    .iconHover:hover{
        cursor:pointer;
    }

    .fixMargin{
        margin-top:2px;
        font-size: 14px;
     }
    </style>
</head>
<body id="body">
    <div id="group">


        <div id="widget" style="position:absolute; left:0px; top:0px; width:100%; height:100px; z-index:100;">
            <div id="container">
                <div id="headerBar">
                    <b id="tableTitle"></b>
                </div>
                <table id="table" style="width: 100%">
                    <thead>
                        <tr id="header">
                        </tr>
                    </thead>
                    <tbody id="tbody">
                    </tbody>
                </table>
                <div id="footer" style="height:30px; width: 100%; display:none  "></div>
            </div>
        </div>
    </div>
    <div id="cardChildTemplate" style="display:none;">
        <div data-section="main" data-info="SideBarStatus" data-value="triggered" class="normalCardBorder SideBarGreen" onclick="toggleClearScreen(this)" style="font-family: sans-serif;border-radius:2px; padding: 8px; overflow:hidden;z-index:130;">
            <div data-section="cell">
                <div>
                    <div class="container flex" style="margin: 8px 8px 4px 0;  ">

                        <!--<div data-info="SideBarStatus" class="SideBarGreen">

                        </div>-->
                        <!--Dummy Trap Icon start-->
                        <div style="border-right: 0.98px solid #9b9b9bff;width:99%;">
                            <span data-value="DeviceNumber" class="PositionNumber">--</span>
                            <div class="iconDeviceError" data-info="deviceErrorStatus" style="display:none">

                                <svg xmlns:dc="http://purl.org/dc/elements/1.1/"
                                     xmlns:cc="http://creativecommons.org/ns#"
                                     xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                                     xmlns:svg="http://www.w3.org/2000/svg"
                                     xmlns="http://www.w3.org/2000/svg"
                                     xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
                                     xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
                                     width="18px"
                                     height="18px"
                                     viewBox="0 0 3.1593108 10.265815"
                                     version="1.1"
                                     id="svg46764"
                                     inkscape:version="0.92.4 (5da689c313, 2019-01-14)"
                                     sodipodi:docname="Exclamation.svg">
                                    <defs id="defs46758" />


                                    <g inkscape:label="Layer 1"
                                       inkscape:groupmode="layer"
                                       id="layer1"
                                       transform="translate(-57.384632,-79.444472)">
                                        <path d="m 60.027039,88.133224 a 1.0627789,1.060213 0 0 1 -1.059222,1.060208 1.0627789,1.060213 0 0 1 -1.066312,-1.053111 1.0627789,1.060213 0 0 1 1.052085,-1.067256 1.0627789,1.060213 0 0 1 1.073354,1.045967"
                                              sodipodi:open="true"
                                              sodipodi:end="6.2697986"
                                              sodipodi:start="0"
                                              sodipodi:ry="1.060213"
                                              sodipodi:rx="1.0627789"
                                              sodipodi:cy="88.133224"
                                              sodipodi:cx="58.96426"
                                              sodipodi:type="arc"
                                              id="path28027"
                                              style="opacity:1;fill:#d74423;fill-opacity:1;stroke:#d74423;stroke-width:1.03369844;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
                                              inkscape:export-filename="C:\Users\fredy\Documents\Sensavation\Pest\UI Elements\mbb.png"
                                              inkscape:export-xdpi="96"
                                              inkscape:export-ydpi="96"
                                              inkscape:transform-center-x="0.22674155"
                                              inkscape:transform-center-y="-5.2179916" />
                                        <path inkscape:transform-center-y="1.645522"
                                              inkscape:transform-center-x="17.617202"
                                              inkscape:connector-curvature="0"
                                              id="path28029"
                                              d="m 58.888664,84.311469 -0.0247,-3.515579"
                                              style="fill:#d74423;fill-opacity:1;stroke:#d74423;stroke-width:2.66488314;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                                    </g>
                                </svg>
                            </div>
                            <div class="iconCommunicationError" data-info="communicationErrorStatus" style="display:none">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#d74423" class="bi bi-wifi-off" viewBox="0 0 16 16">
                                    <path d="M10.706 3.294A12.545 12.545 0 0 0 8 3C5.259 3 2.723 3.882.663 5.379a.485.485 0 0 0-.048.736.518.518 0 0 0 .668.05A11.448 11.448 0 0 1 8 4c.63 0 1.249.05 1.852.148l.854-.854zM8 6c-1.905 0-3.68.56-5.166 1.526a.48.48 0 0 0-.063.745.525.525 0 0 0 .652.065 8.448 8.448 0 0 1 3.51-1.27L8 6zm2.596 1.404.785-.785c.63.24 1.227.545 1.785.907a.482.482 0 0 1 .063.745.525.525 0 0 1-.652.065 8.462 8.462 0 0 0-1.98-.932zM8 10l.933-.933a6.455 6.455 0 0 1 2.013.637c.285.145.326.524.1.75l-.015.015a.532.532 0 0 1-.611.09A5.478 5.478 0 0 0 8 10zm4.905-4.905.747-.747c.59.3 1.153.645 1.685 1.03a.485.485 0 0 1 .047.737.518.518 0 0 1-.668.05 11.493 11.493 0 0 0-1.811-1.07zM9.02 11.78c.238.14.236.464.04.66l-.707.706a.5.5 0 0 1-.707 0l-.707-.707c-.195-.195-.197-.518.04-.66A1.99 1.99 0 0 1 8 11.5c.374 0 .723.102 1.021.28zm4.355-9.905a.53.53 0 0 1 .75.75l-10.75 10.75a.53.53 0 0 1-.75-.75l10.75-10.75z"/>
                                  </svg>
                            </div>
                            <div class="deviceIcon">
                                <svg xmlns:dc="http://purl.org/dc/elements/1.1/"
                                     xmlns:cc="http://creativecommons.org/ns#"
                                     xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                                     xmlns:svg="http://www.w3.org/2000/svg"
                                     xmlns="http://www.w3.org/2000/svg"
                                     id="svg29831"
                                     version="1.1"
                                     viewBox="0 0 16.933333 16.933333"
                                     height="25"
                                     width="25"
                                     data-info="iconDummy"
                                     style="margin-top: 12px; display:none;">
                                    <g id="g25716" transform="matrix(0.35356524,0,0,-0.35271157,-872.43975,177.40608)">
                                        <g transform="translate(2609.6979,-736.76742)" id="g9647-9-8-80">
                                            <path id="path6880-7-3-8-0-4-0" d="m -97.915822,1213.08 v -17.9842 H -138.3176 v 40.8342 h 40.031118 v -6.7954" style="fill:none;stroke:#41505a;stroke-width:7.5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"></path>
                                        </g>
                                        <path transform="scale(1,-1)" style="opacity:1;fill:#41505a;fill-opacity:1;stroke:#41505a;stroke-width:2.27642;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path24990-4" d="m 2493.9189,-478.74548 a 2.3376312,2.3376312 0 0 1 -2.3298,2.33761 2.3376312,2.3376312 0 0 1 -2.3454,-2.32197 2.3376312,2.3376312 0 0 1 2.3141,-2.35316 2.3376312,2.3376312 0 0 1 2.3609,2.30622 l -2.3374,0.0313 z"></path>
                                    </g>
                                </svg>
                                <!--Dummy Trap Icon end-->
                                <!--Smart Trap Icon start-->
                                <svg data-info="iconSmart"
                                     style="margin-top: 12px; display:none;"
                                     xmlns:dc="http://purl.org/dc/elements/1.1/"
                                     xmlns:cc="http://creativecommons.org/ns#"
                                     xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                                     xmlns:svg="http://www.w3.org/2000/svg"
                                     xmlns="http://www.w3.org/2000/svg"
                                     id="svg29831"
                                     version="1.1"
                                     viewBox="0 0 16.933333 16.933333"
                                     height="25"
                                     width="25">
                                    <defs id="defs29825" />

                                    <g transform="translate(0,-280.06667)" id="layer1">
                                        <g transform="matrix(0.99308565,0,0,0.99308565,-104.14524,81.741953)" id="g25310">
                                            <path id="path24992" d="m 110.9523,208.5002 c 0.19067,-1.56225 1.18424,-2.13723 2.4862,-2.2128" style="fill:none;fill-opacity:1;stroke:#41505a;stroke-width:0.84635907;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                                            <g transform="matrix(0.35277777,0,0,-0.35277777,216.07457,636.91667)" id="g7816-3-6-0-8-5">
                                                <path id="path6880-5-6-9-2-2" d="m -270.79532,1212.4821 v -17.9842 h -40.40178 v 40.8342 h 40.03112 v -6.7954" style="fill:none;stroke:#41505a;stroke-width:7.5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                                            </g>
                                            <path style="opacity:1;fill:#41505a;fill-opacity:1;stroke:#41505a;stroke-width:0.80306929;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path24990-5" d="m 114.24228,208.69815 a 0.82466435,0.82466435 0 0 1 -0.8219,0.82466 0.82466435,0.82466435 0 0 1 -0.82741,-0.81914 0.82466435,0.82466435 0 0 1 0.81637,-0.83014 0.82466435,0.82466435 0 0 1 0.83287,0.81358" />
                                            <path style="fill:none;fill-opacity:1;stroke:#41505a;stroke-width:1.03047788;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m 109.27007,208.23222 c 0.16348,-0.94022 0.45971,-1.66746 0.85972,-2.21848 0.75304,-1.03726 1.87392,-1.45007 3.16954,-1.48368" id="path24992-1-6" />
                                        </g>
                                    </g>
                                </svg>
                                <!--Smart Trap Icon end-->
                                <!--Smart Trap Error Icon start-->
                                <svg xmlns:dc="http://purl.org/dc/elements/1.1/"
                                     xmlns:cc="http://creativecommons.org/ns#"
                                     xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                                     xmlns:svg="http://www.w3.org/2000/svg"
                                     xmlns="http://www.w3.org/2000/svg"
                                     id="svg29831"
                                     version="1.1"
                                     viewBox="0 0 16.933333 16.933333"
                                     height="25"
                                     width="25"
                                     data-info="iconSmartError"
                                     style="margin-top: 12px; display:none;">


                                    <g id="g8372" transform="translate(-161.98269,-24.891438)">
                                        <path style="fill:none;stroke:#41505a;stroke-width:2.64854;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m 177.57657,34.252709 v 6.343234 H 163.2919 V 26.193249 h 14.15362 v 2.396816" id="path6880-7-3-8-0-4-0-8-2"></path>
                                        <path style="opacity:1;fill:#d74423;fill-opacity:1;stroke:#d74423;stroke-width:0.80389;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path24990-4-4-5" d="m 171.5802,33.613804 a 0.82650512,0.82450956 0 0 1 -0.82374,0.824505 0.82650512,0.82450956 0 0 1 -0.82925,-0.818986 0.82650512,0.82450956 0 0 1 0.81818,-0.829987 0.82650512,0.82450956 0 0 1 0.83473,0.813431 l -0.82643,0.01104 z"></path>
                                        <path style="fill:#000000;fill-opacity:0;stroke:#d74423;stroke-width:2.03333;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m 170.76591,31.121397 -0.0244,-2.082158" id="path5448-9-8-5-3-9-4-6-7-4-7-9-0"></path>
                                    </g>

                                </svg>
                                <!--Smart Trap Error Icon end-->
                                <!--Smart Trap No Signal Icon start-->
                                <svg xmlns:dc="http://purl.org/dc/elements/1.1/"
                                     xmlns:cc="http://creativecommons.org/ns#"
                                     xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                                     xmlns:svg="http://www.w3.org/2000/svg"
                                     xmlns="http://www.w3.org/2000/svg"
                                     id="svg29831"
                                     version="1.1"
                                     viewBox="0 0 16.933333 16.933333"
                                     height="25"
                                     width="25"
                                     data-info="iconSmartNoSignal"
                                     style="margin-top: 12px; display:none;">

                                    <g id="g9056" transform="matrix(1.0067255,0,0,1,-118.44967,13.27514)">
                                        <g id="g7816-3-6-0-8-5-0" transform="matrix(0.35033854,0,0,-0.35033854,228.02635,420.82483)">
                                            <path style="fill:none;stroke:#41505a;stroke-width:7.5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m -270.79532,1212.4821 v -17.9842 h -40.40178 v 40.8342 h 40.03112 v -6.7954" id="path6880-5-6-9-2-2-6"></path>
                                        </g>
                                        <g id="g9048">
                                            <path id="path24992-2" d="m 123.63093,-4.6294193 c 0.18935,-1.551448 1.17605,-2.122453 2.46901,-2.1975" style="fill:none;fill-opacity:1;stroke:#d74423;stroke-width:0.840507;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"></path>
                                            <path style="opacity:1;fill:#d74423;fill-opacity:1;stroke:#d74423;stroke-width:0.797517;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path24990-5-3" d="m 126.89816,-4.4328383 a 0.81896233,0.81896233 0 0 1 -0.81622,0.818958 0.81896233,0.81896233 0 0 1 -0.82169,-0.813476 0.81896233,0.81896233 0 0 1 0.81073,-0.8244 0.81896233,0.81896233 0 0 1 0.82711,0.807954"></path>
                                            <path style="fill:none;fill-opacity:1;stroke:#d74423;stroke-width:1.02335;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m 121.96033,-4.8955463 c 0.16235,-0.933719 0.45653,-1.655931 0.85377,-2.203141 0.74784,-1.030088 1.86097,-1.440044 3.14763,-1.473421" id="path24992-1-6-7"></path>
                                        </g>
                                    </g>
                                </svg>
                                <div class="StationId">
                                    <span class="StationId StationLabel" data-value="StationId" aria></span>
                                 </div>
                    
                            </div>

                            <!--Smart Trap No Signal Icon start-->
                            <!--<div data-info="icon" class="redIcon vertical-center" style="display: inline-block; width: 25px; height: 25px;"></div>-->
                            <div class="vertical-center setupContent">
                                <div class="row">
                                    <span data-value="Status" style="margin-right: 6px;" class="capitalize StatusIndicator"></span>
                                </div>
                                <div class="row CardLabels">
                                    <div  data-value="DeviceName" class="capitalize" style=" font-size: 12.5px">
                                     --
                                    </div>

                                    <div data-value="Address" style="display:inline-block;word-wrap:break-word;font-size: 10.5px;">
                                        --
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="float: right; margin-right: -12px; display: flex; width:100%; z-index:140;">
                            <div class="displayContainer" style="text-align: center;margin-left: 6px; width:100%;">
                                <span data-value="Dial" class="ValueStyle">
                                    --
                                </span>
                                <div class="UnderlineGray" data-info="UnderlineBait" style="width: 100%;">
                                    <span data-value="status1Pos" class="underlineIndicatorCenter"></span>
                                </div>
                                <span class="LabelStyle">BAIT LEFT</span>
                            </div>
                            <div class="displayContainer" style="text-align: center;margin-left: 6px; width:100%;">
                                <span data-value="Consumed" class="ValueStyle">
                                    --
                                </span>
                                <div class="UnderlineGray" data-info="UnderlineBaitTaken" style="width: 100%;">
                                    <span data-value="status4Pos" class="underlineIndicatorLeft"></span>
                                </div>
                                <span class="LabelStyle">BAIT TAKEN</span>
                            </div>
                            <div class="displayContainer" style="text-align: center;margin-left: 10px; margin-right:10px; width:100%;">
                                <span data-value="Hours" class="ValueStyle">
                                    --
                                </span>
                                <div class="UnderlineGray" data-info="UnderlineHours" style="width:100%;">
                                    <span data-value="status2Pos" class="underlineIndicatorCenter"></span>
                                </div>
                                <span class="LabelStyle">ACTIVE CYCLE</span>
                            </div>
                            <div class="displayContainer" style="text-align: center;width:100%;">
                                <span data-value="Duration" class="ValueStyle">
                                    --
                                </span>
                                <div class="UnderlineGray" data-info="UnderlineDuration" style="width:100%;">
                                    <span data-value="status3Pos" class="underlineIndicatorCenter"></span>
                                </div>
                                <span class="LabelStyle">NEXT CHECK</span>
                            </div>
                            
                            <!--<div data-value="Hours" style="display: inline-block; border: 2px solid red; border-radius: 14px; text-align:center; color: red; font-weight:bold; padding: 2px; margin-right: 4px; margin-left: 2px; min-width: 16px; ">
                                -
                            </div>-->
                            <br />
                        </div>
                    </div>

                </div>
            </div>
            <div data-section="clearScreen" onclick="event.stopPropagation()" style="width:100%;background-color: #41505aff;border: 1px solid #bfbfbf; overflow: hidden; display: none;">
                <div data-info="btnActionsCtl" class="flex" style="width:100%; ">
                    <a id="devAction" href="#" class="tabBtnSelected" data-info="btnActions" style="width:50%;" onclick="OpenActions(event)">
                        Actions
                    </a>
                    <a id="devInfo" href="#" class="tabBtn" data-info="btnInfo" style="width:50%;" onclick="OpenDeviceInfo(event)">
                        Device Info
                    </a>
                </div>
                <div data-section="alert" style="display: none; flex-direction: column; justify-content:space-evenly; text-align: center; margin-bottom: 4px;">
                    <div data-value="alert">
                    </div>
                    <hr style="margin: 8px;" />
                </div>

                <div data-section="DeviceInfo" style="overflow: hidden;display: flex;flex-direction: row;text-align: center;margin-top: 10px; display:none;">

                    <p data-component="ErrorTempalte" style="display: none;color:white; width: 100%;font-size: 12px;" data-info="">
                        <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="info-circle" width="15" height="10" class="svg-inline--fa fa-info-circle fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path></svg>
                        <span data-value="errorDate" onclick="OpenError(event)" style="cursor:pointer;"></span> 
                        <span style="width: 100%;cursor:pointer;" data-value="ErrorDescription" onclick="OpenError(event)" ></span> 
                        <span data-value="errorIcon" class="iconHover" style="float: right;padding-right: 24px; margin-top: -3px;" onclick="RemoveError(event)">
                            <svg width="15" height="15" aria-hidden="true" focusable="false" data-prefix="far" data-icon="trash-alt" class="svg-inline--fa fa-trash-alt fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M268 416h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12zM432 80h-82.41l-34-56.7A48 48 0 0 0 274.41 0H173.59a48 48 0 0 0-41.16 23.3L98.41 80H16A16 16 0 0 0 0 96v16a16 16 0 0 0 16 16h16v336a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128h16a16 16 0 0 0 16-16V96a16 16 0 0 0-16-16zM171.84 50.91A6 6 0 0 1 177 48h94a6 6 0 0 1 5.15 2.91L293.61 80H154.39zM368 464H80V128h288zm-212-48h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12z"></path></svg>
                        </span>
                    </p>

                    <div data-info="ErrorSection" class="flex ErrorLabelHolder"  >
                       
                    </div>  
                    <div class="flex" style="flex-direction:row; justify-content:space-evenly;  width:100%;text-align:center;">
                        <div style="width:100%;display:grid;">
                            <span style="float: left; margin-right: 0;     margin-top: 5px;  color: white;font-weight: normal;" class="LabelStyle">
                                PRODUCT
                            </span>
                            <!--<span style="font-size: 12px;color:#68a5ca;font-weight: 900;" data-value="BaitName">--</span>-->
                            <span style="color:#68a5ca; font-size: 12px;     margin-top: 5px; " class="ValueStyle" data-value="FoodName">--</span>
                        </div>
                        <div style="width:100%;display:grid; margin-right:4px;">
                            <span style="font-weight: normal; font-family:sans-serif;color:white;  margin-top: 5px; " class="LabelStyle">
                                ENTERED WEIGHT
                            </span>
                            <span style="float: left; margin-right: 0;  font-size: 12px;    margin-top: 5px;  color: #68a5ca;" data-value="enteredWeight" class="ValueStyle">
                                --
                            </span>
                           
                          
                           

                        </div>

                        <div style="display: flex; width:100%;margin-right:20px">
                            <div class="displayContainer" style=" width: 100%; text-align: center; margin-left:0px;margin-right:10px;">
                                <span data-value="SignalStrenght" class="ValueStyle" style="font-size: 12px;color: #68a5ca; ">
                                    --
                                </span>
                                <div class="UnderlineGreen" data-info="UnderlineSignal"></div>
                                <span style="justify-content:center;  display:block; color: white;font-weight: normal; margin-top: 6px;" class="LabelStyle">SIGNAL</span>
                            </div>

                            <div class="displayContainer" style=" width: 100%; text-align: center; ">
                                <span id="numVal" data-section="BatteryVal" class="ValueStyle" style="font-size: 12px;color: #68a5ca;">
                                    --
                                </span>
                                <div class="UnderlineGreen" data-info="UnderlineBattery"></div>
                                <span style="justify-content:center; display:block;color: white;font-weight: normal; margin-top: 6px;" class="LabelStyle">BATTERY</span>
                            </div>
                            <div class="displayContainer" onclick="ShowMap(this)" style="margin-left:10px; z-index:140;  display: none; ">

                                <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="ID_31" version="1.1" viewBox="0 0 16.933333 18.933333" height="60" width="40" data-value="map">
                                    <g id="g8225-3-9" transform="translate(-26.847364,-24.215189)">

                                        <g style="stroke:#ff0000" id="g8098-9-4-4" transform="translate(65.493399,-9.9190641)">
                                            <path style="opacity:1;fill: #6ac0f3;fill-opacity:1;stroke: #ffffff;stroke-width:1.77158;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;" d="m -26.663135,39.093673 a 3.5554496,3.5554496 0 0 1 -3.555451,3.555449 3.5554496,3.5554496 0 0 1 -3.555449,-3.555449 3.5554496,3.5554496 0 0 1 3.555449,-3.555449 3.5554496,3.5554496 0 0 1 3.555451,3.555449 z" id="path7975-0-8-4-0"></path>
                                            <path style="fill: #ffffff;fill-opacity:1;stroke:none;stroke-width:0.529167;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;" d="m -34.339821,40.773931 4.093422,7.671634 c 1.381425,-2.559629 3.230117,-5.812082 4.144273,-7.678889 -2.454894,3.121173 -5.109367,3.839063 -8.237695,0.0073 z" id="path8088-3-7-7"></path>
                                        </g>
                                        <path id="path8216-8-5" d="m 31.178828,36.392542 -4.357449,4.417974 h 16.908209 l -4.50977,-4.417969 -2.41904,-0.0012 -0.28858,0.524401 2.49476,1.58e-4 3.43945,3.371094 H 28.071409 l 3.328129,-3.371094 2.609,0.0016 -0.27916,-0.521264 z" style="color: #fffbfb;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color: #fffdfd;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;vector-effect:none;fill: #ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.32292;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate;"></path>
                                    </g>
                                </svg>
                            </div>
                        </div>

                    </div>
                    <div class="PositionToggle">
                        <!-- <label class="switch" data-info="baitStateToggle" onclick="ChangeBaitState(this)">
                            <input type="checkbox" data-value="checkbox"  disabled>
                            <span   class="slider round"><span data-value="SelectElementCB"  class="inactiveToggle">Taken</span></span>
                        </label> -->
                        <label class="switch" onclick="ChangeActiveGraphSource(this)">
                            <input type="checkbox" data-value="checkbox" checked disabled>
                            <span data-value="AdvStatus" class="slider round"><span data-value="SelectElement" class="activeToggle">Taken</span></span>
                        </label>

                    </div>
                    <div class="flex">

                        <div data-info="noChartData" style="height:248px; width:100%">
                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 800 231" style="enable-background:new 0 0 800 231; height:100%; width:100%;" xml:space="preserve">
                            <style type="text/css">
                                .st0 {
                                    fill: #41505a;
                                }

                                .st1 {
                                    fill: none;
                                    stroke: #CACDD6;
                                    stroke-miterlimit: 10;
                                }

                                .st2 {
                                    fill: #ffffff;
                                }

                                .st3 {
                                    fill: #ffffff;
                                }

                                .st4 {
                                    fill: #ffffff;
                                }
</style>
                            <g>
                            <g id="Layer_2_1_">
                            <g id="design">
                            <path class="st0" d="M0.7-0.2h800v231.6H0.7L0.7-0.2z" />
			
                            <path class="st2" d="M385.2,156.2H384l-5.1-7.8h0c0.1,0.9,0.1,1.8,0.1,2.5v5.3h-1V147h1.2l5.1,7.8h0c0-0.1,0-0.5-0.1-1.1     s0-1.1,0-1.3V147h1L385.2,156.2z M393.6,152.8c0.1,1-0.3,1.9-0.9,2.7c-0.6,0.7-1.5,1-2.4,1c-0.6,0-1.2-0.1-1.7-0.4     c-0.5-0.3-0.9-0.7-1.1-1.3c-0.3-0.6-0.4-1.3-0.4-1.9c-0.1-1,0.2-1.9,0.9-2.6c0.6-0.7,1.5-1,2.4-1c0.9,0,1.7,0.3,2.3,1     C393.4,150.9,393.7,151.8,393.6,152.8L393.6,152.8z M388.3,152.8c0,0.7,0.1,1.4,0.5,2c0.4,0.5,1,0.7,1.6,0.7     c0.6,0,1.2-0.2,1.6-0.7c0.4-0.6,0.6-1.3,0.5-2c0-0.7-0.1-1.4-0.5-2c-0.4-0.5-1-0.7-1.6-0.7c-0.6,0-1.2,0.2-1.6,0.7     C388.5,151.4,388.3,152.1,388.3,152.8L388.3,152.8z M403.6,155.3L403.6,155.3c-0.6,0.7-1.4,1.1-2.3,1.1c-0.8,0-1.6-0.3-2.1-0.9     c-0.5-0.8-0.8-1.7-0.8-2.6c-0.1-1,0.2-1.9,0.8-2.7c0.5-0.7,1.3-1,2.1-1c0.8,0,1.7,0.3,2.2,1h0.1v-3.8h1.1v9.9h-0.9L403.6,155.3z      M401.5,155.5c0.6,0.1,1.2-0.2,1.6-0.6c0.4-0.6,0.5-1.2,0.5-1.9v-0.2c0.1-0.7-0.1-1.5-0.5-2.1c-0.4-0.4-1-0.7-1.6-0.6     c-0.6,0-1.1,0.2-1.4,0.7c-0.4,0.6-0.5,1.3-0.5,2c0,0.7,0.1,1.4,0.5,2C400.4,155.3,400.9,155.5,401.5,155.5z M411.1,156.2l-0.2-1     h0c-0.3,0.4-0.6,0.7-1,0.9c-0.4,0.2-0.8,0.2-1.3,0.2c-0.6,0-1.2-0.2-1.6-0.5c-0.4-0.4-0.6-1-0.6-1.5c0-1.4,1.1-2.1,3.4-2.2h1.2     v-0.4c0-0.4-0.1-0.9-0.4-1.2c-0.3-0.3-0.7-0.4-1.1-0.4c-0.7,0-1.4,0.2-2,0.5l-0.3-0.8c0.4-0.2,0.7-0.3,1.1-0.4     c0.4-0.1,0.8-0.2,1.2-0.1c0.7-0.1,1.3,0.1,1.8,0.6c0.4,0.5,0.7,1.1,0.6,1.8v4.8L411.1,156.2z M408.7,155.5c0.6,0,1.1-0.2,1.5-0.5     c0.4-0.4,0.6-0.9,0.6-1.5v-0.6l-1.1,0.1c-0.6,0-1.2,0.1-1.8,0.4c-0.4,0.2-0.6,0.6-0.6,1.1c0,0.3,0.1,0.6,0.4,0.9     C408,155.4,408.4,155.5,408.7,155.5L408.7,155.5z M416.3,155.5c0.2,0,0.4,0,0.5,0c0.1,0,0.3,0,0.4-0.1v0.8     c-0.2,0.1-0.3,0.1-0.5,0.1c-0.2,0-0.4,0.1-0.6,0.1c-1.3,0-2-0.7-2-2.1v-4.1h-1v-0.5l1-0.4l0.4-1.5h0.6v1.6h2v0.8h-2v4.1     c0,0.4,0.1,0.7,0.3,1C415.7,155.4,416,155.5,416.3,155.5L416.3,155.5z M422.9,156.2l-0.2-1h0c-0.3,0.4-0.6,0.7-1,0.9     c-0.4,0.2-0.8,0.2-1.3,0.2c-0.6,0-1.2-0.2-1.6-0.5c-0.4-0.4-0.6-1-0.6-1.5c0-1.4,1.1-2.1,3.4-2.2h1.2v-0.4c0-0.4-0.1-0.9-0.4-1.2     c-0.3-0.3-0.7-0.4-1.1-0.4c-0.7,0-1.4,0.2-2,0.5l-0.3-0.8c0.4-0.2,0.7-0.3,1.1-0.4c0.4-0.1,0.8-0.2,1.2-0.1     c0.7-0.1,1.3,0.1,1.9,0.6c0.4,0.5,0.7,1.1,0.6,1.8v4.8L422.9,156.2z M420.5,155.5c0.6,0,1.1-0.2,1.5-0.5c0.4-0.4,0.6-1,0.6-1.5     v-0.6l-1,0.1c-0.6,0-1.2,0.1-1.8,0.4c-0.4,0.2-0.6,0.6-0.6,1.1c0,0.3,0.1,0.6,0.4,0.9C419.8,155.4,420.2,155.5,420.5,155.5     L420.5,155.5z" />

                            <path class="st4" d="M418.7,113.4v14.1h-36v-14.1l6.3-17.2h23.5L418.7,113.4z M417.2,113.4l-5.5-15.6h-21.9l-5.5,15.6h11v0.8     c0,3,2.5,5.5,5.5,5.5s5.5-2.5,5.5-5.5v-0.8H417.2z M417.2,115h-9.4c-0.2,1.7-1.1,3.3-2.4,4.5c-2.7,2.4-6.7,2.4-9.4,0     c-1.3-1.1-2.1-2.7-2.4-4.5h-9.4v10.9h32.9L417.2,115z" />

		                                </g>
	                                </g>
                                </g>
                            </svg>
                        </div>
                        <div data-info="chart" style="display:none; width:100%;height:200px;">
                        </div>

                        <div class="ct-chart ct-golden-section" data-info="lineChart" style="display:none;"></div>
                    </div>
                    <div class="flex" style="flex-direction:row; justify-content:space-evenly;  margin-bottom: 20px; width:100%;text-align:center;">

                        <div style="width:100%;display:grid;">
                            <span style="float: left; margin-right: 0; color: #ffffffff;font-weight: normal;" class="LabelStyle">
                                LAST MOTION
                            </span>
                            <span style="font-size: 12px ;color: #68a5ca;  margin-top: 5px; " data-value="updateTime">--</span>
                        </div>

                        <div style="width:100%;display:grid;">
                            <span style="float: left; margin-right: 0;   color: #ffffffff;font-weight: normal;" class="LabelStyle">
                                BAIT CHANGED
                            </span>
                            <span style="font-size: 12px; color:#68a5ca; margin-top: 5px; " data-value="SetTimeFormatted">--</span>
                        </div>

                        <div style="width:100%;display:grid;">
                            <span style="width: 100%; color: #ffffffff;font-weight: normal;" class="LabelStyle">
                                LAST SET DATE
                            </span>
                            <span style="font-size: 12px; color:#68a5ca;  margin-top: 5px; " data-value="setDateTime">--</span>
                        </div>

                    </div>
                    <div class="flex" style="flex-direction: row; justify-content: space-evenly; width: 100%; text-align: center; margin-top: 15px;" data-info="r1">

                        <div style="width:100%;display:grid;">
                            <span style="float: left; margin-right: 0; font-size: 12px; color: #ffffffff;font-weight: normal; " class="ValueStyle">
                                Packet Type
                            </span>
                            <span style="font-size: 15.5px ;color: #68a5ca;font-weight: 900;" data-value="packetType">--</span>
                        </div>

                        <div style="width:100%;display:grid;">
                            <span style="float: left; margin-right: 0; font-size: 12px; color: #ffffffff;font-weight: normal;" class="ValueStyle">
                                Device Range
                            </span>
                            <span style="font-size: 15.5px; color:#68a5ca;font-weight: 900;" data-value="deviceRange">--</span>
                        </div>

                        <div style="width:100%;display:grid;">
                            <span style="font-size: 12px; width: 100%; color: #ffffffff;font-weight: normal;" class="ValueStyle">
                                Rebait Range
                            </span>
                            <span style="font-size: 15.5px; color:#68a5ca;font-weight: 900;" data-value="rebaitRange">--</span>
                        </div>

                    </div>
                    <div class="flex" style="flex-direction:row; justify-content:space-evenly;  width:100%;text-align:center; margin-top:15px;" data-info="r2">



                        <div style="width:100%;display:grid;">
                            <span style="float: left; margin-right: 0; font-size: 12px; color: #ffffffff;font-weight: normal;" class="ValueStyle">
                                Packet 6 L1
                            </span>
                            <span style="font-size: 15.5px; color:#68a5ca;font-weight: 900;" data-value="l1">--</span>
                        </div>

                        <div style="width:100%;display:grid;">
                            <span style="font-size: 12px; width: 100%; color: #ffffffff;font-weight: normal;" class="ValueStyle">
                                Packet 6 L2
                            </span>
                            <span style="font-size: 15.5px; color:#68a5ca;font-weight: 900;" data-value="l2">--</span>
                        </div>
                        <div style="width:100%;display:grid;">
                            <span style="font-size: 12px; width: 100%; color: #ffffffff;font-weight: normal;" class="ValueStyle">
                                Packet 6 Test
                            </span>
                            <span style="font-size: 15.5px; color:#68a5ca;font-weight: 900;" data-value="p6Test">--</span>
                        </div>
                    </div>
                    <div class="flex" style="flex-direction:row; justify-content:space-evenly;  width:100%;text-align:center; margin-top:15px;" data-info="r3">

                        <div style="width:100%;display:grid;">
                            <span style="float: left; margin-right: 0; font-size: 12px; color: #ffffffff;font-weight: normal;" class="ValueStyle">
                                Packet 1 Load Cell
                            </span>
                            <span style="font-size: 15.5px; color:#68a5ca;font-weight: 900;" data-value="p1">--</span>
                        </div>

                        <div style="width:100%;display:grid;">
                            <span style="font-size: 12px; width: 100%; color: #ffffffff;font-weight: normal;" class="ValueStyle">
                                Packet 2 Load Cell
                            </span>
                            <span style="font-size: 15.5px; color:#68a5ca;font-weight: 900;" data-value="p2">--</span>
                        </div>
                        <div style="width:100%;display:grid;">
                            <button style="width:100%; " onclick="DeleteDevice(this)">
                                Delete Device
                            </button>
                        </div>  
                    </div>
                </div>
                <div data-section="Actions">
                    <div data-section="OrdinaryDevice">
                        <div class="row">
                            <div style="margin:3%;" data-section="ordinaryFormBtn">
                                <div class="row">
                                    <a href="#" class="selectBtn fullWidth fixMargin" data-button="manualLog" onclick="UpdateManual(event)">
                                        Add Bait
                                    </a>
                                </div>
                                <div class="row">
                                    <a href="#" class="selectBtn fullWidth fixMargin" data-button="resetIR" onclick="ActivateManual(event)">
                                        Observation
                                    </a>
                                </div>
                                <div class="row">
                                    <a href="#" class="selectBtn fullWidth fixMargin" data-button="noActivityBtn" onclick="NoActivity(event)">
                                        No Activity
                                    </a>
                                </div>



                            </div>
                        </div>
                    </div>
                    <div data-section="SmartDevice">


                        <div class="row" onclick="event.stopPropagation()">
                            <div class="container-fluid" data-info="btnSmart">
                                <div class="row flex flexItemHolder">
                                    <div class="flexItem">
                                        <svg xmlns="http://www.w3.org/2000/svg" data-info="baitIcon" onclick="AddBait(event)" width="16" height="16" fill="currentColor" class="bi bi-plus-circle iconGrid" viewBox="0 0 16 16">
                                            <path fill="#4d98c2ff" d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                            <path fill="#4d98c2ff" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                                        </svg>
                                        <p style="color:#4d98c2ff" data-info="baitText" class="fixMargin">ADD BAIT</p>
                                        <!--<a href="#" class="selectBtn fullWidth" data-button="addBait" >
                                            Add Bait
                                        </a>-->
                                    </div>
                                    <div class="flexItem" style="display: none;">
                                        <!--<a href="#" class="selectBtn fullWidth" data-button="noActivityBtn" onclick="NoActivity(event)">
                                            No Activity
                                        </a>-->
                                        <svg xmlns="http://www.w3.org/2000/svg" onclick="NoActivity(event)" width="16" height="16" fill="currentColor" class="bi bi-eye iconGrid" viewBox="0 0 16 16">
                                            <path fill="#4d98c2ff" d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z" />
                                            <path fill="#4d98c2ff" d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z" />
                                        </svg>
                                        <p style="color:#4d98c2ff;" class="fixMargin">OBSERVATION</p>
                                    </div>
                                    <div class="flexItem">
                                        <!--<a href="#" class="selectBtn fullWidth" data-button="resetIR">
                                            Reset Motion Count
                                        </a>-->
                                        <svg xmlns="http://www.w3.org/2000/svg" onclick="ResetIR(event)" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise iconGrid" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" fill="#4d98c2ff" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z" />
                                            <path fill="#4d98c2ff" d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z" />
                                        </svg>
                                        <p style="color:#4d98c2ff;" class="fixMargin">RESET</p>
                                    </div>
                                </div>
                                <div class="row flex flexItemHolder">
                                    <div class="flexItem">

                                        <svg xmlns="http://www.w3.org/2000/svg" onclick="SetDeviceCard(event)" width="16" height="16" fill="currentColor" class="bi bi-arrow-bar-down iconGrid" viewBox="0 0 16 16">
                                            <path fill="white" fill-rule="evenodd" d="M1 3.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13a.5.5 0 0 1-.5-.5zM8 6a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 0 1 .708-.708L7.5 12.293V6.5A.5.5 0 0 1 8 6z" />
                                        </svg>
                                        <p style="color:white;" class="fixMargin">SET</p>
                                    </div>
                                    <div class="flexItem" style="display: none;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-square iconGrid" viewBox="0 0 16 16">
                                            <path fill="white" d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z" />
                                            <path fill="white" d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                                        </svg>
                                        <p style="color:white;" class="fixMargin">CLEAR</p>
                                    </div>
                                    <div class="flexItem">
                                        <svg xmlns="http://www.w3.org/2000/svg" onclick="StartRemove(event)" width="16" height="16" fill="currentColor" class="bi bi-arrow-bar-up iconGrid" viewBox="0 0 16 16">
                                            <path fill="white" fill-rule="evenodd" d="M8 10a.5.5 0 0 0 .5-.5V3.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 3.707V9.5a.5.5 0 0 0 .5.5zm-7 2.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13a.5.5 0 0 1-.5-.5z" />
                                        </svg>
                                        <p style="color:white;" class="fixMargin">REMOVE</p>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                    <div data-section="formScreen" onclick="event.stopPropagation()" style="background-color: rgb(65, 80, 90); border: 1px solid #bfbfbf; margin-top: 15px; display: none;">

                        <div data-form="formTemp">

                        </div>
                        <div data-form="formBait">
                            <div style="margin-top:10px;">
                                <div class="PositionCheckbox">
                                    <p class="CheckboxLabel" style="margin:8px;">Repeat</p>
                                    <input type="checkbox" class="CustomCheckbox" data-info="RepeatCheckbox" onchange="RepeateChecked(this)" style="border-radius:5px;" />
                                </div>
                                <!-- <select data-select="BaitType" onchange="baitChanged(this)" class="select-css" style="margin-top: 15px; display:none;">
                                    <option value="default" disabled selected>Select Bait Type</option>
                                </select> -->
                                <div style="margin-top: 10px; ">
                                    <select data-select="BaitType" onchange="BaitDetailChanged(this)" class="select-css" style="margin-top: 15px; height: 44px; background: #646c83; ">
                                        <option value="default" disabled selected>Select</option>
                                    </select>
                                </div>
                                <div style="display:flex">
                                    <p class="alignLabelCenter" style="margin-bottom: 2px;margin-top: 30px;">QTY (Blocks)</p>
                                    <p class="alignLabelCenter" style="margin-bottom: 2px;margin-top: 30px;">QTY (GM / OZ)</p>

                                </div>
                                <div style="display:flex">
                                    <div class="number-input" style="height:44px;">
                                        <input class="quantity" min="0" data-info="qtyInput" name="quantity" value="1" type="number" onkeyup="QtyBoxChanged(this)">
                                        <button onclick="DecrementCounter(this)" style="border-right:1px solid white;color:white;"></button>
                                        <button onclick="IncrementCounter(this)" style="color:white;" class="plus"></button>
                                    </div>
                                    <p class="alignLabelCenter" style="font-size: 26px;margin-top:12px;" data-value="QtyLabel">0 / 0</p>
                                </div>
                                <label for="StationId">Next Check</label>

                                <div style="display:flex">
                                    <div class="number-input" style="height:44px; width:100%;">
                                        <input type="date" class="inputDate" min="0" data-info="expiryDate" onchange="ExpiryChanged(this)">
                                    </div>
                                </div>

                                <select data-select="Quantity" class="select-css" style="margin-top: 15px; display:none">
                                    <option value="default" disabled selected>Quantity</option>
                                </select>
                                <div class="flex" style="overflow: auto; margin-top:8px;  ">

                                    <a data-button="cancelButton" onclick="CancelBait(event)" class="selectBtn" style="margin:0px;width:100%;border-right:1px solid #fff;">
                                        CANCEL
                                    </a>
                                    <a data-button="submitButton" onclick="submitTrap(event)" class="selectBtn" style="margin:0px;width:100%;">
                                        SAVE
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div data-form="formSet" style="display:none;">
                            <div style="margin-top:10px;">
                                <div class="PositionCheckbox" style="display: none;">
                                    <span class="CheckboxLabel" style="cursor:pointer;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-camera" viewBox="0 0 16 16">
                                            <path d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z"></path>
                                            <path d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"></path>
                                        </svg>
                                    </span>
                                </div>
                                <div style="margin-top: 10px; ">
                                    <select data-select="DeviceTypes" onchange="DeviceTypeChanged(this)" class="select-css" style="margin-top: 15px; background: #646c83; ">
                                        <option value="default" disabled selected>Select</option>
                                    </select>
                                </div>

                                <div style="display:flex">
                                    <div  class="BoxLabel">
                                        <label for="name">Name</label>
                                        <div class="number-input" style="height:44px; width:100%;">
                                            <input type="text" id="name" class="inputDate inputText" min="0" data-info="setNane" onchange="NameChanged(this)">
                                        </div>
                                    </div>
                                    
                                </div>
                                <div style="display: flex; margin-top: 8px;">
                                    <div class="BoxLabel">
                                        <label for="locationNotes">Location Notes</label>
                                        <div class="number-input" style="height:44px; width:100%;">
                                            <input type="text" id="locationNotes" class="inputDate inputText" min="0" data-info="setLocation" onchange="LocationChanged(this)">
                                        </div>
                                    </div>
                                   
                                </div>
 
                                <div style="display:flex">
                                    <div class="BoxLabel" style="margin-right:0;">
                                        <label for="StationId">Station Id</label>

                                        <div class="number-input" style="height: 44px; width: 96%; display: flex;">
                                            <input class="quantity " id="StationId" style="width:100%;  max-width:70%;" min="0" data-info="stationInput" name="quantity" value="1" type="number" onchange="StationBoxChanged(this)">
                                            <button onclick="DecrementCounterSet(this)" style="border-right:1px solid white;color:white;"></button>
                                            <button onclick="IncrementCounterSet(this)" style="color:white;" class="plus"></button>
                                        </div>

                                    </div>
                                 
                                </div>



                                <select data-select="Quantity" class="select-css" style="margin-top: 15px; display:none">
                                    <option value="default" disabled selected>Quantity</option>
                                </select>
                                <div class="flex" style="overflow: auto; margin-top:8px;  ">

                                    <a data-button="cancelButton" onclick="CancelBait(event)" class="selectBtn" style="margin:0px;width:100%;border-right:1px solid #fff;">
                                        CANCEL
                                    </a>
                                    <a data-button="submitButton" onclick="SetCard(event)" class="selectBtn" style="margin:0px;width:100%;">
                                        SAVE
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div data-form="RemoveDevice">
                            <h2 style="color:white;font-size: 15px;text-align: center;">CLICK SAVE TO REMOVE DEVICE FROM THIS LOCATION?</h2>
                            <div class="flex" style="overflow: auto; margin-top:8px;  ">
                                <a data-button="cancelButton" class="selectBtn" onclick="ResetIRCancel(event)" style="margin:0px;width:100%;border-right:1px solid #fff;">
                                    CANCEL
                                </a>
                                <a data-button="submitButton" onclick="RemoveDevice(event)" class="selectBtn" style="margin:0px;width:100%;">
                                    SAVE
                                </a>
                            </div>
                        </div>
                        <div data-form="ResetIR">
                            <h2 style="color:white;font-size: 15px;text-align: center;">CLICK SAVE TO CONFIRM DEVICE RESET</h2>
                            <div class="row" style=" display: inline-block; width: 100%;">
                                <div class="PositionCheckbox">
                                    <p class="CheckboxLabel">Motion</p>
                                    <input type="checkbox" class="CustomCheckbox" data-info="MotionCheckbox" checked style="border-radius:5px;" />
                                </div>
                                <div class="PositionCheckbox">
                                    <p class="CheckboxLabel">Alerts</p>
                                    <input type="checkbox" class="CustomCheckbox" data-info="AlertCheckbox" style="border-radius:5px;" />
                                </div>
                            </div>

                            <div class="flex" style="overflow: auto; margin-top:8px;  ">
                                <a data-button="cancelButton" class="selectBtn" onclick="ResetIRCancel(event)" style="margin:0px;width:100%;border-right:1px solid #fff;">
                                    CANCEL
                                </a>
                                <a data-button="submitButton" onclick="ResetIRSubmit(event)" class="selectBtn" style="margin:0px;width:100%;">
                                    SAVE
                                </a>
                            </div>
                        </div>

                        <div data-form="noActivity">
                            <h2 style="color:white;font-size: 15px;text-align: center;">CONFIRM NO ACTIVITY?</h2>
                            <div class="flex" style="overflow: auto; margin-top:8px;  ">
                                <a data-button="cancelButton" class="selectBtn" onclick="ResetIRCancel(event)" style="margin:0px;width:100%;border-right:1px solid #fff;">
                                    CANCEL
                                </a>
                                <a data-button="submitButton" onclick="NoActivitySubmit(event)" class="selectBtn" style="margin:0px;width:100%;">
                                    SAVE
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="cardTemplate" style="display:none">
        <div>
            <!--Start of Parent Card-->
            <div class="normalCardBorder" onclick="ShowTraps(this)" style="font-family: sans-serif; background-color: #f2f2f2; padding: 8px; overflow:auto; overflow-x:hidden">
                <div data-section="cell">
                    <div>
                        <div class="container flex" style="margin: 8px 8px 4px 0; ">
                            <div class="col-left" style="border-right: 0.98px solid #9b9b9bff;width:100%;">
                                <div class="iconWidth PositionIcon">
                                    <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" id="svg29831" version="1.1" viewBox="0 0 16.933333 16.933333" height="36" width="36">
                                        <g id="g8856" transform="matrix(1.0393596,0,0,1.0918312,-144.64395,-96.576359)">
                                            <g id="g8880">
                                                <path id="path18578-0-7-9-4" d="m 151.37301,104.03303 -8.46777,-0.006 -1.0003,-0.009 h -2.68785 V 88.523917 h 13.75153 v 6.730598 l 0.005,-2.01108 -1.30933,0.01668 -0.0117,1.994402 v -5.56608 H 140.5335 V 102.8535 h 1.37841 l 1.00727,0.009 7.73503,0.006 z" style="color:#000000;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;vector-effect:none;fill:#41505a;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.23812;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"></path>
                                                <rect transform="scale(-1)" y="-92.548515" x="-150.43297" height="1.8080391" width="8.6755915" id="rect18586-3-79-9-9" style="opacity:1;fill:#2c5aa0;fill-opacity:1;stroke:#d74423;stroke-width:0;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"></rect>
                                                <path style="opacity:1;fill:#2c5aa0;fill-opacity:1;stroke:#d74423;stroke-width:0;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="m 148.8019,95.137243 h -7.04451 v -1.808039 h 8.67558 c -0.70958,0.529282 -1.38201,1.074999 -1.63107,1.808039 z" id="rect18588-6-6-2-1"></path>
                                                <path id="path18590-6-1-8-7" d="m 141.75782,97.743303 v -1.789747 l 6.75536,-0.0092 c -0.11624,0.430866 -0.29459,0.730966 -0.28386,1.817226 z" style="color:#000000;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;vector-effect:none;fill:#2c5aa0;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:0;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"></path>
                                                <g id="g8846" transform="matrix(0.68359534,0,0,0.68359534,43.301134,37.305868)">
                                                    <path id="path7975-0-8-4-00" d="m 163.24978,87.851079 a 3.5554496,3.5554496 0 0 1 -3.55545,3.555449 3.5554496,3.5554496 0 0 1 -3.55545,-3.555449 3.5554496,3.5554496 0 0 1 3.55545,-3.555449 3.5554496,3.5554496 0 0 1 3.55545,3.555449 z" style="opacity:1;fill:none;fill-opacity:1;stroke:#41505a;stroke-width:1.77158;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"></path>
                                                    <path id="path8088-3-7-2" d="m 155.57309,89.531337 4.09342,7.671637 c 1.38143,-2.559632 3.23012,-5.812085 4.14428,-7.678892 -2.4549,3.121173 -5.10937,3.839063 -8.2377,0.0073 z" style="fill:#41505a;fill-opacity:1;stroke:none;stroke-width:0.529167;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"></path>
                                                </g>
                                            </g>
                                        </g>
                                    </svg>
                                </div>
                                <!--<div data-info="icon" class="redIcon vertical-center" style="display: inline-block; width: 25px; height: 25px;"></div>-->
                                <div class="vertical-center setupContent">
                                    <div class="row">
                                        <div class="capitalize" data-value="CardName" style="font-size: 12.5px">
                                            loading...
                                        </div>

                                        <div data-value="CardAddress" style="display:inline-block;word-wrap:break-word;font-size: 10.5px;">
                                            loading...
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div style="float: right; margin-right: -12px; display: flex; width:100%;">

                                <div class="displayContainer" style=" text-align: center;margin-left: 10px; width:100%;">
                                    <span class="ValueStyle" data-value="Urgent">
                                        --
                                    </span>
                                    <div class="UnderlineRed" style="width:100%">
                                        <span data-value="status1Pos" class="underlineIndicatorCenter"></span>
                                    </div>
                                    <span class="LabelStyle" data-info="lbl1">URGENT</span>
                                </div>

                                <div class="displayContainer" style="text-align: center;margin-left: 10px;width:100%;">
                                    <span class="ValueStyle" data-value="Important">
                                        --
                                    </span>
                                    <div class="UnderlineOrange" style="width:100%">
                                        <span data-value="status2Pos" class="underlineIndicatorCenter"></span>
                                    </div>
                                    <span class="LabelStyle" data-info="lbl2">IMPORTANT</span>
                                </div>

                                <div class="displayContainer" style="text-align: center;margin-left: 10px;width:100%; margin-right:2%;">
                                    <span class="ValueStyle" data-value="Minor">
                                        --
                                    </span>
                                    <div class="UnderlineGreen" style="width:100%">
                                        <span data-value="status3Pos" class="underlineIndicatorCenter"></span>
                                    </div>
                                    <span class="LabelStyle" data-info="lbl3">NO ACTIVITY</span>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <!--End of Parent Card-->


            <div data-selector="Traps" style="display:none;">

            </div>

        </div>
    </div>
    <!-- <script src="/widgets/api/DataTypes.js"></script> -->
    <script src="/widgets/api/Database.js"></script>
    <script src="/widgets/api/Script.js"></script>
    <script src="/widgets/api/Utils.js"></script>
    <script src="/widgets/api/ClientEvents.js"></script>
    <script src="/widgets/api/Client.js"></script>

    <script src="/widgets/js/line_chart/chartist.min.js"></script>
    <script src="../js/utilities.js"></script>

    <script>
        "use strict";

        var options = {
            settings: {
                "category": "widget",
                "type": window.location.pathname.split("/").slice(-1)[0].split(".")[0].replace("%20", " "),
                "iniHeight": parseInt(widget.style.height),
                "iniWidth": parseInt(widget.style.width),
                "author": "Sensavation",
                "tbTooltip": "Display data by column/row",
                "tooltip": "",
                "version": "190104",
                "group": "forms",
                "zIndex": "ZINDEX_DEFAULT",
                "disabled": false,
                "scaling": true,
                "help": "card"
            },
            clientEvents: {
                inputEvents: {
                    "receive value": receive_value,
                    "receive headers": receive_headers,
                    "set technicians": settechnicians,
                    "set trap type": setTrapTypes,
                    "set animals": setAnimals,
                    "set alert": setAlertEvent,
                    "toggle card": toggleCardEvent,
                    "set new photo status": newPhotoEvent,
                    "sort": sortEvent,
                    "device action": controlDeviceAction,
                    "filter": filterCards,
                    "set baits": setBaits, // Depricated
                    "set baitTypes": setBaitTypes,
                    "set Quantities": setQuantities,
                    "set report log": incomingLogMessage,
                    "clear content": clearContent,
                    "set thresholds": setTresholds,
                    "end of day check": endOfDayCheck,
                    "change visible counter": ChangeCardHeaderType,
                    "change view pointer": ChangeCardPointer,
                    "toggle child": ToggleChild,
                    "addBait": OpenDeviceBait,
                    "GraphState": SetGraphState,
                    "DisableBait": DeviceDisableBait,
                    "DeviceDetails": UpdateDeviceDetails,
                    "DeviceErrorsLoaded":SetDeviceErrors,
                    "setTopPosition": setTopPosition,
                    "setSiteId": setSiteId,
                    "SetCurrentStationId": SetCurrentStationId,
                    "SetAdjacentStationIds": SetAdjacentStationIds
                },
                outputEvents: 
                [
                    "deactivate trap",
                    "address pressed",
                    "set trap",
                    "check trap",
                    "clear trap",
                    "photo icon pressed",
                    "children populated", 
                    "ChildCardToggled", 
                    "ChangeBait",
                    "DeviceDetails",
                    "EventTransaction",
                    "SaveTimeWindow",
                    "UpdateTimeWindow",
                ]

            },
            serverEvents: {
                inputEvents: {
                    "feed": {
                        "function": fw_feed
                    },
                    "history": {
                        "function": fw_history,

                    },

                },
                outputEvents: [
                    "smtpclient"
                ]
            },
            dataTypes: {
                "feed": ["sensacollection", "number", "string"],
                "retValue": ["array"],
                "history": ["array"]

            },
            attribs: {

            }
        };
        //#endregion
        //#region --- Declarations ---
        var battery = document.getElementById("battery");
        var numVal = document.getElementById("numVal");
        //#endregion
        // Look at having a circular array incase the buffer gets too big. Will be an issue if page is left open for weeks.
        var tableBody = document.getElementById("tbody");
        var cardTemplate = document.getElementById("cardTemplate");
        var cardChildTemplate = document.getElementById("cardChildTemplate");

        // enum type object to remove magic numbers for card state - State is the red, yellow, green, grey colour of the card
        const CardState = {UrgentRed: 4, ImportantYellow: 3, NormalGreen: 2, DeactivatedGrey: 1, Unassigned: 0};
        // status is whether the device is enabled or disabled.
        const CardStatus = {Disabled: 0, Enabled: 1};

        var weekday = new Array(7);
        weekday[1] = "Mon";
        weekday[2] = "Tue";
        weekday[3] = "Wed";
        weekday[4] = "Thu";
        weekday[5] = "Fri";
        weekday[6] = "Sat";
        weekday[0] = "Sun";
        var ActiveDatasource;
        var rowStateHeaders = {};
        var SelectedVisibleState = 1;
        var rowElems = {};
        var rowHeaderElemVals = {};
        var rowHeaderElems = {};
        var rowState = {};
        var trapTypesObj = {};
        var animalsObj = {};
        var technicianObj = {};
        var SelectVlueObj = {};
        var cardSelected;
        var cardSelectedParent;
        var BindingBaitDetails;
        var areaReport = [];
        var activeDropdowndataSources = [];
        var BaitDetailId;
        var BaitTypeId;
        var rowKeys;
        var lastHeader;
        var baitThreshold;
        var baitThresholdUpper;
        var triggerTreshold;
        var triggerTresholdUpper;
        var activeCards = [];
        var _Id;
        var _TimeSeriesData = {};
        var _DaysSeriesWeight;
        var _DaysSeriesIR;
        var _DaysSeriesCycle;
        var _IrLoaded = false;
        var _WeightLoaded = false;
        var _CycleLeftLoaded = false;
        var _CycleRightLoaded = false;
        var lastDateCycleCount;
        var AveragesIR;
        var averagesWeight;
        var averagesWeightTaken;
        var averagesCycle;
        var averagesCycleTaken;
        var selectedChart;
        var _ToggledChartType = true;
        var _IsGraphOpened = false;
        var _selectedDay = 0;
        var _selectedType = true;
        var selectedDay = 0;
        var GraphEnabled = true;
        var BaitState = false;
        var InnerRowId;
        var ActiveCardProduct;
        var DefaultActiveCardProduct;
        var BarCompensation = 11.1;
        var Errors = [];
        var QtySet;
        var LastSetDateChanged;
        var RepeatBait;
        var minDown = 0;
        var siteId;
        var currentStationId;
        var adjacentStationIds;
        var showActive = true;
        var deviceControlToggle = 0;

        Date.prototype.addDays = function (days) {
            var date = new Date(this.valueOf());
            date.setDate(date.getDate() + days);
            return date;
        }

        Date.prototype.substractDays = function (days) {
            var date = new Date(this.valueOf());
            date.setDate(date.getDate() - days);
            return date;
        }

        function pad(number) {
            if (number < 10) {
                return '0' + number;
            }
            return number;
        }


        //#region --- Declarations ---
        // It doesn't appear that this is used, I can't find an event on the widget that uses it.
        function setAlertEvent(eventData) {
            if (typeof eventData.value !== "string") {

                throw new TypeError("Expected a string but found " + typeof eventData.value);
            }

            var card = rowElems[eventData.value];

            if (card === undefined) {

                throw new Error("No card exists with the primary key '" + eventData.value + "'");
            }


            card.parentElement.parentElement.classList = [];
            card.parentElement.parentElement.classList.add("alertBorder");

        }

        // internal function interacts with HTML
        // this event is called directly from pressing the actions button. When a device card is open and this function is run, it displays
        // the actions tab for a device card. It highlights the action button, de-highlights the device info button, and hides the device info.
        function OpenActions(event) {

            var id = event.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.getAttribute("data-id");
            if (rowState[id].DeviceType == "1") {

                event.currentTarget.parentNode.parentNode.querySelector("[data-section='OrdinaryDevice']").style.setProperty("display", "none");
                event.currentTarget.parentNode.parentNode.querySelector("[data-section='SmartDevice']").style.setProperty("display", "");
            }
            else {
                event.currentTarget.parentNode.parentNode.querySelector("[data-section='OrdinaryDevice']").style.setProperty("display", "none");
                event.currentTarget.parentNode.parentNode.querySelector("[data-section='SmartDevice']").style.setProperty("display", "");
            }

            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-section='DeviceInfo']")
                .style.setProperty("display", "none");
            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-section='Actions']")
                .style.setProperty("display", "");
            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-info='btnActions']")
                .setAttribute("class", "tabBtnSelected");
            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-info='btnInfo']")
                .setAttribute("class", "tabBtn"); 
        }

        // internal function
        // this event is called directly from pressing the device info button. When a device card is open and this function is run, it displays
        // the device info tab for a device card. It highlights the device info button, de-highlights the action info button, and hides the action.
        function OpenDeviceInfo(event) {
             
            var id = cardSelected.parentNode.getAttribute("data-id");
            fw.fireEvent("DeviceDetails", id);

            event.currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-section='Actions']")
                .style
                .setProperty("display", "none");
            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-section='DeviceInfo']")
                .style.setProperty("display", "");
            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-info='btnInfo']")
                .setAttribute("class", "tabBtnSelected"); 
            event
                .currentTarget
                .parentNode
                .parentNode
                .querySelector("[data-info='btnActions']")
                .setAttribute("class", "tabBtn");
            //   selectedChart.update();
        }

        // I don't think this function is ever used.
        function newPhotoEvent(eventData) {
            if (typeof eventData.value !== "string") {

                throw new TypeError("Expected a string but found " + typeof eventData.value);
            }

            var card = rowElems[eventData.value];

            if (card === undefined) {

                throw new Error("No card exists with the primary key '" + eventData.value + "'");
            }

            //card.querySelector("[data-section='photo']").style.setProperty("display", "");
            card.parentElement.parentElement.classList = [];
            if (!card.parentElement.parentElement.classList.contains('alertBorder')) {
                //card.parentElement.parentElement.classList.add("newPhotoBorder");
            }
        }


        /**
         * Internal function
         * checks if priority2 is higher than priority1. Returns true or false
         *
         * @param priority1
         * @param priority2
         */
        function isHigherUrgency(priority1, priority2) {
            return priority2 > priority1;
        }

        /**
         * Client input event function
         * takes an array of ids and hides all other cards.
         *
         * @param eventData
         */
        function filterCards(eventData) {
            if (eventData.value === undefined) {
                // error
                throw new Error("Filter expected a client event object.");
                return;
            }

            if (Array.isArray(eventData.value)) {
                // Must have an array of IDs
                var children = tbody.children;

                for (var i = 0; i < children.length; i++) {
                    if (eventData.value.length === 0) {
                        children[i].style.setProperty("display", "");
                    } else if (eventData.value.indexOf(children[i].getAttribute("data-id")) === -1) {
                        children[i].style.setProperty("display", "none");
                    } else {
                        children[i].style.setProperty("display", "");
                    }
                }

                
            } else if (typeof eventData.value === "string") {
                var children = tbody.children[0].children;

                for (var i = 0; i < children.length; i++) {
                    let cardAddress = children[i].querySelectorAll("[data-value=CardAddress]")[0];
                    let cardName = children[i].querySelector("[data-value='CardName']");

                    let deviceNumber = children[i].querySelector("[data-value='DeviceNumber']");
                    let deviceName = children[i].querySelector("[data-value='DeviceName']");
                    let deviceAddress = children[i].querySelector("[data-value='Address']");

                    if (eventData.value.length === 0) {
                        // Blank query, display result
                        children[i].style.setProperty("display", "");
                    } else if ((deviceNumber != undefined && deviceNumber.innerHTML.toUpperCase().indexOf(eventData.value.toUpperCase()) === -1) &&
                            (deviceName != undefined && deviceName.innerHTML.toUpperCase().indexOf(eventData.value.toUpperCase()) === -1) &&
                            (deviceAddress != undefined && deviceAddress.innerHTML.toUpperCase().indexOf(eventData.value.toUpperCase()) === -1)) {
                            children[i].style.setProperty("display", "none");
                    } else {
                        // Address or name contains search query, display result
                        children[i].style.setProperty("display", "");
                        // If this is a child node, ensure the parent is visible
                        if (children[i].parentElement.dataset.selector === "Children") {
                            // children[i].parentElement.parentElement.parentElement.parentElement.style.setProperty("display", "");
                        }
                    }
                }
            } else if(typeof eventData.value === "object" ) {
                if(eventData.value.value === 'All') {
                    document.querySelectorAll("[data-status='0']").forEach(item => item.style.display = '');
                    showActive = false;
                } else {
                    document.querySelectorAll("[data-status='0']").forEach(item => item.style.display = 'none');
                    showActive = true;
                }
            } else {
                throw new TypeError("Filter must be an array or a string. Found " + typeof eventData.value);
            }
        }


        //Tpm remove
        function setBaits() {
            console.log("Event depricated due to change in the schema.")
        }

        /**
         * When the address is clicked in a card the card will broadcast an event with the given ID.
         * It doesn't ever seem to be called.
         * DEPRECATED??
         * @param event
         */
        function addressEvent(event) {
            // get card id
            var id = event.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.getAttribute("data-id");
            fw.fireEvent("address pressed", id);
            event.stopPropagation();
        }


        /**
         * Client input event function
         * Sets all the trap options available for the card.
         * DEPRECATED??
         * @param packet
         */
        function setTrapTypes(packet) {
            var values = packet;
            if (typeof packet === "object" && packet.value !== undefined) {
                values = packet.value;
            }

            if (!Array.isArray(values)) {

                throw new TypeError("set trap type event expected an array but found '" + typeof values + "'.");
            }
            SetSelectValues(values, "trapType");

        }

        // client input event function
        // doesn't seem to be used in the application
        // DEPRECATED??
        function setQuantities(packet) {


            var values = packet;

            var tempArray = [];
            packet.value.forEach(x => {
                var valSplit = x.Name.split("g");
                tempArray.push(parseInt(valSplit[0]));
            });
            tempArray.sort(function (a, b) { return a - b });

            var bindingData = [];

            tempArray.forEach(x => {
                bindingData.push(x + "g");
            });


            activeDropdowndataSources.push({

                Name: "Quantity",
                Values: packet.value
            });


            SetSelectValues(bindingData, "Quantity");
        }

        // client input event function
        // function that recieves the available quantities that can be used for each bait type. This information is set in the App Settings,
        // and the data is retrieved from a database from the BaitBox controller.
        function setBaitTypes(packet) {
            
            var values = packet;
            if (typeof packet === "array" && packet.value !== undefined) {
                values = packet.value;
            }
            
            activeDropdowndataSources.push({
                Name: "DeviceTypes",
                value:
                    [
                        {
                            Id: 1,
                            Name: "Bait Weight (Default)"
                        },
                        {
                            Id: 1,
                            Name: "Snap Trap"
                        }
                    ]
            });
             
            var vals = PackageData(values);

            activeDropdowndataSources.push({

                Name: "BaitType",
                Values: packet.value
            });
          //  SetSelectValues(vals, "BaitType");
            var elements = "";
            // if(val === undefined)
            // {
            //     return;
            // }
            // val.forEach(x=>{
            //     elements += "<option value="+x+">"+x+"</option>";
            // });
            // cardSelected.querySelector("[data-form='formBait']").querySelector("[data-select='BaitType']").innerHTML= elements;

        }
  
        // internal function
        // takes the incoming data, then for each object in the value key, grabs the name, it pushes it to an array, then sends the full array.
        function PackageData(incoming) {

            var sending = [];
            incoming.value.forEach(x => {
                sending.push(x.Name);
            });
            return sending;
        }
        /**
         * Sets all the technicians available for the card dropdown.
         * DEPRECATED??
         * @param packet
         */
        function settechnicians(packet) {
            var values = packet;
            if (typeof packet === "object" && packet.value !== undefined) {
                values = packet.value;
            }

            if (!Array.isArray(values)) {

                throw new TypeError("set technicians event expected an array but found '" + typeof values + "'.");
            }
            var vals = PackageData(values);
            activeDropdowndataSources.push({

                Name: "technician",
                Values: packet.value
            });

            SetSelectValues(vals, "technician");
        }


        /**
         * Internal function, interacts directly with HTML
         * Used to set the values of certain elements, such as: "technician", "DeviceTypes", "trapType", "Quantity"
         * DEPRECATED??
         */
        function SetSelectValues(values, elementName) {

            SelectVlueObj = {};
            var joinArray = [];
            var optionsArray = [];
            for (var i = 0; i < values.length; i++) {
                if (SelectVlueObj[values[i]] === undefined) {
                    joinArray.push(values[i]);
                }
            }

            for (var i = 0; i < joinArray.length; i++) {
                var opElem = document.createElement("option");
                opElem.innerHTML = joinArray[i];
                opElem.value = joinArray[i];
                optionsArray.push(opElem)
                SelectVlueObj[joinArray[i]] = opElem;
            }

            var select = cardChildTemplate.querySelector("[data-select='" + elementName + "']");
            for (var i = 0; i < optionsArray.length; i++) {
                select.appendChild(optionsArray[i]);
            }
            var rowKeys = Object.keys(rowElems);


            for (var i = 0; i < rowKeys.length; i++) {
                var row = rowElems[rowKeys[i]];
                var selectNode = row.querySelector("[data-select='" + elementName + "']");

                // If no trap types have been added we need to add them all.
                if (selectNode.children.length === 1) {
                    var opKeys = Object.keys(SelectVlueObj);
                    for (var k = 0; k < opKeys.length; k++) {
                        var key = opKeys[k];
                        selectNode.appendChild(SelectVlueObj[key].cloneNode(true));
                    }
                } else {
                    // if (elementName === "BaitType") {
                    //     selectNode.innerHTML += "<option value=\"default\" disabled selected>Select Product</option>";
                    // }
                    for (var j = 0; j < optionsArray.length; j++) {
                        selectNode.appendChild(optionsArray[j].cloneNode(true));
                    }
                }
            }
        }

        /** Client input event
         * toggles the selected card. Usually on startup this opens up the location card, displaying all the devices
         */
        
        function toggleCardEvent(packet) {
            //deviceControlToggle = packet.value[0];
            console.log("The packet received " + JSON.stringify(packet, null, 4));
            //var id = packet.value[1];
            var id = packet.value;
            if (typeof id !== "string") {
                return;
            }

            if (rowHeaderElems[id] === undefined) {
                return;
            }
            _Id = id;
            TrapSelected(rowHeaderElems[id]);
        }

        /**
         * Client input event - may be unnecessary
         * Toggles the child of the selected card. I have stopped the function from running and it doesn't seem to have affected the app
         */ 
        function ToggleChild(packet) {
            var id = packet.value;
            if (typeof id !== "string") {
                return;
            }

            if (rowState[id] === undefined) {
                return;
            }
            _Id = id;
            var row = rowState[id];

            toggleClearScreen(row["Card"]);
            Script.setState("barcodeId", "0", true);

        }



        /**
         * Used in the animal traps solutions, not used for pestsense
         * Sets all the animals available for the card.
         * DEPRECATED??
         * @param packet
         */
        function setAnimals(packet) {
            var values = packet;
            if (typeof packet === "object" && packet.value !== undefined) {
                values = packet.value;
            }

            if (!Array.isArray(values)) {

                throw new TypeError("set animals event expected an array but found '" + typeof values + "'.");
            }

            var optionsArray = [];
            var joinArray = [];

            for (var i = 0; i < values.length; i++) {
                if (animalsObj[values[i]] === undefined) {
                    joinArray.push(values[i]);
                }
            }

            for (var i = 0; i < joinArray.length; i++) {
                var opElem = document.createElement("option");
                opElem.innerHTML = joinArray[i];
                opElem.value = joinArray[i];
                optionsArray.push(opElem)
                animalsObj[joinArray[i]] = opElem;
            }


        }

        /**
         * Internal Function
         * Shows the dropdown menu screen. Is called when some device actions are pressed such as add bait, set device, remove device, any button that makes a form appear.
         *
         * @param event
         */
        function showFormScreen(event) {

            cardSelected.querySelector("[data-section='formScreen']").style.setProperty("display", "");
            event.parentNode.parentNode.parentNode.style.setProperty("display", "none");

            var container = document.getElementById("container");
            // Offset is the amount of the card that is hidden.
            var offset = (cardSelected.offsetTop + cardSelected.offsetHeight - container.scrollTop) - container.offsetHeight;
            // Set the container scroll top so the bottom of the card is at the bottom of the container.
            container.scrollTop += offset;
            if (1 > container.offsetHeight) {
                container.scrollTop = cardSelected.offsetHeight + cardSelected.offsetTop;
            }
         //   event.stopPropagation();
        }



        /**
         * Internal Function
         * Closes the downdown menu screen. However it doesn't appear to be called from anywhere.
         * @param event
         */
        function cancelFormScreen(event) {
            var id = cardSelected.parentNode.parentNode.getAttribute("data-id");
            setState(id, rowState[id].State);
            cardSelected.querySelector("[data-section='formScreen']").style.setProperty("display", "none");
           // event.stopPropagation();
        }



        /**
         * Deactivates a trap. However it doesn't seem to be called from anywhere.
         * DEPRECATED??
         * @param event
         */
        function deactivateTrap(event) {
            // get trap ID
            var id = cardSelected.parentNode.parentNode.getAttribute("data-id");
            // build sensacollection of card
            setState(id, CardState.DeactivatedGrey);
            fw.fireEvent("deactivate trap", rowState[id]);

        }

        /**
         * Client Input Event
         * Removes all of the html inside the rodent widget, basically sets a clean slate for new html to be pushed
         * 
         */ 
        function clearContent(packet) {
            rowHeaderElems = [];
            var getParent = document.getElementById("tbody");
            getParent.innerHTML = "";
        }

        /**
         * Client Input Event
        * Takes in a packet that sets the rodent grid threshold values that are reponsible to handle card statuses
        * @param packet
        */
        function setTresholds(packet) {

            var current;
            for (var val in packet.value.value.data) {
                current = packet.value.value.data[val];
                var currentVal = current[0].split(",");
                switch (currentVal[0]) {

                    case "baitLower":
                        baitThreshold = parseInt(currentVal[1]);
                        break;
                    case "baitUpper":
                        baitThresholdUpper = parseInt(currentVal[1]);
                        break;
                    case "sensorEntrance":
                        triggerTreshold = parseInt(currentVal[1]);
                        break;
                    case "sensorUpper":
                        triggerTresholdUpper = parseInt(currentVal[1]);
                        break;
                }
            }

        }

        /**
         * Client Input Event
         * Doesn't appear to be used.
         * Looks like it goes through each device and removes an hour from the hours column.
         * DEPRECATED??
         */ 
        function endOfDayCheck(eventData) {
            rowState[rowKeys[i]][headerValue]

            for (var row in rowState) {

                var dbVal = {};
                dbVal[row["Id"]] = {
                    "Id": row["Id"],
                    "Hours": parseInt(row["Hours"]) - 1
                };

                // Update a record's values, Fails if the record does not exist.
                Database.updateRecord("Rodent", "Devices", dbVal, function (data) {

                });
            }

        }

        /**
         * Internal Function
         * Gets the row of the device using it's serial ID.
         */ 
        function GetRowBySid(sid) {
            for (var row in rowState) {
                if (rowState[row]["Sid"] === sid) {
                    return rowState[row];
                }
            }

            return null;
        }

        /**
         * Internal Function
         * Gets the row of the device using it's device name
         */ 
        function GetRowByDeviceName(name) {
            for (var row in rowState) {
                if (rowState[row]["DeviceNumber"].toUpperCase() === name.toUpperCase()) {
                    return rowState[row];
                }
            }

            return null;
        }

        /**
         * Internal Function
         * Adds data to the global variable "areaReport". This is an array that holds all of this logging data. It is then used to
         * set the area reports value of a row.
         */ 
        function incomingLogMessage(packet) {

            var data = packet.value;
            areaReport.push(data);
        }


        //Form Set Functions



        //End Form Set


        //Form Add Bait Functions
        /** 
         * Internal function interacts directly with HTML
         * Activates when the bait dropdown is changed inside the add bait menu. Also populates the card with information about the bait type.
         * 
         */ 
        function BaitDetailChanged(event) {
            var types;
             
            activeDropdowndataSources.forEach(x => {
                if (x.Name === "BaitType") {
                    types = x;
                }
            });
             
             types.Values.some(x => {
                var word = "";
                var compare = "";
                x.Name.split(" ").forEach(y=>{
                    word += y;
                });

                event.value.split(" ").forEach(z=>{
                    compare += z;
                })
                if (word === compare) {
                    ActiveCardProduct = x;
                    return x;
                }
            });
            QtySet = 1;
             
            var temp = ActiveCardProduct.WeightPerBlock;
            var expiryDate = new Date();
            expiryDate = expiryDate.addDays(parseInt(ActiveCardProduct.Expiry));
            event.parentNode.parentNode.querySelector("[data-info='qtyInput']").value = 1;
            var expiryDate = formatDate(expiryDate, "yyyy-MM-dd");
            event.parentNode.parentNode.querySelector("[data-info='expiryDate']").min = expiryDate;
            event.parentNode.parentNode.querySelector("[data-info='expiryDate']").value = expiryDate;
          
            event.parentNode.parentNode.querySelector("[data-value='QtyLabel']").innerHTML = Math.round(parseInt(temp), 2) + " / " + (parseInt(temp) * 0.035274).toString().substr(1,3);
            BaitDetailId = event.value;
        }

        /**
         * Internal Function
         * Function that is run from OpenDeviceBait that is run from a client input event. Populates the bait dropdown with the bait types
         * available to the user.
         */ 
        function baitChanged(event) {
           // BaitTypeId = event.value;
            var id = cardSelected.parentNode.getAttribute("data-id");
            var card = rowElems[id];
            var sending = [];
            var selected;
            cardSelected.querySelector("[data-form='formBait']").querySelector("[data-select='BaitType']").innerHTML= "";
            var types;
             
            activeDropdowndataSources.forEach(x => {
                if (x.Name === "BaitType") {
                    types = x;
                }
            });
            var elements = "";
            var isFirst = true;
            types.Values.forEach(x => {
                if(isFirst)
                {
                    DefaultActiveCardProduct = x;
                    ActiveCardProduct = x;
                    isFirst = false;
                }
                var currentName = "";
                x.Name.split(" ").forEach(y=>{
                    currentName += y;
                });
                elements += "<option value="+currentName+">"+x.Name+"</option>";
            });
            var baitDropdown = cardSelected.querySelector("[data-form='formBait']").querySelector("[data-select='BaitType']");
            baitDropdown.innerHTML=elements;

       
          //  SetSelectValues(sending, "BaitType");
        }


  

        function ActivateManual(event) {
            var id = cardSelected.parentNode.getAttribute("data-id");
            var val = rowState[id].Id;

            rowState[id].checkTime = new Date();
            var d = rowState[id].checkTime.toLocaleString().split(", ");
            var d0 = d[0].split("/");
            d0[2] = d0[2] - 2000;
            d0 = d0.join("/");

            //rowElems[id].querySelector("[data-value='SignalStatus']").innerHTML = "Rodent Activity";
            //      rowElems[id].querySelector("[data-value='Status']").innerHTML = "Manual Device triggered";
            setState(id, CardState.UrgentRed);

            rowElems[id].querySelector("[data-value='SetTimeFormatted']").innerHTML = d[1] + "<br />" + d0;
            //  rowElems[id].querySelector("[data-value='updateTimeFormatted']").innerHTML = d[1] + "<br />" + d0;
            rowElems[id].querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineRed");
            rowElems[id].querySelector("[data-info='UnderlineBattery']").setAttribute("class", "UnderlineRed");
            rowElems[id].querySelector("[data-info='UnderlineBait']").setAttribute("class", "UnderlineRed");
            rowElems[id].querySelector("[data-info='UnderlineSignal']").setAttribute("class", "UnderlineRed");



            areaReport.push({
                "CardName": id,
                "Message": "Card " + id + " Manual Trap triggered, rodent activity.",
                "DateTime": new Date(),
            });

            var dbVal = {};
            dbVal[val] = {
                "Id": val,
                "SignalStatus": "Rodent Activity.",
                "Status": CardStatus.Enabled,
                "BaitRate": baitThreshold - 1,
                "Hours": triggerTresholdUpper + 1,
                "State": CardState.UrgentRed,
                "SetTime": new Date(),
                "SignalStrenght": 0
            };
            // Update a record's values, Fails if the record does not exist.
            Database.updateRecord("Rodent", "Devices", dbVal, function (data) {

            });
            setState(id, CardState.UrgentRed);
            sortEvent({
                value: [
                    "State",
                    "false"
                ]
            });
            cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
            cardSelected.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }



        /**
        * Broadcasts an event when a card increment quantity is pressed
        * @param eventData
        * Increases the active counter by 1
        */
        function IncrementCounter(eventData) {
            eventData.parentNode.parentNode.querySelector("[data-info='qtyInput']").value = parseInt(eventData.parentNode.parentNode.querySelector("[data-info='qtyInput']").value) + 1;
            CalculateQtyLabel(eventData.parentNode.parentNode, eventData.parentNode.parentNode.querySelector("[data-info='qtyInput']").value);
        }

        /**
        * Broadcasts an event when a card decrement quantity is pressed
        * @param eventData
        * Decreases the active counter by 1
        */
        function DecrementCounter(eventData) {

            var val = parseInt(eventData.parentNode.parentNode.querySelector("[data-info='qtyInput']").value);
            if (val > 0) {
                eventData.parentNode.parentNode.querySelector("[data-info='qtyInput']").value = val - 1;
                CalculateQtyLabel(eventData.parentNode.parentNode, eventData.parentNode.parentNode.querySelector("[data-info='qtyInput']").value);
            }

        }

        /**
         * Broadcasts an event when a card quantity box is changed.
         *
         * @param eventData
         * holds the event for the last entered value in the input responsible for calculating the current card quantity based on blocks.
         */
        function QtyBoxChanged(eventData) {
            if(eventData.value !== "")
            {
                CalculateQtyLabel(eventData.parentNode.parentNode, eventData.value);
            }

        }

        function CalculateQtyLabel(parent, qty) {
            QtySet = qty;
            var temp = ActiveCardProduct.WeightPerBlock;
            parent.parentNode.parentNode.querySelector("[data-value='QtyLabel']").innerHTML = Math.round((parseInt(qty) * temp), 2) + " / " + ((parseInt(qty) * temp) * 0.035274).toString().substr(0,3);

        }

        /**
         * Broadcasts an event when a card expiry date is changed
         *
         * @param eventData
         * holds the event for the last entered value in the input responsible for calculating the current card expiry date;
         */
        function ExpiryChanged(event) {

            LastSetDateChanged = event.valueAsNumber;
        }


        function SetDeviceErrors(event) {

            if (cardSelected === undefined || cardSelected === null) {
                return;
            }
            Errors = {};
            var errorParent = cardSelected.querySelector("[data-info='ErrorSection']");
            errorParent.innerHTML = "";
            var errorEnable = event.value.pop();
            //var dev = document.getElementById("devAction"); //.style.setProperty("display", "none");
            //dev.innerHTML = "";
            //this.parentElement.querySelector("[data-info='devAction']").style.setProperty("display", "none");
            //console.log(" The value received is " + errorEnable + " type is  " + typeof errorEnable);
            event.value.forEach(x => {

                var template = cardSelected.querySelector("[data-component='ErrorTempalte']").cloneNode(true);
                template.style.setProperty("display", "");
                var date = new Date(parseInt(x.CreatedAt));
                var formated = formatDate(date, "dd/MM/yy H:mm");
                template.querySelector("[data-value='errorDate']").innerHTML = formated + ":";
                template.querySelector("[data-value='ErrorDescription']").innerHTML = x.Description;

                if (errorEnable === 0) {
                    template.querySelector("[data-value='errorIcon']").setAttribute("hidden", "hidden");
                }
                template.setAttribute("data-value", x.IssueId);
                errorParent.appendChild(template);
                Errors[x.IssueId] = {
                    Id: x.IssueId,
                    TroubleshootingHelp: x.TroubleshootingHelp,
                    TransactionId: x.Id
                };
            });
        }

        function setTopPosition(packet) {
            fw.func("ADJUSTSIZE", "TOPOFFSET", packet.value);
        }

        // when a device error is clicked on, it should go to the help screen and display the correct help file
        function OpenError(event)
        {
             // get the ID of the issue from the node
            var issueId = event.currentTarget.parentNode.getAttribute("data-value");
            var page;
            // get the page that relates to the issue (using the error code table)
            for(var error in Errors)
            {
                if(Errors[error].Id === issueId)
                {
                    page = Errors[error].TroubleshootingHelp;
                    break;
                }
            }

            if(page !== undefined && page !== "")
            {
                // set the filepath in the statestore and then jump screen to the help screen
                Script.setState("helpFilePath", page);
                fw.func("JUMPSCREEN", "Help Screen");
                // originally opened the help sidebar
                // Client.toggleHelpSidebarWidget(page);
            }   
        }

        function countProperties(obj) {
            return Object.keys(obj).length;
        }

        function RemoveError(event)
        {
            
            var issueId = event.currentTarget.parentNode.getAttribute("data-value");
            var tpm  = {};
            var itemId ;
            for(var error in Errors)
            {
                if(Errors[error].Id !== issueId)
                {
                    tpm[error] = {
                        Id : Errors[error].Id,
                        TroubleshootingHelp: Errors[error].TroubleshootingHelp,
                        TransactionId: Errors[error].TransactionId
                    }; 
                }
                else
                {
                    itemId = Errors[error].TransactionId;
                }
            }
           
            Errors = tpm; 

            var paramDelete = [{
				Sql: "Update ErrorTransactions set IsActive = 0 where Id = $Id",
				Data: [{
					Column: "$Id",
					value: itemId
				}]
			}];
			Database.cudParam("Rodent","ErrorTransactions",paramDelete, function (data){
 			});
            event.currentTarget.parentNode.remove();
             
            if(countProperties(Errors) === 0)
            {
                var id = cardSelected.parentNode.getAttribute("data-id");

                // var paramUpdateDevices = [{
                //     Sql: "Update Devices set CommunicationError = 0 where Id = $Id",
                //     Data: [{
                //         Column: "$Id",
                //         value: id
                //     }]
                // }];
                var paramUpdateDevices = [{
                    Sql: "Update Devices set ErrorCodeFlag = 0 where Id = $Id",
                    Data: [{
                        Column: "$Id",
                        value: id
                    }]
                }];
                Database.cudParam("Rodent","Devices",paramUpdateDevices, function (data){
                });
                cardSelected.querySelector("[data-info='deviceErrorStatus']").style.setProperty("display", "none");
                
            }
        }

        /**
         * Broadcasts an event when a card expiry date is changed
         *
         * @param eventData
         * holds the event for the last entered value in the input responsible for calculating the current card expiry date;
         */
        function UpdateDeviceDetails(event) {
            
            var row = rowState[event.value.ID];
            if (row === null || row === undefined) {
                return;
            }

            
            var user = fw.func("GETUSER");
            if(user !== "admin")
            {
                row.Card.querySelector("[data-info='r1']").style.setProperty("display","none");
                row.Card.querySelector("[data-info='r2']").style.setProperty("display","none");
                row.Card.querySelector("[data-info='r3']").style.setProperty("display","none");
            }
            row.Card.querySelector("[data-value='packetType']").innerHTML = event.value.PacketType === "" ? "--" : event.value.PacketType;
            row.Card.querySelector("[data-value='deviceRange']").innerHTML = event.value.DeviceRange === "" ? "--" : event.value.DeviceRange;
            row.Card.querySelector("[data-value='rebaitRange']").innerHTML = event.value.RebaitRange === "" ? "--" : event.value.RebaitRange;
            row.Card.querySelector("[data-value='l1']").innerHTML = event.value.L1 === "" ? "--" : event.value.L1;
            row.Card.querySelector("[data-value='l2']").innerHTML = event.value.L2 === "" ? "--" : event.value.L2;
            row.Card.querySelector("[data-value='p6Test']").innerHTML = event.value.PState === "" ? "--" : event.value.PState;
            row.Card.querySelector("[data-value='p1']").innerHTML = event.value.P1Weight === "" ? "--" : event.value.P1Weight;
            row.Card.querySelector("[data-value='p2']").innerHTML = event.value.P2Weight === "" ? "--" : event.value.P2Weight;

        } 

        /**
        * Incoming event when the bait button has been disabled/enabled.
        *
        * @param event
        */
        function DeviceDisableBait(event) {
             
            var id = cardSelected.parentNode.getAttribute("data-id");

            var itemData = event.value.value.data[id];

            if (itemData[1] === "0") {
                rowState[id].BaitDisabled = 1;
            //    cardSelected.querySelector()
            }
            else {
                rowState[id].BaitDisabled = 0;
            }
        }

        /**
         * Broadcasts an event when a trap is set or cleared.
         *
         * @param event
         */
        function submitTrap(event) {
               
            var id = cardSelected.parentNode.getAttribute("data-id");
            var val = rowState[id].Id;

            rowState[id].checkTime = new Date();
            var d = rowState[id].checkTime.toLocaleString().split(", ");
            var d0 = d[0].split("/");
            d0[2] = d0[2] - 2000;
            d0 = d0.join("/");

            var remember = cardSelected.querySelector("[data-info='RepeatCheckbox']");
           
            rowElems[id].querySelector("[data-value='FoodName']").innerHTML = rowElems[id].querySelector("[data-select='BaitType']").value;
            numVal = rowElems[id].querySelector("[data-section='BatteryVal']");
             
            //rowElems[id].querySelector("[data-value='Dial']").innerHTML = rowElems[id].querySelector("[data-select='Quantity']").value
            rowState[id].BaitType = BaitTypeId;
            rowState[id].Baits = BaitDetailId;
            rowState[id].quantity = rowElems[id].querySelector("[data-select='Quantity']").value;

            //rowElems[id].querySelector("[data-value='SignalStatus']").innerHTML = "Bait Updated Working";
            // rowElems[id].querySelector("[data-value='Status']").innerHTML = "Bait Updated Working";
            rowState[id]["SetTime"] = new Date().getTime();
            rowElems[id].querySelector("[data-value='SetTimeFormatted']").innerHTML = formatDate(new Date(), "dd/MM/yy H:mm");
            //                rowElems[id].querySelector("[data-value='updateTimeFormatted']").innerHTML = d[1] + "<br />" + d0;

            fw.fireEvent("check trap", rowState[id]);
            areaReport.push({
                "CardName": id,
                "Message": "Card " + id + " has been updated",
                "DateTime": new Date(),

            });
            var dbVal = {};

            var bait;
            bait = ActiveCardProduct;
            rowState[id]["BaitName"] = ActiveCardProduct.Name;

            var baitName = bait.Id;
            var expiryDate;
            var expirtDays;
            if (LastSetDateChanged !== undefined) {
                expiryDate = new Date(LastSetDateChanged);
                expirtDays = expiryDate;
                rowState[id].Duration = LastSetDateChanged - new Date().getTime();

                const diffDays = Math.ceil(rowState[id].Duration / (1000 * 60 * 60 * 24));
                var remaining = diffDays.toString() + "d";
                rowElems[id].querySelector("[data-value='Duration']").innerHTML = remaining;
            }
            else {
                expiryDate = new Date();
                expiryDate = expiryDate.addDays(parseInt(bait.Expiry));
                expirtDays = expiryDate;
                rowState[id].Duration = parseInt(bait.Expiry);
                rowElems[id].querySelector("[data-value='Duration']").innerHTML = bait.Expiry;
            }
            var qty = cardSelected.querySelector("[data-info='qtyInput']").value;
            if(qty === "0" || qty === undefined || qty === null)
            {
                Client.alert("Quantity cannot be 0!");
                return;
            }
            RepeatBait = {
                    Product: rowElems[id].querySelector("[data-select='BaitType']").value,
                    Blocks: QtySet,
                    Expiry: expirtDays,
                    WeightPerBlock:ActiveCardProduct.WeightPerBlock
                }
            Script.setState("RepeatBait",RepeatBait, true );
            // if (remember.checked)
            // {
            //     RepeatBait = {
            //         Product: rowElems[id].querySelector("[data-select='BaitType']").value,
            //         Blocks: QtySet,
            //         Expiry: expirtDays
            //     }
            // } else {
            //     RepeatBait = undefined;
            // }

            rowElems[id].querySelector("[data-value='FoodName']").innerHTML = rowElems[id].querySelector("[data-select='BaitType']").value;
//            rowElems[id].querySelector("[data-value='BaitName']").innerHTML = rowElems[id].querySelector("[data-select='Baits']").value;
            var enteredWeight1;
            rowState[id].BaitRate = (parseInt(ActiveCardProduct.WeightPerBlock) * QtySet);
            enteredWeight1 = (parseInt(ActiveCardProduct.WeightPerBlock) * QtySet);

                //Revert Later
            rowState[id].DeviceRange = parseInt(rowState[id].DeviceRange);
            rowState[id].RebaitRange = ((rowState[id].DeviceRange  / (enteredWeight1 + BarCompensation)));
            rowState[id].EnteredWeight = enteredWeight1 + BarCompensation;
            rowElems[id].querySelector("[data-value='enteredWeight']").innerHTML = enteredWeight1;
            var rebaitRangePercent = 0.5;
             
            var rebaitRangeDelimiter =  rowState[id].RebaitRange * rebaitRangePercent;
            var ghostWeight = (rowState[id].DeviceRange ) / (enteredWeight1 + BarCompensation);
            dbVal[val] = {
                "Id": val,
                "BaitRate": enteredWeight1, //Todo implement an api call to take the new bate rate
                "CompanyProductId": baitName,
                "EmptyBy": new Date(),
                "FoodDate": expiryDate,
                "SetTime": new Date().getTime(),
                "Expiry": bait.Expiry,
                "IsYellow": 0,
                "IsRed": 0,
                "WeightS":0,
                "MotionS": 0,
                "CheckS":0,
                "DeviceRange": rowState[id].DeviceRange ,
                "Address":"4",
                "Hours":0,
                //    "EnteredRange": enteredRange,
                "GhostWeight": ghostWeight,
                "WeightLeft": enteredWeight1,
                "EnteredWeight": enteredWeight1 + BarCompensation,
                "RebaitRange": rowState[id].RebaitRange,
                "FullRange": rowState[id].FullRange,
                "CalculatedWeight": 100,
                "RebaitRangeDelimiter":rebaitRangeDelimiter
            };


            rowElems[id].CalculatedWeight = 100;
            rowState[id]["FoodDateVal"] = expiryDate;
            if (rowState[id].DeviceType === "1") {
                SetCardLineColor(rowElems[id], dbVal[val].BaitRate, baitThreshold, baitThresholdUpper, "UnderlineBait");
                rowElems[id].querySelector("[data-value='Dial']").innerHTML = "100%";
            }
            else {
                rowElems[id].querySelector("[data-value='Dial']").innerHTML = "100%";

            }

            // Update a record's values, Fails if the record does not exist.
            Database.updateRecord("Rodent", "Devices", dbVal, function (data) {

            });

            fw.fireEvent("EventTransaction", { ID: id, EventType: 1, CreatedOn: new Date().getTime(), CreatedBy:fw.func("GETUSER"), Owner:fw.func("GETUSER"), CompanyProductId: baitName, Value: enteredWeight1 });

            ClientEvents.publish("WEIGHT", 100);
            Script.publishToChannel({
                category: "PESTCO",
                className: "RODENTS",
                instance: rowState[id].DeviceNumber,
                scope: "WEIGHT",
                label: "string",
                value: enteredWeight1.toString()
            });
            Script.publishToChannel({
                category: "PESTCO",
                className: "RODENTS",
                instance: rowState[id].DeviceNumber,
                scope: "WEIGHTNOBAR",
                label: "string",
                value: enteredWeight1.toString()
            });

            cardSelected.querySelector("[data-info='UnderlineBait']").setAttribute("class","UnderlineGreen");
            cardSelected.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class","UnderlineGreen");
            cardSelected.querySelector("[data-info='UnderlineDuration']").setAttribute("class","UnderlineGreen");
            cardSelected.querySelector("[data-info='UnderlineHours']").setAttribute("class","UnderlineGreen");

            
            setDeviceStatus(id);
            ChangeHeaderValue();
            sortEvent({
                value: [
                    "State",
                    "false"
                ]
            });

            ActiveCardProduct = DefaultActiveCardProduct;
            CancelBait(event);
        }

        function controlDeviceAction(event){

            deviceControlToggle = event.value;

           // if(deviceControlToggle == 0) {
                //document.getElementById("devAction").remove();
                 //document.getElementById("devAction").style.setProperty("display", "none"); //btnActions querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
                //document.getElementById("devInfo").style.setProperty("width", "100%"); //.style.setProperty("display", "none");
            //devInfo.
           // }
            


        }

        // End form Add Bait 

        //Form Reset Functions

        function NoActivitySubmit(event) {

            var id = cardSelected.parentNode.getAttribute("data-id");
            var val = rowState[id].Id;

            rowElems[id].querySelector("[data-value='Hours']").innerHTML = 0;

            var dbVal = {};
            dbVal[val] = {
                "Id": val,
                "Hours": "0",
                // "BaitRate": baitThresholdUpper + 1,
                "Status": CardStatus.Enabled
               // "UpdateTime": new Date()

            };
            rowState[id]["Hours"] = 0;
            // Update a record's values, Fails if the record does not exist.
            Database.updateRecord("Rodent", "Devices", dbVal, function (data) {

            });
            var card = rowState[id]["Card"];
            rowElems[id].querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGreen");
            rowElems[id].querySelector("[data-info='UnderlineBattery']").setAttribute("class", "UnderlineGreen");
            rowElems[id].querySelector("[data-info='UnderlineBait']").setAttribute("class", "UnderlineGreen");
            rowElems[id].querySelector("[data-info='UnderlineSignal']").setAttribute("class", "UnderlineGreen");
            sortEvent({
                value: [
                    "State",
                    "false"
                ]
            });
            cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
            cardSelected.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }


        function ResetIRSubmit(event) {

            var id = cardSelected.parentNode.getAttribute("data-id");
            var state = rowState[id].State;
            var val = rowState[id].Id;

            rowElems[id].querySelector("[data-value='Hours']").innerHTML = 0;
            cardSelected.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGreen");


            rowState[id]["Hours"] = 0;
            //    rowElems[id].querySelector("[data-value='Status']").innerHTML = "IR Reset";
            var remember1 = cardSelected.querySelector("[data-info='MotionCheckbox']");
            var remember2 = cardSelected.querySelector("[data-info='AlertCheckbox']");


            var dbVal = {};
            dbVal[val] = {
                "Id": val,
            };

            if (remember1.checked) {
                dbVal[val]["Hours"] = "0";
                dbVal[val]["EntranceSensor"] = "0";
                dbVal[val]["ExitSensor"] = "0";       
            }

            if (remember2.checked) {
                dbVal[val]["IsYellow"] = 0;
                dbVal[val]["IsRed"] = 0;
                dbVal[val]["WeightS"] = 0;
                dbVal[val]["MotionS"] = 0;
                dbVal[val]["CheckS"] = 0;

            }

            if (remember1.checked || remember2.checked) {
                // Update a record's values, Fails if the record does not exist.
                Database.updateRecord("Rodent", "Devices", dbVal, function (data) {

                });
                setDeviceStatus(id);
                sortEvent({
                    value: [
                        "State",
                        "false"
                    ]
                });
            }
          

            cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
            cardSelected.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }


        //End form reset functions

        /**
        * Disables a device setting the status to innactive
        *
        * @param event
        */
        function DisableTrap(event) {
            var id = cardSelected.parentNode.parentNode.getAttribute("data-id");
            var val = rowState[id].Id;

            // rowState[id].SetTime = new Date();
            // var d = rowState[id].SetTime.toLocaleString().split(", ");
            var d0 = d[0].split("/");
            d0[2] = d0[2] - 2000;
            d0 = d0.join("/");

            rowElems[id].querySelector("[data-value='SetTimeFormatted']").innerHTML = d[1] + "<br />" + d0;
            setState(id, CardState.DeactivatedGrey);

            areaReport.push({
                "CardName": id,
                "Message": "Card " + id + " event: IR Resetted!",
                "DateTime": new Date(),
            });
            var dbVal = {};
            dbVal[val] = {
                "Id": val,
                "State": CardState.DeactivatedGrey,
                "BaitRate": 100,
                "Status": CardStatus.Disabled,
                "Alert": "",
                "EmptyBy": new Date(),
                "SignalStatus": "",
                "SetTime": new Date().getTime(),
                "SignalStrenght": 0
            };
            // Update a record's values, Fails if the record does not exist.
            Database.updateRecord("Rodent", "Devices", dbVal, function (data) {

            });

            fw.fireEvent("set trap", rowState[id]);


            areaReport.push({
                "CardName": id,
                "Message": "Card " + id + " been cleared",
                "DateTime": new Date(),
            });

            setDeviceStatus(id);
            sortEvent({
                value: [
                    "State",
                    "false"
                ]
            });

            fw.fireEvent("clear trap", rowState[id]);
            cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
            cardSelected.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }

        /**
        * Broadcasts an event when a trap is set or cleared.
        *
        * @param eventData
        */
        function SetGraphState(eventData) {
            if (eventData === "true") {
                GraphEnabled = true;
            }
            else {
                GraphEnabled = false;
            }
        }


        
        /**
        * Broadcasts an event when a trap is set or cleared.
        * @param eventData
        * Increases the active counter by 1
        */
        function IncrementCounterSet(eventData) {

            eventData.parentNode.parentNode.querySelector("[data-info='stationInput']").value = parseInt(eventData.parentNode.parentNode.querySelector("[data-info='stationInput']").value) + 1;
           // CalculateQtyLabel(eventData.parentNode.parentNode, eventData.parentNode.parentNode.querySelector("[data-info='qtyInput']").value);
        }

        /**
        * Broadcasts an event when a trap is set or cleared.
        * @param eventData
        * Decreases the active counter by 1
        */
        function DecrementCounterSet(eventData) {
            var val = parseInt(eventData.parentNode.parentNode.querySelector("[data-info='stationInput']").value);
            if (val >  minDown) {
                eventData.parentNode.parentNode.querySelector("[data-info='stationInput']").value = val - 1;
            //    CalculateQtyLabel(eventData.parentNode.parentNode, eventData.parentNode.parentNode.querySelector("[data-info='qtyInput']").value);
            }
        }

        /**
        * Broadcasts an event when a card quantity has changed
        *
        * @param eventData
        * holds the event for the last entered value in the input responsible for calculating the current card quantity based on blocks.
        */
        function StationBoxChanged(eventData) {

            //CalculateQtyLabel(eventData.parentNode.parentNode, eventData.value);

        }


        function NoActivity(current) {
             
            var screenForm =  cardSelected.querySelector("[data-section='formScreen']");
            screenForm.querySelector("[data-form='formBait']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='formSet']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='ResetIR']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='noActivity']").style.setProperty("display", "");
            screenForm.querySelector("[data-form='RemoveDevice']").style.setProperty("display", "none");

            showFormScreen(current.currentTarget);
        }

        function ResetIR(current) {

            var screenForm = current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector("[data-section='formScreen']");
            screenForm.querySelector("[data-form='formBait']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='noActivity']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='formSet']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='ResetIR']").style.setProperty("display", "");
            screenForm.querySelector("[data-form='RemoveDevice']").style.setProperty("display", "none");

            showFormScreen(current.currentTarget);

        }

        function ResetIRCancel(current) {

            current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.style.setProperty("display", "none");
            event.currentTarget.parentNode.parentNode.parentNode.parentNode.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }

        function setSiteId(eventData) {
            siteId = eventData.value;
        }


        function SetCard(eventData) {
            var id = cardSelected.parentNode.getAttribute("data-id");

            // Check that stationId is not duplicate
            let stationId = cardSelected.querySelector("[data-info='stationInput']").value;
            // for (var item in rowState) {
            //     var x = rowState[item];
            //     if (x.StationId !== undefined && x.StationId !== "") {
            //         if (parseInt(stationId) === parseInt(x.StationId) && id != rowState[item].Id) {
            //             // StationId already exists for another node
            //             Client.alert("This Station ID already exists!");
            //             return;
            //         }
            //     }
            // }

            const stationIds = [];
            for (var item in adjacentStationIds) {
                if (adjacentStationIds[item][0] !== "" && adjacentStationIds[item][0] !== undefined) {
                    stationIds.push(parseInt(adjacentStationIds[item][0]));
                    if (parseInt(stationId) == parseInt(adjacentStationIds[item][0]) && id !== item) {
                        Client.alert("This Station ID already exists!");
                        return;
                    }
                }
            }
             
            var dbVal = {};
 
            var deviceType;
            switch (cardSelected.querySelector("[data-select='DeviceTypes']").value) {

                case "Bait Weight (Default)":
                    deviceType = 1;
                    break;
                case "Snap Trap":
                    deviceType = 2;
                    break;
                default:
                    deviceType = 1;
                    break;
            }
            var user = fw.func("GETUSER");
            var formated = formatDate(new Date(), "dd/MM/yy H:mm");
            cardSelected.querySelector("[data-value='setDateTime']").innerHTML = formated;
            
            dbVal[id] = {
                "Id": id,
                "DeviceType": deviceType,
                "DeviceName": cardSelected.querySelector("[data-info='setNane']").value,
                "Location": cardSelected.querySelector("[data-info='setLocation']").value,
                "StationId": cardSelected.querySelector("[data-info='stationInput']").value,
                "TriggerTime" : new Date().getTime(),
                "Owner": user,
                "Status": CardStatus.Enabled
            };
            stationIds.push(parseInt(cardSelected.querySelector("[data-info='stationInput']").value))
            // Update a record's values, Fails if the record does not exist.
            Database.updateRecord("Rodent", "Devices", dbVal, function (data) {

            });

            let siteDbVal = {};
            let locationId = cardSelected.parentNode.parentNode.getAttribute("data-id");
            
            // Database.readRecords("Rodent", "Locations", function (eventData) {
                // let siteId = eventData.value.getColumn("RelativeId")[0];
            let nextAvailStationId = 0;
            stationIds.sort((a, b) => a - b);
            stationIds.every((id, index) => {
                if(index === (stationIds.length - 1)){
                    nextAvailStationId = id + 1;
                    return false;
                } else {
                    if((stationIds[index + 1] - id) > 1){
                        nextAvailStationId = id + 1;
                        return false;
                    }
                    return true;
                }
            });
            siteDbVal[siteId] = {
                "Id": siteId,
                "StationId": nextAvailStationId
            }
            
            Database.updateRecord("Rodent", "Sites", siteDbVal, function (data) {

            });
            // }, {filter: `Id='${locationId}'`});

            fw.fireEvent("EventTransaction", { ID: id, EventType: 3, CreatedOn: new Date().getTime(), CreatedBy:fw.func("GETUSER"), Owner:fw.func("GETUSER"), CompanyProductId: "", Value: "" });
            fw.fireEvent("SaveTimeWindow", { id, locationId });
            
            rowState[id].Location = cardSelected.querySelector("[data-info='setLocation']").value;
            rowState[id].StationId = cardSelected.querySelector("[data-info='stationInput']").value;
            rowState[id].DeviceName = cardSelected.querySelector("[data-info='setNane']").value;

            cardSelected.querySelector("[data-value='StationId']").innerHTML = cardSelected.querySelector("[data-info='stationInput']").value;
            cardSelected.querySelector("[data-value='DeviceName']").innerHTML = cardSelected.querySelector("[data-info='setNane']").value;
            cardSelected.querySelector("[data-value='Address']").innerHTML = cardSelected.querySelector("[data-info='setLocation']").value;
            cardSelected.querySelector("[data-value='StationId']").innerHTML = cardSelected.querySelector("[data-info='stationInput']").value;
             
            CancelBait(eventData);


        }

        function RemoveDevice() {
              
            var id = cardSelected.parentNode.getAttribute("data-id");
            var dbVal = {};
            dbVal[id] = {
                "Id": id,
                "LocationId": "0",
                "SiteId": "0",
                "CustomerId":"0",
                "Location":null,
                "UpdateTime": null,
                "Hours":null,
                "State"	: CardState.DeactivatedGrey,
                "StationId": null,
                "Technician":null,
                "BaitRate":null,
                "Alert"	:null,
                "EntranceSensor"	:null,
                "ExitSensor"	:null,   
                "EmptyBy"	:null,
                "SetTime"	:null,
                "SignalStatus":null,
                "TriggerTime":null,
                "Floor":null,
                "Address"	:null,
                "Expiry":null,
                "FoodDate":null,
                "CommunicationError":null,
                "MaximumClibrationTemperature":null,
                "MinimumClibrationTemperature":null,
                "InitialCalibration":null,
                "ClibrationRange":null,
                "MinimumCalibration":null,
                "UpdatedOn":new Date().getTime(),
                "UpdatedBy":fw.func("GETUSER"),
                "EnteredWeight":null,
                "WeightConsumed":null,
                "WeightLeft":null,
                "EnteredRange"	:null,
                "GhostWeight"	:null,
                "DeviceRange"	:null,
                "TareWeight":null,
                "CalculatedWeight":null,
                "FullRange"	:null,
                "RebaitRange":null,
                "P1Weight":null,
                "P2Weight"	:null,
                "PacketType":null,
                "PState":null,
                "P6Result":null,
                "L1":null,
                "L2":null,
                "BaitEnalbed": "0",
                "CompanyProductId":null,
                "Status": CardStatus.Disabled
            };
            // Update a record's values, Fails if the record does not exist.
            Database.updateRecord("Rodent", "Devices", dbVal, function (data) {

            });

            cardSelected.remove();
            fw.fireEvent("EventTransaction", { ID: id, EventType: 2, CreatedOn: new Date().getTime(), CreatedBy:fw.func("GETUSER"), Owner:fw.func("GETUSER"), CompanyProductId: "", Value:"" });
            fw.fireEvent("UpdateTimeWindow", { id });
            cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
            cardSelected.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }
        function DeleteDevice(event)
        {
             
            var id = cardSelected.parentNode.getAttribute("data-id");
            cardSelected.remove();
            var paramDelete = [{
				Sql: "DELETE FROM ErrorTransactions where DeviceId = $Id",
				Data: [{
					Column: "$Id",
					value: id
				}]
			}];
			Database.cudParam("Rodent","ErrorTransactions",paramDelete, function (data){
 			});

             var events = [{
				Sql: "DELETE FROM EventLogs where DeviceId = $Id",
				Data: [{
					Column: "$Id",
					value: id
				}]
			}];
			Database.cudParam("Rodent","EventLogs",events, function (data){
 			});


            var deleteDevice = [{
				Sql: "DELETE FROM Devices where Id = $Id",
				Data: [{
					Column: "$Id",
					value: id
				}]
			}];
			Database.cudParam("Rodent","Devices",deleteDevice, function (data){
 			});

            cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
            cardSelected.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }
        function StartRemove(current) {
             
            var screenForm = current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector("[data-section='formScreen']");

            screenForm.querySelector("[data-form='formBait']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='noActivity']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='formSet']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='ResetIR']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='RemoveDevice']").style.setProperty("display", "");
            showFormScreen(current.currentTarget);


        }

        function SetCurrentStationId(eventData) {
            currentStationId = parseInt(eventData.value);
            // May not be defined in DB
            if (currentStationId == null || currentStationId == undefined || isNaN(currentStationId)) {
                currentStationId = 0;
            }
        }

        function SetAdjacentStationIds(eventData) {
            adjacentStationIds = eventData.value;
        }

        function SetDeviceCard(current) {
            var id = cardSelected.parentNode.getAttribute("data-id");
             
            var screenForm = current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector("[data-section='formScreen']");
            screenForm.querySelector("[data-form='formBait']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='noActivity']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='formSet']").style.setProperty("display", "");
            screenForm.querySelector("[data-form='ResetIR']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='RemoveDevice']").style.setProperty("display", "none");

            var deviceTypes;
            activeDropdowndataSources.forEach(x => {
                if (x.Name === "DeviceTypes") {
                    deviceTypes = PackageData(x);
                }
            });
            SetSelectValues(deviceTypes, "DeviceTypes");
            var i = 1;
            var selectedDeviceType;
             
            deviceTypes.forEach(x => {
                if (i == parseInt(rowState[id].DeviceType)) {
                    selectedDeviceType = x;
                }
                i++;
            });

            if (rowState[id].StationId === "" || rowState[id].StationId === undefined) {
                for (var item in rowState) {
                    var x = rowState[item];
                    if (x.StationId !== undefined && x.StationId !== "") {
                        if (currentStationId < parseInt(x.StationId)) {
                            currentStationId = parseInt(x.StationId);
                        }
                    }
                }
               
                minDown = currentStationId+1;
                cardSelected.querySelector("[data-info='stationInput']").value = currentStationId;
            }
            else {
                cardSelected.querySelector("[data-info='stationInput']").value = rowState[id].StationId;
                minDown = rowState[id].StationId;
            }

            cardSelected.querySelector("[data-select='DeviceTypes']").value = selectedDeviceType;
            cardSelected.querySelector("[data-info='setNane']").value = rowState[id].DeviceName;
            if(rowState[id].Location !== undefined)
            {
                cardSelected.querySelector("[data-info='setLocation']").value = rowState[id].Location;
            }
           
            
            showFormScreen(current.currentTarget);
        }

        function AddBait(current) {
             
            event.currentTarget.parentNode.parentNode.style.setProperty("display", "");
            var id = cardSelected.parentNode.getAttribute("data-id");
            var form = cardSelected.querySelector("[data-section='formScreen']");
            cardSelected.querySelector("[data-info='RepeatCheckbox']").checked = false;

            fw.fireEvent("ChangeBait", { ID: id, form: form  });

            
            var item = rowState[id];

            var screenForm = current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector("[data-section='formScreen']");
            showFormScreen(current.currentTarget );

        }

        /**
         * Function that handles the bait enabled flag coming through flows into the rodent widget.
         * Based on the data that comes through, controls if the operator is able to add bait.
         */ 
        function BaitEnalbed(device, data){
            
            var getRow = GetRowByDeviceName(device);
            if(getRow === null)
            {
                return;
            }

            setDefaultBaitText();

            // if the flag is not one of the possible flags, return (reject message)
            if(parseInt(data) !== 1 && parseInt(data) !== 0 && parseInt(data) !== -1)
                return;
 
            // if the bait flag is disabled, hide the bait icon and text
            if(parseInt(data) === 0) 
            {
                hideBaitTextAndIcon();
            }
            else if (parseInt(data) == -1) {
                // if the flag represents an error, change text and hide icon
                setBaitTextErrorAndHideIcon();
            }
            else
            {
                // if it is a 1, it is enabled, allows the addition of bait and sets all the losenges to grey
                setState(getRow["rowId"],CardState.NormalGreen);
                getRow.Card.querySelector("[data-info='UnderlineBait']").setAttribute("class","UnderlineGray");
                getRow.Card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class","UnderlineGray");
                getRow.Card.querySelector("[data-info='UnderlineHours']").setAttribute("class","UnderlineGray");
                getRow.Card.querySelector("[data-info='UnderlineDuration']").setAttribute("class","UnderlineGray");
                getRow.Card.querySelector("[data-info='baitIcon']").style.setProperty("display","");
                getRow.Card.querySelector("[data-info='baitText']").style.setProperty("display","");
            }
        }

        // default text and color for baitText
        function setDefaultBaitText() {
            cardSelected.querySelector("[data-info='baitText']").style.setProperty("color","#4d98c2ff");
            cardSelected.querySelector("[data-info='baitText']").innerHTML = "ADD BAIT";
        }

        // disable the add bait button and also display some text to reflect the error
        function setBaitTextErrorAndHideIcon() {
            cardSelected.querySelector("[data-info='baitIcon']").style.setProperty("display","none");
            cardSelected.querySelector("[data-info='baitText']").style.setProperty("color","#ff5e5e");
            cardSelected.querySelector("[data-info='baitText']").innerHTML = "Baiting Error, please retry";
        }

        // hide the icon and the text, don't let people add bait.
        function hideBaitTextAndIcon() {
            cardSelected.querySelector("[data-info='baitText']").style.setProperty("display","none");
            cardSelected.querySelector("[data-info='baitIcon']").style.setProperty("display","none");
        }

        /**
         * Client Input Event - addBait
         * when addBait is run, this function handles whether the add bait icon is visible or not
         * Also hides and shows certain device info
         */ 
        function OpenDeviceBait(eventData) {
              
            if (cardSelected === null || cardSelected === undefined) {
                return;
            }

            setDefaultBaitText();

            if (parseInt(eventData.value.BaitEnalbed) === 0) {
                // 0 means disable the add bait button
                hideBaitTextAndIcon();
                
            } else if (parseInt(eventData.value.BaitEnalbed) === -1) {
                // -1 means a baiting error
                setBaitTextErrorAndHideIcon();
            }

            var screenForm = eventData.value.Form;
            rowState[eventData.value.ID].DeviceRange = eventData.value.DeviceRange;
            rowState[eventData.value.ID].FullRange = eventData.value.FullRange;
            rowState[eventData.value.ID].ClibrationRange = eventData.value.ClibrationRange;
            cardSelected.querySelector("[data-info='qtyInput']").value = 0;
            cardSelected.querySelector("[data-value='QtyLabel']").innerHTML = "0 / 0";
            ActiveCardProduct = DefaultActiveCardProduct;
             
            screenForm.querySelector("[data-form='formBait']").style.setProperty("display", "");
            screenForm.querySelector("[data-form='ResetIR']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='noActivity']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='RemoveDevice']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='formSet']").style.setProperty("display", "none");
            
            baitChanged();
            var expiryDate = new Date();
            expiryDate = expiryDate.addDays(parseInt(ActiveCardProduct.Expiry));
            var expiryDate = formatDate(expiryDate, "yyyy-MM-dd");
            cardSelected.querySelector("[data-info='expiryDate']").value = expiryDate;
 

        }

        function RepeateChecked(event)
        {
             
            RepeatBait = Script.getState("RepeatBait");
            if(event.checked)
            {
                if (RepeatBait !== undefined && RepeatBait !== null) {
                    
                  
                    var types;
                    
                    activeDropdowndataSources.forEach(x => {
                        if (x.Name === "BaitType") {
                            types = x;
                        }
                    });
                                
                    types.Values.some(x => {
                         
                        var currentName = "";
                        x.Name.split(" ").forEach(y=>{
                            currentName += y;
                        });
                        if (currentName === RepeatBait.Product) {
                            ActiveCardProduct = x;
                            return x;
                        }
                    });
                     
                    QtySet = RepeatBait.Blocks;
                    cardSelected.querySelector("[data-select='BaitType']").value = RepeatBait.Product;
                    cardSelected.querySelector("[data-info='qtyInput']").value = RepeatBait.Blocks;
                    cardSelected.querySelector("[data-value='QtyLabel']").innerHTML = Math.round((parseInt( RepeatBait.Blocks) * RepeatBait.WeightPerBlock), 2) + " / " +  ((parseInt(RepeatBait.Blocks) * RepeatBait.WeightPerBlock) * 0.035274).toString().substr(1,3);
                    cardSelected.querySelector("[data-info='expiryDate']").value = formatDate(RepeatBait.Expiry, "yyyy-MM-dd");
                }
            } 
            else
            {
                cardSelected.querySelector("[data-select='BaitType']").value = DefaultActiveCardProduct.Name;
                cardSelected.querySelector("[data-info='qtyInput']").value = 0;
                cardSelected.querySelector("[data-value='QtyLabel']").innerHTML =  "0 / 0";

                var expiryDate = new Date();
                expiryDate = expiryDate.addDays(parseInt(ActiveCardProduct.Expiry));
                event.parentNode.parentNode.querySelector("[data-info='qtyInput']").value = 1;
                var expiryDate = formatDate(expiryDate, "yyyy-MM-dd");
                cardSelected.querySelector("[data-info='expiryDate']").value = ActiveCardProduct.Expiry;
            }
        }

        function UpdateManual(current) {
            var screenForm = current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector("[data-section='formScreen']");

            screenForm.querySelector("[data-form='formBait']").style.setProperty("display", "");
            screenForm.querySelector("[data-form='ResetIR']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='noActivity']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='formSet']").style.setProperty("display", "none");
            screenForm.querySelector("[data-form='RemoveDevice']").style.setProperty("display", "none");


            showFormScreen(current.currentTarget);

        }

        function CancelBait(current) {
             
            current.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.style.setProperty("display", "none");
            event.currentTarget.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector("[data-info='btnSmart']").style.setProperty("display", "");
            cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

        }


        function ShowAdvisories(event) {
            fw.func("JUMPSCREEN", "Show Advisories");

        }
        /**
         * 1: Grey, deactivated. 2: green, activated. 3: yellow, important 4: red, urgent
         *
         * @param id - id of the card to be modified.
         * @param value {number} - state to change the card to.
         */
        function setState(id, value) {

            if (typeof value !== "number") {
                throw new TypeError("Value must be a number, found '" + typeof value + "'.");
            }
            if (value > 4 || value < 0) {

                throw new Error("State value must either 0, 1, 2, 4. Found " + value);
            }

            var card = rowElems[id];
            var sideStatus = card.querySelector("[data-info='SideBarStatus'");
            var icon = card.querySelector("[data-info='icon']");
            var hours = card.querySelector("[data-value='Hours']");
            //icon.classList.remove("greenIcon");
            //icon.classList.remove("redIcon");
            //icon.classList.remove("greyIcon");

            switch (value) {
                case CardState.DeactivatedGrey:
                    sideStatus.setAttribute("class", "normalCardBorder SideBarGray")

                    var trapTypeSelect = card.querySelector("[data-select='trapType']");
                    if (rowState[id].animalType !== undefined) {
                        trapTypeSelect.value = rowState[id].animalType;
                    }
                    Database.saveRecordParam("Rodent", "Devices", {
                        id:
                        {
                            "Id": id,
                            "State": CardState.DeactivatedGrey,

                        }
                    }, function (data) {

                    });
                    break;
                case CardState.NormalGreen:
                    sideStatus.setAttribute("class", "normalCardBorder SideBarGreen");
                    var trapTypeSelect = card.querySelector("[data-select='trapType']");

                    if (rowState[id].animalType !== undefined) {
                        trapTypeSelect.value = rowState[id].animalType;
                    }
                    Database.saveRecordParam("Rodent", "Devices", {
                        id:
                        {
                            "Id": id,
                            "State": CardState.NormalGreen,

                        }
                    }, function (data) {

                    });
                    break;
                case CardState.UrgentRed:
                    sideStatus.setAttribute("class", "normalCardBorder SideBarRed")
                    areaReport.push({
                        "CardName": id,
                        "Message": "Card " + id + " has been updated, activity sensor activated possible rodent in containment",
                        "DateTime": new Date(),
                    });
                    Database.saveRecordParam("Rodent", "Devices", {
                        id:
                        {
                            "Id": id,
                            "State": CardState.UrgentRed,

                        }
                    }, function (data) {

                    });
                    var trapTypeSelect = card.querySelector("[data-select='trapType']");
                    if (rowState[id].animalType !== undefined) {
                        trapTypeSelect.value = rowState[id].animalType;
                    }

                    // Display notes
                    if (rowState[id].notes && rowState[id] !== "") {
                        card.querySelector("[data-section='notes']").style.setProperty("display", "flex");
                    } else {
                        //card.querySelector("[data-section='notes']").style.setProperty("display", "none");
                    }

                    break;
                case CardState.ImportantYellow:
                    Database.saveRecordParam("Rodent", "Devices", {
                        id:
                        {
                            "Id": id,
                            "State": CardState.ImportantYellow,

                        }
                    }, function (data) {

                    });
                    sideStatus.setAttribute("class", "normalCardBorder SideBarYellow");
                    break;

            }
            rowState[id].State = value;
            rowState[id].ReportData = GetTrapReport(areaReport);
        }

        function GetTrapReport(id) {
            var result = [];
            areaReport.forEach(x => {
                if (x.CardName === id) {
                    result.push(x);
                }
            });
            return result;
        }

        function GetDropDownId(dropdown, lookup) {
            var value;
            activeDropdowndataSources.forEach(current => {
                if (current.Name === dropdown) {
                    current.Values.forEach(x => {
                        if (x.Name === lookup) {
                            value = x.Id;
                        }
                    });
                }
            });
            return value;
        }

        /**
        * Shows the traps of a card that has been clicked.
        * @param event
        */
        function ShowTraps(event) {
            cardSelected = null;
              
            if (cardSelectedParent !== undefined && cardSelectedParent !== null) {
                activeCards.forEach(x => {
                    //deleteCard(x);
                    x.parentNode.remove();
                });
            }

            var clearScreen = event.parentNode.parentNode.querySelector("[data-selector='Traps']");
            if (clearScreen.style.display === "none") {
                lastHeader = clearScreen;
                clearScreen.style.setProperty("display", "");
                cardSelectedParent = clearScreen.parentNode.parentNode.parentNode;

                var id = cardSelectedParent.getAttribute("data-id");
                Script.setState("selectedSite", id);
                fw.func("PUBLISHCLIENT", "LoadCardTraps", id);
            }
            else {
                clearScreen.style.setProperty("display", "none");

            }

        }


        function TrapSelected(event) {

            var clearScreen = event.parentNode.querySelector("[data-selector='Traps']");
            if (clearScreen.style.display === "none") {
                if (lastHeader) {
                    lastHeader.style.setProperty("display", "none");
                    lastHeader = null;
                    activeCards.forEach(x => {
                        deleteCard(x);
                    });
                    return;
                }
                lastHeader = clearScreen;
                clearScreen.style.setProperty("display", "inherit;");
                cardSelectedParent = clearScreen.parentNode.parentNode.parentNode;

                var id = cardSelectedParent.getAttribute("data-id");
                Script.setState("selectedSite", _Id);
                fw.func("PUBLISHCLIENT", "LoadCardTraps", _Id);


            }
        }

        /**
         * Shows the stats of a card that has been clicked.
         * @param event
         */
        function toggleClearScreen(event) {
            
            var clearScreen = event.querySelector("[data-section='clearScreen']");
            if (clearScreen.style.display == "none") {
                if (cardSelected) {
                    cardSelected.classList.remove("openCardBorder");
                    cardSelected.querySelector("[data-section='clearScreen']").style.setProperty("display", "none");
                    cardSelected.querySelector("[data-section='formScreen']").style.setProperty("display", "none");
                   
                }

                clearScreen.style.setProperty("display", ""); 
                cardSelected = clearScreen.parentNode.parentNode;
                try {
                    setTimeout(ToggleChildPosition, 200);
                }
                catch (e) {

                }
                 
                var form = cardSelected.querySelector("[data-section='formScreen']");


                var id = cardSelected.parentNode.getAttribute("data-id");
                const stationId = cardSelected.querySelector('.StationId .StationLabel').innerHTML;

                InnerRowId = id;
                cardSelected.querySelector('[data-info="chart"]').style.setProperty("display", "none");
                cardSelected.querySelector('[data-info="lineChart"]').style.setProperty("display", "none");
                BindChartData(rowState[id].DeviceNumber);

                var deviceType = rowState[id].DeviceType;


                if(deviceControlToggle === 0) {
                 
                
                    cardSelected.querySelector("[data-info='btnActions']").style.display = 'none';
                    cardSelected.querySelector("[data-info='btnInfo']").style.width = '100%';
                    cardSelected.querySelector("[data-info='btnInfo']").click();

                    cardSelected.querySelector("[data-info='btnInfo']").disabled = true;

        
                    clearScreen.querySelector("[data-section='Actions']").style.setProperty("display", "none");
                    cardSelected.querySelector("[data-section='DeviceInfo']").style.setProperty("display", "");
                    cardSelected.querySelector("[data-info='btnInfo']").setAttribute("class", "tabBtnSelected");
                    //devInfo.click();
                    fw.fireEvent("ChangeBait", { ID: id, form: form });
                    

                   
                        

                } else {
                    //document.querySelector("[data-section='btnActions']").style.setProperty("display", "none");
                    cardSelected.querySelector("[data-info='btnActions']").setAttribute("class", "tabBtnSelected");
                    cardSelected.querySelector("[data-info='btnInfo']").setAttribute("class", "tabBtn");
                    clearScreen.querySelector("[data-section='Actions']").style.setProperty("display", "");
                    cardSelected.querySelector("[data-section='DeviceInfo']").style.setProperty("display", "none");


                    cardSelected.querySelector('[data-info="chart"]').style.setProperty("display", "");
                    cardSelected.querySelector('[data-info="lineChart"]').style.setProperty("display", "none");
                    _selectedDay = 0;
                    _IsGraphOpened = false;
                    _ToggledChartType = true;
                    var toggle = cardSelected.querySelector('[data-value="SelectElement"]');
                    cardSelected.querySelector('[data-value="checkbox"]').checked = true;
                    toggle.innerHTML = "Taken";
                    toggle.setAttribute("class", "activeToggle");
                    cardSelected.querySelector('[data-info="chart"]').style.setProperty("display", "none");

                    var name = rowState[id].DeviceNumber;
                    fw.fireEvent("ChildCardToggled", name);



                    if (deviceType === "1") {

                        var ordinary = event.querySelector("[data-section='OrdinaryDevice']");
                        var smart = event.querySelector("[data-section='SmartDevice']");
                        console.log("Inside device 1");
                        smart.style.setProperty("display", "");
                        ordinary.style.setProperty("display", "none");

                    }
                    else {
                        console.log("Inside not device");
                        var ordinary = event.querySelector("[data-section='OrdinaryDevice']");
                        var smart = event.querySelector("[data-section='SmartDevice']");
                        smart.style.setProperty("display", "");
                        ordinary.style.setProperty("display", "none");
                    }
                    console.log("Trying to toggle the selected card in if again");
                    cardSelected.querySelector("[data-info='btnActions']").setAttribute("class", "tabBtnSelected");
                    cardSelected.querySelector("[data-info='btnInfo']").setAttribute("class", "tabBtn");
                    fw.fireEvent("ChangeBait", { ID: id, form: form });
                }
                fw.func("PUBLISHCLIENT", "highlightFloorMapItems", { stationId });
            } else {
                //document.getElementById("devAction").style.setProperty("display", "none"); //btnActio

                clearScreen.style.setProperty("display", "none");
                if (cardSelected) {
                    cardSelected.querySelector("[data-section='formScreen']").style.setProperty("display", "none");
                    cardSelected.classList.remove("openCardBorder");
                    var smrtBtn = cardSelected.querySelector("[data-info='btnSmart']");
                    smrtBtn.style.setProperty("display", "");
                    cardSelected.querySelector("[data-section='DeviceInfo']").style.setProperty("display", "none");

                    cardSelected.querySelector("[data-section='clearScreen']").querySelector("[data-section='Actions']").querySelector("[data-section='ordinaryFormBtn']").style.setProperty("display", "");

                    fw.func("PUBLISHCLIENT", "highlightFloorMapItems", { });
                }
            }
            
            
            
        }



        function ToggleChildPosition() {

            // Scroll Container
            var container = document.getElementById("container");
            // Offset is the amount of the card that is hidden.
            var offset = (cardSelected.offsetTop + cardSelected.offsetHeight - container.scrollTop) - container.offsetHeight;
            // Set the container scroll top so the bottom of the card is at the bottom of the container.
            container.scrollTop += offset;
            if (1 > container.offsetHeight) {
                container.scrollTop = cardSelected.offsetHeight + cardSelected.offsetTop;
            }

            // Add open border style
            if (!cardSelected.classList.contains("newPhotoBorder")) {
                cardSelected.classList.add("openCardBorder");
            }
        }
        /**
        * Adds a new record or updates and existing record header with the given sensor collection.
        *
        * The columns available are: CardName, CardLocation,UrgentCount, ImportantCount, MinorCount.
        *
        * Anything with data-value will automaticcally have the value updated in .innerHTML. From items etc neet to use the second switch statement.
        *
        * @param packet
        */
        function receive_headers(packet) {
                 
            var collection = packet.value.value;
            var rowHeaderKeys = Object.keys(collection.data);
            rowStateHeaders = {};
            for (var i = 0; i < rowHeaderKeys.length; i++) {
                var card = rowHeaderElems[rowHeaderKeys[i]];
                if (card == undefined) {
                    // Create new card
                    card = cardTemplate.cloneNode(true);
                    card.setAttribute("id", "");
                    card.style.setProperty("display", "");
                    rowHeaderElems[rowHeaderKeys[i]] = card;
                    // Add to table.
                    addCard(rowHeaderKeys[i], card);
                    rowStateHeaders[rowHeaderKeys[i]] = {};


                }
                ActiveDatasource = collection.data;

                // Update stats
                for (var j = 0; j < collection.headers.length; j++) {
                    var headerValue = collection.headers[j];
                    var elem = card.querySelector("[data-value='" + headerValue + "']");

                    // It may not exist.
                    if (elem !== null) {
                        switch (headerValue) {
                            case "CardName":
                                if (collection.data[rowHeaderKeys[i]][j] === "") {
                                    card.querySelector("[data-value='CardName']").innerHTML = "Missing Value";
                                } else {
                                    card.querySelector("[data-value='CardName']").innerHTML = collection.data[rowHeaderKeys[i]][j];
                                }
                                break;
                            case "CardAddress":
                                if (collection.data[rowHeaderKeys[i]][j] === "") {
                                    card.querySelector("[data-value='CardAddress']").innerHTML = "Missing Value";
                                } else {
                                    card.querySelector("[data-value='CardAddress']").innerHTML = collection.data[rowHeaderKeys[i]][j];

                                }
                                break;
                            case "Urgent":
                                card.querySelector("[data-value='Urgent']").innerHTML = "--";

                                break;
                            case "Important":
                                card.querySelector("[data-value='Important']").innerHTML = "--";

                                break;
                            case "Minor":
                                card.querySelector("[data-value='Minor']").innerHTML = "--";
                                break;
                        }

                    }
                    else {
                        switch (headerValue) {
                            case "NoAction":
                                rowStateHeaders[rowHeaderKeys[i]][headerValue] = collection.data[rowHeaderKeys[i]][j];

                                break;
                            case "Danger":
                                rowStateHeaders[rowHeaderKeys[i]][headerValue] = collection.data[rowHeaderKeys[i]][j];

                                break;
                            case "Attention":
                                rowStateHeaders[rowHeaderKeys[i]][headerValue] = collection.data[rowHeaderKeys[i]][j];

                                break;
                        }
                        //rowState[rowHeaderKeys[i]][headerValue] = collection.data[rowHeaderKeys[i]][j];

                    }

                }

                rowStateHeaders[rowHeaderKeys[i]]["Card"] = card;
            }
        }

        /**
         * Adds a new record or updates and existing record with the given sensor collection.
         *
         * The columns available are: technician, trapType, temp, setTime, updateTime, triggeredTime.
         *
         * Anything with data-value will automaticcally have the value updated in .innerHTML. From items etc neet to use the second switch statement.
         *
         * @param packet
         */
        function receive_value(packet) {
             
            activeCards = [];
            rowElems = {};
            rowState = {};
            var collection = packet.value.value;
            rowKeys = Object.keys(collection.data);
            for (var i = 0; i < rowKeys.length; i++) {
                var card = rowElems[rowKeys[i]];
                if (card == undefined) {
                    // Create new card
                    card = cardChildTemplate.cloneNode(true);
                    card.setAttribute("id", "");
                    card.style.setProperty("display", "");
                    rowElems[rowKeys[i]] = card;
                    // Add to table.
                    var statusIndex = collection._columnMap.Status;
                    AddCardChild(rowKeys[i], card, cardSelectedParent, collection.data[parseInt(rowKeys[i])][statusIndex]? collection.data[parseInt(rowKeys[i])][statusIndex] : '0');
                    rowState[rowKeys[i]] = {};
                    rowState[rowKeys[i]]["rowId"] = rowKeys[i];


                    if (collection.headers.indexOf("State") === -1) {
                        setState(rowKeys[i], CardState.Unassigned);
                    }

                }
                ActiveDatasource = collection.data;
                var currentCard = card.querySelector("[data-value='map']");
                currentCard.id = "ID_" + collection.data[rowKeys[i]][0];
                rowState[rowKeys[i]]["Card"] = card;
                // Update stats
                 
                for (var j = 0; j < collection.headers.length; j++) {
                    var headerValue = collection.headers[j];
                    var elem = card.querySelector("[data-value='" + headerValue + "']");

                    // It may not exist.
                    if (elem !== null) {
                        switch (headerValue) {

                            case "Status":

                                if (collection.data[rowKeys[i]][j] === "" ) {
                                    // card.querySelector("[data-value='Status']").innerHTML = "Network Error";
                                } else {
                                    // card.querySelector("[data-value='Status']").innerHTML = collection.data[rowKeys[i]][j];
                                }
                                break;
                            case "Address":
                                 
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    switch (parseInt(collection.data[rowKeys[i]][j]))
                                    {
                                        case 1:
                                             
                                        card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class", "UnderlineOrange");
                                        rowState[rowKeys[i]]["ConsumptionStatus"] = 1;
                                            break;
                                        case 2:
                                         
                                        card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class", "UnderlineRed");
                                        rowState[rowKeys[i]]["ConsumptionStatus"] = 2;
                                            break;
                                        default:
                                        card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class", "UnderlineGreen");

                                            break;
                                    }
                                } 
                                else 
                                {
                                  //  card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class", "UnderlineGray");
                                }
                            break;
                            case "Notes":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    //card.querySelector("[data-section='notes']").style.setProperty("display", "flex");
                                } else {
                                    // card.querySelector("[data-section='notes']").style.setProperty("display", "none");
                                }

                                //card.querySelector("[data-form='notes']").value = collection.data[rowKeys[i]][j];
                                break;
                            case "Hours":
                                if (collection.data[rowKeys[i]][j] !== "") {

                                    card.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGray")

                                    card.querySelector("[data-value='Hours']").innerHTML = collection.data[rowKeys[i]][j];
                                    //SetCardLineColor(card, , triggerTresholdUpper, triggerTreshold, "UnderlineHours");

                                    var parseVal = parseInt(collection.data[rowKeys[i]][j]);


                                    if (parseVal > triggerTresholdUpper) {
                                        card.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineRed")
                                    }
                                    else if (parseVal >= triggerTreshold && parseVal <= triggerTresholdUpper) {
                                        card.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineOrange")
                                    }
                                    else if (parseVal < 0) {
                                        card.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGray")
                                    }
                                    else {
                                        card.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGreen")
                                    }




                                } else {
                                    card.querySelector("[data-value='Hours']").innerHTML = "--";
                                    //SetCardLineColor(card, 0, 40, "UnderlineHours");
                                    card.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGray")


                                }
                                //card.querySelector("[data-form='notes']").value = collection.data[rowKeys[i]][j];
                                break;
                            case "Id":

                                if (collection.data[rowKeys[i]][j] !== "") {
                                    card.querySelector("[data-value='Id']").innerHTML = collection.data[rowKeys[i]][j];
                                } else {
                                    card.querySelector("[data-value='Id']").innerHTML = "--";
                                }
                                //card.querySelector("[data-form='notes']").value = collection.data[rowKeys[i]][j];
                                break;
                            case "DeviceNumber":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    card.querySelector("[data-value='DeviceNumber']").innerHTML = collection.data[rowKeys[i]][j];
                                } else {
                                    card.querySelector("[data-value='DeviceNumber']").innerHTML = "--";
                                }
                                break;

                            case "SignalStatus":
                                //if (collection.data[rowKeys[i]][j] !== "") {
                                //    card.querySelector("[data-value='SignalStatus']").innerHTML = collection.data[rowKeys[i]][j];
                                //} else {
                                //    card.querySelector("[data-value='SignalStatus']").innerHTML = "No Vlaue";
                                //}

                                //card.querySelector("[data-form='notes']").value = collection.data[rowKeys[i]][j];
                                break;

                            case "SignalStrenght":

                                if (collection.data[rowKeys[i]][j] !== "") {
                                    let quality = collection.data[rowKeys[i]][j];
                                    // let qualityRange = quality < 25 ? "Low" : quality < 60 ? "Medium" : "High";
                                    card.querySelector("[data-value='SignalStrenght']").innerHTML = quality + "%";
                                    SetCardLineColorOver(card, collection.data[rowKeys[i]][j], 30, 60, "UnderlineSignal");

                                } else {
                                    card.querySelector("[data-info='UnderlineSignal']").setAttribute("class", "UnderlineGray")
                                    //    card.querySelector("[data-value='SignalStatus']").innerHTML = "No Vlaue";
                                }

                                //card.querySelector("[data-form='notes']").value = collection.data[rowKeys[i]][j];
                                break;

                            case "Alert":
                                if (collection.data[rowKeys[i]][j] !== "" ) {
                                    card.querySelector("[data-section='alert']").style.setProperty("display", "flex");
                                } else {
                                    card.querySelector("[data-section='alert']").style.setProperty("display", "none");
                                }
                                break;
                            case "BaitName":
                                 
                                if (collection.data[rowKeys[i]][j] !== "") {
                                   // card.querySelector("[data-value='BaitName']").innerHTML = collection.data[rowKeys[i]][31];
                                } else {
                                 //   card.querySelector("[data-value='BaitName']").innerHTML = "--";
                                }
                                break;
                            
                            case "DeviceName":
                                 
                                if (collection.data[rowKeys[i]][j] !== "" ) {
                                    card.querySelector("[data-value='DeviceName']").innerHTML = collection.data[rowKeys[i]][j];
                                    rowState[rowKeys[i]]["DeviceName"] = collection.data[rowKeys[i]][j];

                                }
                                else {
                                    card.querySelector("[data-value='DeviceName']").innerHTML = "--";
                                }
                                break;
                            case "StationId":
                                 
                                if (collection.data[rowKeys[i]][j] !== "" ) {
                                    card.querySelector("[data-value='StationId']").innerHTML = collection.data[rowKeys[i]][j];
                                    rowState[rowKeys[i]]["StationId"] = collection.data[rowKeys[i]][j];
                                }
                                else {
                                    card.querySelector("[data-value='StationId']").innerHTML = "--";
                                }
                                break;                             


                        }
                        // elem.innerHTML = collection.data[rowKeys[i]][j];
                        rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];
                    } else {

                        // Put item in here if it does not directly go into .innerHTML
                        switch (headerValue) {
                            case "Id":
                                rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];
                                break;
                            case "Sid":

                                rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];
                                break;
                            case "State":
                                // Set correct color
                                // unsure if this is needed, set device state seems to do this as well, and is run at the end of this function
                                setState(rowKeys[i], parseInt(collection.data[rowKeys[i]][j]));

                                break;
                            case "BaitTypeName":
                                if (collection.data[rowKeys[i]][j] !== "" ) {
                                    
                                    card.querySelector("[data-value='FoodName']").innerHTML = collection.data[rowKeys[i]][31];
                                } else {
                                    card.querySelector("[data-value='FoodName']").innerHTML = "--";
                                }
                                break;

                            case "CatchNotes":
                                //card.querySelector("[data-form='catchNotes']").value = collection.data[rowKeys[i]][j];
                                break;
                            case "BaitRate":
                                if (collection.data[rowKeys[i]][j] !== "" ) {
                                    //  card.querySelector("[data-value='Dial']").innerHTML = collection.data[rowKeys[i]][j] + "g";
                                    rowState[rowKeys[i]]["BaitRate"] = collection.data[rowKeys[i]][j];
                                     
                                    //if (collection.data[rowKeys[i]][20] === "1") {
                                        //   SetCardLineColor(card, collection.data[rowKeys[i]][j], baitThreshold, baitThresholdUpper, "UnderlineBait");
                                    //}
                                }
                                else {
                                    //card.querySelector("[data-value='Dial']").innerHTML = "--";
                                    card.querySelector("[data-info='UnderlineBait']").setAttribute("class", "UnderlineGray");

                                }
                                break;
                            case "DeviceBattery":
                                // TODO: needs to be redone in the flows to account for proper voltage ratings
                                // The flows should post the percentage value to the database, not the voltage
                                if (collection.data[rowKeys[i]][j] !== "" ) {
                                    numVal = card.querySelector("[data-section='BatteryVal']");
                                    let batteryVoltage = parseInt(parseFloat(collection.data[rowKeys[i]][j]) * 100);
                                    // var battery = Math.min(100, Math.round((parseFloat(batteryVoltage) / 6.3) * 100));
                                    
                                    let upperLimit = parseInt(collection.getColumn("BatteryUpper")[i]);
                                    let lowerLimit = parseInt(collection.getColumn("BatteryLower")[i]);

                                    let batteryPercentage = Math.max(0, Math.min(100, 100 - ((upperLimit - batteryVoltage) / 2)));
                                    card.querySelector("[data-section='BatteryVal']").innerHTML = batteryPercentage.toString() + "%";
                                    SetCardLineColorPercentage(card, batteryPercentage, "UnderlineBattery");
                                } else {
                                    card.querySelector("[data-info='UnderlineBattery']").setAttribute("class", "UnderlineGray")
                                }
                                break;
                            case "DeviceType":

                                rowState[rowKeys[i]][headerValue] = collection.data[rowKeys[i]][j];
                                switch (collection.data[rowKeys[i]][j]) {
                                    case "1":
                                        HideCardIcons(card);
                                        card.querySelector("[data-info='iconSmart']").style.setProperty("display", "");
                                        rowState[rowKeys[i]]["ActiveIcon"] = "[data-info='iconSmart']";
                                        break;
                                    case "2":
                                        HideCardIcons(card);
                                        card.querySelector("[data-info='iconDummy']").style.setProperty("display", "");
                                        rowState[rowKeys[i]]["ActiveIcon"] = "[data-info='iconDummy']";
                                        break;
                                }
                                break;
                                
                                case "CommunicationError":
                                // TODO remove this case once ErrorCodeFlag has been fully implemented - presumably damien did this, sebastian is now putting it back in.
                                // communication error and error code flag have been modified on the app server temporarily to
                                // fix an issue with the communication error not displaying. These changes will be ovewritten
                                // on the next production push
                                if (collection.data[rowKeys[i]][j] !== "" ) {                                      
                                    if (collection.data[rowKeys[i]][j] === "1" && collection.data[rowKeys[i]][20] === "1") {
                                        card.querySelector("[data-info='communicationErrorStatus']").style.setProperty("display", "");
                                        rowState[rowKeys[i]]["CommunicationError"] = true;

                                    }
                                    else if (collection.data[rowKeys[i]][j] === "0" && collection.data[rowKeys[i]][20] === "1") {
                                        card.querySelector("[data-info='communicationErrorStatus']").style.setProperty("display", "none");
                                    }
                                    else if(collection.data[rowKeys[i]][j] === "2")
                                    {
                                        card.querySelector("[data-info='communicationErrorStatus']").style.setProperty("display", "");
                                        rowState[rowKeys[i]]["CommunicationError"] = true;
                                    }
                                }
                                else {
                                    card.querySelector("[data-info='communicationErrorStatus']").style.setProperty("display", "none");
                                    rowState[rowKeys[i]]["CommunicationError"] = false;
                                }
                                break;

                            case "ErrorCodeFlag":
                                if (collection.data[rowKeys[i]][j] !== "" ) {
                                    if (collection.data[rowKeys[i]][j] === "1") {
                                        card.querySelector("[data-info='deviceErrorStatus']").style.setProperty("display", "");
                                        rowState[rowKeys[i]]["DeviceError"] = true;
                                    } else if (collection.data[rowKeys[i]][j] === "0") {
                                        card.querySelector("[data-info='deviceErrorStatus']").style.setProperty("display", "none");
                                        rowState[rowKeys[i]]["DeviceError"] = false;
                                    }
                                } else {
                                    card.querySelector("[data-info='deviceErrorStatus']").style.setProperty("display", "none");
                                    rowState[rowKeys[i]]["DeviceError"] = false;
                                }
                                break;
                            case "UpdateTime":
                                 
                                var date = new Date(parseInt(collection.data[rowKeys[i]][j]));
                                if (date.toString() === "Invalid Date") {
                                    card.querySelector("[data-value='updateTime']").innerHTML = "--";

                                }
                                else {
                                    var formated = formatDate(date, "dd/MM/yy H:mm");
                                    card.querySelector("[data-value='updateTime']").innerHTML = formated;
                                }
                                break;
                            case "TriggerTime":
                                 
                                var date = new Date(parseInt(collection.data[rowKeys[i]][j]));
                                if (date.toString() === "Invalid Date") {
                                    card.querySelector("[data-value='setDateTime']").innerHTML = "--";

                                }
                                else {
                                    var formated = formatDate(date, "dd/MM/yy H:mm");
                                    card.querySelector("[data-value='setDateTime']").innerHTML = formated;
                                }
                                break;
                            case "SetTime":
                                 
                                var date = new Date(parseInt(collection.data[rowKeys[i]][j]))
                                if (date.toString() === "Invalid Date") {
                                    card.querySelector("[data-value='SetTimeFormatted']").innerHTML = "--";
                                }
                                else {
                                    var formated = formatDate(date, "dd/MM/yy H:mm");
                                    card.querySelector("[data-value='SetTimeFormatted']").innerHTML = formated;
                                    rowState[rowKeys[i]]["SetTime"] = collection.data[rowKeys[i]][j];

                                    //const diffTime = Math.abs(new Date() - new Date(collection.data[rowKeys[i]][j]));
                                    //const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                    //var remaining = diffDays;
                                }

                                break;
                            case "Expiry":
                                  
                                if (collection.data[rowKeys[i]][j] !== "" ) {
                                    var date = new Date();
                                    var foodDate;
                                    rowState[rowKeys[i]]["FoodDateVal"] = collection.data[rowKeys[i]][18]; // Food Date Val
                                    rowState[rowKeys[i]]["BaitNameVal"] = collection.data[rowKeys[i]][31]; // Bait Name
                                     

                                    var foodDateVal = collection.data[rowKeys[i]][18];
                                    if (foodDateVal !== "" && foodDateVal.toString() !== "Invalid date") {
                                        var foodItem;
                                        activeDropdowndataSources.forEach(current => {
                                            if (current.Name === "BaitType") {
                                                current.Values.forEach(x => {
                                                    if (x.Name === collection.data[rowKeys[i]][31]) {
                                                        foodItem = x;
                                                    }
                                                });
                                            }
                                        });
                                        foodDate = new Date(foodDateVal);
                                        const diffTime = foodDate - date
                                        if (isNaN(diffTime)) {
                                            card.querySelector("[data-value='Duration']").innerHTML = "--";
                                            card.querySelector("[data-info='UnderlineDuration']").setAttribute("class", "UnderlineGray");
                                        }
                                        else {
                                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                            var remaining = diffDays.toString() + "d";
                                            card.querySelector("[data-value='Duration']").innerHTML = remaining;
                                            if (foodItem !== undefined) {
                                                SetCardLineColor(card, diffDays, parseInt(foodItem.LowerThreshold), parseInt(foodItem.UpperThreshold), "UnderlineDuration");
                                            }
                                        }

                                    }
                                    else {
                                        card.querySelector("[data-value='Duration']").innerHTML = "--";
                                        card.querySelector("[data-info='UnderlineDuration']").setAttribute("class", "UnderlineGray");
                                    }
                                }
                                else if (collection.data[rowKeys[i]][j] === '' ) {
                                    card.querySelector("[data-value='Duration']").innerHTML = "--";
                                    card.querySelector("[data-info='UnderlineDuration']").setAttribute("class", "UnderlineGray");
                                }
                                rowState[rowKeys[i]]["Duration"] = collection.data[rowKeys[i]][j];
                                break;
                            case "WeightConsumed":
                                var fullrange = collection.data[rowKeys[i]][j];

                                if (collection.data[rowKeys[i]][j] !== ""  ) {
                                     
                                    rowState[rowKeys[i]]["WeightConsumed"] = collection.data[rowKeys[i]][j];
                                    card.querySelector("[data-value='Consumed']").innerHTML = Math.round(parseFloat((collection.data[rowKeys[i]][j]))) + "g";
                                    if(rowState[rowKeys[i]]["ConsumptionStatus"] === undefined)
                                    {
                                         card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class","UnderlineGreen");
                                    }
                                    else
                                    {
                                        switch(rowState[rowKeys[i]]["ConsumptionStatus"])
                                        {
                                            case 1:
                                                card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class","UnderlineOrange");

                                            break;
                                            case 2:
                                            card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class","UnderlineRed");

                                            break;
                                            default:
                                            card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class","UnderlineGreen");

                                            break;
                                        }
                                    }
                                     
                                    // if(Math.round(parseFloat((collection.data[rowKeys[i]][j]))) )

                                }
                                else {
                                    rowState[rowKeys[i]]["WeightConsumed"] = "--";
                                }
                                break;
                            case "CalculatedWeight":
 
                                var CalculatedWeight = collection.data[rowKeys[i]][j];


                                if (collection.data[rowKeys[i]][j] !== "") {
                                     
                                    card.querySelector("[data-value='Dial']").innerHTML = Math.round(parseFloat(collection.data[rowKeys[i]][j])) + "%";
                                    SetCardLineColor(card, collection.data[rowKeys[i]][j], baitThreshold, baitThresholdUpper, "UnderlineBait");

                                    rowState[rowKeys[i]]["CalculatedWeight"] = collection.data[rowKeys[i]][j];
                                }
                                else {
                                    rowState[rowKeys[i]]["CalculatedWeight"] = "";
                                }
                                break;
                            case "RebaitRange":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    rowState[rowKeys[i]]["RebaitRange"] = collection.data[rowKeys[i]][j];
                                }
                                else {
                                    rowState[rowKeys[i]]["RebaitRange"] = 0;
                                }
                                break;
                            case "DeviceRange":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    rowState[rowKeys[i]]["DeviceRange"] = collection.data[rowKeys[i]][j];
                                }
                                else {
                                    rowState[rowKeys[i]]["DeviceRange"] = 0;
                                }
                                break;
                            case "EnteredWeight":
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    card.querySelector("[data-value='enteredWeight']").innerHTML = Math.round(parseFloat(collection.data[rowKeys[i]][j]) - BarCompensation) + "g";
                                    rowState[rowKeys[i]]["EnteredWeight"] = collection.data[rowKeys[i]][j];
                                    var weightConsumedAmmount = ((rowState[rowKeys[i]]["WeightConsumed"] / Math.round(parseFloat(collection.data[rowKeys[i]][j]) - BarCompensation)));
                                    if( weightConsumedAmmount > 10  && weightConsumedAmmount < 15)
                                    {
                                        card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class","UnderlineYellow");

                                    }
                                    else if(weightConsumedAmmount > 15)
                                    {
                                        card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class","UnderlineRed");
                                    }
                                }
                                else {
                                    card.querySelector("[data-value='enteredWeight']").innerHTML = "--";
                                }
                                break;
                            case "Location":
                                 
                                if (collection.data[rowKeys[i]][j] !== "" ) {
                                    card.querySelector("[data-value='Address']").innerHTML = collection.data[rowKeys[i]][j];
                                    rowState[rowKeys[i]]["Location"] = collection.data[rowKeys[i]][j];

                                }
                                else {
                                    //card.querySelector("[data-value='Address']").innerHTML = "--";
                                }
                                break;
                            case "PacketType":
                                 
                                if (collection.data[rowKeys[i]][j] !== "") {
                                    rowState[rowKeys[i]]["PacketType"] = collection.data[rowKeys[i]][j];
                                    if( collection.data[rowKeys[i]][j] === "1")
                                    {
                                        card.querySelector("[data-info='UnderlineBait']").setAttribute("class","UnderlineGray");
                                  //      card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class","UnderlineGray");
                                    }
                                }
                                else {
                                    rowState[rowKeys[i]]["PacketType"] = -1;
                                    if( collection.data[rowKeys[i]][j] === "1")
                                    {
                                        card.querySelector("[data-info='UnderlineBait']").setAttribute("class","UnderlineGray");
                                      //  card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class","UnderlineGray");
                                    }
                                }
                                break;
                         
                        }
                    }
                }
                setDeviceStatus(rowKeys[i]);
                //if (rowState[rowKeys[i]]["DeviceError"]) {
                //    DisableDevice(rowState[rowKeys[i]]);
                //}
            }

            fw.fireEvent("children populated", 0);

            //fw_feed(null, null, null);
            //  ChangeCardHeaderType(1);
            ChangeHeaderValue();
        }


        function DisableDevice(data) {
            card.querySelector("[data-value='Duration']").innerHTML = "--";
            card.querySelector("[data-info='UnderlineBattery']").setAttribute("class", "UnderlineGray");
            card.querySelector("[data-value='Dial']").innerHTML = "--";
            card.querySelector("[data-info='UnderlineBait']").setAttribute("class", "UnderlineGray");
            card.querySelector("[data-value='FoodName']").innerHTML = "--";

            setState(1, CardState.DeactivatedGrey);
        }

        // set the Device Status and State
        function setDeviceStatus(id) {
            rowState[id]["exiperyRisen"] = false;
            var prevStatus = rowState[id]["sstatus"];
            var foodItem;

            if (prevStatus === undefined) {
                prevStatus == CardStatus.Disabled;
            }

            if (rowState[id].PacketType === -1) {
                rowState[id]["sstatus"] = CardStatus.Disabled;
                setState(id, CardState.DeactivatedGrey);
                return;

            }

            if (rowState[id].PacketType === "1") {
                rowState[id]["sstatus"] = CardStatus.Disabled;
                setState(id, CardState.DeactivatedGrey);
                rowState[id].Card.querySelector("[data-info='UnderlineBait']").setAttribute("class","UnderlineGray");
                rowState[id].Card.querySelector("[data-info='UnderlineBaitTaken']").setAttribute("class","UnderlineGray");
                rowState[id].Card.querySelector("[data-info='UnderlineHours']").setAttribute("class","UnderlineGray");
                rowState[id].Card.querySelector("[data-info='UnderlineDuration']").setAttribute("class","UnderlineGray");
                return;

            } 

            activeDropdowndataSources.forEach(current => {
                if (current.Name === "BaitType") {
                    current.Values.forEach(x => {
                        if (x.Name === rowState[id]["BaitNameVal"]) {
                            foodItem = x;
                        }
                    });
                }
            });

            // check the weight, hours, and device error and set the state accordingly.
            var sidebarStateVal = CheckRowState(parseInt(rowState[id]["CalculatedWeight"]), parseInt(rowState[id]["Hours"]), rowState[id]["DeviceError"], id);
            setState(id, sidebarStateVal);

            // if there is a state, and the device is type 1
            if (sidebarStateVal !== null && rowState[id]["DeviceType"] === "1") {
                // only if it is green or yellow, check the food date expiry
                if (sidebarStateVal === CardState.NormalGreen || sidebarStateVal === CardState.ImportantYellow) {


                    var date = new Date();
                    var foodDate;
                    var foodDateVal = rowState[id]["FoodDateVal"];
                    if (foodDateVal !== "") {

                        foodDate = new Date(foodDateVal);

                        const diffTime = foodDate - date;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        //rowState[id].Card.querySelector("[data-value='Duration']").innerHTML = diffDays + "d";
                        if(foodItem !== undefined)
                        {
                            SetCardLineColor(rowState[id].Card, diffDays, parseInt(foodItem.LowerThreshold), parseInt(foodItem.UpperThreshold), "UnderlineDuration");
                            
                            var updatedVal = CheckRowStateManul(diffDays, parseInt(foodItem.LowerThreshold), parseInt(foodItem.UpperThreshold), id);
                            // if updated val is higher priority, then update the sstatus
                            if (isHigherUrgency(sidebarStateVal, updatedVal)) {
                                setState(id, updatedVal);
                            }
                            else {
                                // if it isn't a higher priority, set it to yellow?
                                switch (sidebarStateVal) {
                                    case CardState.ImportantYellow:
                                        setState(id, CardState.ImportantYellow);

                                        break;

                                    // case 3:
                                    //     setState(id, 3);

                                    //     break;
                                }
                            }

                        }


                    }
                    else {
                        rowState[id].Card.querySelector("[data-value='Duration']").innerHTML = "--";
                        rowState[id].Card.querySelector("[data-info='UnderlineDuration']").setAttribute("class", "UnderlineGray");
                        setState(id, CardState.NormalGreen);

                    }
                }

            }
            else if (rowState[id]["DeviceType"] === "2") {


                var date = new Date();
                var foodDate;
                var foodDateVal = rowState[id]["FoodDateVal"];
                if (foodDateVal !== "") {
                    foodDate = new Date(foodDateVal);
                    const diffTime = Math.abs(foodDate - date);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    rowState[id].Card.querySelector("[data-value='Duration']").innerHTML = diffDays + "d";
                    SetCardLineColor(rowState[id].Card, diffDays, 3, 5, "UnderlineDuration");
                    var stateValue = CheckRowStateManul(diffDays, parseInt(foodItem.LowerThreshold), parseInt(foodItem.UpperThreshold), id);
                    setState(id, stateValue);

                }
                else {
                    card.querySelector("[data-value='Duration']").innerHTML = "--";
                    card.querySelector("[data-info='UnderlineDuration']").setAttribute("class", "UnderlineGray");
                    setState(id, CardState.NormalGreen);

                }

            }

            if(rowState[id]["ConsumptionStatus"] === 1 && sidebarStateVal < CardState.ImportantYellow)
            {
                setState(id, CardState.ImportantYellow);
                return;
            }

            if(rowState[id]["ConsumptionStatus"] === 2)
            {
                setState(id, CardState.UrgentRed);
                return;
            }

        }


        function ChangeHeaderValue() {
            cardSelectedParent.querySelector("[data-value='Urgent']").innerHTML = 0;
            cardSelectedParent.querySelector("[data-value='Important']").innerHTML = 0;
            cardSelectedParent.querySelector("[data-value='Minor']").innerHTML = 0;


            var greenCount = 0;
            var yellowCount = 0;
            var redCount = 0;
            for (var rowIndex in rowState) {
                var row = rowState[rowIndex];
                if(row.PacketType !== -1 && row.PacketType !== 1)
                {
                    switch (row["State"]) 
                    {
                        case CardState.UrgentRed:
                            redCount += 1;
                            break;
                        case CardState.ImportantYellow:
                            yellowCount += 1;
                            break;
                        case CardState.NormalGreen:
                            greenCount += 1;
                            break;
                    }
                }
            
            }

            cardSelectedParent.querySelector("[data-value='Urgent']").innerHTML = redCount;
            cardSelectedParent.querySelector("[data-value='Important']").innerHTML = yellowCount;
            cardSelectedParent.querySelector("[data-value='Minor']").innerHTML = greenCount;
        }

        // checks the state of the card, using the expiry and bait thresholds.
        function CheckRowStateManul(expiery, threshold, tresholdUpper, row) {
            var result;
            if (expiery === '') {
                result = CardState.Unassigned;
                return result;
            }

            if (expiery <= threshold) {
                result = CardState.UrgentRed;

            }
            else if (expiery >= threshold && expiery <= tresholdUpper) {
                result = CardState.ImportantYellow;

            }
            else {
                result = CardState.NormalGreen;

            }

            return result;
        }

        // checks the state of the row, also sets the state of the row. Should not change the state of the row, just check.
        function CheckRowState(baitLeft, triggers, deviceError, row) {
            var result = CardState.Unassigned;
            var importantRisen = 0;
            var urgentRisen = 0;

            // if there is a device error, set the state to red
            if (deviceError) {
                result = CardState.UrgentRed;
                return result;
            }
 
            // if the bait left is less than the bait threshold, raise urgent
            if (parseInt(baitLeft) <= baitThreshold && baitLeft !== "" && Number.isInteger(parseInt(baitLeft)))  {
                urgentRisen = 1;
            }
            // if the number of triggers is bigger than the upper threshold, raise urgent
            else if (parseInt(triggers) > triggerTresholdUpper && Number.isInteger(parseInt(triggers)) ) {
                urgentRisen = 1;
            }
            // if the bait left is less than the baitThresholdUpper (but more than the bait threshold), raise important
            else if (parseInt(baitLeft) <= baitThresholdUpper && baitLeft !== "" && Number.isInteger(parseInt(baitLeft))) {
                importantRisen = 1;
            }
            // if the triggers is bigger than the trigger threshold (but less than the triggerTresholdUpper), raise important
            else if (parseInt(triggers) >= triggerTreshold && parseInt(triggers) <= triggerTresholdUpper && Number.isInteger(parseInt(triggers)) ) {
                importantRisen = 1;
            }
            // if there are negative triggers, raise urgent
            else if (parseInt(triggers) < 0) {
                urgentRisen = 1;
            }

            // if there was an important risen, but no urgent risen, set the state to yellow
            if (importantRisen === 1 && urgentRisen === 0) {
                // setState(row, CardState.ImportantYellow);
                result = CardState.ImportantYellow;
            }
            // if there was an urgent risen, set the state to red
            else if (urgentRisen == 1) {
                // setState(row, CardState.UrgentRed);
                result = CardState.UrgentRed;
            }
            // otherwise set the state to green
            else {
                // setState(row, CardState.NormalGreen);
                result = CardState.NormalGreen;
            }


            return result;
        }

        function BindChartData(deviceName) {
            if (GraphEnabled) {

                _TimeSeriesData["Cycle"] = [];
                _DaysSeriesCycle = {};
                _CycleRightLoaded = false;
                _CycleLeftLoaded = false;
                
                var endDate = new Date();
                var startDate = new Date();
                endDate = endDate.setDate(endDate.getDate() - 7);
                endDate = new Date(endDate).toISOString();
                startDate = startDate.toISOString();

                fw.func("history", "PESTCO/RODENTS/" + deviceName.toUpperCase() + "/WEIGHT", "WEIGHT", endDate, startDate);         // request data from server
                fw.func("history", "PESTCO/RODENTS/" + deviceName.toUpperCase() + "/BAITTAKEN", "BAITTAKEN", endDate, startDate);         // request data from server
                fw.func("history", "PESTCO/RODENTS/" + deviceName.toUpperCase() + "/COUNTERTOTAL", "COUNTERTOTAL", endDate, startDate);         // request data from server
                fw.func("history", "PESTCO/RODENTS/" + deviceName.toUpperCase() + "/ACTIVECYCLELEFT", "ACTIVECYCLELEFT", endDate, startDate);
                fw.func("history", "PESTCO/RODENTS/" + deviceName.toUpperCase() + "/ACTIVECYCLERIGHT", "ACTIVECYCLERIGHT", endDate, startDate);
            }
        }

        // function ChangeBaitState(eventData) {

        //     var toggle = eventData.querySelector('[data-value="SelectElementCB"]');
        //     var currentClass = toggle.classList[0]
        //     if (currentClass === "activeToggle") {
        //         eventData.querySelector('[data-value="checkbox"]').checked = true;
        //         toggle.innerHTML = "Taken";
        //         toggle.setAttribute("style", "");

        //         toggle.setAttribute("class", "inactiveToggle");
        //         BaitState = false;
        //         if (!_IsGraphOpened) {
        //             CheckRender();
        //         }
        //         else {
        //             RenderWeightChart(_selectedDay);
        //         }

        //     }
        //     else {
        //         eventData.querySelector('[data-value="checkbox"]').checked = false;
        //         toggle.innerHTML = "Left";
        //         toggle.setAttribute("class", "activeToggle");
        //         toggle.setAttribute("style", "left: 26px;");

        //         BaitState = true;
        //         if (!_IsGraphOpened) {
        //             CheckRender();
        //         }
        //         else {
        //             RenderWeightChart(_selectedDay);
        //         }
        //     }
        // }

        function ChangeActiveGraphSource(eventData) {

            var toggle = eventData.querySelector('[data-value="SelectElement"]');
            var currentClass = toggle.classList[0]
            if (currentClass === "inactiveToggle") {
                eventData.querySelector('[data-value="checkbox"]').checked = true;
                toggle.innerHTML = "Taken";
                // cardSelected.querySelector("[data-info='baitStateToggle']").style.setProperty("display","");

                toggle.setAttribute("class", "activeToggle");
                _ToggledChartType = true;
                if (!_IsGraphOpened) {
                    CheckRender();
                }
                else {
                    RenderWeightChart(_selectedDay);
                }
            } else {
                eventData.querySelector('[data-value="checkbox"]').checked = false;
                toggle.innerHTML = "Cycle";
                // cardSelected.querySelector("[data-info='baitStateToggle']").style.setProperty("display","none");
                toggle.setAttribute("class", "inactiveToggle");
                _ToggledChartType = false;
                if (!_IsGraphOpened) {
                    CheckRender();
                }
                else {
                    cardSelected.querySelector('[data-info="chart"]').style.setProperty("display", "");
                    cardSelected.querySelector('[data-info="lineChart"]').style.setProperty("display", "none");
                    RenderCycleCount(_selectedDay);
                }
            }
            // else {
            //     eventData.querySelector('[data-value="checkbox"]').checked = false;
            //     toggle.innerHTML = "Motion";
            //     cardSelected.querySelector("[data-info='baitStateToggle']").style.setProperty("display","none");
            //     toggle.setAttribute("class", "inactiveToggle");
            //     _ToggledChartType = false;
            //     if (!_IsGraphOpened) {
            //         CheckRender();
            //     }
            //     else {
            //         cardSelected.querySelector('[data-info="chart"]').style.setProperty("display", "");
            //         cardSelected.querySelector('[data-info="lineChart"]').style.setProperty("display", "none");
            //         RenderMotionCounter(_selectedDay);
            //     }
            // }
        }

        function RenderChart(graphData) {
            _IsGraphOpened = false;
            _selectedDay = 0;
            selectedDay = 0;

            var chartjson = {
                "title": "Weekly Consumption",
                "data": [],
                "xtitle": "Bait Consumption",
                "ytitle": "Consumption in grams",
                "ymax": 100,
                "ykey": 'score',
                "xkey": "name"
            };

 
            var suffix;
            var lenght = graphData.length;
            var today = new Date();
            var last = 0;
            var maxVal = 0;
            for (var i = lenght; i > 0; i--) {
                today = new Date(today.setDate(new Date().getDate() - i));

                var date = graphData[i - 1].day;
                var day = date.getDay();
           
                if (last < parseInt(graphData[i - 1].value)) {
                    last = graphData[i - 1].value;
                }
                 
                var bindingVal;
                //If dates match
                if (date.getDate() === new Date().getDate()) {
                    //Only when rendering the taken/consumed data
                    if (_ToggledChartType) 
                    {
                
                            if (BaitState) {
                        
                                            //We devide the data for the day over the entered weight including the bar and conver it to a percent of consumption
                                    bindingVal = Math.round( (Math.round(parseFloat(graphData[i - 1].All)) / (parseInt(rowState[InnerRowId].EnteredWeight) - BarCompensation)) * 100)  
                                
                            }
                            else {
                                if(parseInt(graphData[i - 1].All) > maxVal)
                                {
                                    maxVal =Math.round(parseFloat(graphData[i - 1].All))
                                }
                                bindingVal =Math.round(parseFloat(graphData[i - 1].All)) //We take the whole value for the day 
                            }
                        
                    }
                    //Incase we render the timeseries motion count data
                    else 
                    {
                        bindingVal = Math.round(parseFloat(graphData[i - 1].All))
                    }
                }
                else {
                    //We devide the data for the day over the entered weight including the bar and conver it to a percent of consumption
                    if (_ToggledChartType) 
                    {
              
                            if (BaitState) 
                            {
                                //We devide the data for the day over the entered weight including the bar and conver it to a percent of consumption
                                bindingVal = Math.round((Math.round(parseFloat(graphData[i - 1].All)) / (parseInt(rowState[InnerRowId].EnteredWeight) - BarCompensation)) * 100)
                            }
                            else {
                                if(parseInt(graphData[i - 1].All) > maxVal)
                                {
                                    maxVal = Math.round(parseFloat(graphData[i - 1].All));
                                }
                                bindingVal = Math.round(parseFloat(graphData[i - 1].All));
                            }
                        
                    }
                    else 
                    {
                        bindingVal = Math.round(parseFloat(graphData[i - 1].All));
                    }
                }

                var cDate = date.getTime();
                var set = parseInt(activeRow["SetTime"]);
                if(BaitState && _ToggledChartType)
                {
                    if(cDate >= set)
                    {

                        chartjson.data.push({
                            "name": weekday[day] + " " + date.getDate(),
                            "score": bindingVal,
                            "key": graphData[i - 1].key,
                            "Day":date
                        });
                    }
                }
                else
                {
                    chartjson.data.push({
                            "name": weekday[day] + " " + date.getDate(),
                            "score": bindingVal,
                            "key": graphData[i - 1].key,
                            "Day":date

                        });
                }
                
            }
            if (last === 0 || last < 184) {
                last = 184;
            }

             
            //constants
            var TROW = 'tr',
                TDATA = 'td';
            var chart = document.createElement('div');

            chart.style.setProperty("height", "100%");
            //create the chart canvas
            var barchart = document.createElement('table');
            //create the title row
            //create the title data
            var titledata = document.createElement(TDATA);
            //make the colspan to number of records
            titledata.setAttribute('colspan', chartjson.data.length + 1);
            //titledata.setAttribute('class', 'charttitle');
            //titledata.innerText = chartjson.title;
            chart.appendChild(barchart);
            var legend = document.createElement("div");
            legend.setAttribute("class", "flex");

            //create the bar row
            var barrow = document.createElement(TROW);
            var tpmdata = {};
            tpmdata.data = [];
    
            var cDate = chartjson.data[0].Day;
            var daysData = [
                        {
                            "name": weekday[cDate.addDays(-6).getDay()]+ " "+ (cDate.addDays(-6).getDate()),
                            "score": 0,
                            "key": cDate.addDays(-6).getDate(),
                            "Day": 0,
                            "IsSet": false
                        },
                        {
                            "name": weekday[cDate.addDays(-5).getDay()]+ " "+ (cDate.addDays(-5).getDate()),
                            "score": 0,
                            "key": cDate.addDays(-5).getDate(),
                            "Day": 0,
                            "IsSet": false
                        },
                        {
                            "name": weekday[cDate.addDays(-4).getDay()]+ " "+ (cDate.addDays(-4).getDate()),
                            "score": 0,
                            "key": cDate.addDays(-4).getDate(),
                            "Day": 0,
                            "IsSet": false
                        },
                        {
                            "name": weekday[cDate.addDays(-3).getDay()]+ " "+ (cDate.addDays(-3).getDate()),
                            "score": 0,
                            "key": cDate.addDays(-3).getDate(),
                            "Day": 0,
                            "IsSet": false
                        },
                        {
                            "name": weekday[cDate.addDays(-2).getDay()]+ " "+ (cDate.addDays(-2).getDate()),
                            "score": 0,
                            "key": cDate.addDays(-2).getDate(),
                            "Day": 0,
                            "IsSet": false
                        },
                        {
                            "name": weekday[cDate.addDays(-1).getDay()]+ " "+ (cDate.addDays(-1).getDate()),
                            "score": 0,
                            "key": cDate.addDays(-1).getDate(),
                            "Day": 0,
                            "IsSet": false
                        },
                        {
                            "name": weekday[cDate.getDay()]+ " "+ cDate.getDate(),
                            "score": 0,
                            "key": cDate.getDate(),
                            "Day": 0,
                            "IsSet": false
                        }
            ]
             
            if(chartjson.data.length < 7 && !BaitState) 
            {
                var k = 1;
                var firstDate = chartjson.data[0].Day.addDays(-6);

                for(var i= 0; i < 7; i++)
                {
                    for(var currentData in  chartjson.data)
                    {
                        var record =  chartjson.data[currentData];
                        var cDay = chartjson.data[currentData].Day.getDay();
                        var fDay = firstDate.getDay();
                        // TODO use alternative check for the day
                        // if(record.key === parseInt(fDay))
                        // {
                        //     daysData[i].key = record.key;
                        //     daysData[i].Day = record.Day;
                        //     daysData[i].score = record.score;
                        //     daysData[i].name = record.name;
                        //     daysData[i].IsSet = true;
                        // }
                        // Check if the day is the same, replace the corresponding day
                        if (record.key === daysData[i].key) {
                            daysData[i].key = record.key;
                            daysData[i].Day = record.Day;
                            daysData[i].score = record.score;
                            // daysData[i].name = record.name;
                            daysData[i].IsSet = true;
                        }
                    }
               
                    // if(!daysData[i].IsSet)
                    // {
                    //     var ciDate =chartjson.data[0].Day;
                    //     ciDate = ciDate.addDays(-(chartjson.data[0].key-firstDate.getDay()));
                    //     if(daysData[ciDate.getDay() - 1] !== undefined)
                    //     {
                    //         daysData[ciDate.getDay() - 1].name = weekday[ciDate.getDay()] + " "+ firstDate.getDate();
                    //         daysData[ciDate.getDay() - 1].score = record.score;

                    //     }

                    // }
                  
                    firstDate = firstDate.addDays(1);
                }
                chartjson.data  = daysData;
              //  chartjson.data.push(tpmdata.data)
             }
             else if(BaitState)
             {
                chartjson.data =   chartjson.data.reverse();
             }
            else if(chartjson.data.length >= 7 && !BaitState)
            {
                chartjson.data =   chartjson.data.reverse();

            }
            //lets add data to the chart
            for (var i = 0; i < chartjson.data.length; i++) {
                barrow.setAttribute('class', 'bars');
                //create the bar data
                var bardata = document.createElement(TDATA);
                bardata.setAttribute('onclick', "BarItemClicked(" + chartjson.data[i]["key"] + "," + _ToggledChartType + ")");
                var bar = document.createElement('div');
                bar.setAttribute("style", "1");

                var legendData = document.createElement("span");
                legendData.setAttribute("class", "barLegend");
                legendData.innerHTML = chartjson.data[i].name;

                //   bar.setAttribute('class', colors[i]);
                if (_ToggledChartType) {
                    bar.setAttribute('class', "barColor");
                    if (BaitState) {
                        suffix = "%";

                    }
                    else {
                        suffix = "g";
                    }
                }
                else {
                    bar.setAttribute('class', "barColorMotion");
                    suffix = "";
                }

                var val = ((chartjson.data[i][chartjson.ykey] - last) * 100) / (last) * -1;
                val = (val - 100) * -1;
                if (isNaN(val)) {
                    bar.style.setProperty("height", "0%");
                    bardata.innerText = "--" + suffix;
                }
                else
                {
                    if(_ToggledChartType)
                    {
                        if(BaitState)
                        {
                            bar.style.setProperty("height", 100 - val  + "%");
                            bardata.innerText = 100 - (chartjson.data[i][chartjson.ykey]) + suffix;
                        }
                        else
                        {
                            bar.style.setProperty("height", ((val / maxVal) * 100) + "%");
                            bardata.innerText = chartjson.data[i][chartjson.ykey] + suffix;
                        }
                    }
                    else
                    {
                        bar.style.setProperty("height", val + "%");
                        bardata.innerText = chartjson.data[i][chartjson.ykey] + suffix;
                    }
                  
                }

                bar.onclick = BarItemClicked;
                bar.setAttribute("data-info", "1");

                bardata.appendChild(bar);
                barrow.appendChild(bardata);
                legend.appendChild(legendData);
            }

            barchart.appendChild(barrow);

            chart.appendChild(barchart);

            var cChart = cardSelected.querySelector('[data-info="chart"]');
            if (chartjson.data.length > 0) {
                cChart.style.setProperty("display", "");
                cardSelected.querySelector('[data-info="noChartData"]').style.setProperty("display", "none");
            }
            else {
                cChart.style.setProperty("display", "none");
            }
            chart.appendChild(legend);

            cChart.innerHTML = chart.outerHTML;
        

        }

        function GetEmptyHoursWeight() {
            return [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null]
        }

        function GetEmptyHours() {
            return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        }

        function RenderMotionCounter(day) {
            _selectedDay = day;
            var chartjson = {
                "title": "Weekly Consumption",
                "data": [],
                "xtitle": "Bait Consumption",
                "ytitle": "Consumption in grams",
                "ymax": 100,
                "ykey": 'score',
                "xkey": "name"
            };
            var last = 0;
            var source = [];
            var emptyIr = GetEmptyHours();
            var prevLow = 0;
            for (var item in _DaysSeriesIR[day].Source) {
                var currentIr = _DaysSeriesIR[day].Source[item];
                if (currentIr.value !== 0) {
                    emptyIr[currentIr.day.getHours()] = currentIr.value2;

                }
            }

            for (var item in emptyIr) {


                var current1 = emptyIr[item];
                if (current1 < 0 && current1 < prevLow && current1 !== null) {
                    prevLow = current1;
                }

                source.push(current1);

                //labels.push(current["time"]);

            }
            // source = GetEmptyHours();
            if (last === 0) {
                last = 200;
            }

            //constants
            var TROW = 'tr',
                TDATA = 'td';
            var chart = document.createElement('div');

            chart.style.setProperty("height", "100%");
            //create the chart canvas
            var barchart = document.createElement('table');
            //create the title row
            //create the title data
            var titledata = document.createElement(TDATA);
            //make the colspan to number of records
            titledata.setAttribute('colspan', chartjson.data.length + 1);
            //titledata.setAttribute('class', 'charttitle');
            //titledata.innerText = chartjson.title;
            chart.appendChild(barchart);
            var legend = document.createElement("div");
            legend.setAttribute("class", "flex");

            //create the bar row
            var barrow = document.createElement(TROW);

            //lets add data to the chart
            for (var i = 0; i < source.length; i++) {
                barrow.setAttribute('class', 'bars');
                //create the bar data
                var bardata = document.createElement(TDATA);
                var bar = document.createElement('div');
                bar.setAttribute("style", "1");

                var legendData = document.createElement("span");
                legendData.setAttribute("class", "barLegend");
                legendData.style.setProperty("padding-left", "0");
                legendData.style.setProperty("padding-right", "0");
                legendData.innerHTML = i + 1;

                var val = ((source[i] - last) * 100) / (last) * -1;
                val = (val - 100) * -1;
                bar.style.setProperty("height", val + "%");
                bar.onclick = BarItemClicked;
                bar.setAttribute("data-info", "1");
                bar.setAttribute('class', "barColorMotion");

                bardata.innerText = source[i];
                bardata.appendChild(bar);
                barrow.appendChild(bardata);
                legend.appendChild(legendData);
            }

            barchart.appendChild(barrow);

            chart.appendChild(barchart);

            var cChart = cardSelected.querySelector('[data-info="chart"]');
            if (source.length > 0) {
                cChart.style.setProperty("display", "");
                cardSelected.querySelector('[data-info="noChartData"]').style.setProperty("display", "none");
            }
            else {
                cChart.style.setProperty("display", "none");
            }


            var backBtn = document.createElement('span');
            backBtn.innerHTML = "Back";
            backBtn.setAttribute("id", "chartReturn");
            backBtn.setAttribute("onclick", "ReturnToChart()");
            backBtn.setAttribute("class", "postionChartButton");
            backBtn.style.setProperty("position", "relative");
            backBtn.style.setProperty("right", "0");

            chart.appendChild(legend);
            chart.appendChild(backBtn);

            cChart.innerHTML = chart.outerHTML;


        }

        function RenderCycleCount(day) {
            _selectedDay = day;
            var chartjson = {
                "title": "Weekly Cycle Count",
                "data": [],
                "xtitle": "Cycle Count",
                "ytitle": "Cycle Count",
                "ymax": 100,
                "ykey": 'score',
                "xkey": "name"
            };
            var last = 0;
            var source = [];
            var emptyIr = GetEmptyHours();
            var prevLow = 0;
            for (var item in _DaysSeriesCycle[day].Source) {
                var currentIr = _DaysSeriesCycle[day].Source[item];
                if (currentIr.value !== 0) {
                    emptyIr[currentIr.day.getHours()] = currentIr.value2;

                }
            }

            for (var item in emptyIr) {


                var current1 = emptyIr[item];
                if (current1 < 0 && current1 < prevLow && current1 !== null) {
                    prevLow = current1;
                }

                source.push(current1);

                //labels.push(current["time"]);

            }
            // source = GetEmptyHours();
            if (last === 0) {
                last = 200;
            }

            //constants
            var TROW = 'tr',
                TDATA = 'td';
            var chart = document.createElement('div');

            chart.style.setProperty("height", "100%");
            //create the chart canvas
            var barchart = document.createElement('table');
            //create the title row
            //create the title data
            var titledata = document.createElement(TDATA);
            //make the colspan to number of records
            titledata.setAttribute('colspan', chartjson.data.length + 1);
            //titledata.setAttribute('class', 'charttitle');
            //titledata.innerText = chartjson.title;
            chart.appendChild(barchart);
            var legend = document.createElement("div");
            legend.setAttribute("class", "flex");

            //create the bar row
            var barrow = document.createElement(TROW);

            //lets add data to the chart
            for (var i = 0; i < source.length; i++) {
                barrow.setAttribute('class', 'bars');
                //create the bar data
                var bardata = document.createElement(TDATA);
                var bar = document.createElement('div');
                bar.setAttribute("style", "1");

                var legendData = document.createElement("span");
                legendData.setAttribute("class", "barLegend");
                legendData.style.setProperty("padding-left", "0");
                legendData.style.setProperty("padding-right", "0");
                legendData.innerHTML = i + 1;

                var val = ((source[i] - last) * 100) / (last) * -1;
                val = (val - 100) * -1;
                bar.style.setProperty("height", val + "%");
                bar.onclick = BarItemClicked;
                bar.setAttribute("data-info", "1");
                bar.setAttribute('class', "barColorMotion");

                bardata.innerText = source[i];
                bardata.appendChild(bar);
                barrow.appendChild(bardata);
                legend.appendChild(legendData);
            }

            barchart.appendChild(barrow);

            chart.appendChild(barchart);

            var cChart = cardSelected.querySelector('[data-info="chart"]');
            if (source.length > 0) {
                cChart.style.setProperty("display", "");
                cardSelected.querySelector('[data-info="noChartData"]').style.setProperty("display", "none");
            }
            else {
                cChart.style.setProperty("display", "none");
            }


            var backBtn = document.createElement('span');
            backBtn.innerHTML = "Back";
            backBtn.setAttribute("id", "chartReturn");
            backBtn.setAttribute("onclick", "ReturnToChart()");
            backBtn.setAttribute("class", "postionChartButton");
            backBtn.style.setProperty("position", "relative");
            backBtn.style.setProperty("right", "0");

            chart.appendChild(legend);
            chart.appendChild(backBtn);

            cChart.innerHTML = chart.outerHTML;
        }

        function RenderWeightChart(day) {
            selectedDay = day;
            _selectedDay = day;
            cardSelected.querySelector('[data-info="chart"]').style.setProperty("display", "none");
            cardSelected.querySelector('[data-info="lineChart"]').style.setProperty("display", "");
            var labels = ["12am", "3am", "6am", "9am", "12pm", "3pm", "6pm", "9pm", "12am"];
            var source = [];
            var i = 1;

            var getEmptyHours = GetEmptyHoursWeight();

            var prevLow = 0;
             
            for (var item in _DaysSeriesWeight[day].Source) {

                var current = _DaysSeriesWeight[day].Source[item];

                if (BaitState) {
                    getEmptyHours[current.day.getHours()] = Math.round((current.value / (parseInt(rowState[InnerRowId].EnteredWeight) - BarCompensation)) * 100);
                }
                else {
                    getEmptyHours[current.day.getHours()] = current.value;
                }
            }

            for (var item in getEmptyHours) {


                var current = getEmptyHours[item];
                if (current < 0 && current < prevLow && current !== null) {
                    prevLow = current;
                }
                source.push(current);
                //labels.push(current["time"]);

            }



            var responsiveOptions = [
                ['screen and (min-width: 641px) and (max-width: 1024px)', {
                    showPoint: false,

                }],
                ['screen and (max-width: 640px)', {
                    showPoint: false,


                }]
            ];

            // Initialize a Line chart in the container with the ID chart1
            var lineChartController = new Chartist.Line(cardSelected.querySelector('[data-info="lineChart"]'), {
                series: [source]
            }, { height: 200, low: prevLow }, responsiveOptions);
            var lineChart = cardSelected.querySelector('[data-info="lineChart"]');
            var parent;

            parent = lineChart.querySelector('[data-info="labelHolder"]')
            if (parent !== null && parent !== undefined) {
                parent.innerHTML = "";
            }
            else {
                parent = document.createElement("div");
                parent.setAttribute("data-info", "labelHolder");
                parent.setAttribute("class", "labelsParent");
            }

            for (var hour in labels) {
                var labelElement = document.createElement("span");
                labelElement.innerHTML = labels[hour];
                labelElement.setAttribute("class", "alignCenter");
                parent.appendChild(labelElement);
            }





            var backBtn = document.createElement('span');
            backBtn.innerHTML = "Back";
            backBtn.setAttribute("id", "chartReturn");
            backBtn.setAttribute("onclick", "ReturnToChart()");
            backBtn.setAttribute("class", "postionChartButton");
            lineChart.appendChild(backBtn);
            lineChart.appendChild(parent);
        }

        function BarItemClicked(day, type) {
            if(BaitState && _ToggledChartType)
            {
                return;
            }
            _IsGraphOpened = true;
             
            if (type) {
               
                RenderWeightChart(day);
            }
            else {
                // RenderMotionCounter(day);
                RenderCycleCount(day);
            }
        }

        function ReturnToChart() {

            _selectedDay = 0;
            _IsGraphOpened = false;
            if (_ToggledChartType) {
                cardSelected.querySelector('[data-info="chart"]').style.setProperty("display", "");
                cardSelected.querySelector('[data-info="lineChart"]').style.setProperty("display", "none");
                CheckRender();

            }
            else {
                CheckRender();
            }
        }

        function HideCardIcons(card) {
            card.querySelector("[data-info='iconDummy']").style.setProperty("display", "none");
            card.querySelector("[data-info='iconSmart']").style.setProperty("display", "none");
        }

        function SetCardLineColor(card, value, treshold, tresholdUpper, querySelector) {
            card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGray")

            var parseVal = parseInt(value);
            if (parseVal <= treshold) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineRed")
                return;
            }
            else if (parseVal >= treshold && parseVal <= tresholdUpper) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineOrange")
            }
            else {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGreen")
            }
        }

        function SetCardLineColorFloat(card, value, treshold, tresholdUpper, querySelector) {
            card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGray")

            var parseVal = parseFloat(value);
            if (parseVal <= treshold) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineRed")
                return;
            }
            else if (parseVal > treshold && parseVal <= tresholdUpper) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineOrange")
            }
            else {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGreen")
            }
        }

        function SetCardLineColorPercentage(card, percentageValue, querySelector) {
            card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGray")

            if (percentageValue > 60) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGreen")
                return;
            }
            else if (percentageValue < 25) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineRed")
            }
            else {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineOrange")
            }
        }

        function SetCardLineColorOver(card, value, treshold, tresholdUpper, querySelector) {
            card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGray")

            var parseVal = parseInt(value);
            if (parseVal < treshold) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineRed")
                return;
            }
            else if (parseVal >= treshold && parseVal <= tresholdUpper) {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineOrange")
            }
            else {
                card.querySelector("[data-info='" + querySelector + "']").setAttribute("class", "UnderlineGreen")
            }
        }
        /**
         * Changes the visible counters on the screen.
         * @param packet
         */
        function ChangeCardHeaderType(packet) {

            UpdateCardSource(rowStateHeaders, packet, false);
            sortEvent({
                value: [
                    "State",
                    "false"
                ]
            });
        }


        /**
        * Changes the visible count pointer on the screen.
        * @param eventData - holds an integer value from 1 - 3  based on the active view.
        */
        function ChangeCardPointer(eventData) {

            if (isNaN(eventData)) {
                eventData = eventData.value;
            }
            UpdateCardPointer(rowStateHeaders, eventData);
            UpdateCardPointer(rowState, eventData);
        }

        function UpdateCardPointer(source, packet) {

            for (var row in source) {
                var currentRow = source[row];
                var card = currentRow["Card"];
                switch (packet) {
                    case 1:
                        card.querySelector("[data-value='status1Pos']").setAttribute("class", "underlineIndicatorLeft");
                        card.querySelector("[data-value='status2Pos']").setAttribute("class", "underlineIndicatorLeft");
                        card.querySelector("[data-value='status3Pos']").setAttribute("class", "underlineIndicatorLeft");
                        break;
                    case 2:
                        card.querySelector("[data-value='status1Pos']").setAttribute("class", "underlineIndicatorRight");
                        card.querySelector("[data-value='status2Pos']").setAttribute("class", "underlineIndicatorRight");
                        card.querySelector("[data-value='status3Pos']").setAttribute("class", "underlineIndicatorRight");
                        break;
                    case 3:
                        card.querySelector("[data-value='status1Pos']").setAttribute("class", "underlineIndicatorCenter");
                        card.querySelector("[data-value='status2Pos']").setAttribute("class", "underlineIndicatorCenter");
                        card.querySelector("[data-value='status3Pos']").setAttribute("class", "underlineIndicatorCenter");
                        break;
                }
            }
        }

        function UpdateCardSource(source, packet, isChild) {

            for (var row in source) {
                var currentRow = source[row];
                var card = currentRow["Card"];
                if (packet === 2 || packet.value === 2) {

                    card.querySelector("[data-info='lbl1']").innerHTML = "URGENT";
                    card.querySelector("[data-info='lbl2']").innerHTML = "IMPORTANT";
                    card.querySelector("[data-info='lbl3']").innerHTML = "NO ACTIVITY";
                    card.querySelector("[data-value='Urgent']").innerHTML = currentRow["Urgent"];
                    card.querySelector("[data-value='Important']").innerHTML = currentRow["Important"];
                    card.querySelector("[data-value='Minor']").innerHTML = currentRow["Minor"];
                    SelectedVisibleState = 2;

                    if (isChild) {
                        setAdvisory(card, currentRow);

                    }

                }
                else {

                    card.querySelector("[data-info='lbl1']").innerHTML = "URGENT";
                    card.querySelector("[data-info='lbl2']").innerHTML = "IMPORTANT";
                    card.querySelector("[data-info='lbl3']").innerHTML = "NO ACTIVITY";
                    card.querySelector("[data-value='Urgent']").innerHTML = currentRow["Danger"];
                    card.querySelector("[data-value='Important']").innerHTML = currentRow["Attention"];
                    card.querySelector("[data-value='Minor']").innerHTML = currentRow["NoAction"];
                    SelectedVisibleState = 1;

                    if (isChild) {
                        setSatus(card, currentRow);
                    }

                }

            }

            if (packet === 2) {
                sortCards({
                    value: "sadvisories"
                });

            }
            else {

                sortCards({
                    value: "State"
                });
            }
        }

        /**
         * Sorts the cards by the given column value.
         *
         * @param payload
         */
        function sortEvent(payload) {

            if (Array.isArray(payload.value) || typeof payload.value !== "string") {
                if (typeof payload.value[0] !== "string") {

                    throw new TypeError("Traps Card sort event expected an Array or string but found '" + typeof payload.value + "'.");
                }
                // else {
                //     payload.value = [payload.value[0]];
                // }
            }


            var validSorts = ["BaitName", "SetTime", "sstatus", "updateTime", "triggeredtime", "State", "technician", "StationId"];
            if (validSorts.indexOf(payload.value[0]) === -1) {
                throw new TypeError(payload.value + " is an invalid sort. Please use " + validSorts.join());
            }

            if (payload.value.length > 1) {
                var order = sortCards(rowState, payload.value[0], payload.value[1]);
            } else {
                var order = sortCards(rowState, payload.value[0], false);
            }
            console.log("Order: " + order);

            reorderCards(order);
        }


        /**
         * Reorders the cards in the table.
         * @param order
         */
        function reorderCards(order) {
            for (var i = 0; i < order.length; i++) {
                cardSelectedParent.appendChild(rowElems[order[i]].parentElement);
            }
        }

        /**
         * The sort function used for sorting the cards. This is a custom function per card application.
         * @param data Data object containing the state of all the cards.
         * @param sortType Field inside the object to sort by.
         */
        function sortCards(data, sortType, asc) {

            var dataKeys = Object.keys(data);
            // asc = false;

            if (asc === false) {
                return dataKeys.sort(function (firstKey, secondKey) {

                    var first = data[firstKey];
                    var second = data[secondKey];

                    if (first["State"] > second["State"]) {
                        return -1;
                    } else if (first["State"] == second["State"]) {
                        // if states are equal, sort by calculated weight % (lowest first)
                        if (parseInt(first["CalculatedWeight"]) < parseInt(second["CalculatedWeight"])) {
                            return -1;
                            // need the OR statement if both parameters are undefined
                        } else if (parseInt(first["CalculatedWeight"]) == parseInt(second["CalculatedWeight"]) || first["CalculatedWeight"] == second["CalculatedWeight"]) {
                            
                            // if states and CalculatedWeight % are both equal, sort by active cycle
                            if (parseInt(first["Hours"]) > parseInt(second["Hours"])) {
                                return -1;
                            // need the OR statement if both parameters are undefined
                            } else if (parseInt(first["Hours"]) == parseInt(second["Hours"]) || first["Hours"] == second["Hours"]) {
                                return 0;

                            } else {
                                return 1;
                            }

                        } else {
                            return 1;
                        }
                    
                    } else {
                        return 1;
                    }

                });
            } else {
                return dataKeys.sort(function (firstKey, secondKey) {
                    var first = data[firstKey];
                    var second = data[secondKey];
                    
                    return first[sortType] - second[sortType];

                });
            }
        }



        function addCard(id, card) {
            tableBody = document.getElementById("tbody");
            var row = document.createElement("tr");
            row.appendChild(card);
            row.setAttribute("data-id", id);
            tableBody.appendChild(row);
        }


        function AddCardChild(id, card, parent, status) {

            var cardBody = parent.querySelector("[data-selector='Traps']");
            var row = document.createElement("div");
            row.appendChild(card);
            row.setAttribute("data-id", id);
            if(status)
                row.setAttribute("data-status", status);
            if(showActive && status == '0'){
                row.style.display = 'none';
            }
            cardBody.appendChild(row);
            activeCards.push(card);
        }


        function deleteCard(id) {


            var container = document.getElementById("body");
            var card = container.querySelector("[data-id='" + id + "']");
            if (card !== null) {
                card.remove();
                delete rowElems[id];
            }
        }


        function updateValue(id, stat, value) {
            var row = document.querySelector("[data-id='" + id + "']");
            var statElem = row.querySelector("[data-value='" + stat + "']").innerHTML = value;
        }

        // API actions for dashboard mode
        function fw_dashStart(mode) {

            if (mode !== "DASHBOARD") {
                document.getElementsByTagName("html")[0].style.setProperty("background-color", "grey");
            }



            return "OK";
        }


        // API startup actions for toolbox. Return "OK" if startup OK else return an error string
        function fw_toolStart(mode) {

            var battery = document.getElementById("currentBattery");
            return "OK";
        }

        // API startup actions when first created by dropping in design mode. Return "OK" if startup OK else return an error string
        function fw_newWidget(mode) {
            return fw_dashStart();
        }

        // API called when switching to design mode (optional, delete if not using)
        function fw_startDesign() {
            return true;
        }

        // API called to manage scaling
        function fw_scale(scaleX, scaleY) {
            if (options !== undefined) {
                fw.widgetID.style.setProperty("width", (options.settings.iniWidth * scaleX) + "px");
                fw.widgetID.style.setProperty("height", (options.settings.iniHeight * scaleY) + "px");
                //  battery.setAttribute("transform", "scale(" + 0.5 + "," + 0.5 + ")");
                //  numVal.setAttribute("transform", "scale(" + 0.5 + "," + 0.5 + ")");

            }


            return true;
        }

        // API called when widget edit starts (return false to stop editor, "NOSCALE", "NOVERT", "NOHORIZ", "NOVERT,NOHORIZ" to customise scaling)
        function fw_startEdit() {
            return true;
        }

        // API called when widget edit finishes (apply edit changes here)
        function fw_endEdit(mode) {
        }

        function fw_db(channel, scope, data) {

        }

        // API called for incoming channel events
        function fw_feed(channel, scope, data) {
            if (scope === "DEVICEOFFLINE") {
                try {
                    var getRow = GetRowByDeviceName(data.value);
                    var row = rowElems[getRow["rowId"]];
                    row.querySelector("[data-info='deviceErrorStatus']").style.setProperty("display", "");
                    setState(row, CardState.UrgentRed);
                }
                catch (e) {
                    throw new TypeError("Device not found :" + typeof eventData.value);
                }
            }
            else if(channel.split("/")[3] === "P2ENABLED")
            {
                 
                BaitEnalbed(channel.split("/")[2], data.value);
            }

            try {


                //var sensorData  = dataPacket; // Debug only
                var sensorData = JSON.parse(data.value); // Production reading
                var getRow = GetRowBySid(sensorData.sid);
                console.log(sensorData);
                if (getRow !== null) {

                    var row = rowElems[getRow["rowId"]];
                    var date = new Date(sensorData.timestamp).toLocaleString();
                    var d = date.split(", ");
                    var d0 = d[0].split("/");
                    d0[2] = d0[2] - 2000;
                    d0 = d0.join("/");
                    var deviceType = rowState[getRow["rowId"]]["DeviceType"];
                    var currentWeight;

                    if (scope.toLowerCase() === "sensordata2") {
                        currentWeight = evenRound(parseInt(sensorData.Weight) - BarCompensation);

                    }
                    else {
                        currentWeight = evenRound((parseInt(sensorData.data.weight1) / 10) - BarCompensation);
                    }

                    if (currentWeight < 0) {
                        currentWeight = 0;
                    }

                    rowState[getRow["rowId"]]["BaitRate"] = currentWeight;

                    row.querySelector("[data-value='Dial']").innerHTML = currentWeight + "g";
                    if (deviceType === "1") {
                        //   SetCardLineColor(row, currentWeight, baitThreshold, baitThresholdUpper, "UnderlineBait");
                    }
                    row.querySelector("[data-info='deviceErrorStatus']").style.setProperty("display", "none");

                    var dBm = parseInt(sensorData.data.signal);
                    //This is the lora signal strenght so it has a negative "DBM"
                    var quality;
                    quality = CheckSignalStrenght(dBm);
                    let qualityRange = CheckSignalStrengthRange(dBm);
                    row.querySelector("[data-value='SignalStrenght']").innerHTML = quality.toFixed() + "%";
                    // row.querySelector("[data-value='SignalStrenght']").innerHTML = qualityRange;
                    SetCardLineColorOver(row, quality, 30, 60, "UnderlineSignal");
                    var currentHours = 0;
                    var sensorHours = 0;
                    if (parseInt(row.querySelector("[data-value='Hours']").innerHTML) !== 0) {
                        currentHours = parseInt(row.querySelector("[data-value='Hours']").innerHTML);
                    }

                    if (isNaN(parseInt(row.querySelector("[data-value='Hours']").innerHTML))) {
                        currentHours = 0;
                    }

                    var sensorHoursError = false;

                    var left = parseInt(dataPacket.data.counter1);
                    var right = parseInt(dataPacket.data.counter2);
                    if (dataPacket.data.counter1 === "0" && dataPacket.data.counter2 === "0") {
                        sensorHours = parseInt(selected[2]);
                        updateTime = selected[6];
                    }
                    else {
                        if (left > 0 || right > 0) {
                            if (left > 0 && right > 0) {
                                justSensors = left + right;
                                sensorHours = currentHours + (left + right);
                            }
                            else if (left < 0 && right > 0) {
                                justSensors = right;
                                sensorHours = currentHours + right;
                            }
                            else {
                                justSensors = left;
                                sensorHours = currentHours + left;
                            }
                            updateTime = dataPacket.timestamp;
                        }
                        else if (left < 0 && right < 0) {
                            sensorHoursError = true;
                            row.querySelector("[data-value='Hours']").innerHTML = "--";
                            row.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGray")
                        }
                        else {
                            sensorHours = currentHours;
                        }
                    }

                    if (!sensorHoursError) {
                        if (isNaN(sensorHours)) {
                            sensorHours = 0;
                            row.querySelector("[data-value='Hours']").innerHTML = "0";
                        }

                        row.querySelector("[data-value='Hours']").innerHTML = sensorHours;
                        if (sensorHours >= triggerTresholdUpper) {
                            row.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineRed");
                        }
                        else if (sensorHours >= triggerTreshold && sensorHours <= triggerTresholdUpper) {
                            row.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineOrange");
                        }
                        else if (sensorHours < 0) {
                            row.querySelector("[data-value='Hours']").innerHTML = "--";
                            row.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineRed");
                        }
                        else {
                            row.querySelector("[data-info='UnderlineHours']").setAttribute("class", "UnderlineGreen");
                        }
                    }


                    //Convert MV to V - 4 times 1.5v batteries.
                    var batteryRaw = (sensorData.data.batterymv / 6500).toFixed(2);
                    var battery = Math.min(100, ((parseFloat(batteryRaw) + 0.005) * 100));

                    row.querySelector("[data-section='BatteryVal']").innerHTML = parseInt(battery) + "%";

                    SetCardLineColorFloat(row, battery, 45, 65, "UnderlineBattery");
                    var id = getRow.Id;

                    if (rowState[id]["exiperyRisen"] === true) {
                        return;
                    }
                    var foodItem;
                    activeDropdowndataSources.forEach(current => {
                        if (current.Name === "BaitType") {
                            current.Values.forEach(x => {
                                if (x.Name === rowState[id]["BaitName"]) {
                                    foodItem = x;
                                }
                            });
                        }
                    });
                    var sidebarStateVal = CheckRowState(currentWeight, sensorHours, rowState[getRow["rowId"]]["DeviceError"], getRow["rowId"]);

                    if (sidebarStateVal !== null && rowState[id]["DeviceType"] === "1") {

                        if (sidebarStateVal === CardState.NormalGreen || sidebarStateVal === CardState.ImportantYellow) {


                            var date = new Date();
                            var foodDate;
                            var foodDateVal = rowState[id]["FoodDateVal"];
                            if (foodDateVal !== "") {



                                foodDate = new Date(foodDateVal);

                                const diffTime = foodDate - date;
                                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                rowState[id].Card.querySelector("[data-value='Duration']").innerHTML = diffDays + "d";
                                SetCardLineColor(rowState[id].Card, diffDays, parseInt(foodItem.LowerThreshold), parseInt(foodItem.UpperThreshold), "UnderlineDuration");

                                var updatedVal = CheckRowStateManul(diffDays, parseInt(foodItem.LowerThreshold), parseInt(foodItem.UpperThreshold), id);
                                // if the updated val has a higher priority, then update the state value
                                if (isHigherUrgency(sidebarStateVal, updatedVal)) {
                                    setState(id, updatedVal);
                                }
                                else {
                                    switch (sidebarStateVal) {
                                        case CardState.ImportantYellow:
                                            setState(id, CardState.ImportantYellow);

                                            break;
                                        case CardState.UrgentRed:
                                            setState(id, CardState.UrgentRed);

                                            break;
                                    }
                                }


                            }
                        }
                    }
                    ChangeHeaderValue();



                }
            } catch (e) {
                throw new TypeError("Expected a string but found " + typeof data.value);
            }

        }

        function CheckSignalStrenght(dBm) {
            if (dBm < -120) {
                //  console.log("Signal is 10");
                return 10;
            }

            if (dBm < -115) {
                //    console.log("Signal is 20");
                return 20;
            }

            if (dBm < -111) {
                //  console.log("Signal is 30");
                return 30;
            }

            if (dBm < -107) {
                //    console.log("Signal is 40");
                return 40;
            }

            if (dBm < -101) {
                //   console.log("Signal is 50");
                return 50;
            }

            if (dBm < -95) {
                //  console.log("Signal is 60");
                return 60;
            }

            if (dBm < -90) {
                //  console.log("Signal is 70");
                return 70;
            }

            if (dBm > -90) {
                //   console.log("Signal is 100");
                return 100;
            }
        }

        function CheckSignalStrengthRange(dBm) {
            if (dBm < -110) {
                return "Low";
            }

            if (dBm <= -90) {
                return "Medium";
            }

            if (dBm > -90) {
                return "High";
            }
        }

        function CheckRender() {
            if (_WeightLoaded && _CycleLeftLoaded && _CycleRightLoaded) {//) && _WeightLoaded) {

                if (_ToggledChartType) {

                    if (_selectedDay !== 0) {
                        BarItemClicked(selectedDay);
                    }
                    else {
                        if (BaitState) {

                        }

                        RenderChart(averagesWeight.sort(function (a, b) {
                            // Turn your strings into dates, and then subtract them
                            // to get a value that is either negative, positive, or zero.
                            var diff = b.timestamp - a.timestamp;
                            return diff;
                        }).reverse());
                    }


                }
                else {
                    if (_selectedDay !== 0) {
                        BarItemClicked(selectedDay);
                    }
                    else {
                        RenderChart(averagesCycle.sort(function (a, b) {
                            // Turn your strings into dates, and then subtract them
                            // to get a value that is either negative, positive, or zero.
                            var diff = b.timestamp - a.timestamp;
                            return diff;
                        }).reverse());
                        // RenderChart(AveragesIR.sort(function (a, b) {
                        //     // Turn your strings into dates, and then subtract them
                        //     // to get a value that is either negative, positive, or zero.
                        //     var diff = b.timestamp - a.timestamp;
                        //     return diff;
                        // }).reverse());
                    }


                }
            }
        }


        function fw_history(channel, scope, data) {
             
            var deviceName = channel.split("/");

            if (deviceName[3] === "BAITTAKEN") {
                PopulateWeight(deviceName, data);
            // } else if (deviceName[3] === "COUNTERTOTAL") {
            //     populateCounter(deviceName, data);
            } else if (deviceName[3] === "ACTIVECYCLELEFT" || deviceName[3] === "ACTIVECYCLERIGHT") {
                if (deviceName[3] === "ACTIVECYCLELEFT") {
                    _CycleLeftLoaded = true;
                } else {
                    _CycleRightLoaded = true;
                }
                PopulateCycle(deviceName, data);
            }
        }
        var activeRow;
        function populateCounter(deviceName, data) {

            var getRow = GetRowByDeviceName(deviceName[2]);

            if (getRow === undefined || getRow === null) {
                return;
            }
            activeRow = getRow;

            if (getRow["Card"] === cardSelected) {
                _TimeSeriesData["Counter"] = data.value;//data;//
                AssignIrSeries("Counter");
                AveragesIR = GetLastForDay(_DaysSeriesIR);
                _IrLoaded = true;
                CheckRender();
            }
        }

        function PopulateWeight(deviceName, data) {
            var getRow = GetRowByDeviceName(deviceName[2]);

            if (getRow === undefined || getRow === null) {
                return;
            }
            activeRow = getRow;

            if (getRow["Card"] === cardSelected) {
                _TimeSeriesData["Weight"] = data.value;//data;//
                AssignSeries("Weight");
               
                averagesWeight = GetLastForDay(_DaysSeriesWeight);
                _WeightLoaded = true;
                CheckRender();
            }
        }

        function PopulateCycle(deviceName, data) {
            var getRow = GetRowByDeviceName(deviceName[2]);

            if (getRow === undefined || getRow === null) {
                return;
            }
            activeRow = getRow;

            if (getRow["Card"] === cardSelected) {
                _TimeSeriesData["Cycle"] = _TimeSeriesData["Cycle"].concat(data.value);
                
                if (_CycleRightLoaded && _CycleLeftLoaded) {
                    var dayseries = {};
                    for (var item in _TimeSeriesData["Cycle"]) {
                        let time = new Date(_TimeSeriesData["Cycle"][item][0]);
                        let value = parseInt(_TimeSeriesData["Cycle"][item][1]);

                        if (!(time.getDate() in dayseries)) {
                            dayseries[time.getDate()] = {
                                value: 0,
                                day: time,
                                key: time.getDate(),
                                time: _TimeSeriesData["Cycle"][item][0],
                                timestamp: time.getTime()
                            };
                        }
                        dayseries[time.getDate()].value += value;
                    }
                    averagesCycle = [];
                    for (var day in dayseries) {
                        averagesCycle.push({
                            All: dayseries[day].value,
                            key: day,
                            time: dayseries[day].time,
                            timestamp: dayseries[day].timestamp,
                            day: dayseries[day].day
                        });
                    }
                    AssignCycleSeries("Cycle");
                    // averagesCycle = GetLastForDay(_DaysSeriesCycle);
                    CheckRender();
                }
            }
        }

        function AssignIrSeries(type) {
            var lastDate;
            _DaysSeriesIR = {};
            var hour;
            var localdata = [];
            var result = [];
            var index = -1;
            var totalForHour = 0;
            var isFirst = true;
            var date;
            var day;
             
            for (var item in _TimeSeriesData[type]) {
                var serie = _TimeSeriesData[type][item];
                var cDate = new Date(serie[0]).getTime();
                var set = parseInt(activeRow["SetTime"]);
                
                
                date = new Date(serie[0]);

                var totalForDay;
                if (lastDate === undefined) {
                    totalForDay = 0;
                    lastDate = date.getDate();
                    _DaysSeriesIR[date.getDate()] = {};
                }

                if (date.getDate() != lastDate) {
                    totalForDay = 0;
                    totalForHour = 0;
                    localdata = [];
                    lastDate = date.getDate();
                    _DaysSeriesIR[date.getDate()] = {};
                    day = new Date(serie[0]);

                    if (hour === undefined) {
                        hour = day.getHours();
                    }
                    var ir = serie[1];
                    isFirst = true;
                    if (hour !== day.getHours() || isFirst) {
                        hour = day.getHours();
                        index++;
                        localdata.push({
                            time: serie[0],
                            value: totalForDay,
                            value2: totalForHour + parseInt(ir),
                            day: day,
                            key: date.getDate(),
                            timestamp: day.getTime(),

                        });

                        _DaysSeriesIR[date.getDate()]["Source"] = localdata;
                        if (isFirst) {
                            totalForHour =parseInt(ir);
                            totalForDay = parseInt(ir);
                        } else {
                            totalForHour = 0;
                            totalForDay = 0;
                        }
                        isFirst = false;                  
                    }
                } else {
                    day = new Date(serie[0]);
                    if (hour === undefined) {
                        hour = day.getHours();
                    }
                    var ir = serie[1];
                    if (hour !== day.getHours() || isFirst) {

                        hour = day.getHours();

                        index++;
                        localdata.push({
                            time: serie[0],
                            value: totalForDay,
                            value2: totalForHour + parseInt(ir),
                            day: day,
                            key: date.getDate(),
                            timestamp: day.getTime(),

                        });

                        _DaysSeriesIR[date.getDate()]["Source"] = localdata;
                        if (isFirst) {
                            totalForHour = parseInt(ir);
                            totalForDay = parseInt(ir);
                        } else {
                            totalForHour = 0;
                            totalForDay = 0;
                        }
                        isFirst = false;

                    } else {
                        if (parseInt(ir) > 0) {
                            totalForHour += parseInt(ir);
                            totalForDay += parseInt(ir);
                        }
                    }
                } 
            }
            localdata.push({
                time: serie[0],
                value: totalForDay,
                value2: totalForHour + parseInt(ir),
                day: day,
                key: date.getDate(),
                timestamp: day.getTime(),

            });

            _DaysSeriesIR[date.getDate()]["Source"] = localdata;
        }

        function AssignCycleSeries(type) {
            var lastDate;
            // _DaysSeriesCycle = {};
            var hour;
            var localdata = [];
            var result = [];
            var index = -1;
            var totalForHour = 0;
            var isFirst = true;
            var date;
            var day;
            var readingsForHour;

            for (var item in _TimeSeriesData[type]) {
                var serie = _TimeSeriesData[type][item];
                var cDate = new Date(serie[0]).getTime();
                var set = parseInt(activeRow["SetTime"]);
                
                date = new Date(serie[0]);

                var totalForDay;
                if (lastDate === undefined) {
                    totalForDay = 0;
                    lastDate = date.getDate();
                    _DaysSeriesCycle[date.getDate()] = {};
                }

                if (date.getDate() != lastDate) {
                    totalForDay = 0;
                    totalForHour = 0;
                    localdata = [];
                    lastDate = date.getDate();
                    _DaysSeriesCycle[date.getDate()] = {};
                    day = new Date(serie[0]);

                    if (hour === undefined) {
                        hour = day.getHours();
                    }
                    var ir = serie[1];
                    isFirst = true;
                    if (hour !== day.getHours() || isFirst) {
                        hour = day.getHours();
                        index++;
                        localdata.push({
                            time: serie[0],
                            value: totalForDay,
                            value2: totalForHour + parseInt(ir),
                            day: day,
                            key: date.getDate(),
                            timestamp: day.getTime(),

                        });

                        // _DaysSeriesIR[date.getDate()]["Source"] = localdata;
                        if (!("Source" in _DaysSeriesCycle[date.getDate()])) {
                            _DaysSeriesCycle[date.getDate()]["Source"] = [];
                        }
                        _DaysSeriesCycle[date.getDate()]["Source"] = _DaysSeriesCycle[date.getDate()]["Source"].concat(localdata);
                        if (isFirst) {
                            totalForHour =parseInt(ir);
                            totalForDay = parseInt(ir);
                        } else {
                            totalForHour = 0;
                            totalForDay = 0;
                        }
                        isFirst = false;                  
                    }
                } else {
                    day = new Date(serie[0]);
                    if (hour === undefined) {
                        hour = day.getHours();
                    }
                    var ir = serie[1];
                    if (hour !== day.getHours() || isFirst) {

                        hour = day.getHours();

                        index++;
                        localdata.push({
                            time: serie[0],
                            value: totalForDay,
                            value2: totalForHour + parseInt(ir),
                            day: day,
                            key: date.getDate(),
                            timestamp: day.getTime(),

                        });

                        if (!("Source" in _DaysSeriesCycle[date.getDate()])) {
                            _DaysSeriesCycle[date.getDate()]["Source"] = [];
                        }
                        _DaysSeriesCycle[date.getDate()]["Source"] = _DaysSeriesCycle[date.getDate()]["Source"].concat(localdata);
                        if (isFirst) {
                            totalForHour = parseInt(ir);
                            totalForDay = parseInt(ir);
                        } else {
                            totalForHour = 0;
                            totalForDay = 0;
                        }
                        isFirst = false;

                    } else {
                        if (parseInt(ir) > 0) {
                            totalForHour += parseInt(ir);
                            totalForDay += parseInt(ir);
                        }
                    }
                } 
            }
            localdata.push({
                time: serie[0],
                value: totalForDay,
                value2: totalForHour + parseInt(ir),
                day: day,
                key: date.getDate(),
                timestamp: day.getTime(),

            });

            if (!("Source" in _DaysSeriesCycle[date.getDate()])) {
                _DaysSeriesCycle[date.getDate()]["Source"] = [];
            }
            _DaysSeriesCycle[date.getDate()]["Source"] = _DaysSeriesCycle[date.getDate()]["Source"].concat(localdata);
        }

        function AssignSeries(type) {
            var lastDate;
            _DaysSeriesWeight = {};
            var hour;
            var localdata = [];
            var result = [];
            var isFirst = true;
            var index = -1;
            var readingsForHour ;
            var date;
            var day;
            for (var item in _TimeSeriesData[type]) {
                var serie = _TimeSeriesData[type][item];
        
                date = new Date(serie[0]);

                if (lastDate === undefined) {
                    lastDate = date.getDate();
                    _DaysSeriesWeight[date.getDate()] = {};
                }

                if (date.getDate() != lastDate) {
                    readingsForHour = 0;
                    localdata = [];
                    lastDate = date.getDate();
                    _DaysSeriesWeight[date.getDate()] = {};
                    isFirst = true;
                    var day = new Date(serie[0]);

                    if (hour === undefined) {
                        hour = day.getHours();
                        readingsForHour = 0;
                    }
                    var currentWeight = parseFloat(serie[1]);
                    if (currentWeight <= 0) {
                        currentWeight = 0;
                    }

                    if (hour !== day.getHours() || isFirst) {
                        hour = day.getHours();
                        index++;
                        localdata.push({
                            time: serie[0],
                            value: readingsForHour + currentWeight,
                            day: day,
                            key: date.getDate(),
                            timestamp: day.getTime(),
                        });

                        _DaysSeriesWeight[date.getDate()]["Source"] = localdata;
                        if (isFirst) {
                            readingsForHour = currentWeight;
                        } else {
                            readingsForHour = 0;
                        }
                        isFirst = false;
                    }
                } else {
                    day = new Date(serie[0]);
                    if (hour === undefined) {
                        hour = day.getHours();
                        readingsForHour = 0;
                    }
                    var currentWeight = parseFloat(serie[1]);
                    if (currentWeight <= 0) {
                            
                        currentWeight = 0;
                    }
                    
                    if (hour !== day.getHours() || isFirst) {
                        hour = day.getHours();
                        index++;
                        localdata.push({
                            time: serie[0],
                            value: readingsForHour + currentWeight,
                            day: day,
                            key: date.getDate(),
                            timestamp: day.getTime(),
                        });

                        _DaysSeriesWeight[date.getDate()]["Source"] = localdata;
                        if (isFirst)
                            readingsForHour = currentWeight;
                        else
                            readingsForHour = 0;
                        isFirst = false;
                    } else {
                        readingsForHour += currentWeight;
                    }

                }
                
            }
            index++;
            localdata.push({
                time: serie[0],
                value: readingsForHour + currentWeight,
                day: day,
                key: date.getDate(),
                timestamp: day.getTime(),
            });
            _DaysSeriesWeight[date.getDate()]["Source"] = localdata;

        }

        function GetLastForDay(dataSource) {

            var result = [];


            for (var item in dataSource) {
                var day = dataSource[item];
                var source = day["Source"];
                if (source !== undefined) {
                    var val = 0;
                    source.forEach(x => {
                        val += parseFloat(x.value);
                    });
                    source[0].All = val;
                    result.push(source[0]);
                }
            }

            return result;
        }

        function GetSummaryForDay(dataSource) {

            var result = [];


            for (var item in dataSource) {
                var day = dataSource[item];
                var source = day["Source"];
                if (source !== undefined) {
                    result.push(source[source.length - 1]);
                }
            }

            return result;
        }


        function evenRound(num, decimalPlaces) {
            var d = decimalPlaces || 0;
            var m = Math.pow(10, d);
            var n = +(d ? num * m : num).toFixed(8); // Avoid rounding errors
            var i = Math.floor(n), f = n - i;
            var e = 1e-8; // Allow for rounding errors in f
            var r = (f > 0.5 - e && f < 0.5 + e) ?
                ((i % 2 == 0) ? i : i + 1) : Math.round(n);
            return d ? r / m : r;
        }
        function GetAvgForDay() {
            var result = [];


            for (var item in _DaysSeriesWeight) {
                var day = _DaysSeriesWeight[item];

                result.push(day["Source"].reduce((a, b) => (a.value + b.value)) / day["Source"].length);
            }

            return result;
        }

        // Initialize widget framework API - DO NOT ADJUST OR DELETE
        var fw = new parent.widgetAPI(window.name);  // widget framework object
        fw.ready();

        function convertUTCDateToLocalDate(date) {
            var newDate = new Date(date.getTime() - date.getTimezoneOffset() * 60 * 1000);
            return newDate;
        }
    </script>
</body>
</html>
